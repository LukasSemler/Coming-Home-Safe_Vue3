var bb=Object.defineProperty,wb=Object.defineProperties;var Eb=Object.getOwnPropertyDescriptors;var wd=Object.getOwnPropertySymbols;var Iy=Object.prototype.hasOwnProperty,Cy=Object.prototype.propertyIsEnumerable;var Sy=(a,d,g)=>d in a?bb(a,d,{enumerable:!0,configurable:!0,writable:!0,value:g}):a[d]=g,si=(a,d)=>{for(var g in d||(d={}))Iy.call(d,g)&&Sy(a,g,d[g]);if(wd)for(var g of wd(d))Cy.call(d,g)&&Sy(a,g,d[g]);return a},hn=(a,d)=>wb(a,Eb(d));var wo=(a,d)=>{var g={};for(var A in a)Iy.call(a,A)&&d.indexOf(A)<0&&(g[A]=a[A]);if(a!=null&&wd)for(var A of wd(a))d.indexOf(A)<0&&Cy.call(a,A)&&(g[A]=a[A]);return g};function Om(a,d){const g=Object.create(null),A=a.split(",");for(let w=0;w<A.length;w++)g[A[w]]=!0;return d?w=>!!g[w.toLowerCase()]:w=>!!g[w]}const Tb="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Sb=Om(Tb);function Xx(a){return!!a||a===""}function Um(a){if(Xt(a)){const d={};for(let g=0;g<a.length;g++){const A=a[g],w=fr(A)?Mb(A):Um(A);if(w)for(const S in w)d[S]=w[S]}return d}else{if(fr(a))return a;if(mr(a))return a}}const Ib=/;(?![^(]*\))/g,Cb=/:(.+)/;function Mb(a){const d={};return a.split(Ib).forEach(g=>{if(g){const A=g.split(Cb);A.length>1&&(d[A[0].trim()]=A[1].trim())}}),d}function Vm(a){let d="";if(fr(a))d=a;else if(Xt(a))for(let g=0;g<a.length;g++){const A=Vm(a[g]);A&&(d+=A+" ")}else if(mr(a))for(const g in a)a[g]&&(d+=g+" ");return d.trim()}const FI=a=>fr(a)?a:a==null?"":Xt(a)||mr(a)&&(a.toString===Kx||!ci(a.toString))?JSON.stringify(a,Hx,2):String(a),Hx=(a,d)=>d&&d.__v_isRef?Hx(a,d.value):ic(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((g,[A,w])=>(g[`${A} =>`]=w,g),{})}:Qx(d)?{[`Set(${d.size})`]:[...d.values()]}:mr(d)&&!Xt(d)&&!Jx(d)?String(d):d,Vi={},tc=[],to=()=>{},kb=()=>!1,zb=/^on[^a-z]/,Kd=a=>zb.test(a),jm=a=>a.startsWith("onUpdate:"),zr=Object.assign,Nm=(a,d)=>{const g=a.indexOf(d);g>-1&&a.splice(g,1)},Pb=Object.prototype.hasOwnProperty,Ii=(a,d)=>Pb.call(a,d),Xt=Array.isArray,ic=a=>Jd(a)==="[object Map]",Qx=a=>Jd(a)==="[object Set]",ci=a=>typeof a=="function",fr=a=>typeof a=="string",$m=a=>typeof a=="symbol",mr=a=>a!==null&&typeof a=="object",Yx=a=>mr(a)&&ci(a.then)&&ci(a.catch),Kx=Object.prototype.toString,Jd=a=>Kx.call(a),Db=a=>Jd(a).slice(8,-1),Jx=a=>Jd(a)==="[object Object]",Gm=a=>fr(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,Ld=Om(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ep=a=>{const d=Object.create(null);return g=>d[g]||(d[g]=a(g))},Bb=/-(\w)/g,Io=ep(a=>a.replace(Bb,(d,g)=>g?g.toUpperCase():"")),Lb=/\B([A-Z])/g,cc=ep(a=>a.replace(Lb,"-$1").toLowerCase()),tp=ep(a=>a.charAt(0).toUpperCase()+a.slice(1)),jf=ep(a=>a?`on${tp(a)}`:""),Zu=(a,d)=>!Object.is(a,d),Rd=(a,d)=>{for(let g=0;g<a.length;g++)a[g](d)},Nd=(a,d,g)=>{Object.defineProperty(a,d,{configurable:!0,enumerable:!1,value:g})},$d=a=>{const d=parseFloat(a);return isNaN(d)?a:d};let My;const Rb=()=>My||(My=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let Jo;class ev{constructor(d=!1){this.active=!0,this.effects=[],this.cleanups=[],!d&&Jo&&(this.parent=Jo,this.index=(Jo.scopes||(Jo.scopes=[])).push(this)-1)}run(d){if(this.active)try{return Jo=this,d()}finally{Jo=this.parent}}on(){Jo=this}off(){Jo=this.parent}stop(d){if(this.active){let g,A;for(g=0,A=this.effects.length;g<A;g++)this.effects[g].stop();for(g=0,A=this.cleanups.length;g<A;g++)this.cleanups[g]();if(this.scopes)for(g=0,A=this.scopes.length;g<A;g++)this.scopes[g].stop(!0);if(this.parent&&!d){const w=this.parent.scopes.pop();w&&w!==this&&(this.parent.scopes[this.index]=w,w.index=this.index)}this.active=!1}}}function tv(a){return new ev(a)}function Fb(a,d=Jo){d&&d.active&&d.effects.push(a)}const Zm=a=>{const d=new Set(a);return d.w=0,d.n=0,d},iv=a=>(a.w&Xs)>0,rv=a=>(a.n&Xs)>0,Ob=({deps:a})=>{if(a.length)for(let d=0;d<a.length;d++)a[d].w|=Xs},Ub=a=>{const{deps:d}=a;if(d.length){let g=0;for(let A=0;A<d.length;A++){const w=d[A];iv(w)&&!rv(w)?w.delete(a):d[g++]=w,w.w&=~Xs,w.n&=~Xs}d.length=g}},om=new WeakMap;let Bu=0,Xs=1;const sm=30;let So;const ja=Symbol(""),am=Symbol("");class qm{constructor(d,g=null,A){this.fn=d,this.scheduler=g,this.active=!0,this.deps=[],this.parent=void 0,Fb(this,A)}run(){if(!this.active)return this.fn();let d=So,g=qs;for(;d;){if(d===this)return;d=d.parent}try{return this.parent=So,So=this,qs=!0,Xs=1<<++Bu,Bu<=sm?Ob(this):ky(this),this.fn()}finally{Bu<=sm&&Ub(this),Xs=1<<--Bu,So=this.parent,qs=g,this.parent=void 0}}stop(){this.active&&(ky(this),this.onStop&&this.onStop(),this.active=!1)}}function ky(a){const{deps:d}=a;if(d.length){for(let g=0;g<d.length;g++)d[g].delete(a);d.length=0}}let qs=!0;const nv=[];function uc(){nv.push(qs),qs=!1}function hc(){const a=nv.pop();qs=a===void 0?!0:a}function zn(a,d,g){if(qs&&So){let A=om.get(a);A||om.set(a,A=new Map);let w=A.get(g);w||A.set(g,w=Zm()),ov(w)}}function ov(a,d){let g=!1;Bu<=sm?rv(a)||(a.n|=Xs,g=!iv(a)):g=!a.has(So),g&&(a.add(So),So.deps.push(a))}function rs(a,d,g,A,w,S){const z=om.get(a);if(!z)return;let o=[];if(d==="clear")o=[...z.values()];else if(g==="length"&&Xt(a))z.forEach((L,j)=>{(j==="length"||j>=A)&&o.push(L)});else switch(g!==void 0&&o.push(z.get(g)),d){case"add":Xt(a)?Gm(g)&&o.push(z.get("length")):(o.push(z.get(ja)),ic(a)&&o.push(z.get(am)));break;case"delete":Xt(a)||(o.push(z.get(ja)),ic(a)&&o.push(z.get(am)));break;case"set":ic(a)&&o.push(z.get(ja));break}if(o.length===1)o[0]&&lm(o[0]);else{const L=[];for(const j of o)j&&L.push(...j);lm(Zm(L))}}function lm(a,d){for(const g of Xt(a)?a:[...a])(g!==So||g.allowRecurse)&&(g.scheduler?g.scheduler():g.run())}const Vb=Om("__proto__,__v_isRef,__isVue"),sv=new Set(Object.getOwnPropertyNames(Symbol).map(a=>Symbol[a]).filter($m)),jb=Wm(),Nb=Wm(!1,!0),$b=Wm(!0),zy=Gb();function Gb(){const a={};return["includes","indexOf","lastIndexOf"].forEach(d=>{a[d]=function(...g){const A=Ci(this);for(let S=0,z=this.length;S<z;S++)zn(A,"get",S+"");const w=A[d](...g);return w===-1||w===!1?A[d](...g.map(Ci)):w}}),["push","pop","shift","unshift","splice"].forEach(d=>{a[d]=function(...g){uc();const A=Ci(this)[d].apply(this,g);return hc(),A}}),a}function Wm(a=!1,d=!1){return function(A,w,S){if(w==="__v_isReactive")return!a;if(w==="__v_isReadonly")return a;if(w==="__v_isShallow")return d;if(w==="__v_raw"&&S===(a?d?sw:hv:d?uv:cv).get(A))return A;const z=Xt(A);if(!a&&z&&Ii(zy,w))return Reflect.get(zy,w,S);const o=Reflect.get(A,w,S);return($m(w)?sv.has(w):Vb(w))||(a||zn(A,"get",w),d)?o:Hi(o)?!z||!Gm(w)?o.value:o:mr(o)?a?dv(o):Mo(o):o}}const Zb=av(),qb=av(!0);function av(a=!1){return function(g,A,w,S){let z=g[A];if(rc(z)&&Hi(z)&&!Hi(w))return!1;if(!a&&!rc(w)&&(pv(w)||(w=Ci(w),z=Ci(z)),!Xt(g)&&Hi(z)&&!Hi(w)))return z.value=w,!0;const o=Xt(g)&&Gm(A)?Number(A)<g.length:Ii(g,A),L=Reflect.set(g,A,w,S);return g===Ci(S)&&(o?Zu(w,z)&&rs(g,"set",A,w):rs(g,"add",A,w)),L}}function Wb(a,d){const g=Ii(a,d);a[d];const A=Reflect.deleteProperty(a,d);return A&&g&&rs(a,"delete",d,void 0),A}function Xb(a,d){const g=Reflect.has(a,d);return(!$m(d)||!sv.has(d))&&zn(a,"has",d),g}function Hb(a){return zn(a,"iterate",Xt(a)?"length":ja),Reflect.ownKeys(a)}const lv={get:jb,set:Zb,deleteProperty:Wb,has:Xb,ownKeys:Hb},Qb={get:$b,set(a,d){return!0},deleteProperty(a,d){return!0}},Yb=zr({},lv,{get:Nb,set:qb}),Xm=a=>a,ip=a=>Reflect.getPrototypeOf(a);function Ed(a,d,g=!1,A=!1){a=a.__v_raw;const w=Ci(a),S=Ci(d);d!==S&&!g&&zn(w,"get",d),!g&&zn(w,"get",S);const{has:z}=ip(w),o=A?Xm:g?Ym:qu;if(z.call(w,d))return o(a.get(d));if(z.call(w,S))return o(a.get(S));a!==w&&a.get(d)}function Td(a,d=!1){const g=this.__v_raw,A=Ci(g),w=Ci(a);return a!==w&&!d&&zn(A,"has",a),!d&&zn(A,"has",w),a===w?g.has(a):g.has(a)||g.has(w)}function Sd(a,d=!1){return a=a.__v_raw,!d&&zn(Ci(a),"iterate",ja),Reflect.get(a,"size",a)}function Py(a){a=Ci(a);const d=Ci(this);return ip(d).has.call(d,a)||(d.add(a),rs(d,"add",a,a)),this}function Dy(a,d){d=Ci(d);const g=Ci(this),{has:A,get:w}=ip(g);let S=A.call(g,a);S||(a=Ci(a),S=A.call(g,a));const z=w.call(g,a);return g.set(a,d),S?Zu(d,z)&&rs(g,"set",a,d):rs(g,"add",a,d),this}function By(a){const d=Ci(this),{has:g,get:A}=ip(d);let w=g.call(d,a);w||(a=Ci(a),w=g.call(d,a)),A&&A.call(d,a);const S=d.delete(a);return w&&rs(d,"delete",a,void 0),S}function Ly(){const a=Ci(this),d=a.size!==0,g=a.clear();return d&&rs(a,"clear",void 0,void 0),g}function Id(a,d){return function(A,w){const S=this,z=S.__v_raw,o=Ci(z),L=d?Xm:a?Ym:qu;return!a&&zn(o,"iterate",ja),z.forEach((j,O)=>A.call(w,L(j),L(O),S))}}function Cd(a,d,g){return function(...A){const w=this.__v_raw,S=Ci(w),z=ic(S),o=a==="entries"||a===Symbol.iterator&&z,L=a==="keys"&&z,j=w[a](...A),O=g?Xm:d?Ym:qu;return!d&&zn(S,"iterate",L?am:ja),{next(){const{value:B,done:Z}=j.next();return Z?{value:B,done:Z}:{value:o?[O(B[0]),O(B[1])]:O(B),done:Z}},[Symbol.iterator](){return this}}}}function Rs(a){return function(...d){return a==="delete"?!1:this}}function Kb(){const a={get(S){return Ed(this,S)},get size(){return Sd(this)},has:Td,add:Py,set:Dy,delete:By,clear:Ly,forEach:Id(!1,!1)},d={get(S){return Ed(this,S,!1,!0)},get size(){return Sd(this)},has:Td,add:Py,set:Dy,delete:By,clear:Ly,forEach:Id(!1,!0)},g={get(S){return Ed(this,S,!0)},get size(){return Sd(this,!0)},has(S){return Td.call(this,S,!0)},add:Rs("add"),set:Rs("set"),delete:Rs("delete"),clear:Rs("clear"),forEach:Id(!0,!1)},A={get(S){return Ed(this,S,!0,!0)},get size(){return Sd(this,!0)},has(S){return Td.call(this,S,!0)},add:Rs("add"),set:Rs("set"),delete:Rs("delete"),clear:Rs("clear"),forEach:Id(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(S=>{a[S]=Cd(S,!1,!1),g[S]=Cd(S,!0,!1),d[S]=Cd(S,!1,!0),A[S]=Cd(S,!0,!0)}),[a,g,d,A]}const[Jb,ew,tw,iw]=Kb();function Hm(a,d){const g=d?a?iw:tw:a?ew:Jb;return(A,w,S)=>w==="__v_isReactive"?!a:w==="__v_isReadonly"?a:w==="__v_raw"?A:Reflect.get(Ii(g,w)&&w in A?g:A,w,S)}const rw={get:Hm(!1,!1)},nw={get:Hm(!1,!0)},ow={get:Hm(!0,!1)},cv=new WeakMap,uv=new WeakMap,hv=new WeakMap,sw=new WeakMap;function aw(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function lw(a){return a.__v_skip||!Object.isExtensible(a)?0:aw(Db(a))}function Mo(a){return rc(a)?a:Qm(a,!1,lv,rw,cv)}function cw(a){return Qm(a,!1,Yb,nw,uv)}function dv(a){return Qm(a,!0,Qb,ow,hv)}function Qm(a,d,g,A,w){if(!mr(a)||a.__v_raw&&!(d&&a.__v_isReactive))return a;const S=w.get(a);if(S)return S;const z=lw(a);if(z===0)return a;const o=new Proxy(a,z===2?A:g);return w.set(a,o),o}function is(a){return rc(a)?is(a.__v_raw):!!(a&&a.__v_isReactive)}function rc(a){return!!(a&&a.__v_isReadonly)}function pv(a){return!!(a&&a.__v_isShallow)}function fv(a){return is(a)||rc(a)}function Ci(a){const d=a&&a.__v_raw;return d?Ci(d):a}function nc(a){return Nd(a,"__v_skip",!0),a}const qu=a=>mr(a)?Mo(a):a,Ym=a=>mr(a)?dv(a):a;function mv(a){qs&&So&&(a=Ci(a),ov(a.dep||(a.dep=Zm())))}function _v(a,d){a=Ci(a),a.dep&&lm(a.dep)}function Hi(a){return!!(a&&a.__v_isRef===!0)}function $t(a){return gv(a,!1)}function uw(a){return gv(a,!0)}function gv(a,d){return Hi(a)?a:new hw(a,d)}class hw{constructor(d,g){this.__v_isShallow=g,this.dep=void 0,this.__v_isRef=!0,this._rawValue=g?d:Ci(d),this._value=g?d:qu(d)}get value(){return mv(this),this._value}set value(d){d=this.__v_isShallow?d:Ci(d),Zu(d,this._rawValue)&&(this._rawValue=d,this._value=this.__v_isShallow?d:qu(d),_v(this))}}function ai(a){return Hi(a)?a.value:a}const dw={get:(a,d,g)=>ai(Reflect.get(a,d,g)),set:(a,d,g,A)=>{const w=a[d];return Hi(w)&&!Hi(g)?(w.value=g,!0):Reflect.set(a,d,g,A)}};function yv(a){return is(a)?a:new Proxy(a,dw)}function pw(a){const d=Xt(a)?new Array(a.length):{};for(const g in a)d[g]=mw(a,g);return d}class fw{constructor(d,g,A){this._object=d,this._key=g,this._defaultValue=A,this.__v_isRef=!0}get value(){const d=this._object[this._key];return d===void 0?this._defaultValue:d}set value(d){this._object[this._key]=d}}function mw(a,d,g){const A=a[d];return Hi(A)?A:new fw(a,d,g)}class _w{constructor(d,g,A,w){this._setter=g,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new qm(d,()=>{this._dirty||(this._dirty=!0,_v(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!w,this.__v_isReadonly=A}get value(){const d=Ci(this);return mv(d),(d._dirty||!d._cacheable)&&(d._dirty=!1,d._value=d.effect.run()),d._value}set value(d){this._setter(d)}}function gw(a,d,g=!1){let A,w;const S=ci(a);return S?(A=a,w=to):(A=a.get,w=a.set),new _w(A,w,S||!w,g)}Promise.resolve();function Ws(a,d,g,A){let w;try{w=A?a(...A):a()}catch(S){rp(S,d,g)}return w}function Vn(a,d,g,A){if(ci(a)){const S=Ws(a,d,g,A);return S&&Yx(S)&&S.catch(z=>{rp(z,d,g)}),S}const w=[];for(let S=0;S<a.length;S++)w.push(Vn(a[S],d,g,A));return w}function rp(a,d,g,A=!0){const w=d?d.vnode:null;if(d){let S=d.parent;const z=d.proxy,o=g;for(;S;){const j=S.ec;if(j){for(let O=0;O<j.length;O++)if(j[O](a,z,o)===!1)return}S=S.parent}const L=d.appContext.config.errorHandler;if(L){Ws(L,null,10,[a,z,o]);return}}yw(a,g,w,A)}function yw(a,d,g,A=!0){console.error(a)}let Gd=!1,cm=!1;const In=[];let ts=0;const Ou=[];let Lu=null,Yl=0;const Uu=[];let js=null,Kl=0;const xv=Promise.resolve();let Km=null,um=null;function Mn(a){const d=Km||xv;return a?d.then(this?a.bind(this):a):d}function xw(a){let d=ts+1,g=In.length;for(;d<g;){const A=d+g>>>1;Wu(In[A])<a?d=A+1:g=A}return d}function vv(a){(!In.length||!In.includes(a,Gd&&a.allowRecurse?ts+1:ts))&&a!==um&&(a.id==null?In.push(a):In.splice(xw(a.id),0,a),Av())}function Av(){!Gd&&!cm&&(cm=!0,Km=xv.then(Ev))}function vw(a){const d=In.indexOf(a);d>ts&&In.splice(d,1)}function bv(a,d,g,A){Xt(a)?g.push(...a):(!d||!d.includes(a,a.allowRecurse?A+1:A))&&g.push(a),Av()}function Aw(a){bv(a,Lu,Ou,Yl)}function bw(a){bv(a,js,Uu,Kl)}function Jm(a,d=null){if(Ou.length){for(um=d,Lu=[...new Set(Ou)],Ou.length=0,Yl=0;Yl<Lu.length;Yl++)Lu[Yl]();Lu=null,Yl=0,um=null,Jm(a,d)}}function wv(a){if(Uu.length){const d=[...new Set(Uu)];if(Uu.length=0,js){js.push(...d);return}for(js=d,js.sort((g,A)=>Wu(g)-Wu(A)),Kl=0;Kl<js.length;Kl++)js[Kl]();js=null,Kl=0}}const Wu=a=>a.id==null?1/0:a.id;function Ev(a){cm=!1,Gd=!0,Jm(a),In.sort((g,A)=>Wu(g)-Wu(A));const d=to;try{for(ts=0;ts<In.length;ts++){const g=In[ts];g&&g.active!==!1&&Ws(g,null,14)}}finally{ts=0,In.length=0,wv(),Gd=!1,Km=null,(In.length||Ou.length||Uu.length)&&Ev(a)}}function ww(a,d,...g){const A=a.vnode.props||Vi;let w=g;const S=d.startsWith("update:"),z=S&&d.slice(7);if(z&&z in A){const O=`${z==="modelValue"?"model":z}Modifiers`,{number:B,trim:Z}=A[O]||Vi;Z?w=g.map(Q=>Q.trim()):B&&(w=g.map($d))}let o,L=A[o=jf(d)]||A[o=jf(Io(d))];!L&&S&&(L=A[o=jf(cc(d))]),L&&Vn(L,a,6,w);const j=A[o+"Once"];if(j){if(!a.emitted)a.emitted={};else if(a.emitted[o])return;a.emitted[o]=!0,Vn(j,a,6,w)}}function Tv(a,d,g=!1){const A=d.emitsCache,w=A.get(a);if(w!==void 0)return w;const S=a.emits;let z={},o=!1;if(!ci(a)){const L=j=>{const O=Tv(j,d,!0);O&&(o=!0,zr(z,O))};!g&&d.mixins.length&&d.mixins.forEach(L),a.extends&&L(a.extends),a.mixins&&a.mixins.forEach(L)}return!S&&!o?(A.set(a,null),null):(Xt(S)?S.forEach(L=>z[L]=null):zr(z,S),A.set(a,z),z)}function e_(a,d){return!a||!Kd(d)?!1:(d=d.slice(2).replace(/Once$/,""),Ii(a,d[0].toLowerCase()+d.slice(1))||Ii(a,cc(d))||Ii(a,d))}let Un=null,Sv=null;function Zd(a){const d=Un;return Un=a,Sv=a&&a.type.__scopeId||null,d}function Ew(a,d=Un,g){if(!d||a._n)return a;const A=(...w)=>{A._d&&Wy(-1);const S=Zd(d),z=a(...w);return Zd(S),A._d&&Wy(1),z};return A._n=!0,A._c=!0,A._d=!0,A}function Nf(a){const{type:d,vnode:g,proxy:A,withProxy:w,props:S,propsOptions:[z],slots:o,attrs:L,emit:j,render:O,renderCache:B,data:Z,setupState:Q,ctx:ce,inheritAttrs:Ee}=a;let Ae,Fe;const ft=Zd(a);try{if(g.shapeFlag&4){const mt=w||A;Ae=To(O.call(mt,mt,B,S,Q,Z,ce)),Fe=L}else{const mt=d;Ae=To(mt.length>1?mt(S,{attrs:L,slots:o,emit:j}):mt(S,null)),Fe=d.props?L:Tw(L)}}catch(mt){ju.length=0,rp(mt,a,1),Ae=ji(Co)}let Pt=Ae;if(Fe&&Ee!==!1){const mt=Object.keys(Fe),{shapeFlag:Rt}=Pt;mt.length&&Rt&7&&(z&&mt.some(jm)&&(Fe=Sw(Fe,z)),Pt=Ga(Pt,Fe))}return g.dirs&&(Pt.dirs=Pt.dirs?Pt.dirs.concat(g.dirs):g.dirs),g.transition&&(Pt.transition=g.transition),Ae=Pt,Zd(ft),Ae}const Tw=a=>{let d;for(const g in a)(g==="class"||g==="style"||Kd(g))&&((d||(d={}))[g]=a[g]);return d},Sw=(a,d)=>{const g={};for(const A in a)(!jm(A)||!(A.slice(9)in d))&&(g[A]=a[A]);return g};function Iw(a,d,g){const{props:A,children:w,component:S}=a,{props:z,children:o,patchFlag:L}=d,j=S.emitsOptions;if(d.dirs||d.transition)return!0;if(g&&L>=0){if(L&1024)return!0;if(L&16)return A?Ry(A,z,j):!!z;if(L&8){const O=d.dynamicProps;for(let B=0;B<O.length;B++){const Z=O[B];if(z[Z]!==A[Z]&&!e_(j,Z))return!0}}}else return(w||o)&&(!o||!o.$stable)?!0:A===z?!1:A?z?Ry(A,z,j):!0:!!z;return!1}function Ry(a,d,g){const A=Object.keys(d);if(A.length!==Object.keys(a).length)return!0;for(let w=0;w<A.length;w++){const S=A[w];if(d[S]!==a[S]&&!e_(g,S))return!0}return!1}function Cw({vnode:a,parent:d},g){for(;d&&d.subTree===a;)(a=d.vnode).el=g,d=d.parent}const Mw=a=>a.__isSuspense;function kw(a,d){d&&d.pendingBranch?Xt(a)?d.effects.push(...a):d.effects.push(a):bw(a)}function pr(a,d){if(Tr){let g=Tr.provides;const A=Tr.parent&&Tr.parent.provides;A===g&&(g=Tr.provides=Object.create(A)),g[a]=d}}function Ni(a,d,g=!1){const A=Tr||Un;if(A){const w=A.parent==null?A.vnode.appContext&&A.vnode.appContext.provides:A.parent.provides;if(w&&a in w)return w[a];if(arguments.length>1)return g&&ci(d)?d.call(A.proxy):d}}function fn(a,d){return t_(a,null,d)}const Fy={};function pn(a,d,g){return t_(a,d,g)}function t_(a,d,{immediate:g,deep:A,flush:w,onTrack:S,onTrigger:z}=Vi){const o=Tr;let L,j=!1,O=!1;if(Hi(a)?(L=()=>a.value,j=pv(a)):is(a)?(L=()=>a,A=!0):Xt(a)?(O=!0,j=a.some(is),L=()=>a.map(Fe=>{if(Hi(Fe))return Fe.value;if(is(Fe))return Va(Fe);if(ci(Fe))return Ws(Fe,o,2)})):ci(a)?d?L=()=>Ws(a,o,2):L=()=>{if(!(o&&o.isUnmounted))return B&&B(),Vn(a,o,3,[Z])}:L=to,d&&A){const Fe=L;L=()=>Va(Fe())}let B,Z=Fe=>{B=Ae.onStop=()=>{Ws(Fe,o,4)}};if(Xu)return Z=to,d?g&&Vn(d,o,3,[L(),O?[]:void 0,Z]):L(),to;let Q=O?[]:Fy;const ce=()=>{if(!!Ae.active)if(d){const Fe=Ae.run();(A||j||(O?Fe.some((ft,Pt)=>Zu(ft,Q[Pt])):Zu(Fe,Q)))&&(B&&B(),Vn(d,o,3,[Fe,Q===Fy?void 0:Q,Z]),Q=Fe)}else Ae.run()};ce.allowRecurse=!!d;let Ee;w==="sync"?Ee=ce:w==="post"?Ee=()=>dn(ce,o&&o.suspense):Ee=()=>{!o||o.isMounted?Aw(ce):ce()};const Ae=new qm(L,Ee);return d?g?ce():Q=Ae.run():w==="post"?dn(Ae.run.bind(Ae),o&&o.suspense):Ae.run(),()=>{Ae.stop(),o&&o.scope&&Nm(o.scope.effects,Ae)}}function zw(a,d,g){const A=this.proxy,w=fr(a)?a.includes(".")?Iv(A,a):()=>A[a]:a.bind(A,A);let S;ci(d)?S=d:(S=d.handler,g=d);const z=Tr;oc(this);const o=t_(w,S.bind(A),g);return z?oc(z):$a(),o}function Iv(a,d){const g=d.split(".");return()=>{let A=a;for(let w=0;w<g.length&&A;w++)A=A[g[w]];return A}}function Va(a,d){if(!mr(a)||a.__v_skip||(d=d||new Set,d.has(a)))return a;if(d.add(a),Hi(a))Va(a.value,d);else if(Xt(a))for(let g=0;g<a.length;g++)Va(a[g],d);else if(Qx(a)||ic(a))a.forEach(g=>{Va(g,d)});else if(Jx(a))for(const g in a)Va(a[g],d);return a}function Pw(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Ur(()=>{a.isMounted=!0}),i_(()=>{a.isUnmounting=!0}),a}const On=[Function,Array],Dw={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:On,onEnter:On,onAfterEnter:On,onEnterCancelled:On,onBeforeLeave:On,onLeave:On,onAfterLeave:On,onLeaveCancelled:On,onBeforeAppear:On,onAppear:On,onAfterAppear:On,onAppearCancelled:On},setup(a,{slots:d}){const g=ap(),A=Pw();let w;return()=>{const S=d.default&&kv(d.default(),!0);if(!S||!S.length)return;const z=Ci(a),{mode:o}=z,L=S[0];if(A.isLeaving)return $f(L);const j=Oy(L);if(!j)return $f(L);const O=hm(j,z,A,g);dm(j,O);const B=g.subTree,Z=B&&Oy(B);let Q=!1;const{getTransitionKey:ce}=j.type;if(ce){const Ee=ce();w===void 0?w=Ee:Ee!==w&&(w=Ee,Q=!0)}if(Z&&Z.type!==Co&&(!Oa(j,Z)||Q)){const Ee=hm(Z,z,A,g);if(dm(Z,Ee),o==="out-in")return A.isLeaving=!0,Ee.afterLeave=()=>{A.isLeaving=!1,g.update()},$f(L);o==="in-out"&&j.type!==Co&&(Ee.delayLeave=(Ae,Fe,ft)=>{const Pt=Mv(A,Z);Pt[String(Z.key)]=Z,Ae._leaveCb=()=>{Fe(),Ae._leaveCb=void 0,delete O.delayedLeave},O.delayedLeave=ft})}return L}}},Cv=Dw;function Mv(a,d){const{leavingVNodes:g}=a;let A=g.get(d.type);return A||(A=Object.create(null),g.set(d.type,A)),A}function hm(a,d,g,A){const{appear:w,mode:S,persisted:z=!1,onBeforeEnter:o,onEnter:L,onAfterEnter:j,onEnterCancelled:O,onBeforeLeave:B,onLeave:Z,onAfterLeave:Q,onLeaveCancelled:ce,onBeforeAppear:Ee,onAppear:Ae,onAfterAppear:Fe,onAppearCancelled:ft}=d,Pt=String(a.key),mt=Mv(g,a),Rt=(We,gt)=>{We&&Vn(We,A,9,gt)},Ke={mode:S,persisted:z,beforeEnter(We){let gt=o;if(!g.isMounted)if(w)gt=Ee||o;else return;We._leaveCb&&We._leaveCb(!0);const Tt=mt[Pt];Tt&&Oa(a,Tt)&&Tt.el._leaveCb&&Tt.el._leaveCb(),Rt(gt,[We])},enter(We){let gt=L,Tt=j,Dt=O;if(!g.isMounted)if(w)gt=Ae||L,Tt=Fe||j,Dt=ft||O;else return;let It=!1;const yt=We._enterCb=ti=>{It||(It=!0,ti?Rt(Dt,[We]):Rt(Tt,[We]),Ke.delayedLeave&&Ke.delayedLeave(),We._enterCb=void 0)};gt?(gt(We,yt),gt.length<=1&&yt()):yt()},leave(We,gt){const Tt=String(a.key);if(We._enterCb&&We._enterCb(!0),g.isUnmounting)return gt();Rt(B,[We]);let Dt=!1;const It=We._leaveCb=yt=>{Dt||(Dt=!0,gt(),yt?Rt(ce,[We]):Rt(Q,[We]),We._leaveCb=void 0,mt[Tt]===a&&delete mt[Tt])};mt[Tt]=a,Z?(Z(We,It),Z.length<=1&&It()):It()},clone(We){return hm(We,d,g,A)}};return Ke}function $f(a){if(np(a))return a=Ga(a),a.children=null,a}function Oy(a){return np(a)?a.children?a.children[0]:void 0:a}function dm(a,d){a.shapeFlag&6&&a.component?dm(a.component.subTree,d):a.shapeFlag&128?(a.ssContent.transition=d.clone(a.ssContent),a.ssFallback.transition=d.clone(a.ssFallback)):a.transition=d}function kv(a,d=!1){let g=[],A=0;for(let w=0;w<a.length;w++){const S=a[w];S.type===eo?(S.patchFlag&128&&A++,g=g.concat(kv(S.children,d))):(d||S.type!==Co)&&g.push(S)}if(A>1)for(let w=0;w<g.length;w++)g[w].patchFlag=-2;return g}function Yi(a){return ci(a)?{setup:a,name:a.name}:a}const pm=a=>!!a.type.__asyncLoader,np=a=>a.type.__isKeepAlive;function Bw(a,d){zv(a,"a",d)}function Lw(a,d){zv(a,"da",d)}function zv(a,d,g=Tr){const A=a.__wdc||(a.__wdc=()=>{let w=g;for(;w;){if(w.isDeactivated)return;w=w.parent}return a()});if(op(d,A,g),g){let w=g.parent;for(;w&&w.parent;)np(w.parent.vnode)&&Rw(A,d,g,w),w=w.parent}}function Rw(a,d,g,A){const w=op(d,a,A,!0);io(()=>{Nm(A[d],w)},g)}function op(a,d,g=Tr,A=!1){if(g){const w=g[a]||(g[a]=[]),S=d.__weh||(d.__weh=(...z)=>{if(g.isUnmounted)return;uc(),oc(g);const o=Vn(d,g,a,z);return $a(),hc(),o});return A?w.unshift(S):w.push(S),S}}const ns=a=>(d,g=Tr)=>(!Xu||a==="sp")&&op(a,d,g),Pv=ns("bm"),Ur=ns("m"),Fw=ns("bu"),Ow=ns("u"),i_=ns("bum"),io=ns("um"),Uw=ns("sp"),Vw=ns("rtg"),jw=ns("rtc");function Nw(a,d=Tr){op("ec",a,d)}let fm=!0;function $w(a){const d=Bv(a),g=a.proxy,A=a.ctx;fm=!1,d.beforeCreate&&Uy(d.beforeCreate,a,"bc");const{data:w,computed:S,methods:z,watch:o,provide:L,inject:j,created:O,beforeMount:B,mounted:Z,beforeUpdate:Q,updated:ce,activated:Ee,deactivated:Ae,beforeDestroy:Fe,beforeUnmount:ft,destroyed:Pt,unmounted:mt,render:Rt,renderTracked:Ke,renderTriggered:We,errorCaptured:gt,serverPrefetch:Tt,expose:Dt,inheritAttrs:It,components:yt,directives:ti,filters:li}=d;if(j&&Gw(j,A,null,a.appContext.config.unwrapInjectedRef),z)for(const ui in z){const Bt=z[ui];ci(Bt)&&(A[ui]=Bt.bind(g))}if(w){const ui=w.call(g,g);mr(ui)&&(a.data=Mo(ui))}if(fm=!0,S)for(const ui in S){const Bt=S[ui],ki=ci(Bt)?Bt.bind(g,g):ci(Bt.get)?Bt.get.bind(g,g):to,Sr=!ci(Bt)&&ci(Bt.set)?Bt.set.bind(g):to,Qi=zt({get:ki,set:Sr});Object.defineProperty(A,ui,{enumerable:!0,configurable:!0,get:()=>Qi.value,set:Ir=>Qi.value=Ir})}if(o)for(const ui in o)Dv(o[ui],A,g,ui);if(L){const ui=ci(L)?L.call(g):L;Reflect.ownKeys(ui).forEach(Bt=>{pr(Bt,ui[Bt])})}O&&Uy(O,a,"c");function bi(ui,Bt){Xt(Bt)?Bt.forEach(ki=>ui(ki.bind(g))):Bt&&ui(Bt.bind(g))}if(bi(Pv,B),bi(Ur,Z),bi(Fw,Q),bi(Ow,ce),bi(Bw,Ee),bi(Lw,Ae),bi(Nw,gt),bi(jw,Ke),bi(Vw,We),bi(i_,ft),bi(io,mt),bi(Uw,Tt),Xt(Dt))if(Dt.length){const ui=a.exposed||(a.exposed={});Dt.forEach(Bt=>{Object.defineProperty(ui,Bt,{get:()=>g[Bt],set:ki=>g[Bt]=ki})})}else a.exposed||(a.exposed={});Rt&&a.render===to&&(a.render=Rt),It!=null&&(a.inheritAttrs=It),yt&&(a.components=yt),ti&&(a.directives=ti)}function Gw(a,d,g=to,A=!1){Xt(a)&&(a=mm(a));for(const w in a){const S=a[w];let z;mr(S)?"default"in S?z=Ni(S.from||w,S.default,!0):z=Ni(S.from||w):z=Ni(S),Hi(z)&&A?Object.defineProperty(d,w,{enumerable:!0,configurable:!0,get:()=>z.value,set:o=>z.value=o}):d[w]=z}}function Uy(a,d,g){Vn(Xt(a)?a.map(A=>A.bind(d.proxy)):a.bind(d.proxy),d,g)}function Dv(a,d,g,A){const w=A.includes(".")?Iv(g,A):()=>g[A];if(fr(a)){const S=d[a];ci(S)&&pn(w,S)}else if(ci(a))pn(w,a.bind(g));else if(mr(a))if(Xt(a))a.forEach(S=>Dv(S,d,g,A));else{const S=ci(a.handler)?a.handler.bind(g):d[a.handler];ci(S)&&pn(w,S,a)}}function Bv(a){const d=a.type,{mixins:g,extends:A}=d,{mixins:w,optionsCache:S,config:{optionMergeStrategies:z}}=a.appContext,o=S.get(d);let L;return o?L=o:!w.length&&!g&&!A?L=d:(L={},w.length&&w.forEach(j=>qd(L,j,z,!0)),qd(L,d,z)),S.set(d,L),L}function qd(a,d,g,A=!1){const{mixins:w,extends:S}=d;S&&qd(a,S,g,!0),w&&w.forEach(z=>qd(a,z,g,!0));for(const z in d)if(!(A&&z==="expose")){const o=Zw[z]||g&&g[z];a[z]=o?o(a[z],d[z]):d[z]}return a}const Zw={data:Vy,props:Fa,emits:Fa,methods:Fa,computed:Fa,beforeCreate:Qr,created:Qr,beforeMount:Qr,mounted:Qr,beforeUpdate:Qr,updated:Qr,beforeDestroy:Qr,beforeUnmount:Qr,destroyed:Qr,unmounted:Qr,activated:Qr,deactivated:Qr,errorCaptured:Qr,serverPrefetch:Qr,components:Fa,directives:Fa,watch:Ww,provide:Vy,inject:qw};function Vy(a,d){return d?a?function(){return zr(ci(a)?a.call(this,this):a,ci(d)?d.call(this,this):d)}:d:a}function qw(a,d){return Fa(mm(a),mm(d))}function mm(a){if(Xt(a)){const d={};for(let g=0;g<a.length;g++)d[a[g]]=a[g];return d}return a}function Qr(a,d){return a?[...new Set([].concat(a,d))]:d}function Fa(a,d){return a?zr(zr(Object.create(null),a),d):d}function Ww(a,d){if(!a)return d;if(!d)return a;const g=zr(Object.create(null),a);for(const A in d)g[A]=Qr(a[A],d[A]);return g}function Xw(a,d,g,A=!1){const w={},S={};Nd(S,sp,1),a.propsDefaults=Object.create(null),Lv(a,d,w,S);for(const z in a.propsOptions[0])z in w||(w[z]=void 0);g?a.props=A?w:cw(w):a.type.props?a.props=w:a.props=S,a.attrs=S}function Hw(a,d,g,A){const{props:w,attrs:S,vnode:{patchFlag:z}}=a,o=Ci(w),[L]=a.propsOptions;let j=!1;if((A||z>0)&&!(z&16)){if(z&8){const O=a.vnode.dynamicProps;for(let B=0;B<O.length;B++){let Z=O[B];const Q=d[Z];if(L)if(Ii(S,Z))Q!==S[Z]&&(S[Z]=Q,j=!0);else{const ce=Io(Z);w[ce]=_m(L,o,ce,Q,a,!1)}else Q!==S[Z]&&(S[Z]=Q,j=!0)}}}else{Lv(a,d,w,S)&&(j=!0);let O;for(const B in o)(!d||!Ii(d,B)&&((O=cc(B))===B||!Ii(d,O)))&&(L?g&&(g[B]!==void 0||g[O]!==void 0)&&(w[B]=_m(L,o,B,void 0,a,!0)):delete w[B]);if(S!==o)for(const B in S)(!d||!Ii(d,B)&&!0)&&(delete S[B],j=!0)}j&&rs(a,"set","$attrs")}function Lv(a,d,g,A){const[w,S]=a.propsOptions;let z=!1,o;if(d)for(let L in d){if(Ld(L))continue;const j=d[L];let O;w&&Ii(w,O=Io(L))?!S||!S.includes(O)?g[O]=j:(o||(o={}))[O]=j:e_(a.emitsOptions,L)||(!(L in A)||j!==A[L])&&(A[L]=j,z=!0)}if(S){const L=Ci(g),j=o||Vi;for(let O=0;O<S.length;O++){const B=S[O];g[B]=_m(w,L,B,j[B],a,!Ii(j,B))}}return z}function _m(a,d,g,A,w,S){const z=a[g];if(z!=null){const o=Ii(z,"default");if(o&&A===void 0){const L=z.default;if(z.type!==Function&&ci(L)){const{propsDefaults:j}=w;g in j?A=j[g]:(oc(w),A=j[g]=L.call(null,d),$a())}else A=L}z[0]&&(S&&!o?A=!1:z[1]&&(A===""||A===cc(g))&&(A=!0))}return A}function Rv(a,d,g=!1){const A=d.propsCache,w=A.get(a);if(w)return w;const S=a.props,z={},o=[];let L=!1;if(!ci(a)){const O=B=>{L=!0;const[Z,Q]=Rv(B,d,!0);zr(z,Z),Q&&o.push(...Q)};!g&&d.mixins.length&&d.mixins.forEach(O),a.extends&&O(a.extends),a.mixins&&a.mixins.forEach(O)}if(!S&&!L)return A.set(a,tc),tc;if(Xt(S))for(let O=0;O<S.length;O++){const B=Io(S[O]);jy(B)&&(z[B]=Vi)}else if(S)for(const O in S){const B=Io(O);if(jy(B)){const Z=S[O],Q=z[B]=Xt(Z)||ci(Z)?{type:Z}:Z;if(Q){const ce=Gy(Boolean,Q.type),Ee=Gy(String,Q.type);Q[0]=ce>-1,Q[1]=Ee<0||ce<Ee,(ce>-1||Ii(Q,"default"))&&o.push(B)}}}const j=[z,o];return A.set(a,j),j}function jy(a){return a[0]!=="$"}function Ny(a){const d=a&&a.toString().match(/^\s*function (\w+)/);return d?d[1]:a===null?"null":""}function $y(a,d){return Ny(a)===Ny(d)}function Gy(a,d){return Xt(d)?d.findIndex(g=>$y(g,a)):ci(d)&&$y(d,a)?0:-1}const Fv=a=>a[0]==="_"||a==="$stable",r_=a=>Xt(a)?a.map(To):[To(a)],Qw=(a,d,g)=>{const A=Ew((...w)=>r_(d(...w)),g);return A._c=!1,A},Ov=(a,d,g)=>{const A=a._ctx;for(const w in a){if(Fv(w))continue;const S=a[w];if(ci(S))d[w]=Qw(w,S,A);else if(S!=null){const z=r_(S);d[w]=()=>z}}},Uv=(a,d)=>{const g=r_(d);a.slots.default=()=>g},Yw=(a,d)=>{if(a.vnode.shapeFlag&32){const g=d._;g?(a.slots=Ci(d),Nd(d,"_",g)):Ov(d,a.slots={})}else a.slots={},d&&Uv(a,d);Nd(a.slots,sp,1)},Kw=(a,d,g)=>{const{vnode:A,slots:w}=a;let S=!0,z=Vi;if(A.shapeFlag&32){const o=d._;o?g&&o===1?S=!1:(zr(w,d),!g&&o===1&&delete w._):(S=!d.$stable,Ov(d,w)),z=d}else d&&(Uv(a,d),z={default:1});if(S)for(const o in w)!Fv(o)&&!(o in z)&&delete w[o]};function OI(a,d){const g=Un;if(g===null)return a;const A=g.proxy,w=a.dirs||(a.dirs=[]);for(let S=0;S<d.length;S++){let[z,o,L,j=Vi]=d[S];ci(z)&&(z={mounted:z,updated:z}),z.deep&&Va(o),w.push({dir:z,instance:A,value:o,oldValue:void 0,arg:L,modifiers:j})}return a}function Da(a,d,g,A){const w=a.dirs,S=d&&d.dirs;for(let z=0;z<w.length;z++){const o=w[z];S&&(o.oldValue=S[z].value);let L=o.dir[A];L&&(uc(),Vn(L,g,8,[a.el,o,a,d]),hc())}}function Vv(){return{app:null,config:{isNativeTag:kb,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Jw=0;function e2(a,d){return function(A,w=null){w!=null&&!mr(w)&&(w=null);const S=Vv(),z=new Set;let o=!1;const L=S.app={_uid:Jw++,_component:A,_props:w,_container:null,_context:S,_instance:null,version:E2,get config(){return S.config},set config(j){},use(j,...O){return z.has(j)||(j&&ci(j.install)?(z.add(j),j.install(L,...O)):ci(j)&&(z.add(j),j(L,...O))),L},mixin(j){return S.mixins.includes(j)||S.mixins.push(j),L},component(j,O){return O?(S.components[j]=O,L):S.components[j]},directive(j,O){return O?(S.directives[j]=O,L):S.directives[j]},mount(j,O,B){if(!o){const Z=ji(A,w);return Z.appContext=S,O&&d?d(Z,j):a(Z,j,B),o=!0,L._container=j,j.__vue_app__=L,a_(Z.component)||Z.component.proxy}},unmount(){o&&(a(null,L._container),delete L._container.__vue_app__)},provide(j,O){return S.provides[j]=O,L}};return L}}function gm(a,d,g,A,w=!1){if(Xt(a)){a.forEach((Z,Q)=>gm(Z,d&&(Xt(d)?d[Q]:d),g,A,w));return}if(pm(A)&&!w)return;const S=A.shapeFlag&4?a_(A.component)||A.component.proxy:A.el,z=w?null:S,{i:o,r:L}=a,j=d&&d.r,O=o.refs===Vi?o.refs={}:o.refs,B=o.setupState;if(j!=null&&j!==L&&(fr(j)?(O[j]=null,Ii(B,j)&&(B[j]=null)):Hi(j)&&(j.value=null)),ci(L))Ws(L,o,12,[z,O]);else{const Z=fr(L),Q=Hi(L);if(Z||Q){const ce=()=>{if(a.f){const Ee=Z?O[L]:L.value;w?Xt(Ee)&&Nm(Ee,S):Xt(Ee)?Ee.includes(S)||Ee.push(S):Z?O[L]=[S]:(L.value=[S],a.k&&(O[a.k]=L.value))}else Z?(O[L]=z,Ii(B,L)&&(B[L]=z)):Hi(L)&&(L.value=z,a.k&&(O[a.k]=z))};z?(ce.id=-1,dn(ce,g)):ce()}}}const dn=kw;function t2(a){return i2(a)}function i2(a,d){const g=Rb();g.__VUE__=!0;const{insert:A,remove:w,patchProp:S,createElement:z,createText:o,createComment:L,setText:j,setElementText:O,parentNode:B,nextSibling:Z,setScopeId:Q=to,cloneNode:ce,insertStaticContent:Ee}=a,Ae=(se,_e,Ce,Ne=null,Be=null,et=null,ht=!1,Ye=null,tt=!!_e.dynamicChildren)=>{if(se===_e)return;se&&!Oa(se,_e)&&(Ne=Ct(se),Yt(se,Be,et,!0),se=null),_e.patchFlag===-2&&(tt=!1,_e.dynamicChildren=null);const{type:Xe,ref:Ft,shapeFlag:At}=_e;switch(Xe){case o_:Fe(se,_e,Ce,Ne);break;case Co:ft(se,_e,Ce,Ne);break;case Fd:se==null&&Pt(_e,Ce,Ne,ht);break;case eo:ti(se,_e,Ce,Ne,Be,et,ht,Ye,tt);break;default:At&1?Ke(se,_e,Ce,Ne,Be,et,ht,Ye,tt):At&6?li(se,_e,Ce,Ne,Be,et,ht,Ye,tt):(At&64||At&128)&&Xe.process(se,_e,Ce,Ne,Be,et,ht,Ye,tt,xi)}Ft!=null&&Be&&gm(Ft,se&&se.ref,et,_e||se,!_e)},Fe=(se,_e,Ce,Ne)=>{if(se==null)A(_e.el=o(_e.children),Ce,Ne);else{const Be=_e.el=se.el;_e.children!==se.children&&j(Be,_e.children)}},ft=(se,_e,Ce,Ne)=>{se==null?A(_e.el=L(_e.children||""),Ce,Ne):_e.el=se.el},Pt=(se,_e,Ce,Ne)=>{[se.el,se.anchor]=Ee(se.children,_e,Ce,Ne,se.el,se.anchor)},mt=({el:se,anchor:_e},Ce,Ne)=>{let Be;for(;se&&se!==_e;)Be=Z(se),A(se,Ce,Ne),se=Be;A(_e,Ce,Ne)},Rt=({el:se,anchor:_e})=>{let Ce;for(;se&&se!==_e;)Ce=Z(se),w(se),se=Ce;w(_e)},Ke=(se,_e,Ce,Ne,Be,et,ht,Ye,tt)=>{ht=ht||_e.type==="svg",se==null?We(_e,Ce,Ne,Be,et,ht,Ye,tt):Dt(se,_e,Be,et,ht,Ye,tt)},We=(se,_e,Ce,Ne,Be,et,ht,Ye)=>{let tt,Xe;const{type:Ft,props:At,shapeFlag:Lt,transition:Vt,patchFlag:Jt,dirs:hi}=se;if(se.el&&ce!==void 0&&Jt===-1)tt=se.el=ce(se.el);else{if(tt=se.el=z(se.type,et,At&&At.is,At),Lt&8?O(tt,se.children):Lt&16&&Tt(se.children,tt,null,Ne,Be,et&&Ft!=="foreignObject",ht,Ye),hi&&Da(se,null,Ne,"created"),At){for(const vi in At)vi!=="value"&&!Ld(vi)&&S(tt,vi,null,At[vi],et,se.children,Ne,Be,nt);"value"in At&&S(tt,"value",null,At.value),(Xe=At.onVnodeBeforeMount)&&Eo(Xe,Ne,se)}gt(tt,se,se.scopeId,ht,Ne)}hi&&Da(se,null,Ne,"beforeMount");const ni=(!Be||Be&&!Be.pendingBranch)&&Vt&&!Vt.persisted;ni&&Vt.beforeEnter(tt),A(tt,_e,Ce),((Xe=At&&At.onVnodeMounted)||ni||hi)&&dn(()=>{Xe&&Eo(Xe,Ne,se),ni&&Vt.enter(tt),hi&&Da(se,null,Ne,"mounted")},Be)},gt=(se,_e,Ce,Ne,Be)=>{if(Ce&&Q(se,Ce),Ne)for(let et=0;et<Ne.length;et++)Q(se,Ne[et]);if(Be){let et=Be.subTree;if(_e===et){const ht=Be.vnode;gt(se,ht,ht.scopeId,ht.slotScopeIds,Be.parent)}}},Tt=(se,_e,Ce,Ne,Be,et,ht,Ye,tt=0)=>{for(let Xe=tt;Xe<se.length;Xe++){const Ft=se[Xe]=Ye?$s(se[Xe]):To(se[Xe]);Ae(null,Ft,_e,Ce,Ne,Be,et,ht,Ye)}},Dt=(se,_e,Ce,Ne,Be,et,ht)=>{const Ye=_e.el=se.el;let{patchFlag:tt,dynamicChildren:Xe,dirs:Ft}=_e;tt|=se.patchFlag&16;const At=se.props||Vi,Lt=_e.props||Vi;let Vt;Ce&&Ba(Ce,!1),(Vt=Lt.onVnodeBeforeUpdate)&&Eo(Vt,Ce,_e,se),Ft&&Da(_e,se,Ce,"beforeUpdate"),Ce&&Ba(Ce,!0);const Jt=Be&&_e.type!=="foreignObject";if(Xe?It(se.dynamicChildren,Xe,Ye,Ce,Ne,Jt,et):ht||ki(se,_e,Ye,null,Ce,Ne,Jt,et,!1),tt>0){if(tt&16)yt(Ye,_e,At,Lt,Ce,Ne,Be);else if(tt&2&&At.class!==Lt.class&&S(Ye,"class",null,Lt.class,Be),tt&4&&S(Ye,"style",At.style,Lt.style,Be),tt&8){const hi=_e.dynamicProps;for(let ni=0;ni<hi.length;ni++){const vi=hi[ni],gr=At[vi],Pr=Lt[vi];(Pr!==gr||vi==="value")&&S(Ye,vi,gr,Pr,Be,se.children,Ce,Ne,nt)}}tt&1&&se.children!==_e.children&&O(Ye,_e.children)}else!ht&&Xe==null&&yt(Ye,_e,At,Lt,Ce,Ne,Be);((Vt=Lt.onVnodeUpdated)||Ft)&&dn(()=>{Vt&&Eo(Vt,Ce,_e,se),Ft&&Da(_e,se,Ce,"updated")},Ne)},It=(se,_e,Ce,Ne,Be,et,ht)=>{for(let Ye=0;Ye<_e.length;Ye++){const tt=se[Ye],Xe=_e[Ye],Ft=tt.el&&(tt.type===eo||!Oa(tt,Xe)||tt.shapeFlag&70)?B(tt.el):Ce;Ae(tt,Xe,Ft,null,Ne,Be,et,ht,!0)}},yt=(se,_e,Ce,Ne,Be,et,ht)=>{if(Ce!==Ne){for(const Ye in Ne){if(Ld(Ye))continue;const tt=Ne[Ye],Xe=Ce[Ye];tt!==Xe&&Ye!=="value"&&S(se,Ye,Xe,tt,ht,_e.children,Be,et,nt)}if(Ce!==Vi)for(const Ye in Ce)!Ld(Ye)&&!(Ye in Ne)&&S(se,Ye,Ce[Ye],null,ht,_e.children,Be,et,nt);"value"in Ne&&S(se,"value",Ce.value,Ne.value)}},ti=(se,_e,Ce,Ne,Be,et,ht,Ye,tt)=>{const Xe=_e.el=se?se.el:o(""),Ft=_e.anchor=se?se.anchor:o("");let{patchFlag:At,dynamicChildren:Lt,slotScopeIds:Vt}=_e;Vt&&(Ye=Ye?Ye.concat(Vt):Vt),se==null?(A(Xe,Ce,Ne),A(Ft,Ce,Ne),Tt(_e.children,Ce,Ft,Be,et,ht,Ye,tt)):At>0&&At&64&&Lt&&se.dynamicChildren?(It(se.dynamicChildren,Lt,Ce,Be,et,ht,Ye),(_e.key!=null||Be&&_e===Be.subTree)&&n_(se,_e,!0)):ki(se,_e,Ce,Ft,Be,et,ht,Ye,tt)},li=(se,_e,Ce,Ne,Be,et,ht,Ye,tt)=>{_e.slotScopeIds=Ye,se==null?_e.shapeFlag&512?Be.ctx.activate(_e,Ce,Ne,ht,tt):_r(_e,Ce,Ne,Be,et,ht,tt):bi(se,_e,tt)},_r=(se,_e,Ce,Ne,Be,et,ht)=>{const Ye=se.component=g2(se,Ne,Be);if(np(se)&&(Ye.ctx.renderer=xi),y2(Ye),Ye.asyncDep){if(Be&&Be.registerDep(Ye,ui),!se.el){const tt=Ye.subTree=ji(Co);ft(null,tt,_e,Ce)}return}ui(Ye,se,_e,Ce,Be,et,ht)},bi=(se,_e,Ce)=>{const Ne=_e.component=se.component;if(Iw(se,_e,Ce))if(Ne.asyncDep&&!Ne.asyncResolved){Bt(Ne,_e,Ce);return}else Ne.next=_e,vw(Ne.update),Ne.update();else _e.component=se.component,_e.el=se.el,Ne.vnode=_e},ui=(se,_e,Ce,Ne,Be,et,ht)=>{const Ye=()=>{if(se.isMounted){let{next:Ft,bu:At,u:Lt,parent:Vt,vnode:Jt}=se,hi=Ft,ni;Ba(se,!1),Ft?(Ft.el=Jt.el,Bt(se,Ft,ht)):Ft=Jt,At&&Rd(At),(ni=Ft.props&&Ft.props.onVnodeBeforeUpdate)&&Eo(ni,Vt,Ft,Jt),Ba(se,!0);const vi=Nf(se),gr=se.subTree;se.subTree=vi,Ae(gr,vi,B(gr.el),Ct(gr),se,Be,et),Ft.el=vi.el,hi===null&&Cw(se,vi.el),Lt&&dn(Lt,Be),(ni=Ft.props&&Ft.props.onVnodeUpdated)&&dn(()=>Eo(ni,Vt,Ft,Jt),Be)}else{let Ft;const{el:At,props:Lt}=_e,{bm:Vt,m:Jt,parent:hi}=se,ni=pm(_e);if(Ba(se,!1),Vt&&Rd(Vt),!ni&&(Ft=Lt&&Lt.onVnodeBeforeMount)&&Eo(Ft,hi,_e),Ba(se,!0),At&&at){const vi=()=>{se.subTree=Nf(se),at(At,se.subTree,se,Be,null)};ni?_e.type.__asyncLoader().then(()=>!se.isUnmounted&&vi()):vi()}else{const vi=se.subTree=Nf(se);Ae(null,vi,Ce,Ne,se,Be,et),_e.el=vi.el}if(Jt&&dn(Jt,Be),!ni&&(Ft=Lt&&Lt.onVnodeMounted)){const vi=_e;dn(()=>Eo(Ft,hi,vi),Be)}_e.shapeFlag&256&&se.a&&dn(se.a,Be),se.isMounted=!0,_e=Ce=Ne=null}},tt=se.effect=new qm(Ye,()=>vv(se.update),se.scope),Xe=se.update=tt.run.bind(tt);Xe.id=se.uid,Ba(se,!0),Xe()},Bt=(se,_e,Ce)=>{_e.component=se;const Ne=se.vnode.props;se.vnode=_e,se.next=null,Hw(se,_e.props,Ne,Ce),Kw(se,_e.children,Ce),uc(),Jm(void 0,se.update),hc()},ki=(se,_e,Ce,Ne,Be,et,ht,Ye,tt=!1)=>{const Xe=se&&se.children,Ft=se?se.shapeFlag:0,At=_e.children,{patchFlag:Lt,shapeFlag:Vt}=_e;if(Lt>0){if(Lt&128){Qi(Xe,At,Ce,Ne,Be,et,ht,Ye,tt);return}else if(Lt&256){Sr(Xe,At,Ce,Ne,Be,et,ht,Ye,tt);return}}Vt&8?(Ft&16&&nt(Xe,Be,et),At!==Xe&&O(Ce,At)):Ft&16?Vt&16?Qi(Xe,At,Ce,Ne,Be,et,ht,Ye,tt):nt(Xe,Be,et,!0):(Ft&8&&O(Ce,""),Vt&16&&Tt(At,Ce,Ne,Be,et,ht,Ye,tt))},Sr=(se,_e,Ce,Ne,Be,et,ht,Ye,tt)=>{se=se||tc,_e=_e||tc;const Xe=se.length,Ft=_e.length,At=Math.min(Xe,Ft);let Lt;for(Lt=0;Lt<At;Lt++){const Vt=_e[Lt]=tt?$s(_e[Lt]):To(_e[Lt]);Ae(se[Lt],Vt,Ce,null,Be,et,ht,Ye,tt)}Xe>Ft?nt(se,Be,et,!0,!1,At):Tt(_e,Ce,Ne,Be,et,ht,Ye,tt,At)},Qi=(se,_e,Ce,Ne,Be,et,ht,Ye,tt)=>{let Xe=0;const Ft=_e.length;let At=se.length-1,Lt=Ft-1;for(;Xe<=At&&Xe<=Lt;){const Vt=se[Xe],Jt=_e[Xe]=tt?$s(_e[Xe]):To(_e[Xe]);if(Oa(Vt,Jt))Ae(Vt,Jt,Ce,null,Be,et,ht,Ye,tt);else break;Xe++}for(;Xe<=At&&Xe<=Lt;){const Vt=se[At],Jt=_e[Lt]=tt?$s(_e[Lt]):To(_e[Lt]);if(Oa(Vt,Jt))Ae(Vt,Jt,Ce,null,Be,et,ht,Ye,tt);else break;At--,Lt--}if(Xe>At){if(Xe<=Lt){const Vt=Lt+1,Jt=Vt<Ft?_e[Vt].el:Ne;for(;Xe<=Lt;)Ae(null,_e[Xe]=tt?$s(_e[Xe]):To(_e[Xe]),Ce,Jt,Be,et,ht,Ye,tt),Xe++}}else if(Xe>Lt)for(;Xe<=At;)Yt(se[Xe],Be,et,!0),Xe++;else{const Vt=Xe,Jt=Xe,hi=new Map;for(Xe=Jt;Xe<=Lt;Xe++){const cr=_e[Xe]=tt?$s(_e[Xe]):To(_e[Xe]);cr.key!=null&&hi.set(cr.key,Xe)}let ni,vi=0;const gr=Lt-Jt+1;let Pr=!1,jn=0;const Nn=new Array(gr);for(Xe=0;Xe<gr;Xe++)Nn[Xe]=0;for(Xe=Vt;Xe<=At;Xe++){const cr=se[Xe];if(vi>=gr){Yt(cr,Be,et,!0);continue}let yr;if(cr.key!=null)yr=hi.get(cr.key);else for(ni=Jt;ni<=Lt;ni++)if(Nn[ni-Jt]===0&&Oa(cr,_e[ni])){yr=ni;break}yr===void 0?Yt(cr,Be,et,!0):(Nn[yr-Jt]=Xe+1,yr>=jn?jn=yr:Pr=!0,Ae(cr,_e[yr],Ce,null,Be,et,ht,Ye,tt),vi++)}const zo=Pr?r2(Nn):tc;for(ni=zo.length-1,Xe=gr-1;Xe>=0;Xe--){const cr=Jt+Xe,yr=_e[cr],Po=cr+1<Ft?_e[cr+1].el:Ne;Nn[Xe]===0?Ae(null,yr,Ce,Po,Be,et,ht,Ye,tt):Pr&&(ni<0||Xe!==zo[ni]?Ir(yr,Ce,Po,2):ni--)}}},Ir=(se,_e,Ce,Ne,Be=null)=>{const{el:et,type:ht,transition:Ye,children:tt,shapeFlag:Xe}=se;if(Xe&6){Ir(se.component.subTree,_e,Ce,Ne);return}if(Xe&128){se.suspense.move(_e,Ce,Ne);return}if(Xe&64){ht.move(se,_e,Ce,xi);return}if(ht===eo){A(et,_e,Ce);for(let At=0;At<tt.length;At++)Ir(tt[At],_e,Ce,Ne);A(se.anchor,_e,Ce);return}if(ht===Fd){mt(se,_e,Ce);return}if(Ne!==2&&Xe&1&&Ye)if(Ne===0)Ye.beforeEnter(et),A(et,_e,Ce),dn(()=>Ye.enter(et),Be);else{const{leave:At,delayLeave:Lt,afterLeave:Vt}=Ye,Jt=()=>A(et,_e,Ce),hi=()=>{At(et,()=>{Jt(),Vt&&Vt()})};Lt?Lt(et,Jt,hi):hi()}else A(et,_e,Ce)},Yt=(se,_e,Ce,Ne=!1,Be=!1)=>{const{type:et,props:ht,ref:Ye,children:tt,dynamicChildren:Xe,shapeFlag:Ft,patchFlag:At,dirs:Lt}=se;if(Ye!=null&&gm(Ye,null,Ce,se,!0),Ft&256){_e.ctx.deactivate(se);return}const Vt=Ft&1&&Lt,Jt=!pm(se);let hi;if(Jt&&(hi=ht&&ht.onVnodeBeforeUnmount)&&Eo(hi,_e,se),Ft&6)xt(se.component,Ce,Ne);else{if(Ft&128){se.suspense.unmount(Ce,Ne);return}Vt&&Da(se,null,_e,"beforeUnmount"),Ft&64?se.type.remove(se,_e,Ce,Be,xi,Ne):Xe&&(et!==eo||At>0&&At&64)?nt(Xe,_e,Ce,!1,!0):(et===eo&&At&384||!Be&&Ft&16)&&nt(tt,_e,Ce),Ne&&ir(se)}(Jt&&(hi=ht&&ht.onVnodeUnmounted)||Vt)&&dn(()=>{hi&&Eo(hi,_e,se),Vt&&Da(se,null,_e,"unmounted")},Ce)},ir=se=>{const{type:_e,el:Ce,anchor:Ne,transition:Be}=se;if(_e===eo){Ue(Ce,Ne);return}if(_e===Fd){Rt(se);return}const et=()=>{w(Ce),Be&&!Be.persisted&&Be.afterLeave&&Be.afterLeave()};if(se.shapeFlag&1&&Be&&!Be.persisted){const{leave:ht,delayLeave:Ye}=Be,tt=()=>ht(Ce,et);Ye?Ye(se.el,et,tt):tt()}else et()},Ue=(se,_e)=>{let Ce;for(;se!==_e;)Ce=Z(se),w(se),se=Ce;w(_e)},xt=(se,_e,Ce)=>{const{bum:Ne,scope:Be,update:et,subTree:ht,um:Ye}=se;Ne&&Rd(Ne),Be.stop(),et&&(et.active=!1,Yt(ht,se,_e,Ce)),Ye&&dn(Ye,_e),dn(()=>{se.isUnmounted=!0},_e),_e&&_e.pendingBranch&&!_e.isUnmounted&&se.asyncDep&&!se.asyncResolved&&se.suspenseId===_e.pendingId&&(_e.deps--,_e.deps===0&&_e.resolve())},nt=(se,_e,Ce,Ne=!1,Be=!1,et=0)=>{for(let ht=et;ht<se.length;ht++)Yt(se[ht],_e,Ce,Ne,Be)},Ct=se=>se.shapeFlag&6?Ct(se.component.subTree):se.shapeFlag&128?se.suspense.next():Z(se.anchor||se.el),wi=(se,_e,Ce)=>{se==null?_e._vnode&&Yt(_e._vnode,null,null,!0):Ae(_e._vnode||null,se,_e,null,null,null,Ce),wv(),_e._vnode=se},xi={p:Ae,um:Yt,m:Ir,r:ir,mt:_r,mc:Tt,pc:ki,pbc:It,n:Ct,o:a};let Zt,at;return d&&([Zt,at]=d(xi)),{render:wi,hydrate:Zt,createApp:e2(wi,Zt)}}function Ba({effect:a,update:d},g){a.allowRecurse=d.allowRecurse=g}function n_(a,d,g=!1){const A=a.children,w=d.children;if(Xt(A)&&Xt(w))for(let S=0;S<A.length;S++){const z=A[S];let o=w[S];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=w[S]=$s(w[S]),o.el=z.el),g||n_(z,o))}}function r2(a){const d=a.slice(),g=[0];let A,w,S,z,o;const L=a.length;for(A=0;A<L;A++){const j=a[A];if(j!==0){if(w=g[g.length-1],a[w]<j){d[A]=w,g.push(A);continue}for(S=0,z=g.length-1;S<z;)o=S+z>>1,a[g[o]]<j?S=o+1:z=o;j<a[g[S]]&&(S>0&&(d[A]=g[S-1]),g[S]=A)}}for(S=g.length,z=g[S-1];S-- >0;)g[S]=z,z=d[z];return g}const n2=a=>a.__isTeleport,Vu=a=>a&&(a.disabled||a.disabled===""),Zy=a=>typeof SVGElement!="undefined"&&a instanceof SVGElement,ym=(a,d)=>{const g=a&&a.to;return fr(g)?d?d(g):null:g},o2={__isTeleport:!0,process(a,d,g,A,w,S,z,o,L,j){const{mc:O,pc:B,pbc:Z,o:{insert:Q,querySelector:ce,createText:Ee,createComment:Ae}}=j,Fe=Vu(d.props);let{shapeFlag:ft,children:Pt,dynamicChildren:mt}=d;if(a==null){const Rt=d.el=Ee(""),Ke=d.anchor=Ee("");Q(Rt,g,A),Q(Ke,g,A);const We=d.target=ym(d.props,ce),gt=d.targetAnchor=Ee("");We&&(Q(gt,We),z=z||Zy(We));const Tt=(Dt,It)=>{ft&16&&O(Pt,Dt,It,w,S,z,o,L)};Fe?Tt(g,Ke):We&&Tt(We,gt)}else{d.el=a.el;const Rt=d.anchor=a.anchor,Ke=d.target=a.target,We=d.targetAnchor=a.targetAnchor,gt=Vu(a.props),Tt=gt?g:Ke,Dt=gt?Rt:We;if(z=z||Zy(Ke),mt?(Z(a.dynamicChildren,mt,Tt,w,S,z,o),n_(a,d,!0)):L||B(a,d,Tt,Dt,w,S,z,o,!1),Fe)gt||Md(d,g,Rt,j,1);else if((d.props&&d.props.to)!==(a.props&&a.props.to)){const It=d.target=ym(d.props,ce);It&&Md(d,It,null,j,0)}else gt&&Md(d,Ke,We,j,1)}},remove(a,d,g,A,{um:w,o:{remove:S}},z){const{shapeFlag:o,children:L,anchor:j,targetAnchor:O,target:B,props:Z}=a;if(B&&S(O),(z||!Vu(Z))&&(S(j),o&16))for(let Q=0;Q<L.length;Q++){const ce=L[Q];w(ce,d,g,!0,!!ce.dynamicChildren)}},move:Md,hydrate:s2};function Md(a,d,g,{o:{insert:A},m:w},S=2){S===0&&A(a.targetAnchor,d,g);const{el:z,anchor:o,shapeFlag:L,children:j,props:O}=a,B=S===2;if(B&&A(z,d,g),(!B||Vu(O))&&L&16)for(let Z=0;Z<j.length;Z++)w(j[Z],d,g,2);B&&A(o,d,g)}function s2(a,d,g,A,w,S,{o:{nextSibling:z,parentNode:o,querySelector:L}},j){const O=d.target=ym(d.props,L);if(O){const B=O._lpa||O.firstChild;d.shapeFlag&16&&(Vu(d.props)?(d.anchor=j(z(a),d,o(a),g,A,w,S),d.targetAnchor=B):(d.anchor=z(a),d.targetAnchor=j(B,d,O,g,A,w,S)),O._lpa=d.targetAnchor&&z(d.targetAnchor))}return d.anchor&&z(d.anchor)}const a2=o2,jv="components",Nv=Symbol();function UI(a){return fr(a)?l2(jv,a,!1)||a:a||Nv}function l2(a,d,g=!0,A=!1){const w=Un||Tr;if(w){const S=w.type;if(a===jv){const o=b2(S);if(o&&(o===d||o===Io(d)||o===tp(Io(d))))return S}const z=qy(w[a]||S[a],d)||qy(w.appContext[a],d);return!z&&A?S:z}}function qy(a,d){return a&&(a[d]||a[Io(d)]||a[tp(Io(d))])}const eo=Symbol(void 0),o_=Symbol(void 0),Co=Symbol(void 0),Fd=Symbol(void 0),ju=[];let Na=null;function _n(a=!1){ju.push(Na=a?null:[])}function c2(){ju.pop(),Na=ju[ju.length-1]||null}let Wd=1;function Wy(a){Wd+=a}function $v(a){return a.dynamicChildren=Wd>0?Na||tc:null,c2(),Wd>0&&Na&&Na.push(a),a}function VI(a,d,g,A,w,S){return $v(Zv(a,d,g,A,w,S,!0))}function gn(a,d,g,A,w){return $v(ji(a,d,g,A,w,!0))}function xm(a){return a?a.__v_isVNode===!0:!1}function Oa(a,d){return a.type===d.type&&a.key===d.key}const sp="__vInternal",Gv=({key:a})=>a!=null?a:null,Od=({ref:a,ref_key:d,ref_for:g})=>a!=null?fr(a)||Hi(a)||ci(a)?{i:Un,r:a,k:d,f:!!g}:a:null;function Zv(a,d=null,g=null,A=0,w=null,S=a===eo?0:1,z=!1,o=!1){const L={__v_isVNode:!0,__v_skip:!0,type:a,props:d,key:d&&Gv(d),ref:d&&Od(d),scopeId:Sv,slotScopeIds:null,children:g,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:S,patchFlag:A,dynamicProps:w,dynamicChildren:null,appContext:null};return o?(s_(L,g),S&128&&a.normalize(L)):g&&(L.shapeFlag|=fr(g)?8:16),Wd>0&&!z&&Na&&(L.patchFlag>0||S&6)&&L.patchFlag!==32&&Na.push(L),L}const ji=u2;function u2(a,d=null,g=null,A=0,w=null,S=!1){if((!a||a===Nv)&&(a=Co),xm(a)){const o=Ga(a,d,!0);return g&&s_(o,g),o}if(w2(a)&&(a=a.__vccOpts),d){d=h2(d);let{class:o,style:L}=d;o&&!fr(o)&&(d.class=Vm(o)),mr(L)&&(fv(L)&&!Xt(L)&&(L=zr({},L)),d.style=Um(L))}const z=fr(a)?1:Mw(a)?128:n2(a)?64:mr(a)?4:ci(a)?2:0;return Zv(a,d,g,A,w,z,S,!0)}function h2(a){return a?fv(a)||sp in a?zr({},a):a:null}function Ga(a,d,g=!1){const{props:A,ref:w,patchFlag:S,children:z}=a,o=d?p2(A||{},d):A;return{__v_isVNode:!0,__v_skip:!0,type:a.type,props:o,key:o&&Gv(o),ref:d&&d.ref?g&&w?Xt(w)?w.concat(Od(d)):[w,Od(d)]:Od(d):w,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:z,target:a.target,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:d&&a.type!==eo?S===-1?16:S|16:S,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:a.transition,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&Ga(a.ssContent),ssFallback:a.ssFallback&&Ga(a.ssFallback),el:a.el,anchor:a.anchor}}function d2(a=" ",d=0){return ji(o_,null,a,d)}function jI(a,d){const g=ji(Fd,null,a);return g.staticCount=d,g}function NI(a="",d=!1){return d?(_n(),gn(Co,null,a)):ji(Co,null,a)}function To(a){return a==null||typeof a=="boolean"?ji(Co):Xt(a)?ji(eo,null,a.slice()):typeof a=="object"?$s(a):ji(o_,null,String(a))}function $s(a){return a.el===null||a.memo?a:Ga(a)}function s_(a,d){let g=0;const{shapeFlag:A}=a;if(d==null)d=null;else if(Xt(d))g=16;else if(typeof d=="object")if(A&65){const w=d.default;w&&(w._c&&(w._d=!1),s_(a,w()),w._c&&(w._d=!0));return}else{g=32;const w=d._;!w&&!(sp in d)?d._ctx=Un:w===3&&Un&&(Un.slots._===1?d._=1:(d._=2,a.patchFlag|=1024))}else ci(d)?(d={default:d,_ctx:Un},g=32):(d=String(d),A&64?(g=16,d=[d2(d)]):g=8);a.children=d,a.shapeFlag|=g}function p2(...a){const d={};for(let g=0;g<a.length;g++){const A=a[g];for(const w in A)if(w==="class")d.class!==A.class&&(d.class=Vm([d.class,A.class]));else if(w==="style")d.style=Um([d.style,A.style]);else if(Kd(w)){const S=d[w],z=A[w];z&&S!==z&&!(Xt(S)&&S.includes(z))&&(d[w]=S?[].concat(S,z):z)}else w!==""&&(d[w]=A[w])}return d}function Eo(a,d,g,A=null){Vn(a,d,7,[g,A])}function $I(a,d,g,A){let w;const S=g&&g[A];if(Xt(a)||fr(a)){w=new Array(a.length);for(let z=0,o=a.length;z<o;z++)w[z]=d(a[z],z,void 0,S&&S[z])}else if(typeof a=="number"){w=new Array(a);for(let z=0;z<a;z++)w[z]=d(z+1,z,void 0,S&&S[z])}else if(mr(a))if(a[Symbol.iterator])w=Array.from(a,(z,o)=>d(z,o,void 0,S&&S[o]));else{const z=Object.keys(a);w=new Array(z.length);for(let o=0,L=z.length;o<L;o++){const j=z[o];w[o]=d(a[j],j,o,S&&S[o])}}else w=[];return g&&(g[A]=w),w}const vm=a=>a?qv(a)?a_(a)||a.proxy:vm(a.parent):null,Xd=zr(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>vm(a.parent),$root:a=>vm(a.root),$emit:a=>a.emit,$options:a=>Bv(a),$forceUpdate:a=>()=>vv(a.update),$nextTick:a=>Mn.bind(a.proxy),$watch:a=>zw.bind(a)}),f2={get({_:a},d){const{ctx:g,setupState:A,data:w,props:S,accessCache:z,type:o,appContext:L}=a;let j;if(d[0]!=="$"){const Q=z[d];if(Q!==void 0)switch(Q){case 1:return A[d];case 2:return w[d];case 4:return g[d];case 3:return S[d]}else{if(A!==Vi&&Ii(A,d))return z[d]=1,A[d];if(w!==Vi&&Ii(w,d))return z[d]=2,w[d];if((j=a.propsOptions[0])&&Ii(j,d))return z[d]=3,S[d];if(g!==Vi&&Ii(g,d))return z[d]=4,g[d];fm&&(z[d]=0)}}const O=Xd[d];let B,Z;if(O)return d==="$attrs"&&zn(a,"get",d),O(a);if((B=o.__cssModules)&&(B=B[d]))return B;if(g!==Vi&&Ii(g,d))return z[d]=4,g[d];if(Z=L.config.globalProperties,Ii(Z,d))return Z[d]},set({_:a},d,g){const{data:A,setupState:w,ctx:S}=a;return w!==Vi&&Ii(w,d)?(w[d]=g,!0):A!==Vi&&Ii(A,d)?(A[d]=g,!0):Ii(a.props,d)||d[0]==="$"&&d.slice(1)in a?!1:(S[d]=g,!0)},has({_:{data:a,setupState:d,accessCache:g,ctx:A,appContext:w,propsOptions:S}},z){let o;return!!g[z]||a!==Vi&&Ii(a,z)||d!==Vi&&Ii(d,z)||(o=S[0])&&Ii(o,z)||Ii(A,z)||Ii(Xd,z)||Ii(w.config.globalProperties,z)},defineProperty(a,d,g){return g.get!=null?this.set(a,d,g.get(),null):g.value!=null&&this.set(a,d,g.value,null),Reflect.defineProperty(a,d,g)}},m2=Vv();let _2=0;function g2(a,d,g){const A=a.type,w=(d?d.appContext:a.appContext)||m2,S={uid:_2++,vnode:a,type:A,parent:d,appContext:w,root:null,next:null,subTree:null,effect:null,update:null,scope:new ev(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(w.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Rv(A,w),emitsOptions:Tv(A,w),emit:null,emitted:null,propsDefaults:Vi,inheritAttrs:A.inheritAttrs,ctx:Vi,data:Vi,props:Vi,attrs:Vi,slots:Vi,refs:Vi,setupState:Vi,setupContext:null,suspense:g,suspenseId:g?g.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return S.ctx={_:S},S.root=d?d.root:S,S.emit=ww.bind(null,S),a.ce&&a.ce(S),S}let Tr=null;const ap=()=>Tr||Un,oc=a=>{Tr=a,a.scope.on()},$a=()=>{Tr&&Tr.scope.off(),Tr=null};function qv(a){return a.vnode.shapeFlag&4}let Xu=!1;function y2(a,d=!1){Xu=d;const{props:g,children:A}=a.vnode,w=qv(a);Xw(a,g,w,d),Yw(a,A);const S=w?x2(a,d):void 0;return Xu=!1,S}function x2(a,d){const g=a.type;a.accessCache=Object.create(null),a.proxy=nc(new Proxy(a.ctx,f2));const{setup:A}=g;if(A){const w=a.setupContext=A.length>1?A2(a):null;oc(a),uc();const S=Ws(A,a,0,[a.props,w]);if(hc(),$a(),Yx(S)){if(S.then($a,$a),d)return S.then(z=>{Xy(a,z,d)}).catch(z=>{rp(z,a,0)});a.asyncDep=S}else Xy(a,S,d)}else Wv(a,d)}function Xy(a,d,g){ci(d)?a.type.__ssrInlineRender?a.ssrRender=d:a.render=d:mr(d)&&(a.setupState=yv(d)),Wv(a,g)}let Hy;function Wv(a,d,g){const A=a.type;if(!a.render){if(!d&&Hy&&!A.render){const w=A.template;if(w){const{isCustomElement:S,compilerOptions:z}=a.appContext.config,{delimiters:o,compilerOptions:L}=A,j=zr(zr({isCustomElement:S,delimiters:o},z),L);A.render=Hy(w,j)}}a.render=A.render||to}oc(a),uc(),$w(a),hc(),$a()}function v2(a){return new Proxy(a.attrs,{get(d,g){return zn(a,"get","$attrs"),d[g]}})}function A2(a){const d=A=>{a.exposed=A||{}};let g;return{get attrs(){return g||(g=v2(a))},slots:a.slots,emit:a.emit,expose:d}}function a_(a){if(a.exposed)return a.exposeProxy||(a.exposeProxy=new Proxy(yv(nc(a.exposed)),{get(d,g){if(g in d)return d[g];if(g in Xd)return Xd[g](a)}}))}function b2(a){return ci(a)&&a.displayName||a.name}function w2(a){return ci(a)&&"__vccOpts"in a}const zt=(a,d)=>gw(a,d,Xu);function Yr(a,d,g){const A=arguments.length;return A===2?mr(d)&&!Xt(d)?xm(d)?ji(a,null,[d]):ji(a,d):ji(a,null,d):(A>3?g=Array.prototype.slice.call(arguments,2):A===3&&xm(g)&&(g=[g]),ji(a,d,g))}const E2="3.2.31",T2="http://www.w3.org/2000/svg",Ua=typeof document!="undefined"?document:null,Qy=Ua&&Ua.createElement("template"),S2={insert:(a,d,g)=>{d.insertBefore(a,g||null)},remove:a=>{const d=a.parentNode;d&&d.removeChild(a)},createElement:(a,d,g,A)=>{const w=d?Ua.createElementNS(T2,a):Ua.createElement(a,g?{is:g}:void 0);return a==="select"&&A&&A.multiple!=null&&w.setAttribute("multiple",A.multiple),w},createText:a=>Ua.createTextNode(a),createComment:a=>Ua.createComment(a),setText:(a,d)=>{a.nodeValue=d},setElementText:(a,d)=>{a.textContent=d},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Ua.querySelector(a),setScopeId(a,d){a.setAttribute(d,"")},cloneNode(a){const d=a.cloneNode(!0);return"_value"in a&&(d._value=a._value),d},insertStaticContent(a,d,g,A,w,S){const z=g?g.previousSibling:d.lastChild;if(w&&(w===S||w.nextSibling))for(;d.insertBefore(w.cloneNode(!0),g),!(w===S||!(w=w.nextSibling)););else{Qy.innerHTML=A?`<svg>${a}</svg>`:a;const o=Qy.content;if(A){const L=o.firstChild;for(;L.firstChild;)o.appendChild(L.firstChild);o.removeChild(L)}d.insertBefore(o,g)}return[z?z.nextSibling:d.firstChild,g?g.previousSibling:d.lastChild]}};function I2(a,d,g){const A=a._vtc;A&&(d=(d?[d,...A]:[...A]).join(" ")),d==null?a.removeAttribute("class"):g?a.setAttribute("class",d):a.className=d}function C2(a,d,g){const A=a.style,w=fr(g);if(g&&!w){for(const S in g)Am(A,S,g[S]);if(d&&!fr(d))for(const S in d)g[S]==null&&Am(A,S,"")}else{const S=A.display;w?d!==g&&(A.cssText=g):d&&a.removeAttribute("style"),"_vod"in a&&(A.display=S)}}const Yy=/\s*!important$/;function Am(a,d,g){if(Xt(g))g.forEach(A=>Am(a,d,A));else if(d.startsWith("--"))a.setProperty(d,g);else{const A=M2(a,d);Yy.test(g)?a.setProperty(cc(A),g.replace(Yy,""),"important"):a[A]=g}}const Ky=["Webkit","Moz","ms"],Gf={};function M2(a,d){const g=Gf[d];if(g)return g;let A=Io(d);if(A!=="filter"&&A in a)return Gf[d]=A;A=tp(A);for(let w=0;w<Ky.length;w++){const S=Ky[w]+A;if(S in a)return Gf[d]=S}return d}const Jy="http://www.w3.org/1999/xlink";function k2(a,d,g,A,w){if(A&&d.startsWith("xlink:"))g==null?a.removeAttributeNS(Jy,d.slice(6,d.length)):a.setAttributeNS(Jy,d,g);else{const S=Sb(d);g==null||S&&!Xx(g)?a.removeAttribute(d):a.setAttribute(d,S?"":g)}}function z2(a,d,g,A,w,S,z){if(d==="innerHTML"||d==="textContent"){A&&z(A,w,S),a[d]=g==null?"":g;return}if(d==="value"&&a.tagName!=="PROGRESS"&&!a.tagName.includes("-")){a._value=g;const o=g==null?"":g;(a.value!==o||a.tagName==="OPTION")&&(a.value=o),g==null&&a.removeAttribute(d);return}if(g===""||g==null){const o=typeof a[d];if(o==="boolean"){a[d]=Xx(g);return}else if(g==null&&o==="string"){a[d]="",a.removeAttribute(d);return}else if(o==="number"){try{a[d]=0}catch{}a.removeAttribute(d);return}}try{a[d]=g}catch{}}let Hd=Date.now,Xv=!1;if(typeof window!="undefined"){Hd()>document.createEvent("Event").timeStamp&&(Hd=()=>performance.now());const a=navigator.userAgent.match(/firefox\/(\d+)/i);Xv=!!(a&&Number(a[1])<=53)}let bm=0;const P2=Promise.resolve(),D2=()=>{bm=0},B2=()=>bm||(P2.then(D2),bm=Hd());function Jl(a,d,g,A){a.addEventListener(d,g,A)}function L2(a,d,g,A){a.removeEventListener(d,g,A)}function R2(a,d,g,A,w=null){const S=a._vei||(a._vei={}),z=S[d];if(A&&z)z.value=A;else{const[o,L]=F2(d);if(A){const j=S[d]=O2(A,w);Jl(a,o,j,L)}else z&&(L2(a,o,z,L),S[d]=void 0)}}const ex=/(?:Once|Passive|Capture)$/;function F2(a){let d;if(ex.test(a)){d={};let g;for(;g=a.match(ex);)a=a.slice(0,a.length-g[0].length),d[g[0].toLowerCase()]=!0}return[cc(a.slice(2)),d]}function O2(a,d){const g=A=>{const w=A.timeStamp||Hd();(Xv||w>=g.attached-1)&&Vn(U2(A,g.value),d,5,[A])};return g.value=a,g.attached=B2(),g}function U2(a,d){if(Xt(d)){const g=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{g.call(a),a._stopped=!0},d.map(A=>w=>!w._stopped&&A&&A(w))}else return d}const tx=/^on[a-z]/,V2=(a,d,g,A,w=!1,S,z,o,L)=>{d==="class"?I2(a,A,w):d==="style"?C2(a,g,A):Kd(d)?jm(d)||R2(a,d,g,A,z):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):j2(a,d,A,w))?z2(a,d,A,S,z,o,L):(d==="true-value"?a._trueValue=A:d==="false-value"&&(a._falseValue=A),k2(a,d,A,w))};function j2(a,d,g,A){return A?!!(d==="innerHTML"||d==="textContent"||d in a&&tx.test(d)&&ci(g)):d==="spellcheck"||d==="draggable"||d==="form"||d==="list"&&a.tagName==="INPUT"||d==="type"&&a.tagName==="TEXTAREA"||tx.test(d)&&fr(g)?!1:d in a}const Fs="transition",ku="animation",Hv=(a,{slots:d})=>Yr(Cv,N2(a),d);Hv.displayName="Transition";const Qv={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Hv.props=zr({},Cv.props,Qv);const La=(a,d=[])=>{Xt(a)?a.forEach(g=>g(...d)):a&&a(...d)},ix=a=>a?Xt(a)?a.some(d=>d.length>1):a.length>1:!1;function N2(a){const d={};for(const yt in a)yt in Qv||(d[yt]=a[yt]);if(a.css===!1)return d;const{name:g="v",type:A,duration:w,enterFromClass:S=`${g}-enter-from`,enterActiveClass:z=`${g}-enter-active`,enterToClass:o=`${g}-enter-to`,appearFromClass:L=S,appearActiveClass:j=z,appearToClass:O=o,leaveFromClass:B=`${g}-leave-from`,leaveActiveClass:Z=`${g}-leave-active`,leaveToClass:Q=`${g}-leave-to`}=a,ce=$2(w),Ee=ce&&ce[0],Ae=ce&&ce[1],{onBeforeEnter:Fe,onEnter:ft,onEnterCancelled:Pt,onLeave:mt,onLeaveCancelled:Rt,onBeforeAppear:Ke=Fe,onAppear:We=ft,onAppearCancelled:gt=Pt}=d,Tt=(yt,ti,li)=>{Zl(yt,ti?O:o),Zl(yt,ti?j:z),li&&li()},Dt=(yt,ti)=>{Zl(yt,Q),Zl(yt,Z),ti&&ti()},It=yt=>(ti,li)=>{const _r=yt?We:ft,bi=()=>Tt(ti,yt,li);La(_r,[ti,bi]),rx(()=>{Zl(ti,yt?L:S),Os(ti,yt?O:o),ix(_r)||nx(ti,A,Ee,bi)})};return zr(d,{onBeforeEnter(yt){La(Fe,[yt]),Os(yt,S),Os(yt,z)},onBeforeAppear(yt){La(Ke,[yt]),Os(yt,L),Os(yt,j)},onEnter:It(!1),onAppear:It(!0),onLeave(yt,ti){const li=()=>Dt(yt,ti);Os(yt,B),q2(),Os(yt,Z),rx(()=>{Zl(yt,B),Os(yt,Q),ix(mt)||nx(yt,A,Ae,li)}),La(mt,[yt,li])},onEnterCancelled(yt){Tt(yt,!1),La(Pt,[yt])},onAppearCancelled(yt){Tt(yt,!0),La(gt,[yt])},onLeaveCancelled(yt){Dt(yt),La(Rt,[yt])}})}function $2(a){if(a==null)return null;if(mr(a))return[Zf(a.enter),Zf(a.leave)];{const d=Zf(a);return[d,d]}}function Zf(a){return $d(a)}function Os(a,d){d.split(/\s+/).forEach(g=>g&&a.classList.add(g)),(a._vtc||(a._vtc=new Set)).add(d)}function Zl(a,d){d.split(/\s+/).forEach(A=>A&&a.classList.remove(A));const{_vtc:g}=a;g&&(g.delete(d),g.size||(a._vtc=void 0))}function rx(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let G2=0;function nx(a,d,g,A){const w=a._endId=++G2,S=()=>{w===a._endId&&A()};if(g)return setTimeout(S,g);const{type:z,timeout:o,propCount:L}=Z2(a,d);if(!z)return A();const j=z+"end";let O=0;const B=()=>{a.removeEventListener(j,Z),S()},Z=Q=>{Q.target===a&&++O>=L&&B()};setTimeout(()=>{O<L&&B()},o+1),a.addEventListener(j,Z)}function Z2(a,d){const g=window.getComputedStyle(a),A=ce=>(g[ce]||"").split(", "),w=A(Fs+"Delay"),S=A(Fs+"Duration"),z=ox(w,S),o=A(ku+"Delay"),L=A(ku+"Duration"),j=ox(o,L);let O=null,B=0,Z=0;d===Fs?z>0&&(O=Fs,B=z,Z=S.length):d===ku?j>0&&(O=ku,B=j,Z=L.length):(B=Math.max(z,j),O=B>0?z>j?Fs:ku:null,Z=O?O===Fs?S.length:L.length:0);const Q=O===Fs&&/\b(transform|all)(,|$)/.test(g[Fs+"Property"]);return{type:O,timeout:B,propCount:Z,hasTransform:Q}}function ox(a,d){for(;a.length<d.length;)a=a.concat(a);return Math.max(...d.map((g,A)=>sx(g)+sx(a[A])))}function sx(a){return Number(a.slice(0,-1).replace(",","."))*1e3}function q2(){return document.body.offsetHeight}const ax=a=>{const d=a.props["onUpdate:modelValue"];return Xt(d)?g=>Rd(d,g):d};function W2(a){a.target.composing=!0}function lx(a){const d=a.target;d.composing&&(d.composing=!1,X2(d,"input"))}function X2(a,d){const g=document.createEvent("HTMLEvents");g.initEvent(d,!0,!0),a.dispatchEvent(g)}const GI={created(a,{modifiers:{lazy:d,trim:g,number:A}},w){a._assign=ax(w);const S=A||w.props&&w.props.type==="number";Jl(a,d?"change":"input",z=>{if(z.target.composing)return;let o=a.value;g?o=o.trim():S&&(o=$d(o)),a._assign(o)}),g&&Jl(a,"change",()=>{a.value=a.value.trim()}),d||(Jl(a,"compositionstart",W2),Jl(a,"compositionend",lx),Jl(a,"change",lx))},mounted(a,{value:d}){a.value=d==null?"":d},beforeUpdate(a,{value:d,modifiers:{lazy:g,trim:A,number:w}},S){if(a._assign=ax(S),a.composing||document.activeElement===a&&(g||A&&a.value.trim()===d||(w||a.type==="number")&&$d(a.value)===d))return;const z=d==null?"":d;a.value!==z&&(a.value=z)}},H2=zr({patchProp:V2},S2);let cx;function Q2(){return cx||(cx=t2(H2))}const ZI=(...a)=>{const d=Q2().createApp(...a),{mount:g}=d;return d.mount=A=>{const w=Y2(A);if(!w)return;const S=d._component;!ci(S)&&!S.render&&!S.template&&(S.template=w.innerHTML),w.innerHTML="";const z=g(w,!1,w instanceof SVGElement);return w instanceof Element&&(w.removeAttribute("v-cloak"),w.setAttribute("data-v-app","")),z},d};function Y2(a){return fr(a)?document.querySelector(a):a}function kn(a,d,...g){if(a in d){let w=d[a];return typeof w=="function"?w(...g):w}let A=new Error(`Tried to handle "${a}" but there is no handler defined. Only defined handlers are: ${Object.keys(d).map(w=>`"${w}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(A,kn),A}var Hs=(a=>(a[a.None=0]="None",a[a.RenderStrategy=1]="RenderStrategy",a[a.Static=2]="Static",a))(Hs||{}),Zs=(a=>(a[a.Unmount=0]="Unmount",a[a.Hidden=1]="Hidden",a))(Zs||{});function ar(A){var w=A,{visible:a=!0,features:d=0}=w,g=wo(w,["visible","features"]);var S;if(a||d&2&&g.props.static)return qf(g);if(d&1){let z=(S=g.props.unmount)==null||S?0:1;return kn(z,{[0](){return null},[1](){return qf(hn(si({},g),{props:hn(si({},g.props),{hidden:!0,style:{display:"none"}})}))}})}return qf(g)}function qf({props:a,attrs:d,slots:g,slot:A,name:w}){var S;let j=Yv(a,["unmount","static"]),{as:z}=j,o=wo(j,["as"]),L=(S=g.default)==null?void 0:S.call(g,A);if(z==="template"){if(Object.keys(o).length>0||Object.keys(d).length>0){let[O,...B]=L!=null?L:[];if(!J2(O)||B.length>0)throw new Error(['Passing props on "template"!',"",`The current component <${w} /> is rendering a "template".`,"However we need to passthrough the following props:",Object.keys(o).concat(Object.keys(d)).map(Z=>`  - ${Z}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "template".',"Render a single element as the child so that we can forward the props onto that element."].map(Z=>`  - ${Z}`).join(`
`)].join(`
`));return Ga(O,o)}return Array.isArray(L)&&L.length===1?L[0]:L}return Yr(z,o,L)}function K2(a){let d=Object.assign({},a);for(let g in d)d[g]===void 0&&delete d[g];return d}function Yv(a,d=[]){let g=Object.assign({},a);for(let A of d)A in g&&delete g[A];return g}function J2(a){return a==null?!1:typeof a.type=="string"||typeof a.type=="object"||typeof a.type=="function"}let eE=0;function tE(){return++eE}function mn(){return tE()}var Zi=(a=>(a.Space=" ",a.Enter="Enter",a.Escape="Escape",a.Backspace="Backspace",a.Delete="Delete",a.ArrowLeft="ArrowLeft",a.ArrowUp="ArrowUp",a.ArrowRight="ArrowRight",a.ArrowDown="ArrowDown",a.Home="Home",a.End="End",a.PageUp="PageUp",a.PageDown="PageDown",a.Tab="Tab",a))(Zi||{});function iE(a){throw new Error("Unexpected object: "+a)}var Cn=(a=>(a[a.First=0]="First",a[a.Previous=1]="Previous",a[a.Next=2]="Next",a[a.Last=3]="Last",a[a.Specific=4]="Specific",a[a.Nothing=5]="Nothing",a))(Cn||{});function rE(a,d){let g=d.resolveItems();if(g.length<=0)return null;let A=d.resolveActiveIndex(),w=A!=null?A:-1,S=(()=>{switch(a.focus){case 0:return g.findIndex(z=>!d.resolveDisabled(z));case 1:{let z=g.slice().reverse().findIndex((o,L,j)=>w!==-1&&j.length-L-1>=w?!1:!d.resolveDisabled(o));return z===-1?z:g.length-1-z}case 2:return g.findIndex((z,o)=>o<=w?!1:!d.resolveDisabled(z));case 3:{let z=g.slice().reverse().findIndex(o=>!d.resolveDisabled(o));return z===-1?z:g.length-1-z}case 4:return g.findIndex(z=>d.resolveId(z)===a.id);case 5:return null;default:iE(a)}})();return S===-1?A:S}function Bi(a){return a==null||a.value==null?null:"$el"in a.value?a.value.$el:a.value}let Kv=Symbol("Context");var Pn=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(Pn||{});function nE(){return Qu()!==null}function Qu(){return Ni(Kv,null)}function l_(a){pr(Kv,a)}function ux(a,d){if(a)return a;let g=d!=null?d:"button";if(typeof g=="string"&&g.toLowerCase()==="button")return"button"}function c_(a,d){let g=$t(ux(a.value.type,a.value.as));return Ur(()=>{g.value=ux(a.value.type,a.value.as)}),fn(()=>{var A;g.value||!Bi(d)||Bi(d)instanceof HTMLButtonElement&&!((A=Bi(d))!=null&&A.hasAttribute("type"))&&(g.value="button")}),g}function Za(a){if(typeof window=="undefined")return null;if(a instanceof Node)return a.ownerDocument;if(a!=null&&a.hasOwnProperty("value")){let d=Bi(a);if(d)return d.ownerDocument}return document}function oE({container:a,accept:d,walk:g,enabled:A}){fn(()=>{let w=a.value;if(!w||A!==void 0&&!A.value)return;let S=Za(a);if(!S)return;let z=Object.assign(L=>d(L),{acceptNode:d}),o=S.createTreeWalker(w,NodeFilter.SHOW_ELEMENT,z,!1);for(;o.nextNode();)g(o.currentNode)})}let wm=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].map(a=>`${a}:not([tabindex='-1'])`).join(",");var Ru=(a=>(a[a.First=1]="First",a[a.Previous=2]="Previous",a[a.Next=4]="Next",a[a.Last=8]="Last",a[a.WrapAround=16]="WrapAround",a[a.NoScroll=32]="NoScroll",a))(Ru||{}),Em=(a=>(a[a.Error=0]="Error",a[a.Overflow=1]="Overflow",a[a.Success=2]="Success",a[a.Underflow=3]="Underflow",a))(Em||{}),sE=(a=>(a[a.Previous=-1]="Previous",a[a.Next=1]="Next",a))(sE||{});function aE(a=document.body){return a==null?[]:Array.from(a.querySelectorAll(wm))}var Jv=(a=>(a[a.Strict=0]="Strict",a[a.Loose=1]="Loose",a))(Jv||{});function lE(a,d=0){var g;return a===((g=Za(a))==null?void 0:g.body)?!1:kn(d,{[0](){return a.matches(wm)},[1](){let A=a;for(;A!==null;){if(A.matches(wm))return!0;A=A.parentElement}return!1}})}function zu(a){a==null||a.focus({preventScroll:!0})}let cE=["textarea","input"].join(",");function uE(a){var d,g;return(g=(d=a==null?void 0:a.matches)==null?void 0:d.call(a,cE))!=null?g:!1}function e0(a,d=g=>g){return a.slice().sort((g,A)=>{let w=d(g),S=d(A);if(w===null||S===null)return 0;let z=w.compareDocumentPosition(S);return z&Node.DOCUMENT_POSITION_FOLLOWING?-1:z&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function hx(a,d){var g;let A=(g=Array.isArray(a)?a.length>0?a[0].ownerDocument:document:a==null?void 0:a.ownerDocument)!=null?g:document,w=Array.isArray(a)?e0(a):aE(a),S=A.activeElement,z=(()=>{if(d&5)return 1;if(d&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),o=(()=>{if(d&1)return 0;if(d&2)return Math.max(0,w.indexOf(S))-1;if(d&4)return Math.max(0,w.indexOf(S))+1;if(d&8)return w.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),L=d&32?{preventScroll:!0}:{},j=0,O=w.length,B;do{if(j>=O||j+O<=0)return 0;let Z=o+j;if(d&16)Z=(Z+O)%O;else{if(Z<0)return 3;if(Z>=O)return 1}B=w[Z],B==null||B.focus(L),j+=z}while(B!==A.activeElement);return B.hasAttribute("tabindex")||B.setAttribute("tabindex","0"),d&6&&uE(B)&&B.select(),2}function dx(a,d,g){typeof window!="undefined"&&fn(A=>{window.addEventListener(a,d,g),A(()=>window.removeEventListener(a,d,g))})}function hE(a){typeof queueMicrotask=="function"?queueMicrotask(a):Promise.resolve().then(a).catch(d=>setTimeout(()=>{throw d}))}var t0=(a=>(a[a.None=1]="None",a[a.IgnoreScrollbars=2]="IgnoreScrollbars",a))(t0||{});function i0(a,d,g=1){let A=!1;function w(S){if(A)return;A=!0,hE(()=>{A=!1});let z=S.target;if(!z.ownerDocument.documentElement.contains(z))return;let o=function L(j){return typeof j=="function"?L(j()):Array.isArray(j)||j instanceof Set?j:[j]}(a);if((g&2)===2){let L=20,j=z.ownerDocument.documentElement;if(S.clientX>j.clientWidth-L||S.clientX<L||S.clientY>j.clientHeight-L||S.clientY<L)return}for(let L of o){if(L===null)continue;let j=L instanceof HTMLElement?L:Bi(L);if(j!=null&&j.contains(z))return}d(S,z)}dx("pointerdown",w),dx("mousedown",w)}let dE=Yi({name:"VisuallyHidden",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:d,attrs:g}){return()=>ar({props:hn(si({},a),{style:{position:"absolute",width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",display:"none"}}),slot:{},attrs:g,slots:d,name:"VisuallyHidden"})}});function pE(a){var d;let g=(d=a==null?void 0:a.form)!=null?d:a.closest("form");if(g){for(let A of g.elements)if(A.tagName==="INPUT"&&A.type==="submit"||A.tagName==="BUTTON"&&A.type==="submit"||A.nodeName==="INPUT"&&A.type==="image"){A.click();return}}}function Tm(a,d,g,A){typeof window!="undefined"&&fn(w=>{a=a!=null?a:window,a.addEventListener(d,g,A),w(()=>a.removeEventListener(d,g,A))})}var Fu=(a=>(a[a.None=1]="None",a[a.InitialFocus=2]="InitialFocus",a[a.TabLock=4]="TabLock",a[a.FocusLock=8]="FocusLock",a[a.RestoreFocus=16]="RestoreFocus",a[a.All=30]="All",a))(Fu||{});function fE(a,d=$t(30),g=$t({})){var A,w;let S=$t(null),z=$t(null),o={value:!1},L=zt(()=>Boolean(d.value&16)),j=zt(()=>Boolean(d.value&2)),O=zt(()=>Za(a));return Ur(()=>{pn(L,(B,Z)=>{var Q;B!==Z&&(!L.value||(o.value=!0,S.value||(S.value=(Q=O.value)==null?void 0:Q.activeElement)))},{immediate:!0}),pn(L,(B,Z,Q)=>{B!==Z&&(!L.value||Q(()=>{o.value!==!1&&(o.value=!1,zu(S.value),S.value=null)}))},{immediate:!0}),pn([a,g,g.value.initialFocus,j],(B,Z)=>{var Q,ce;if(B.every((ft,Pt)=>(Z==null?void 0:Z[Pt])===ft)||!j.value)return;let Ee=a.value;if(!Ee)return;let Ae=Bi(g.value.initialFocus),Fe=(Q=O.value)==null?void 0:Q.activeElement;if(Ae){if(Ae===Fe){z.value=Fe;return}}else if(Ee.contains(Fe)){z.value=Fe;return}Ae?zu(Ae):hx(Ee,Ru.First)===Em.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),z.value=(ce=O.value)==null?void 0:ce.activeElement},{immediate:!0})}),Tm((A=O.value)==null?void 0:A.defaultView,"keydown",B=>{var Z;!(d.value&4)||!a.value||B.key===Zi.Tab&&(B.preventDefault(),hx(a.value,(B.shiftKey?Ru.Previous:Ru.Next)|Ru.WrapAround)===Em.Success&&(z.value=(Z=O.value)==null?void 0:Z.activeElement))}),Tm((w=O.value)==null?void 0:w.defaultView,"focus",B=>{var Z;if(!(d.value&8))return;let Q=new Set((Z=g.value.containers)==null?void 0:Z.value);if(Q.add(a),!Q.size)return;let ce=z.value;if(!ce||!o.value)return;let Ee=B.target;Ee&&Ee instanceof HTMLElement?mE(Q,Ee)?(z.value=Ee,zu(Ee)):(B.preventDefault(),B.stopPropagation(),zu(ce)):zu(z.value)},!0),S}function mE(a,d){var g;for(let A of a)if((g=A.value)!=null&&g.contains(d))return!0;return!1}let px="body > *",ql=new Set,Ns=new Map;function fx(a){a.setAttribute("aria-hidden","true"),a.inert=!0}function mx(a){let d=Ns.get(a);!d||(d["aria-hidden"]===null?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden",d["aria-hidden"]),a.inert=d.inert)}function _E(a,d=$t(!0)){fn(g=>{if(!d.value||!a.value)return;let A=a.value,w=Za(A);if(w){ql.add(A);for(let S of Ns.keys())S.contains(A)&&(mx(S),Ns.delete(S));w.querySelectorAll(px).forEach(S=>{if(S instanceof HTMLElement){for(let z of ql)if(S.contains(z))return;ql.size===1&&(Ns.set(S,{"aria-hidden":S.getAttribute("aria-hidden"),inert:S.inert}),fx(S))}}),g(()=>{if(ql.delete(A),ql.size>0)w.querySelectorAll(px).forEach(S=>{if(S instanceof HTMLElement&&!Ns.has(S)){for(let z of ql)if(S.contains(z))return;Ns.set(S,{"aria-hidden":S.getAttribute("aria-hidden"),inert:S.inert}),fx(S)}});else for(let S of Ns.keys())mx(S),Ns.delete(S)})}})}let r0=Symbol("ForcePortalRootContext");function gE(){return Ni(r0,!1)}let Sm=Yi({name:"ForcePortalRoot",props:{as:{type:[Object,String],default:"template"},force:{type:Boolean,default:!1}},setup(a,{slots:d,attrs:g}){return pr(r0,a.force),()=>{let S=a,{force:A}=S,w=wo(S,["force"]);return ar({props:w,slot:{},slots:d,attrs:g,name:"ForcePortalRoot"})}}});function yE(a){let d=Za(a);if(!d)throw new Error(`[Headless UI]: Cannot find ownerDocument for contextElement: ${a}`);let g=d.getElementById("headlessui-portal-root");if(g)return g;let A=d.createElement("div");return A.setAttribute("id","headlessui-portal-root"),d.body.appendChild(A)}let n0=Yi({name:"Portal",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:d,attrs:g}){let A=$t(null),w=zt(()=>Za(A)),S=gE(),z=Ni(o0,null),o=$t(S===!0||z==null?yE(A.value):z.resolveTarget());return fn(()=>{S||z!=null&&(o.value=z.resolveTarget())}),io(()=>{var L,j;let O=(L=w.value)==null?void 0:L.getElementById("headlessui-portal-root");!O||o.value===O&&o.value.children.length<=0&&((j=o.value.parentElement)==null||j.removeChild(o.value))}),()=>{if(o.value===null)return null;let L={ref:A};return Yr(a2,{to:o.value},ar({props:si(si({},a),L),slot:{},attrs:g,slots:d,name:"Portal"}))}}}),o0=Symbol("PortalGroupContext"),xE=Yi({name:"PortalGroup",props:{as:{type:[Object,String],default:"template"},target:{type:Object,default:null}},setup(a,{attrs:d,slots:g}){let A=Mo({resolveTarget(){return a.target}});return pr(o0,A),()=>{let z=a,{target:w}=z,S=wo(z,["target"]);return ar({props:S,slot:{},attrs:d,slots:g,name:"PortalGroup"})}}}),s0=Symbol("StackContext");var Im=(a=>(a[a.Add=0]="Add",a[a.Remove=1]="Remove",a))(Im||{});function vE(){return Ni(s0,()=>{})}function AE({type:a,element:d,onUpdate:g}){let A=vE();function w(...S){g==null||g(...S),A(...S)}Ur(()=>{w(0,a,d),io(()=>{w(1,a,d)})}),pr(s0,w)}let a0=Symbol("DescriptionContext");function bE(){let a=Ni(a0,null);if(a===null)throw new Error("Missing parent");return a}function l0({slot:a=$t({}),name:d="Description",props:g={}}={}){let A=$t([]);function w(S){return A.value.push(S),()=>{let z=A.value.indexOf(S);z!==-1&&A.value.splice(z,1)}}return pr(a0,{register:w,slot:a,name:d,props:g}),zt(()=>A.value.length>0?A.value.join(" "):void 0)}let wE=Yi({name:"Description",props:{as:{type:[Object,String],default:"p"}},setup(a,{attrs:d,slots:g}){let A=bE(),w=`headlessui-description-${mn()}`;return Ur(()=>io(A.register(w))),()=>{let{name:S="Description",slot:z=$t({}),props:o={}}=A,L=a,j=hn(si({},Object.entries(o).reduce((O,[B,Z])=>Object.assign(O,{[B]:ai(Z)}),{})),{id:w});return ar({props:si(si({},L),j),slot:z.value,attrs:d,slots:g,name:S})}}});var EE=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(EE||{});let Cm=Symbol("DialogContext");function Yu(a){let d=Ni(Cm,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,Yu),g}return d}let kd="DC8F892D-2EBD-447C-A4C8-A03058436FF4",qI=Yi({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:kd},initialFocus:{type:Object,default:null}},emits:{close:a=>!0},setup(a,{emit:d,attrs:g,slots:A,expose:w}){var S;let z=$t(0),o=Qu(),L=zt(()=>a.open===kd&&o!==null?kn(o.value,{[Pn.Open]:!0,[Pn.Closed]:!1}):a.open),j=$t(new Set),O=$t(null),B=zt(()=>Za(O));if(w({el:O,$el:O}),!(a.open!==kd||o!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof L.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${L.value===kd?void 0:a.open}`);let Z=zt(()=>L.value?0:1),Q=zt(()=>Z.value===0),ce=zt(()=>z.value>1),Ee=Ni(Cm,null)!==null,Ae=zt(()=>ce.value?"parent":"leaf"),Fe=fE(O,zt(()=>Q.value?kn(Ae.value,{parent:Fu.RestoreFocus,leaf:Fu.All&~Fu.FocusLock}):Fu.None),zt(()=>({initialFocus:$t(a.initialFocus),containers:j})));_E(O,zt(()=>ce.value?Q.value:!1)),AE({type:"Dialog",element:O,onUpdate:(We,gt,Tt)=>{if(gt==="Dialog")return kn(We,{[Im.Add](){j.value.add(Tt),z.value+=1},[Im.Remove](){j.value.delete(Tt),z.value-=1}})}});let ft=l0({name:"DialogDescription",slot:zt(()=>({open:L.value}))}),Pt=`headlessui-dialog-${mn()}`,mt=$t(null),Rt={titleId:mt,panelRef:$t(null),dialogState:Z,setTitleId(We){mt.value!==We&&(mt.value=We)},close(){d("close",!1)}};pr(Cm,Rt),i0(()=>{var We,gt,Tt;return[...Array.from((gt=(We=B.value)==null?void 0:We.querySelectorAll("body > *"))!=null?gt:[]).filter(Dt=>!(!(Dt instanceof HTMLElement)||Dt.contains(Fe.value)||Rt.panelRef.value&&Dt.contains(Rt.panelRef.value))),(Tt=Rt.panelRef.value)!=null?Tt:O.value]},(We,gt)=>{Z.value===0&&(ce.value||(Rt.close(),Mn(()=>gt==null?void 0:gt.focus())))},t0.IgnoreScrollbars),Tm((S=B.value)==null?void 0:S.defaultView,"keydown",We=>{We.key===Zi.Escape&&Z.value===0&&(ce.value||(We.preventDefault(),We.stopPropagation(),Rt.close()))}),fn(We=>{var gt;if(Z.value!==0||Ee)return;let Tt=B.value;if(!Tt)return;let Dt=Tt==null?void 0:Tt.documentElement,It=(gt=Tt.defaultView)!=null?gt:window,yt=Dt.style.overflow,ti=Dt.style.paddingRight,li=It.innerWidth-Dt.clientWidth;Dt.style.overflow="hidden",Dt.style.paddingRight=`${li}px`,We(()=>{Dt.style.overflow=yt,Dt.style.paddingRight=ti})}),fn(We=>{if(Z.value!==0)return;let gt=Bi(O);if(!gt)return;let Tt=new IntersectionObserver(Dt=>{for(let It of Dt)It.boundingClientRect.x===0&&It.boundingClientRect.y===0&&It.boundingClientRect.width===0&&It.boundingClientRect.height===0&&Rt.close()});Tt.observe(gt),We(()=>Tt.disconnect())});function Ke(We){We.stopPropagation()}return()=>{let We=hn(si({},g),{ref:O,id:Pt,role:"dialog","aria-modal":Z.value===0?!0:void 0,"aria-labelledby":mt.value,"aria-describedby":ft.value,onClick:Ke}),yt=a,{open:gt,initialFocus:Tt}=yt,Dt=wo(yt,["open","initialFocus"]),It={open:Z.value===0};return Yr(Sm,{force:!0},()=>Yr(n0,()=>Yr(xE,{target:O.value},()=>Yr(Sm,{force:!1},()=>ar({props:si(si({},Dt),We),slot:It,attrs:g,slots:A,visible:Z.value===0,features:Hs.RenderStrategy|Hs.Static,name:"Dialog"})))))}}});Yi({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:d,slots:g}){let A=Yu("DialogOverlay"),w=`headlessui-dialog-overlay-${mn()}`;function S(z){z.target===z.currentTarget&&(z.preventDefault(),z.stopPropagation(),A.close())}return()=>ar({props:hn(si({},a),{id:w,"aria-hidden":!0,onClick:S}),slot:{open:A.dialogState.value===0},attrs:d,slots:g,name:"DialogOverlay"})}});Yi({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(a,{attrs:d,slots:g,expose:A}){let w=Yu("DialogBackdrop"),S=`headlessui-dialog-backdrop-${mn()}`,z=$t(null);return A({el:z,$el:z}),Ur(()=>{if(w.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let o=a,L={id:S,ref:z,"aria-hidden":!0};return Yr(Sm,{force:!0},()=>Yr(n0,()=>ar({props:si(si(si({},d),o),L),slot:{open:w.dialogState.value===0},attrs:d,slots:g,name:"DialogBackdrop"})))}}});let WI=Yi({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:d,slots:g}){let A=Yu("DialogPanel"),w=`headlessui-dialog-panel-${mn()}`;return()=>{let S={id:w,ref:A.panelRef};return ar({props:si(si({},a),S),slot:{open:A.dialogState.value===0},attrs:d,slots:g,name:"DialogPanel"})}}}),XI=Yi({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(a,{attrs:d,slots:g}){let A=Yu("DialogTitle"),w=`headlessui-dialog-title-${mn()}`;return Ur(()=>{A.setTitleId(w),io(()=>A.setTitleId(null))}),()=>ar({props:hn(si({},a),{id:w}),slot:{open:A.dialogState.value===0},attrs:d,slots:g,name:"DialogTitle"})}});var TE=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(TE||{});let c0=Symbol("DisclosureContext");function u_(a){let d=Ni(c0,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,u_),g}return d}let u0=Symbol("DisclosurePanelContext");function SE(){return Ni(u0,null)}let HI=Yi({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(a,{slots:d,attrs:g}){let A=`headlessui-disclosure-button-${mn()}`,w=`headlessui-disclosure-panel-${mn()}`,S=$t(a.defaultOpen?0:1),z=$t(null),o=$t(null),L={buttonId:A,panelId:w,disclosureState:S,panel:z,button:o,toggleDisclosure(){S.value=kn(S.value,{[0]:1,[1]:0})},closeDisclosure(){S.value!==1&&(S.value=1)},close(j){L.closeDisclosure();let O=(()=>j?j instanceof HTMLElement?j:j.value instanceof HTMLElement?Bi(j):Bi(L.button):Bi(L.button))();O==null||O.focus()}};return pr(c0,L),l_(zt(()=>kn(S.value,{[0]:Pn.Open,[1]:Pn.Closed}))),()=>{let Z=a,{defaultOpen:j}=Z,O=wo(Z,["defaultOpen"]),B={open:S.value===0,close:L.close};return ar({props:O,slot:B,slots:d,attrs:g,name:"Disclosure"})}}}),QI=Yi({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(a,{attrs:d,slots:g,expose:A}){let w=u_("DisclosureButton"),S=SE(),z=S===null?!1:S===w.panelId,o=$t(null);A({el:o,$el:o}),z||fn(()=>{w.button.value=o.value});let L=c_(zt(()=>({as:a.as,type:d.type})),o);function j(){var Z;a.disabled||(z?(w.toggleDisclosure(),(Z=Bi(w.button))==null||Z.focus()):w.toggleDisclosure())}function O(Z){var Q;if(!a.disabled)if(z)switch(Z.key){case Zi.Space:case Zi.Enter:Z.preventDefault(),Z.stopPropagation(),w.toggleDisclosure(),(Q=Bi(w.button))==null||Q.focus();break}else switch(Z.key){case Zi.Space:case Zi.Enter:Z.preventDefault(),Z.stopPropagation(),w.toggleDisclosure();break}}function B(Z){switch(Z.key){case Zi.Space:Z.preventDefault();break}}return()=>{let Z={open:w.disclosureState.value===0},Q=z?{ref:o,type:L.value,onClick:j,onKeydown:O}:{id:w.buttonId,ref:o,type:L.value,"aria-expanded":a.disabled?void 0:w.disclosureState.value===0,"aria-controls":Bi(w.panel)?w.panelId:void 0,disabled:a.disabled?!0:void 0,onClick:j,onKeydown:O,onKeyup:B};return ar({props:si(si({},a),Q),slot:Z,attrs:d,slots:g,name:"DisclosureButton"})}}}),YI=Yi({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:d,slots:g,expose:A}){let w=u_("DisclosurePanel");A({el:w.panel,$el:w.panel}),pr(u0,w.panelId);let S=Qu(),z=zt(()=>S!==null?S.value===Pn.Open:w.disclosureState.value===0);return()=>{let o={open:w.disclosureState.value===0,close:w.close},L={id:w.panelId,ref:w.panel};return ar({props:si(si({},a),L),slot:o,attrs:d,slots:g,features:Hs.RenderStrategy|Hs.Static,visible:z.value,name:"DisclosurePanel"})}}});var IE=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(IE||{}),CE=(a=>(a[a.Pointer=0]="Pointer",a[a.Other=1]="Other",a))(CE||{});function ME(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let h0=Symbol("MenuContext");function lp(a){let d=Ni(h0,null);if(d===null){let g=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(g,lp),g}return d}let KI=Yi({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:d,attrs:g}){let A=$t(1),w=$t(null),S=$t(null),z=$t([]),o=$t(""),L=$t(null),j=$t(1);function O(Z=Q=>Q){let Q=L.value!==null?z.value[L.value]:null,ce=e0(Z(z.value.slice()),Ae=>Bi(Ae.dataRef.domRef)),Ee=Q?ce.indexOf(Q):null;return Ee===-1&&(Ee=null),{items:ce,activeItemIndex:Ee}}let B={menuState:A,buttonRef:w,itemsRef:S,items:z,searchQuery:o,activeItemIndex:L,activationTrigger:j,closeMenu:()=>{A.value=1,L.value=null},openMenu:()=>A.value=0,goToItem(Z,Q,ce){let Ee=O(),Ae=rE(Z===Cn.Specific?{focus:Cn.Specific,id:Q}:{focus:Z},{resolveItems:()=>Ee.items,resolveActiveIndex:()=>Ee.activeItemIndex,resolveId:Fe=>Fe.id,resolveDisabled:Fe=>Fe.dataRef.disabled});o.value="",L.value=Ae,j.value=ce!=null?ce:1,z.value=Ee.items},search(Z){let Q=o.value!==""?0:1;o.value+=Z.toLowerCase();let ce=(L.value!==null?z.value.slice(L.value+Q).concat(z.value.slice(0,L.value+Q)):z.value).find(Ae=>Ae.dataRef.textValue.startsWith(o.value)&&!Ae.dataRef.disabled),Ee=ce?z.value.indexOf(ce):-1;Ee===-1||Ee===L.value||(L.value=Ee,j.value=1)},clearSearch(){o.value=""},registerItem(Z,Q){let ce=O(Ee=>[...Ee,{id:Z,dataRef:Q}]);z.value=ce.items,L.value=ce.activeItemIndex,j.value=1},unregisterItem(Z){let Q=O(ce=>{let Ee=ce.findIndex(Ae=>Ae.id===Z);return Ee!==-1&&ce.splice(Ee,1),ce});z.value=Q.items,L.value=Q.activeItemIndex,j.value=1}};return i0([w,S],(Z,Q)=>{var ce;A.value===0&&(B.closeMenu(),lE(Q,Jv.Loose)||(Z.preventDefault(),(ce=Bi(w))==null||ce.focus()))}),pr(h0,B),l_(zt(()=>kn(A.value,{[0]:Pn.Open,[1]:Pn.Closed}))),()=>{let Z={open:A.value===0};return ar({props:a,slot:Z,slots:d,attrs:g,name:"Menu"})}}}),JI=Yi({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"}},setup(a,{attrs:d,slots:g,expose:A}){let w=lp("MenuButton"),S=`headlessui-menu-button-${mn()}`;A({el:w.buttonRef,$el:w.buttonRef});function z(O){switch(O.key){case Zi.Space:case Zi.Enter:case Zi.ArrowDown:O.preventDefault(),O.stopPropagation(),w.openMenu(),Mn(()=>{var B;(B=Bi(w.itemsRef))==null||B.focus({preventScroll:!0}),w.goToItem(Cn.First)});break;case Zi.ArrowUp:O.preventDefault(),O.stopPropagation(),w.openMenu(),Mn(()=>{var B;(B=Bi(w.itemsRef))==null||B.focus({preventScroll:!0}),w.goToItem(Cn.Last)});break}}function o(O){switch(O.key){case Zi.Space:O.preventDefault();break}}function L(O){a.disabled||(w.menuState.value===0?(w.closeMenu(),Mn(()=>{var B;return(B=Bi(w.buttonRef))==null?void 0:B.focus({preventScroll:!0})})):(O.preventDefault(),O.stopPropagation(),w.openMenu(),ME(()=>{var B;return(B=Bi(w.itemsRef))==null?void 0:B.focus({preventScroll:!0})})))}let j=c_(zt(()=>({as:a.as,type:d.type})),w.buttonRef);return()=>{var O;let B={open:w.menuState.value===0},Z={ref:w.buttonRef,id:S,type:j.value,"aria-haspopup":!0,"aria-controls":(O=Bi(w.itemsRef))==null?void 0:O.id,"aria-expanded":a.disabled?void 0:w.menuState.value===0,onKeydown:z,onKeyup:o,onClick:L};return ar({props:si(si({},a),Z),slot:B,attrs:d,slots:g,name:"MenuButton"})}}}),eC=Yi({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(a,{attrs:d,slots:g,expose:A}){let w=lp("MenuItems"),S=`headlessui-menu-items-${mn()}`,z=$t(null);A({el:w.itemsRef,$el:w.itemsRef}),oE({container:zt(()=>Bi(w.itemsRef)),enabled:zt(()=>w.menuState.value===0),accept(B){return B.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:B.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(B){B.setAttribute("role","none")}});function o(B){var Z;switch(z.value&&clearTimeout(z.value),B.key){case Zi.Space:if(w.searchQuery.value!=="")return B.preventDefault(),B.stopPropagation(),w.search(B.key);case Zi.Enter:if(B.preventDefault(),B.stopPropagation(),w.activeItemIndex.value!==null){let Q=w.items.value[w.activeItemIndex.value];(Z=Bi(Q.dataRef.domRef))==null||Z.click()}w.closeMenu(),Mn(()=>{var Q;return(Q=Bi(w.buttonRef))==null?void 0:Q.focus({preventScroll:!0})});break;case Zi.ArrowDown:return B.preventDefault(),B.stopPropagation(),w.goToItem(Cn.Next);case Zi.ArrowUp:return B.preventDefault(),B.stopPropagation(),w.goToItem(Cn.Previous);case Zi.Home:case Zi.PageUp:return B.preventDefault(),B.stopPropagation(),w.goToItem(Cn.First);case Zi.End:case Zi.PageDown:return B.preventDefault(),B.stopPropagation(),w.goToItem(Cn.Last);case Zi.Escape:B.preventDefault(),B.stopPropagation(),w.closeMenu(),Mn(()=>{var Q;return(Q=Bi(w.buttonRef))==null?void 0:Q.focus({preventScroll:!0})});break;case Zi.Tab:B.preventDefault(),B.stopPropagation();break;default:B.key.length===1&&(w.search(B.key),z.value=setTimeout(()=>w.clearSearch(),350));break}}function L(B){switch(B.key){case Zi.Space:B.preventDefault();break}}let j=Qu(),O=zt(()=>j!==null?j.value===Pn.Open:w.menuState.value===0);return()=>{var B,Z;let Q={open:w.menuState.value===0},ce={"aria-activedescendant":w.activeItemIndex.value===null||(B=w.items.value[w.activeItemIndex.value])==null?void 0:B.id,"aria-labelledby":(Z=Bi(w.buttonRef))==null?void 0:Z.id,id:S,onKeydown:o,onKeyup:L,role:"menu",tabIndex:0,ref:w.itemsRef};return ar({props:si(si({},a),ce),slot:Q,attrs:d,slots:g,features:Hs.RenderStrategy|Hs.Static,visible:O.value,name:"MenuItems"})}}}),tC=Yi({name:"MenuItem",props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1}},setup(a,{slots:d,attrs:g,expose:A}){let w=lp("MenuItem"),S=`headlessui-menu-item-${mn()}`,z=$t(null);A({el:z,$el:z});let o=zt(()=>w.activeItemIndex.value!==null?w.items.value[w.activeItemIndex.value].id===S:!1),L=zt(()=>({disabled:a.disabled,textValue:"",domRef:z}));Ur(()=>{var Q,ce;let Ee=(ce=(Q=Bi(z))==null?void 0:Q.textContent)==null?void 0:ce.toLowerCase().trim();Ee!==void 0&&(L.value.textValue=Ee)}),Ur(()=>w.registerItem(S,L)),io(()=>w.unregisterItem(S)),fn(()=>{w.menuState.value===0&&(!o.value||w.activationTrigger.value!==0&&Mn(()=>{var Q,ce;return(ce=(Q=Bi(z))==null?void 0:Q.scrollIntoView)==null?void 0:ce.call(Q,{block:"nearest"})}))});function j(Q){if(a.disabled)return Q.preventDefault();w.closeMenu(),Mn(()=>{var ce;return(ce=Bi(w.buttonRef))==null?void 0:ce.focus({preventScroll:!0})})}function O(){if(a.disabled)return w.goToItem(Cn.Nothing);w.goToItem(Cn.Specific,S)}function B(){a.disabled||o.value||w.goToItem(Cn.Specific,S,0)}function Z(){a.disabled||!o.value||w.goToItem(Cn.Nothing)}return()=>{let{disabled:Q}=a,ce={active:o.value,disabled:Q};return ar({props:hn(si({},a),{id:S,ref:z,role:"menuitem",tabIndex:Q===!0?void 0:-1,"aria-disabled":Q===!0?!0:void 0,onClick:j,onFocus:O,onPointermove:B,onMousemove:B,onPointerleave:Z,onMouseleave:Z}),slot:ce,attrs:g,slots:d,name:"MenuItem"})}}}),d0=Symbol("LabelContext");function p0(){let a=Ni(d0,null);if(a===null){let d=new Error("You used a <Label /> component, but it is not inside a parent.");throw Error.captureStackTrace&&Error.captureStackTrace(d,p0),d}return a}function kE({slot:a={},name:d="Label",props:g={}}={}){let A=$t([]);function w(S){return A.value.push(S),()=>{let z=A.value.indexOf(S);z!==-1&&A.value.splice(z,1)}}return pr(d0,{register:w,slot:a,name:d,props:g}),zt(()=>A.value.length>0?A.value.join(" "):void 0)}let zE=Yi({name:"Label",props:{as:{type:[Object,String],default:"label"},passive:{type:[Boolean],default:!1}},setup(a,{slots:d,attrs:g}){let A=p0(),w=`headlessui-label-${mn()}`;return Ur(()=>io(A.register(w))),()=>{let{name:S="Label",slot:z={},props:o={}}=A,Z=a,{passive:L}=Z,j=wo(Z,["passive"]),O=hn(si({},Object.entries(o).reduce((Q,[ce,Ee])=>Object.assign(Q,{[ce]:ai(Ee)}),{})),{id:w}),B=si(si({},j),O);return L&&delete B.onClick,ar({props:B,slot:z,attrs:g,slots:d,name:S})}}}),f0=Symbol("GroupContext"),iC=Yi({name:"SwitchGroup",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:d,attrs:g}){let A=$t(null),w=kE({name:"SwitchLabel",props:{onClick(){!A.value||(A.value.click(),A.value.focus({preventScroll:!0}))}}}),S=l0({name:"SwitchDescription"});return pr(f0,{switchRef:A,labelledby:w,describedby:S}),()=>ar({props:a,slot:{},slots:d,attrs:g,name:"SwitchGroup"})}}),rC=Yi({name:"Switch",emits:{"update:modelValue":a=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:!1},name:{type:String,optional:!0},value:{type:String,optional:!0}},inheritAttrs:!1,setup(a,{emit:d,attrs:g,slots:A,expose:w}){let S=Ni(f0,null),z=`headlessui-switch-${mn()}`;function o(){d("update:modelValue",!a.modelValue)}let L=$t(null),j=S===null?L:S.switchRef,O=c_(zt(()=>({as:a.as,type:g.type})),j);w({el:j,$el:j});function B(ce){ce.preventDefault(),o()}function Z(ce){ce.key===Zi.Space?(ce.preventDefault(),o()):ce.key===Zi.Enter&&pE(ce.currentTarget)}function Q(ce){ce.preventDefault()}return()=>{let mt=a,{name:ce,value:Ee,modelValue:Ae}=mt,Fe=wo(mt,["name","value","modelValue"]),ft={checked:Ae},Pt={id:z,ref:j,role:"switch",type:O.value,tabIndex:0,"aria-checked":Ae,"aria-labelledby":S==null?void 0:S.labelledby.value,"aria-describedby":S==null?void 0:S.describedby.value,onClick:B,onKeyup:Z,onKeypress:Q};return Yr(eo,[ce!=null&&Ae!=null?Yr(dE,K2({as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:Ae,name:ce,value:Ee})):null,ar({props:si(si(si({},g),Fe),Pt),slot:ft,attrs:g,slots:A,name:"Switch"})])}}}),nC=zE,oC=wE;function PE(a){let d={called:!1};return(...g)=>{if(!d.called)return d.called=!0,a(...g)}}function m0(){let a=[],d=[],g={enqueue(A){d.push(A)},requestAnimationFrame(...A){let w=requestAnimationFrame(...A);g.add(()=>cancelAnimationFrame(w))},nextFrame(...A){g.requestAnimationFrame(()=>{g.requestAnimationFrame(...A)})},setTimeout(...A){let w=setTimeout(...A);g.add(()=>clearTimeout(w))},add(A){a.push(A)},dispose(){for(let A of a.splice(0))A()},async workQueue(){for(let A of d.splice(0))await A()}};return g}function Wf(a,...d){a&&d.length>0&&a.classList.add(...d)}function zd(a,...d){a&&d.length>0&&a.classList.remove(...d)}var Mm=(a=>(a.Finished="finished",a.Cancelled="cancelled",a))(Mm||{});function DE(a,d){let g=m0();if(!a)return g.dispose;let{transitionDuration:A,transitionDelay:w}=getComputedStyle(a),[S,z]=[A,w].map(o=>{let[L=0]=o.split(",").filter(Boolean).map(j=>j.includes("ms")?parseFloat(j):parseFloat(j)*1e3).sort((j,O)=>O-j);return L});return S!==0?g.setTimeout(()=>d("finished"),S+z):d("finished"),g.add(()=>d("cancelled")),g.dispose}function _x(a,d,g,A,w,S){let z=m0(),o=S!==void 0?PE(S):()=>{};return zd(a,...w),Wf(a,...d,...g),z.nextFrame(()=>{zd(a,...g),Wf(a,...A),z.add(DE(a,L=>(zd(a,...A,...d),Wf(a,...w),o(L))))}),z.add(()=>zd(a,...d,...g,...A,...w)),z.add(()=>o("cancelled")),z.dispose}function Ra(a=""){return a.split(" ").filter(d=>d.trim().length>1)}let h_=Symbol("TransitionContext");var BE=(a=>(a.Visible="visible",a.Hidden="hidden",a))(BE||{});function LE(){return Ni(h_,null)!==null}function RE(){let a=Ni(h_,null);if(a===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return a}function FE(){let a=Ni(d_,null);if(a===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return a}let d_=Symbol("NestingContext");function cp(a){return"children"in a?cp(a.children):a.value.filter(({state:d})=>d==="visible").length>0}function _0(a){let d=$t([]),g=$t(!1);Ur(()=>g.value=!0),io(()=>g.value=!1);function A(S,z=Zs.Hidden){let o=d.value.findIndex(({id:L})=>L===S);o!==-1&&(kn(z,{[Zs.Unmount](){d.value.splice(o,1)},[Zs.Hidden](){d.value[o].state="hidden"}}),!cp(d)&&g.value&&(a==null||a()))}function w(S){let z=d.value.find(({id:o})=>o===S);return z?z.state!=="visible"&&(z.state="visible"):d.value.push({id:S,state:"visible"}),()=>A(S,Zs.Unmount)}return{children:d,register:w,unregister:A}}let g0=Hs.RenderStrategy,OE=Yi({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(a,{emit:d,attrs:g,slots:A,expose:w}){if(!LE()&&nE())return()=>Yr(VE,hn(si({},a),{onBeforeEnter:()=>d("beforeEnter"),onAfterEnter:()=>d("afterEnter"),onBeforeLeave:()=>d("beforeLeave"),onAfterLeave:()=>d("afterLeave")}),A);let S=$t(null),z=$t("visible"),o=zt(()=>a.unmount?Zs.Unmount:Zs.Hidden);w({el:S,$el:S});let{show:L,appear:j}=RE(),{register:O,unregister:B}=FE(),Z={value:!0},Q=mn(),ce={value:!1},Ee=_0(()=>{ce.value||(z.value="hidden",B(Q),d("afterLeave"))});Ur(()=>{let gt=O(Q);io(gt)}),fn(()=>{if(o.value===Zs.Hidden&&!!Q){if(L&&z.value!=="visible"){z.value="visible";return}kn(z.value,{hidden:()=>B(Q),visible:()=>O(Q)})}});let Ae=Ra(a.enter),Fe=Ra(a.enterFrom),ft=Ra(a.enterTo),Pt=Ra(a.entered),mt=Ra(a.leave),Rt=Ra(a.leaveFrom),Ke=Ra(a.leaveTo);Ur(()=>{fn(()=>{if(z.value==="visible"){let gt=Bi(S);if(gt instanceof Comment&&gt.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function We(gt){let Tt=Z.value&&!j.value,Dt=Bi(S);!Dt||!(Dt instanceof HTMLElement)||Tt||(ce.value=!0,L.value&&d("beforeEnter"),L.value||d("beforeLeave"),gt(L.value?_x(Dt,Ae,Fe,ft,Pt,It=>{ce.value=!1,It===Mm.Finished&&d("afterEnter")}):_x(Dt,mt,Rt,Ke,Pt,It=>{ce.value=!1,It===Mm.Finished&&(cp(Ee)||(z.value="hidden",B(Q),d("afterLeave")))})))}return Ur(()=>{pn([L,j],(gt,Tt,Dt)=>{We(Dt),Z.value=!1},{immediate:!0})}),pr(d_,Ee),l_(zt(()=>kn(z.value,{visible:Pn.Open,hidden:Pn.Closed}))),()=>{let Bt=a,{appear:gt,show:Tt,enter:Dt,enterFrom:It,enterTo:yt,entered:ti,leave:li,leaveFrom:_r,leaveTo:bi}=Bt,ui=wo(Bt,["appear","show","enter","enterFrom","enterTo","entered","leave","leaveFrom","leaveTo"]);return ar({props:hn(si({},ui),{ref:S}),slot:{},slots:A,attrs:g,features:g0,visible:z.value==="visible",name:"TransitionChild"})}}}),UE=OE,VE=Yi({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(a,{emit:d,attrs:g,slots:A}){let w=Qu(),S=zt(()=>a.show===null&&w!==null?kn(w.value,{[Pn.Open]:!0,[Pn.Closed]:!1}):a.show);fn(()=>{if(![!0,!1].includes(S.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let z=$t(S.value?"visible":"hidden"),o=_0(()=>{z.value="hidden"}),L={value:!0},j={show:S,appear:zt(()=>a.appear||!L.value)};return Ur(()=>{fn(()=>{L.value=!1,S.value?z.value="visible":cp(o)||(z.value="hidden")})}),pr(d_,o),pr(h_,j),()=>{let O=Yv(a,["show","appear","unmount"]),B={unmount:a.unmount};return ar({props:hn(si({},B),{as:"template"}),slot:{},slots:hn(si({},A),{default:()=>[Yr(UE,si(si(si({onBeforeEnter:()=>d("beforeEnter"),onAfterEnter:()=>d("afterEnter"),onBeforeLeave:()=>d("beforeLeave"),onAfterLeave:()=>d("afterLeave")},g),B),O),A.default)]}),attrs:{},features:g0,visible:z.value==="visible",name:"Transition"})}}});function sC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})])}function aC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])}function lC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function cC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])}function uC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])}function hC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})])}function dC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})])}function pC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})])}function fC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}function mC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function _C(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})])}function gC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor","aria-hidden":"true"},[ji("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])}/*!
  * vue-router v4.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const y0=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",dc=a=>y0?Symbol(a):"_vr_"+a,jE=dc("rvlm"),gx=dc("rvd"),up=dc("r"),x0=dc("rl"),km=dc("rvl"),ec=typeof window!="undefined";function NE(a){return a.__esModule||y0&&a[Symbol.toStringTag]==="Module"}const Ui=Object.assign;function Xf(a,d){const g={};for(const A in d){const w=d[A];g[A]=Array.isArray(w)?w.map(a):a(w)}return g}const Nu=()=>{},$E=/\/$/,GE=a=>a.replace($E,"");function Hf(a,d,g="/"){let A,w={},S="",z="";const o=d.indexOf("?"),L=d.indexOf("#",o>-1?o:0);return o>-1&&(A=d.slice(0,o),S=d.slice(o+1,L>-1?L:d.length),w=a(S)),L>-1&&(A=A||d.slice(0,L),z=d.slice(L,d.length)),A=XE(A!=null?A:d,g),{fullPath:A+(S&&"?")+S+z,path:A,query:w,hash:z}}function ZE(a,d){const g=d.query?a(d.query):"";return d.path+(g&&"?")+g+(d.hash||"")}function yx(a,d){return!d||!a.toLowerCase().startsWith(d.toLowerCase())?a:a.slice(d.length)||"/"}function qE(a,d,g){const A=d.matched.length-1,w=g.matched.length-1;return A>-1&&A===w&&sc(d.matched[A],g.matched[w])&&v0(d.params,g.params)&&a(d.query)===a(g.query)&&d.hash===g.hash}function sc(a,d){return(a.aliasOf||a)===(d.aliasOf||d)}function v0(a,d){if(Object.keys(a).length!==Object.keys(d).length)return!1;for(const g in a)if(!WE(a[g],d[g]))return!1;return!0}function WE(a,d){return Array.isArray(a)?xx(a,d):Array.isArray(d)?xx(d,a):a===d}function xx(a,d){return Array.isArray(d)?a.length===d.length&&a.every((g,A)=>g===d[A]):a.length===1&&a[0]===d}function XE(a,d){if(a.startsWith("/"))return a;if(!a)return d;const g=d.split("/"),A=a.split("/");let w=g.length-1,S,z;for(S=0;S<A.length;S++)if(z=A[S],!(w===1||z==="."))if(z==="..")w--;else break;return g.slice(0,w).join("/")+"/"+A.slice(S-(S===A.length?1:0)).join("/")}var Hu;(function(a){a.pop="pop",a.push="push"})(Hu||(Hu={}));var $u;(function(a){a.back="back",a.forward="forward",a.unknown=""})($u||($u={}));function HE(a){if(!a)if(ec){const d=document.querySelector("base");a=d&&d.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),GE(a)}const QE=/^[^#]+#/;function YE(a,d){return a.replace(QE,"#")+d}function KE(a,d){const g=document.documentElement.getBoundingClientRect(),A=a.getBoundingClientRect();return{behavior:d.behavior,left:A.left-g.left-(d.left||0),top:A.top-g.top-(d.top||0)}}const hp=()=>({left:window.pageXOffset,top:window.pageYOffset});function JE(a){let d;if("el"in a){const g=a.el,A=typeof g=="string"&&g.startsWith("#"),w=typeof g=="string"?A?document.getElementById(g.slice(1)):document.querySelector(g):g;if(!w)return;d=KE(w,a)}else d=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(d):window.scrollTo(d.left!=null?d.left:window.pageXOffset,d.top!=null?d.top:window.pageYOffset)}function vx(a,d){return(history.state?history.state.position-d:-1)+a}const zm=new Map;function eT(a,d){zm.set(a,d)}function tT(a){const d=zm.get(a);return zm.delete(a),d}let iT=()=>location.protocol+"//"+location.host;function A0(a,d){const{pathname:g,search:A,hash:w}=d,S=a.indexOf("#");if(S>-1){let o=w.includes(a.slice(S))?a.slice(S).length:1,L=w.slice(o);return L[0]!=="/"&&(L="/"+L),yx(L,"")}return yx(g,a)+A+w}function rT(a,d,g,A){let w=[],S=[],z=null;const o=({state:Z})=>{const Q=A0(a,location),ce=g.value,Ee=d.value;let Ae=0;if(Z){if(g.value=Q,d.value=Z,z&&z===ce){z=null;return}Ae=Ee?Z.position-Ee.position:0}else A(Q);w.forEach(Fe=>{Fe(g.value,ce,{delta:Ae,type:Hu.pop,direction:Ae?Ae>0?$u.forward:$u.back:$u.unknown})})};function L(){z=g.value}function j(Z){w.push(Z);const Q=()=>{const ce=w.indexOf(Z);ce>-1&&w.splice(ce,1)};return S.push(Q),Q}function O(){const{history:Z}=window;!Z.state||Z.replaceState(Ui({},Z.state,{scroll:hp()}),"")}function B(){for(const Z of S)Z();S=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",O)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",O),{pauseListeners:L,listen:j,destroy:B}}function Ax(a,d,g,A=!1,w=!1){return{back:a,current:d,forward:g,replaced:A,position:window.history.length,scroll:w?hp():null}}function nT(a){const{history:d,location:g}=window,A={value:A0(a,g)},w={value:d.state};w.value||S(A.value,{back:null,current:A.value,forward:null,position:d.length-1,replaced:!0,scroll:null},!0);function S(L,j,O){const B=a.indexOf("#"),Z=B>-1?(g.host&&document.querySelector("base")?a:a.slice(B))+L:iT()+a+L;try{d[O?"replaceState":"pushState"](j,"",Z),w.value=j}catch(Q){console.error(Q),g[O?"replace":"assign"](Z)}}function z(L,j){const O=Ui({},d.state,Ax(w.value.back,L,w.value.forward,!0),j,{position:w.value.position});S(L,O,!0),A.value=L}function o(L,j){const O=Ui({},w.value,d.state,{forward:L,scroll:hp()});S(O.current,O,!0);const B=Ui({},Ax(A.value,L,null),{position:O.position+1},j);S(L,B,!1),A.value=L}return{location:A,state:w,push:o,replace:z}}function yC(a){a=HE(a);const d=nT(a),g=rT(a,d.state,d.location,d.replace);function A(S,z=!0){z||g.pauseListeners(),history.go(S)}const w=Ui({location:"",base:a,go:A,createHref:YE.bind(null,a)},d,g);return Object.defineProperty(w,"location",{enumerable:!0,get:()=>d.location.value}),Object.defineProperty(w,"state",{enumerable:!0,get:()=>d.state.value}),w}function oT(a){return typeof a=="string"||a&&typeof a=="object"}function b0(a){return typeof a=="string"||typeof a=="symbol"}const Us={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},w0=dc("nf");var bx;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(bx||(bx={}));function ac(a,d){return Ui(new Error,{type:a,[w0]:!0},d)}function Vs(a,d){return a instanceof Error&&w0 in a&&(d==null||!!(a.type&d))}const wx="[^/]+?",sT={sensitive:!1,strict:!1,start:!0,end:!0},aT=/[.+*?^${}()[\]/\\]/g;function lT(a,d){const g=Ui({},sT,d),A=[];let w=g.start?"^":"";const S=[];for(const j of a){const O=j.length?[]:[90];g.strict&&!j.length&&(w+="/");for(let B=0;B<j.length;B++){const Z=j[B];let Q=40+(g.sensitive?.25:0);if(Z.type===0)B||(w+="/"),w+=Z.value.replace(aT,"\\$&"),Q+=40;else if(Z.type===1){const{value:ce,repeatable:Ee,optional:Ae,regexp:Fe}=Z;S.push({name:ce,repeatable:Ee,optional:Ae});const ft=Fe||wx;if(ft!==wx){Q+=10;try{new RegExp(`(${ft})`)}catch(mt){throw new Error(`Invalid custom RegExp for param "${ce}" (${ft}): `+mt.message)}}let Pt=Ee?`((?:${ft})(?:/(?:${ft}))*)`:`(${ft})`;B||(Pt=Ae&&j.length<2?`(?:/${Pt})`:"/"+Pt),Ae&&(Pt+="?"),w+=Pt,Q+=20,Ae&&(Q+=-8),Ee&&(Q+=-20),ft===".*"&&(Q+=-50)}O.push(Q)}A.push(O)}if(g.strict&&g.end){const j=A.length-1;A[j][A[j].length-1]+=.7000000000000001}g.strict||(w+="/?"),g.end?w+="$":g.strict&&(w+="(?:/|$)");const z=new RegExp(w,g.sensitive?"":"i");function o(j){const O=j.match(z),B={};if(!O)return null;for(let Z=1;Z<O.length;Z++){const Q=O[Z]||"",ce=S[Z-1];B[ce.name]=Q&&ce.repeatable?Q.split("/"):Q}return B}function L(j){let O="",B=!1;for(const Z of a){(!B||!O.endsWith("/"))&&(O+="/"),B=!1;for(const Q of Z)if(Q.type===0)O+=Q.value;else if(Q.type===1){const{value:ce,repeatable:Ee,optional:Ae}=Q,Fe=ce in j?j[ce]:"";if(Array.isArray(Fe)&&!Ee)throw new Error(`Provided param "${ce}" is an array but it is not repeatable (* or + modifiers)`);const ft=Array.isArray(Fe)?Fe.join("/"):Fe;if(!ft)if(Ae)Z.length<2&&(O.endsWith("/")?O=O.slice(0,-1):B=!0);else throw new Error(`Missing required param "${ce}"`);O+=ft}}return O}return{re:z,score:A,keys:S,parse:o,stringify:L}}function cT(a,d){let g=0;for(;g<a.length&&g<d.length;){const A=d[g]-a[g];if(A)return A;g++}return a.length<d.length?a.length===1&&a[0]===40+40?-1:1:a.length>d.length?d.length===1&&d[0]===40+40?1:-1:0}function uT(a,d){let g=0;const A=a.score,w=d.score;for(;g<A.length&&g<w.length;){const S=cT(A[g],w[g]);if(S)return S;g++}return w.length-A.length}const hT={type:0,value:""},dT=/[a-zA-Z0-9_]/;function pT(a){if(!a)return[[]];if(a==="/")return[[hT]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function d(Q){throw new Error(`ERR (${g})/"${j}": ${Q}`)}let g=0,A=g;const w=[];let S;function z(){S&&w.push(S),S=[]}let o=0,L,j="",O="";function B(){!j||(g===0?S.push({type:0,value:j}):g===1||g===2||g===3?(S.length>1&&(L==="*"||L==="+")&&d(`A repeatable param (${j}) must be alone in its segment. eg: '/:ids+.`),S.push({type:1,value:j,regexp:O,repeatable:L==="*"||L==="+",optional:L==="*"||L==="?"})):d("Invalid state to consume buffer"),j="")}function Z(){j+=L}for(;o<a.length;){if(L=a[o++],L==="\\"&&g!==2){A=g,g=4;continue}switch(g){case 0:L==="/"?(j&&B(),z()):L===":"?(B(),g=1):Z();break;case 4:Z(),g=A;break;case 1:L==="("?g=2:dT.test(L)?Z():(B(),g=0,L!=="*"&&L!=="?"&&L!=="+"&&o--);break;case 2:L===")"?O[O.length-1]=="\\"?O=O.slice(0,-1)+L:g=3:O+=L;break;case 3:B(),g=0,L!=="*"&&L!=="?"&&L!=="+"&&o--,O="";break;default:d("Unknown state");break}}return g===2&&d(`Unfinished custom RegExp for param "${j}"`),B(),z(),w}function fT(a,d,g){const A=lT(pT(a.path),g),w=Ui(A,{record:a,parent:d,children:[],alias:[]});return d&&!w.record.aliasOf==!d.record.aliasOf&&d.children.push(w),w}function mT(a,d){const g=[],A=new Map;d=Tx({strict:!1,end:!0,sensitive:!1},d);function w(O){return A.get(O)}function S(O,B,Z){const Q=!Z,ce=gT(O);ce.aliasOf=Z&&Z.record;const Ee=Tx(d,O),Ae=[ce];if("alias"in O){const Pt=typeof O.alias=="string"?[O.alias]:O.alias;for(const mt of Pt)Ae.push(Ui({},ce,{components:Z?Z.record.components:ce.components,path:mt,aliasOf:Z?Z.record:ce}))}let Fe,ft;for(const Pt of Ae){const{path:mt}=Pt;if(B&&mt[0]!=="/"){const Rt=B.record.path,Ke=Rt[Rt.length-1]==="/"?"":"/";Pt.path=B.record.path+(mt&&Ke+mt)}if(Fe=fT(Pt,B,Ee),Z?Z.alias.push(Fe):(ft=ft||Fe,ft!==Fe&&ft.alias.push(Fe),Q&&O.name&&!Ex(Fe)&&z(O.name)),"children"in ce){const Rt=ce.children;for(let Ke=0;Ke<Rt.length;Ke++)S(Rt[Ke],Fe,Z&&Z.children[Ke])}Z=Z||Fe,L(Fe)}return ft?()=>{z(ft)}:Nu}function z(O){if(b0(O)){const B=A.get(O);B&&(A.delete(O),g.splice(g.indexOf(B),1),B.children.forEach(z),B.alias.forEach(z))}else{const B=g.indexOf(O);B>-1&&(g.splice(B,1),O.record.name&&A.delete(O.record.name),O.children.forEach(z),O.alias.forEach(z))}}function o(){return g}function L(O){let B=0;for(;B<g.length&&uT(O,g[B])>=0&&(O.record.path!==g[B].record.path||!E0(O,g[B]));)B++;g.splice(B,0,O),O.record.name&&!Ex(O)&&A.set(O.record.name,O)}function j(O,B){let Z,Q={},ce,Ee;if("name"in O&&O.name){if(Z=A.get(O.name),!Z)throw ac(1,{location:O});Ee=Z.record.name,Q=Ui(_T(B.params,Z.keys.filter(ft=>!ft.optional).map(ft=>ft.name)),O.params),ce=Z.stringify(Q)}else if("path"in O)ce=O.path,Z=g.find(ft=>ft.re.test(ce)),Z&&(Q=Z.parse(ce),Ee=Z.record.name);else{if(Z=B.name?A.get(B.name):g.find(ft=>ft.re.test(B.path)),!Z)throw ac(1,{location:O,currentLocation:B});Ee=Z.record.name,Q=Ui({},B.params,O.params),ce=Z.stringify(Q)}const Ae=[];let Fe=Z;for(;Fe;)Ae.unshift(Fe.record),Fe=Fe.parent;return{name:Ee,path:ce,params:Q,matched:Ae,meta:xT(Ae)}}return a.forEach(O=>S(O)),{addRoute:S,resolve:j,removeRoute:z,getRoutes:o,getRecordMatcher:w}}function _T(a,d){const g={};for(const A of d)A in a&&(g[A]=a[A]);return g}function gT(a){return{path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:void 0,beforeEnter:a.beforeEnter,props:yT(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||{}:{default:a.component}}}function yT(a){const d={},g=a.props||!1;if("component"in a)d.default=g;else for(const A in a.components)d[A]=typeof g=="boolean"?g:g[A];return d}function Ex(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function xT(a){return a.reduce((d,g)=>Ui(d,g.meta),{})}function Tx(a,d){const g={};for(const A in a)g[A]=A in d?d[A]:a[A];return g}function E0(a,d){return d.children.some(g=>g===a||E0(a,g))}const T0=/#/g,vT=/&/g,AT=/\//g,bT=/=/g,wT=/\?/g,S0=/\+/g,ET=/%5B/g,TT=/%5D/g,I0=/%5E/g,ST=/%60/g,C0=/%7B/g,IT=/%7C/g,M0=/%7D/g,CT=/%20/g;function p_(a){return encodeURI(""+a).replace(IT,"|").replace(ET,"[").replace(TT,"]")}function MT(a){return p_(a).replace(C0,"{").replace(M0,"}").replace(I0,"^")}function Pm(a){return p_(a).replace(S0,"%2B").replace(CT,"+").replace(T0,"%23").replace(vT,"%26").replace(ST,"`").replace(C0,"{").replace(M0,"}").replace(I0,"^")}function kT(a){return Pm(a).replace(bT,"%3D")}function zT(a){return p_(a).replace(T0,"%23").replace(wT,"%3F")}function PT(a){return a==null?"":zT(a).replace(AT,"%2F")}function Qd(a){try{return decodeURIComponent(""+a)}catch{}return""+a}function DT(a){const d={};if(a===""||a==="?")return d;const A=(a[0]==="?"?a.slice(1):a).split("&");for(let w=0;w<A.length;++w){const S=A[w].replace(S0," "),z=S.indexOf("="),o=Qd(z<0?S:S.slice(0,z)),L=z<0?null:Qd(S.slice(z+1));if(o in d){let j=d[o];Array.isArray(j)||(j=d[o]=[j]),j.push(L)}else d[o]=L}return d}function Sx(a){let d="";for(let g in a){const A=a[g];if(g=kT(g),A==null){A!==void 0&&(d+=(d.length?"&":"")+g);continue}(Array.isArray(A)?A.map(S=>S&&Pm(S)):[A&&Pm(A)]).forEach(S=>{S!==void 0&&(d+=(d.length?"&":"")+g,S!=null&&(d+="="+S))})}return d}function BT(a){const d={};for(const g in a){const A=a[g];A!==void 0&&(d[g]=Array.isArray(A)?A.map(w=>w==null?null:""+w):A==null?A:""+A)}return d}function Pu(){let a=[];function d(A){return a.push(A),()=>{const w=a.indexOf(A);w>-1&&a.splice(w,1)}}function g(){a=[]}return{add:d,list:()=>a,reset:g}}function Gs(a,d,g,A,w){const S=A&&(A.enterCallbacks[w]=A.enterCallbacks[w]||[]);return()=>new Promise((z,o)=>{const L=B=>{B===!1?o(ac(4,{from:g,to:d})):B instanceof Error?o(B):oT(B)?o(ac(2,{from:d,to:B})):(S&&A.enterCallbacks[w]===S&&typeof B=="function"&&S.push(B),z())},j=a.call(A&&A.instances[w],d,g,L);let O=Promise.resolve(j);a.length<3&&(O=O.then(L)),O.catch(B=>o(B))})}function Qf(a,d,g,A){const w=[];for(const S of a)for(const z in S.components){let o=S.components[z];if(!(d!=="beforeRouteEnter"&&!S.instances[z]))if(LT(o)){const j=(o.__vccOpts||o)[d];j&&w.push(Gs(j,g,A,S,z))}else{let L=o();w.push(()=>L.then(j=>{if(!j)return Promise.reject(new Error(`Couldn't resolve component "${z}" at "${S.path}"`));const O=NE(j)?j.default:j;S.components[z]=O;const Z=(O.__vccOpts||O)[d];return Z&&Gs(Z,g,A,S,z)()}))}}return w}function LT(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function Ix(a){const d=Ni(up),g=Ni(x0),A=zt(()=>d.resolve(ai(a.to))),w=zt(()=>{const{matched:L}=A.value,{length:j}=L,O=L[j-1],B=g.matched;if(!O||!B.length)return-1;const Z=B.findIndex(sc.bind(null,O));if(Z>-1)return Z;const Q=Cx(L[j-2]);return j>1&&Cx(O)===Q&&B[B.length-1].path!==Q?B.findIndex(sc.bind(null,L[j-2])):Z}),S=zt(()=>w.value>-1&&UT(g.params,A.value.params)),z=zt(()=>w.value>-1&&w.value===g.matched.length-1&&v0(g.params,A.value.params));function o(L={}){return OT(L)?d[ai(a.replace)?"replace":"push"](ai(a.to)).catch(Nu):Promise.resolve()}return{route:A,href:zt(()=>A.value.href),isActive:S,isExactActive:z,navigate:o}}const RT=Yi({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ix,setup(a,{slots:d}){const g=Mo(Ix(a)),{options:A}=Ni(up),w=zt(()=>({[Mx(a.activeClass,A.linkActiveClass,"router-link-active")]:g.isActive,[Mx(a.exactActiveClass,A.linkExactActiveClass,"router-link-exact-active")]:g.isExactActive}));return()=>{const S=d.default&&d.default(g);return a.custom?S:Yr("a",{"aria-current":g.isExactActive?a.ariaCurrentValue:null,href:g.href,onClick:g.navigate,class:w.value},S)}}}),FT=RT;function OT(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const d=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(d))return}return a.preventDefault&&a.preventDefault(),!0}}function UT(a,d){for(const g in d){const A=d[g],w=a[g];if(typeof A=="string"){if(A!==w)return!1}else if(!Array.isArray(w)||w.length!==A.length||A.some((S,z)=>S!==w[z]))return!1}return!0}function Cx(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const Mx=(a,d,g)=>a!=null?a:d!=null?d:g,VT=Yi({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},setup(a,{attrs:d,slots:g}){const A=Ni(km),w=zt(()=>a.route||A.value),S=Ni(gx,0),z=zt(()=>w.value.matched[S]);pr(gx,S+1),pr(jE,z),pr(km,w);const o=$t();return pn(()=>[o.value,z.value,a.name],([L,j,O],[B,Z,Q])=>{j&&(j.instances[O]=L,Z&&Z!==j&&L&&L===B&&(j.leaveGuards.size||(j.leaveGuards=Z.leaveGuards),j.updateGuards.size||(j.updateGuards=Z.updateGuards))),L&&j&&(!Z||!sc(j,Z)||!B)&&(j.enterCallbacks[O]||[]).forEach(ce=>ce(L))},{flush:"post"}),()=>{const L=w.value,j=z.value,O=j&&j.components[a.name],B=a.name;if(!O)return kx(g.default,{Component:O,route:L});const Z=j.props[a.name],Q=Z?Z===!0?L.params:typeof Z=="function"?Z(L):Z:null,Ee=Yr(O,Ui({},Q,d,{onVnodeUnmounted:Ae=>{Ae.component.isUnmounted&&(j.instances[B]=null)},ref:o}));return kx(g.default,{Component:Ee,route:L})||Ee}}});function kx(a,d){if(!a)return null;const g=a(d);return g.length===1?g[0]:g}const jT=VT;function xC(a){const d=mT(a.routes,a),g=a.parseQuery||DT,A=a.stringifyQuery||Sx,w=a.history,S=Pu(),z=Pu(),o=Pu(),L=uw(Us);let j=Us;ec&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const O=Xf.bind(null,Ue=>""+Ue),B=Xf.bind(null,PT),Z=Xf.bind(null,Qd);function Q(Ue,xt){let nt,Ct;return b0(Ue)?(nt=d.getRecordMatcher(Ue),Ct=xt):Ct=Ue,d.addRoute(Ct,nt)}function ce(Ue){const xt=d.getRecordMatcher(Ue);xt&&d.removeRoute(xt)}function Ee(){return d.getRoutes().map(Ue=>Ue.record)}function Ae(Ue){return!!d.getRecordMatcher(Ue)}function Fe(Ue,xt){if(xt=Ui({},xt||L.value),typeof Ue=="string"){const at=Hf(g,Ue,xt.path),se=d.resolve({path:at.path},xt),_e=w.createHref(at.fullPath);return Ui(at,se,{params:Z(se.params),hash:Qd(at.hash),redirectedFrom:void 0,href:_e})}let nt;if("path"in Ue)nt=Ui({},Ue,{path:Hf(g,Ue.path,xt.path).path});else{const at=Ui({},Ue.params);for(const se in at)at[se]==null&&delete at[se];nt=Ui({},Ue,{params:B(Ue.params)}),xt.params=B(xt.params)}const Ct=d.resolve(nt,xt),wi=Ue.hash||"";Ct.params=O(Z(Ct.params));const xi=ZE(A,Ui({},Ue,{hash:MT(wi),path:Ct.path})),Zt=w.createHref(xi);return Ui({fullPath:xi,hash:wi,query:A===Sx?BT(Ue.query):Ue.query||{}},Ct,{redirectedFrom:void 0,href:Zt})}function ft(Ue){return typeof Ue=="string"?Hf(g,Ue,L.value.path):Ui({},Ue)}function Pt(Ue,xt){if(j!==Ue)return ac(8,{from:xt,to:Ue})}function mt(Ue){return We(Ue)}function Rt(Ue){return mt(Ui(ft(Ue),{replace:!0}))}function Ke(Ue){const xt=Ue.matched[Ue.matched.length-1];if(xt&&xt.redirect){const{redirect:nt}=xt;let Ct=typeof nt=="function"?nt(Ue):nt;return typeof Ct=="string"&&(Ct=Ct.includes("?")||Ct.includes("#")?Ct=ft(Ct):{path:Ct},Ct.params={}),Ui({query:Ue.query,hash:Ue.hash,params:Ue.params},Ct)}}function We(Ue,xt){const nt=j=Fe(Ue),Ct=L.value,wi=Ue.state,xi=Ue.force,Zt=Ue.replace===!0,at=Ke(nt);if(at)return We(Ui(ft(at),{state:wi,force:xi,replace:Zt}),xt||nt);const se=nt;se.redirectedFrom=xt;let _e;return!xi&&qE(A,Ct,nt)&&(_e=ac(16,{to:se,from:Ct}),Sr(Ct,Ct,!0,!1)),(_e?Promise.resolve(_e):Tt(se,Ct)).catch(Ce=>Vs(Ce)?Vs(Ce,2)?Ce:ki(Ce):ui(Ce,se,Ct)).then(Ce=>{if(Ce){if(Vs(Ce,2))return We(Ui(ft(Ce.to),{state:wi,force:xi,replace:Zt}),xt||se)}else Ce=It(se,Ct,!0,Zt,wi);return Dt(se,Ct,Ce),Ce})}function gt(Ue,xt){const nt=Pt(Ue,xt);return nt?Promise.reject(nt):Promise.resolve()}function Tt(Ue,xt){let nt;const[Ct,wi,xi]=NT(Ue,xt);nt=Qf(Ct.reverse(),"beforeRouteLeave",Ue,xt);for(const at of Ct)at.leaveGuards.forEach(se=>{nt.push(Gs(se,Ue,xt))});const Zt=gt.bind(null,Ue,xt);return nt.push(Zt),Wl(nt).then(()=>{nt=[];for(const at of S.list())nt.push(Gs(at,Ue,xt));return nt.push(Zt),Wl(nt)}).then(()=>{nt=Qf(wi,"beforeRouteUpdate",Ue,xt);for(const at of wi)at.updateGuards.forEach(se=>{nt.push(Gs(se,Ue,xt))});return nt.push(Zt),Wl(nt)}).then(()=>{nt=[];for(const at of Ue.matched)if(at.beforeEnter&&!xt.matched.includes(at))if(Array.isArray(at.beforeEnter))for(const se of at.beforeEnter)nt.push(Gs(se,Ue,xt));else nt.push(Gs(at.beforeEnter,Ue,xt));return nt.push(Zt),Wl(nt)}).then(()=>(Ue.matched.forEach(at=>at.enterCallbacks={}),nt=Qf(xi,"beforeRouteEnter",Ue,xt),nt.push(Zt),Wl(nt))).then(()=>{nt=[];for(const at of z.list())nt.push(Gs(at,Ue,xt));return nt.push(Zt),Wl(nt)}).catch(at=>Vs(at,8)?at:Promise.reject(at))}function Dt(Ue,xt,nt){for(const Ct of o.list())Ct(Ue,xt,nt)}function It(Ue,xt,nt,Ct,wi){const xi=Pt(Ue,xt);if(xi)return xi;const Zt=xt===Us,at=ec?history.state:{};nt&&(Ct||Zt?w.replace(Ue.fullPath,Ui({scroll:Zt&&at&&at.scroll},wi)):w.push(Ue.fullPath,wi)),L.value=Ue,Sr(Ue,xt,nt,Zt),ki()}let yt;function ti(){yt=w.listen((Ue,xt,nt)=>{const Ct=Fe(Ue),wi=Ke(Ct);if(wi){We(Ui(wi,{replace:!0}),Ct).catch(Nu);return}j=Ct;const xi=L.value;ec&&eT(vx(xi.fullPath,nt.delta),hp()),Tt(Ct,xi).catch(Zt=>Vs(Zt,12)?Zt:Vs(Zt,2)?(We(Zt.to,Ct).then(at=>{Vs(at,20)&&!nt.delta&&nt.type===Hu.pop&&w.go(-1,!1)}).catch(Nu),Promise.reject()):(nt.delta&&w.go(-nt.delta,!1),ui(Zt,Ct,xi))).then(Zt=>{Zt=Zt||It(Ct,xi,!1),Zt&&(nt.delta?w.go(-nt.delta,!1):nt.type===Hu.pop&&Vs(Zt,20)&&w.go(-1,!1)),Dt(Ct,xi,Zt)}).catch(Nu)})}let li=Pu(),_r=Pu(),bi;function ui(Ue,xt,nt){ki(Ue);const Ct=_r.list();return Ct.length?Ct.forEach(wi=>wi(Ue,xt,nt)):console.error(Ue),Promise.reject(Ue)}function Bt(){return bi&&L.value!==Us?Promise.resolve():new Promise((Ue,xt)=>{li.add([Ue,xt])})}function ki(Ue){return bi||(bi=!Ue,ti(),li.list().forEach(([xt,nt])=>Ue?nt(Ue):xt()),li.reset()),Ue}function Sr(Ue,xt,nt,Ct){const{scrollBehavior:wi}=a;if(!ec||!wi)return Promise.resolve();const xi=!nt&&tT(vx(Ue.fullPath,0))||(Ct||!nt)&&history.state&&history.state.scroll||null;return Mn().then(()=>wi(Ue,xt,xi)).then(Zt=>Zt&&JE(Zt)).catch(Zt=>ui(Zt,Ue,xt))}const Qi=Ue=>w.go(Ue);let Ir;const Yt=new Set;return{currentRoute:L,addRoute:Q,removeRoute:ce,hasRoute:Ae,getRoutes:Ee,resolve:Fe,options:a,push:mt,replace:Rt,go:Qi,back:()=>Qi(-1),forward:()=>Qi(1),beforeEach:S.add,beforeResolve:z.add,afterEach:o.add,onError:_r.add,isReady:Bt,install(Ue){const xt=this;Ue.component("RouterLink",FT),Ue.component("RouterView",jT),Ue.config.globalProperties.$router=xt,Object.defineProperty(Ue.config.globalProperties,"$route",{enumerable:!0,get:()=>ai(L)}),ec&&!Ir&&L.value===Us&&(Ir=!0,mt(w.location).catch(wi=>{}));const nt={};for(const wi in Us)nt[wi]=zt(()=>L.value[wi]);Ue.provide(up,xt),Ue.provide(x0,Mo(nt)),Ue.provide(km,L);const Ct=Ue.unmount;Yt.add(Ue),Ue.unmount=function(){Yt.delete(Ue),Yt.size<1&&(j=Us,yt&&yt(),L.value=Us,Ir=!1,bi=!1),Ct()}}}}function Wl(a){return a.reduce((d,g)=>d.then(()=>g()),Promise.resolve())}function NT(a,d){const g=[],A=[],w=[],S=Math.max(d.matched.length,a.matched.length);for(let z=0;z<S;z++){const o=d.matched[z];o&&(a.matched.find(j=>sc(j,o))?A.push(o):g.push(o));const L=a.matched[z];L&&(d.matched.find(j=>sc(j,L))||w.push(L))}return[g,A,w]}function vC(){return Ni(up)}try{self["workbox:window:6.5.2"]&&_()}catch{}function zx(a,d){return new Promise(function(g){var A=new MessageChannel;A.port1.onmessage=function(w){g(w.data)},a.postMessage(d,[A.port2])})}function $T(a,d){for(var g=0;g<d.length;g++){var A=d[g];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(a,A.key,A)}}function Px(a,d){(d==null||d>a.length)&&(d=a.length);for(var g=0,A=new Array(d);g<d;g++)A[g]=a[g];return A}function GT(a,d){var g;if(typeof Symbol=="undefined"||a[Symbol.iterator]==null){if(Array.isArray(a)||(g=function(w,S){if(w){if(typeof w=="string")return Px(w,S);var z=Object.prototype.toString.call(w).slice(8,-1);return z==="Object"&&w.constructor&&(z=w.constructor.name),z==="Map"||z==="Set"?Array.from(w):z==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(z)?Px(w,S):void 0}}(a))||d&&a&&typeof a.length=="number"){g&&(a=g);var A=0;return function(){return A>=a.length?{done:!0}:{done:!1,value:a[A++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return(g=a[Symbol.iterator]()).next.bind(g)}try{self["workbox:core:6.5.2"]&&_()}catch{}var Yf=function(){var a=this;this.promise=new Promise(function(d,g){a.resolve=d,a.reject=g})};function Kf(a,d){var g=location.href;return new URL(a,g).href===new URL(d,g).href}var Du=function(a,d){this.type=a,Object.assign(this,d)};function Pd(a,d,g){return g?d?d(a):a:(a&&a.then||(a=Promise.resolve(a)),d?a.then(d):a)}function ZT(){}var qT={type:"SKIP_WAITING"};function Dx(a,d){if(!d)return a&&a.then?a.then(ZT):Promise.resolve()}var AC=function(a){var d,g;function A(o,L){var j,O;return L===void 0&&(L={}),(j=a.call(this)||this).nn={},j.tn=0,j.rn=new Yf,j.en=new Yf,j.on=new Yf,j.un=0,j.an=new Set,j.cn=function(){var B=j.fn,Z=B.installing;j.tn>0||!Kf(Z.scriptURL,j.sn.toString())||performance.now()>j.un+6e4?(j.vn=Z,B.removeEventListener("updatefound",j.cn)):(j.hn=Z,j.an.add(Z),j.rn.resolve(Z)),++j.tn,Z.addEventListener("statechange",j.ln)},j.ln=function(B){var Z=j.fn,Q=B.target,ce=Q.state,Ee=Q===j.vn,Ae={sw:Q,isExternal:Ee,originalEvent:B};!Ee&&j.mn&&(Ae.isUpdate=!0),j.dispatchEvent(new Du(ce,Ae)),ce==="installed"?j.wn=self.setTimeout(function(){ce==="installed"&&Z.waiting===Q&&j.dispatchEvent(new Du("waiting",Ae))},200):ce==="activating"&&(clearTimeout(j.wn),Ee||j.en.resolve(Q))},j.dn=function(B){var Z=j.hn,Q=Z!==navigator.serviceWorker.controller;j.dispatchEvent(new Du("controlling",{isExternal:Q,originalEvent:B,sw:Z,isUpdate:j.mn})),Q||j.on.resolve(Z)},j.gn=(O=function(B){var Z=B.data,Q=B.ports,ce=B.source;return Pd(j.getSW(),function(){j.an.has(ce)&&j.dispatchEvent(new Du("message",{data:Z,originalEvent:B,ports:Q,sw:ce}))})},function(){for(var B=[],Z=0;Z<arguments.length;Z++)B[Z]=arguments[Z];try{return Promise.resolve(O.apply(this,B))}catch(Q){return Promise.reject(Q)}}),j.sn=o,j.nn=L,navigator.serviceWorker.addEventListener("message",j.gn),j}g=a,(d=A).prototype=Object.create(g.prototype),d.prototype.constructor=d,d.__proto__=g;var w,S,z=A.prototype;return z.register=function(o){var L=(o===void 0?{}:o).immediate,j=L!==void 0&&L;try{var O=this;return function(B,Z){var Q=B();return Q&&Q.then?Q.then(Z):Z(Q)}(function(){if(!j&&document.readyState!=="complete")return Dx(new Promise(function(B){return window.addEventListener("load",B)}))},function(){return O.mn=Boolean(navigator.serviceWorker.controller),O.yn=O.pn(),Pd(O.bn(),function(B){O.fn=B,O.yn&&(O.hn=O.yn,O.en.resolve(O.yn),O.on.resolve(O.yn),O.yn.addEventListener("statechange",O.ln,{once:!0}));var Z=O.fn.waiting;return Z&&Kf(Z.scriptURL,O.sn.toString())&&(O.hn=Z,Promise.resolve().then(function(){O.dispatchEvent(new Du("waiting",{sw:Z,wasWaitingBeforeRegister:!0}))}).then(function(){})),O.hn&&(O.rn.resolve(O.hn),O.an.add(O.hn)),O.fn.addEventListener("updatefound",O.cn),navigator.serviceWorker.addEventListener("controllerchange",O.dn),O.fn})})}catch(B){return Promise.reject(B)}},z.update=function(){try{return this.fn?Dx(this.fn.update()):void 0}catch(o){return Promise.reject(o)}},z.getSW=function(){return this.hn!==void 0?Promise.resolve(this.hn):this.rn.promise},z.messageSW=function(o){try{return Pd(this.getSW(),function(L){return zx(L,o)})}catch(L){return Promise.reject(L)}},z.messageSkipWaiting=function(){this.fn&&this.fn.waiting&&zx(this.fn.waiting,qT)},z.pn=function(){var o=navigator.serviceWorker.controller;return o&&Kf(o.scriptURL,this.sn.toString())?o:void 0},z.bn=function(){try{var o=this;return function(L,j){try{var O=L()}catch(B){return j(B)}return O&&O.then?O.then(void 0,j):O}(function(){return Pd(navigator.serviceWorker.register(o.sn,o.nn),function(L){return o.un=performance.now(),L})},function(L){throw L})}catch(L){return Promise.reject(L)}},w=A,(S=[{key:"active",get:function(){return this.en.promise}},{key:"controlling",get:function(){return this.on.promise}}])&&$T(w.prototype,S),A}(function(){function a(){this.Pn=new Map}var d=a.prototype;return d.addEventListener=function(g,A){this.Sn(g).add(A)},d.removeEventListener=function(g,A){this.Sn(g).delete(A)},d.dispatchEvent=function(g){g.target=this;for(var A,w=GT(this.Sn(g.type));!(A=w()).done;)(0,A.value)(g)},d.Sn=function(g){return this.Pn.has(g)||this.Pn.set(g,new Set),this.Pn.get(g)},a}()),WT=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},XT={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"};const{webm:HT,mp4:QT}=XT,Jf=()=>typeof navigator!="undefined"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,em=()=>"wakeLock"in navigator;class YT{constructor(){if(this.enabled=!1,em()){this._wakeLock=null;const d=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",d),document.addEventListener("fullscreenchange",d)}else Jf()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",HT),this._addSourceToVideo(this.noSleepVideo,"mp4",QT),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(d,g,A){var w=document.createElement("source");w.src=A,w.type=`video/${g}`,d.appendChild(w)}get isEnabled(){return this.enabled}enable(){return em()?navigator.wakeLock.request("screen").then(d=>{this._wakeLock=d,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(d=>{throw this.enabled=!1,console.error(`${d.name}, ${d.message}`),d}):Jf()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(g=>(this.enabled=!0,g)).catch(g=>{throw this.enabled=!1,g})}disable(){em()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):Jf()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}}var bC=YT,KT=!1;/*!
  * pinia v2.0.13
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */let k0;const dp=a=>k0=a,z0=Symbol();function Dm(a){return a&&typeof a=="object"&&Object.prototype.toString.call(a)==="[object Object]"&&typeof a.toJSON!="function"}var Gu;(function(a){a.direct="direct",a.patchObject="patch object",a.patchFunction="patch function"})(Gu||(Gu={}));function wC(){const a=tv(!0),d=a.run(()=>$t({}));let g=[],A=[];const w=nc({install(S){dp(w),w._a=S,S.provide(z0,w),S.config.globalProperties.$pinia=w,A.forEach(z=>g.push(z)),A=[]},use(S){return!this._a&&!KT?A.push(S):g.push(S),this},_p:g,_a:null,_e:a,_s:new Map,state:d});return w}const P0=()=>{};function Bx(a,d,g,A=P0){a.push(d);const w=()=>{const S=a.indexOf(d);S>-1&&(a.splice(S,1),A())};return!g&&ap()&&io(w),w}function Xl(a,...d){a.slice().forEach(g=>{g(...d)})}function Bm(a,d){for(const g in d){if(!d.hasOwnProperty(g))continue;const A=d[g],w=a[g];Dm(w)&&Dm(A)&&a.hasOwnProperty(g)&&!Hi(A)&&!is(A)?a[g]=Bm(w,A):a[g]=A}return a}const JT=Symbol();function eS(a){return!Dm(a)||!a.hasOwnProperty(JT)}const{assign:es}=Object;function tS(a){return!!(Hi(a)&&a.effect)}function iS(a,d,g,A){const{state:w,actions:S,getters:z}=d,o=g.state.value[a];let L;function j(){o||(g.state.value[a]=w?w():{});const O=pw(g.state.value[a]);return es(O,S,Object.keys(z||{}).reduce((B,Z)=>(B[Z]=nc(zt(()=>{dp(g);const Q=g._s.get(a);return z[Z].call(Q,Q)})),B),{}))}return L=D0(a,j,d,g),L.$reset=function(){const B=w?w():{};this.$patch(Z=>{es(Z,B)})},L}function D0(a,d,g={},A,w){let S;const z=g.state,o=es({actions:{}},g),L={deep:!0};let j,O,B=nc([]),Z=nc([]),Q;const ce=A.state.value[a];!z&&!ce&&(A.state.value[a]={}),$t({});function Ee(Ke){let We;j=O=!1,typeof Ke=="function"?(Ke(A.state.value[a]),We={type:Gu.patchFunction,storeId:a,events:Q}):(Bm(A.state.value[a],Ke),We={type:Gu.patchObject,payload:Ke,storeId:a,events:Q}),Mn().then(()=>{j=!0}),O=!0,Xl(B,We,A.state.value[a])}const Ae=P0;function Fe(){S.stop(),B=[],Z=[],A._s.delete(a)}function ft(Ke,We){return function(){dp(A);const gt=Array.from(arguments),Tt=[],Dt=[];function It(li){Tt.push(li)}function yt(li){Dt.push(li)}Xl(Z,{args:gt,name:Ke,store:mt,after:It,onError:yt});let ti;try{ti=We.apply(this&&this.$id===a?this:mt,gt)}catch(li){throw Xl(Dt,li),li}return ti instanceof Promise?ti.then(li=>(Xl(Tt,li),li)).catch(li=>(Xl(Dt,li),Promise.reject(li))):(Xl(Tt,ti),ti)}}const Pt={_p:A,$id:a,$onAction:Bx.bind(null,Z),$patch:Ee,$reset:Ae,$subscribe(Ke,We={}){const gt=Bx(B,Ke,We.detached,()=>Tt()),Tt=S.run(()=>pn(()=>A.state.value[a],Dt=>{(We.flush==="sync"?O:j)&&Ke({storeId:a,type:Gu.direct,events:Q},Dt)},es({},L,We)));return gt},$dispose:Fe},mt=Mo(es({},Pt));A._s.set(a,mt);const Rt=A._e.run(()=>(S=tv(),S.run(()=>d())));for(const Ke in Rt){const We=Rt[Ke];if(Hi(We)&&!tS(We)||is(We))z||(ce&&eS(We)&&(Hi(We)?We.value=ce[Ke]:Bm(We,ce[Ke])),A.state.value[a][Ke]=We);else if(typeof We=="function"){const gt=ft(Ke,We);Rt[Ke]=gt,o.actions[Ke]=We}}return es(mt,Rt),es(Ci(mt),Rt),Object.defineProperty(mt,"$state",{get:()=>A.state.value[a],set:Ke=>{Ee(We=>{es(We,Ke)})}}),A._p.forEach(Ke=>{es(mt,S.run(()=>Ke({store:mt,app:A._a,pinia:A,options:o})))}),ce&&z&&g.hydrate&&g.hydrate(mt.$state,ce),j=!0,O=!0,mt}function EC(a,d,g){let A,w;const S=typeof d=="function";typeof a=="string"?(A=a,w=S?g:d):(w=a,A=a.id);function z(o,L){const j=ap();return o=o||j&&Ni(z0),o&&dp(o),o=k0,o._s.has(A)||(S?D0(A,d,w,o):iS(A,w,o)),o._s.get(A)}return z.$id=A,z}var B0={exports:{}};(function(a,d){(function(g,A){a.exports=A()})(WT,function(){var g,A,w;function S(o,L){if(!g)g=L;else if(!A)A=L;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+A+")(sharedChunk); self.onerror = null;",O={};g(O),w=L(O),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}S(["exports"],function(o){var L="2.8.2",j=O;function O(i,e,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=r,this.p2y=n}O.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},O.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},O.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},O.prototype.solveCurveX=function(i,e){var r,n,l,u,p;for(e===void 0&&(e=1e-6),l=i,p=0;p<8;p++){if(u=this.sampleCurveX(l)-i,Math.abs(u)<e)return l;var f=this.sampleCurveDerivativeX(l);if(Math.abs(f)<1e-6)break;l-=u/f}if((l=i)<(r=0))return r;if(l>(n=1))return n;for(;r<n;){if(u=this.sampleCurveX(l),Math.abs(u-i)<e)return l;i>u?r=l:n=l,l=.5*(n-r)+r}return l},O.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var B=Z;function Z(i,e){this.x=i,this.y=e}Z.prototype={clone:function(){return new Z(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,e){var r=Math.cos(i),n=Math.sin(i),l=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Z.convert=function(i){return i instanceof Z?i:Array.isArray(i)?new Z(i[0],i[1]):i};var Q=typeof self!="undefined"?self:{};const ce=Math.PI/180,Ee=180/Math.PI;function Ae(i){return i*ce}function Fe(i){return i*Ee}const ft=[[0,0],[1,0],[1,1],[0,1]];function Pt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function mt(i,e,r,n){const l=new j(i,e,r,n);return function(u){return l.solve(u)}}const Rt=mt(.25,.1,.25,1);function Ke(i,e,r){return Math.min(r,Math.max(e,i))}function We(i,e,r){return(r=Ke((r-i)/(e-i),0,1))*r*(3-2*r)}function gt(i,e,r){const n=r-e,l=((i-e)%n+n)%n+e;return l===e?r:l}function Tt(i,e,r){if(!i.length)return r(null,[]);let n=i.length;const l=new Array(i.length);let u=null;i.forEach((p,f)=>{e(p,(x,b)=>{x&&(u=x),l[f]=b,--n==0&&r(u,l)})})}function Dt(i){const e=[];for(const r in i)e.push(i[r]);return e}function It(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}let yt=1;function ti(){return yt++}function li(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function _r(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function bi(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function ui(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Bt(i,e){return i.indexOf(e,i.length-e.length)!==-1}function ki(i,e,r){const n={};for(const l in i)n[l]=e.call(r||this,i[l],l,i);return n}function Sr(i,e,r){const n={};for(const l in i)e.call(r||this,i[l],l,i)&&(n[l]=i[l]);return n}function Qi(i){return Array.isArray(i)?i.map(Qi):typeof i=="object"&&i?ki(i,Qi):i}const Ir={};function Yt(i){Ir[i]||(typeof console!="undefined"&&console.warn(i),Ir[i]=!0)}function ir(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Ue(i){let e=0;for(let r,n,l=0,u=i.length,p=u-1;l<u;p=l++)r=i[l],n=i[p],e+=(n.x-r.x)*(r.y+n.y);return e}function xt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function nt(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,l,u)=>{const p=l||u;return e[n]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ct,wi,xi,Zt,at=null;function se(i){if(at==null){const e=i.navigator?i.navigator.userAgent:null;at=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return at}function _e(i){try{const e=Q[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const Ce={now:()=>xi!==void 0?xi:Q.performance.now(),setNow(i){xi=i},restoreNow(){xi=void 0},frame(i){const e=Q.requestAnimationFrame(i);return{cancel:()=>Q.cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:r,height:n}=i;Zt||(Zt=Q.document.createElement("canvas"));const l=Zt.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return(r>Zt.width||n>Zt.height)&&(Zt.width=r,Zt.height=n),l.clearRect(-e,-e,r+2*e,n+2*e),l.drawImage(i,0,0,r,n),l.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:i=>(Ct||(Ct=Q.document.createElement("a")),Ct.href=i,Ct.href),get devicePixelRatio(){return Q.devicePixelRatio},get prefersReducedMotion(){return!!Q.matchMedia&&(wi==null&&(wi=Q.matchMedia("(prefers-reduced-motion: reduce)")),wi.matches)}};let Ne;const Be={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ne==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ne={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{Ne=i}}return Ne},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},et={supported:!1,testSupport:function(i){!tt&&Ye&&(Xe?Ft(i):ht=i)}};let ht,Ye,tt=!1,Xe=!1;function Ft(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Ye),i.isContextLost())return;et.supported=!0}catch{}i.deleteTexture(e),tt=!0}Q.document&&(Ye=Q.document.createElement("img"),Ye.onload=function(){ht&&Ft(ht),ht=null,Xe=!0},Ye.onerror=function(){tt=!0,ht=null},Ye.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const At="01",Lt="NO_ACCESS_TOKEN";function Vt(i){return i.indexOf("mapbox:")===0}function Jt(i){return Be.API_URL_REGEX.test(i)}const hi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ni(i){const e=i.match(hi);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function vi(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function gr(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(Q.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Pr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=gr(Be.ACCESS_TOKEN);let n="";return n=r&&r.u?Q.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):Be.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=_e("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const l=Q.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const u=Q.localStorage.getItem(n);u&&(this.anonId=u)}catch{Yt("Unable to read from LocalStorage")}}saveEventData(){const e=_e("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{Q.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&Q.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Yt("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,l){if(!Be.EVENTS_URL)return;const u=ni(Be.EVENTS_URL);u.params.push(`access_token=${l||Be.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:At,userId:this.anonId},f=r?It(p,r):p,x={url:vi(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([f])};this.pendingRequest=ue(x,b=>{this.pendingRequest=null,n(b),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const jn=new class extends Pr{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){Be.EVENTS_URL&&Be.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Vt(r)||Jt(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=gr(Be.ACCESS_TOKEN),r=e?e.u:Be.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;bi(this.anonId)||(this.anonId=li(),n=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(l),f=(l-this.eventData.lastSuccess)/864e5;n=n||f>=1||f<-1||u.getDate()!==p.getDate()}else n=!0;n?this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},i):this.processRequests()}},Nn=jn.postTurnstileEvent.bind(jn),zo=new class extends Pr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,n){this.skuToken=e,this.errorCb=n,Be.EVENTS_URL&&(r||Be.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Lt)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),bi(this.anonId)||(this.anonId=li()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},cr=zo.postMapLoadEvent.bind(zo),yr=new class extends Pr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,n){if(!Be.API_URL||!Be.SESSION_PATH)return;const l=ni(Be.API_URL+Be.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${n||Be.ACCESS_TOKEN||""}`);const u={url:vi(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ye(u,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,r,n){this.skuToken=e,this.errorCb=n,Be.SESSION_PATH&&Be.API_URL&&(r||Be.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(Lt)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},Po=yr.getSessionAPI.bind(yr),Do=new Set,Wa="mapbox-tiles";let xn,ro,Bo=500,Lo=50;function os(){Q.caches&&!xn&&(xn=Q.caches.open(Wa))}function Ys(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let ss=1/0;const J={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(J);class R extends Error{constructor(e,r,n){r===401&&Jt(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const V=xt()?()=>self.worker&&self.worker.referrer:()=>(Q.location.protocol==="blob:"?Q.parent:Q).location.href,H=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(V())&&!/^\w+:/.test(r))){if(Q.fetch&&Q.Request&&Q.AbortController&&Q.Request.prototype.hasOwnProperty("signal"))return function(n,l){const u=new Q.AbortController,p=new Q.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:V(),signal:u.signal});let f=!1,x=!1;const b=(T=p.url).indexOf("sku=")>0&&Jt(T);var T;n.type==="json"&&p.headers.set("Accept","application/json");const I=(D,U,$)=>{if(x)return;if(D&&D.message!=="SecurityError"&&Yt(D),U&&$)return M(U);const W=Date.now();Q.fetch(p).then(K=>{if(K.ok){const ae=b?K.clone():null;return M(K,ae,W)}return l(new R(K.statusText,K.status,n.url))}).catch(K=>{K.code!==20&&l(new Error(K.message))})},M=(D,U,$)=>{(n.type==="arrayBuffer"?D.arrayBuffer():n.type==="json"?D.json():D.text()).then(W=>{x||(U&&$&&function(K,ae,he){if(os(),!xn)return;const pe={status:ae.status,statusText:ae.statusText,headers:new Q.Headers};ae.headers.forEach((Ie,ke)=>pe.headers.set(ke,Ie));const fe=nt(ae.headers.get("Cache-Control")||"");if(fe["no-store"])return;fe["max-age"]&&pe.headers.set("Expires",new Date(he+1e3*fe["max-age"]).toUTCString());const me=pe.headers.get("Expires");me&&(new Date(me).getTime()-he<42e4||function(Ie,ke){if(ro===void 0)try{new Response(new ReadableStream),ro=!0}catch{ro=!1}ro?ke(Ie.body):Ie.blob().then(ke)}(ae,Ie=>{const ke=new Q.Response(Ie,pe);os(),xn&&xn.then(Le=>Le.put(Ys(K.url),ke)).catch(Le=>Yt(Le.message))}))}(p,U,$),f=!0,l(null,W,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(W=>{x||l(new Error(W.message))})};return b?function(D,U){if(os(),!xn)return U(null);const $=Ys(D.url);xn.then(W=>{W.match($).then(K=>{const ae=function(he){if(!he)return!1;const pe=new Date(he.headers.get("Expires")||0),fe=nt(he.headers.get("Cache-Control")||"");return pe>Date.now()&&!fe["no-cache"]}(K);W.delete($),ae&&W.put($,K.clone()),U(null,K,ae)}).catch(U)}).catch(U)}(p,I):I(null,null),{cancel:()=>{x=!0,f||u.abort()}}}(i,e);if(xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(n,l){const u=new Q.XMLHttpRequest;u.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in n.headers)u.setRequestHeader(p,n.headers[p]);return n.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=n.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(n.type==="json")try{p=JSON.parse(u.response)}catch(f){return l(f)}l(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new R(u.statusText,u.status,n.url))},u.send(n.body),{cancel:()=>u.abort()}}(i,e)},ne=function(i,e){return H(It(i,{type:"arrayBuffer"}),e)},ue=function(i,e){return H(It(i,{method:"POST"}),e)},ye=function(i,e){return H(It(i,{method:"GET"}),e)};function ge(i){const e=Q.document.createElement("a");return e.href=i,e.protocol===Q.document.location.protocol&&e.host===Q.document.location.host}const de="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let be,Re;be=[],Re=0;const it=function(i,e){if(et.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Re>=Be.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return be.push(u),u}Re++;let r=!1;const n=()=>{if(!r)for(r=!0,Re--;be.length&&Re<Be.MAX_PARALLEL_IMAGE_REQUESTS;){const u=be.shift(),{requestParameters:p,callback:f,cancelled:x}=u;x||(u.cancel=it(p,f).cancel)}},l=ne(i,(u,p,f,x)=>{n(),u?e(u):p&&(Q.createImageBitmap?function(b,T){const I=new Q.Blob([new Uint8Array(b)],{type:"image/png"});Q.createImageBitmap(I).then(M=>{T(null,M)}).catch(M=>{T(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(b,T)=>e(b,T,f,x)):function(b,T){const I=new Q.Image,M=Q.URL;I.onload=()=>{T(null,I),M.revokeObjectURL(I.src),I.onload=null,Q.requestAnimationFrame(()=>{I.src=de})},I.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Q.Blob([new Uint8Array(b)],{type:"image/png"});I.src=b.byteLength?M.createObjectURL(D):de}(p,(b,T)=>e(b,T,f,x)))});return{cancel:()=>{l.cancel(),n()}}};function Ve(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Mt(i,e,r){if(r&&r[i]){const n=r[i].indexOf(e);n!==-1&&r[i].splice(n,1)}}class bt{constructor(e,r={}){It(this,r),this.type=e}}class wt extends bt{constructor(e,r={}){super("error",It({error:e},r))}}class Ot{on(e,r){return this._listeners=this._listeners||{},Ve(e,r,this._listeners),this}off(e,r){return Mt(e,r,this._listeners),Mt(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ve(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new bt(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const l=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const f of l)f.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const f of u)Mt(n,f,this._oneTimeListeners),f.call(this,e);const p=this._eventedParent;p&&(It(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof wt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var we=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function fi(i,...e){for(const r of e)for(const n in r)i[n]=r[n];return i}function pt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function di(i){if(Array.isArray(i))return i.map(di);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=di(i[r]);return e}return pt(i)}class mi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ro{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,l]of r)this.bindings[n]=l}concat(e){return new Ro(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const $n={kind:"null"},Je={kind:"number"},ii={kind:"string"},Ht={kind:"boolean"},Dn={kind:"color"},Fo={kind:"object"},Kt={kind:"value"},Oo={kind:"collator"},as={kind:"formatted"},Cr={kind:"resolvedImage"};function Kr(i,e){return{kind:"array",itemType:i,N:e}}function Ri(i){if(i.kind==="array"){const e=Ri(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const gp=[$n,Je,ii,Ht,Dn,as,Fo,Kr(Kt),Cr];function Ks(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ks(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of gp)if(!Ks(r,e))return null}}return`Expected ${Ri(i)} but found ${Ri(e)} instead.`}function Xa(i,e){return e.some(r=>r.kind===i.kind)}function ls(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Ha(i){var e={exports:{}};return i(e,e.exports),e.exports}var pc=Ha(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function l(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function u(f){return(x=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:x>1?1:x;var x}function p(f,x,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?f+(x-f)*b*6:2*b<1?x:3*b<2?f+(x-f)*(2/3-b)*6:f}try{e.parseCSSColor=function(f){var x,b=f.replace(/ /g,"").toLowerCase();if(b in r)return r[b].slice();if(b[0]==="#")return b.length===4?(x=parseInt(b.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:b.length===7&&(x=parseInt(b.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var T=b.indexOf("("),I=b.indexOf(")");if(T!==-1&&I+1===b.length){var M=b.substr(0,T),D=b.substr(T+1,I-(T+1)).split(","),U=1;switch(M){case"rgba":if(D.length!==4)return null;U=u(D.pop());case"rgb":return D.length!==3?null:[l(D[0]),l(D[1]),l(D[2]),U];case"hsla":if(D.length!==4)return null;U=u(D.pop());case"hsl":if(D.length!==3)return null;var $=(parseFloat(D[0])%360+360)%360/360,W=u(D[1]),K=u(D[2]),ae=K<=.5?K*(W+1):K+W-K*W,he=2*K-ae;return[n(255*p(he,ae,$+1/3)),n(255*p(he,ae,$)),n(255*p(he,ae,$-1/3)),U];default:return null}}return null}}catch{}});class pi{constructor(e,r,n,l=1){this.r=e,this.g=r,this.b=n,this.a=l}static parse(e){if(!e)return;if(e instanceof pi)return e;if(typeof e!="string")return;const r=pc.parseCSSColor(e);return r?new pi(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${l})`}toArray(){const{r:e,g:r,b:n,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*n/l,l]}}pi.black=new pi(0,0,0,1),pi.white=new pi(1,1,1,1),pi.transparent=new pi(0,0,0,0),pi.red=new pi(1,0,0,1),pi.blue=new pi(0,0,1,1);class cs{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fc{constructor(e,r,n,l,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=l,this.textColor=u}}class rr{constructor(e){this.sections=e}static fromString(e){return new rr([new fc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof rr?e:rr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class Vr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Vr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function vn(i,e,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,r,n]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qa(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof pi||i instanceof cs||i instanceof rr||i instanceof Vr)return!0;if(Array.isArray(i)){for(const e of i)if(!Qa(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Qa(i[e]))return!1;return!0}return!1}function Ki(i){if(i===null)return $n;if(typeof i=="string")return ii;if(typeof i=="boolean")return Ht;if(typeof i=="number")return Je;if(i instanceof pi)return Dn;if(i instanceof cs)return Oo;if(i instanceof rr)return as;if(i instanceof Vr)return Cr;if(Array.isArray(i)){const e=i.length;let r;for(const n of i){const l=Ki(n);if(r){if(r===l)continue;r=Kt;break}r=l}return Kr(r||Kt,e)}return Fo}function Gn(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof pi||i instanceof rr||i instanceof Vr?i.toString():JSON.stringify(i)}class Zn{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Qa(e[1]))return r.error("invalid value");const n=e[1];let l=Ki(n);const u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Zn(l,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof pi?["rgba"].concat(this.value.toArray()):this.value instanceof rr?this.value.serialize():this.value}}class xr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const mc={string:ii,number:Je,boolean:Ht,object:Fo};class An{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,l=1;const u=e[0];if(u==="array"){let f,x;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in mc)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);f=mc[b],l++}else f=Kt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}n=Kr(f,x)}else n=mc[u];const p=[];for(;l<e.length;l++){const f=r.parse(e[l],l,Kt);if(!f)return null;p.push(f)}return new An(n,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!Ks(this.type,Ki(n)))return n;if(r===this.args.length-1)throw new xr(`Expected value to be of type ${Ri(this.type)}, but found ${Ri(Ki(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(n=>n.serialize()))}}class us{constructor(e){this.type=as,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const l=[];let u=!1;for(let p=1;p<=e.length-1;++p){const f=e[p];if(u&&typeof f=="object"&&!Array.isArray(f)){u=!1;let x=null;if(f["font-scale"]&&(x=r.parse(f["font-scale"],1,Je),!x))return null;let b=null;if(f["text-font"]&&(b=r.parse(f["text-font"],1,Kr(ii)),!b))return null;let T=null;if(f["text-color"]&&(T=r.parse(f["text-color"],1,Dn),!T))return null;const I=l[l.length-1];I.scale=x,I.font=b,I.textColor=T}else{const x=r.parse(e[p],1,Kt);if(!x)return null;const b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new us(l)}evaluate(e){return new rr(this.sections.map(r=>{const n=r.content.evaluate(e);return Ki(n)===Cr?new fc("",n,null,null,null):new fc(Gn(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class hs{constructor(e){this.type=Cr,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,ii);return n?new hs(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=Vr.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const yp={"to-boolean":Ht,"to-color":Dn,"to-number":Je,"to-string":ii};class bn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=yp[n],u=[];for(let p=1;p<e.length;p++){const f=r.parse(e[p],p,Kt);if(!f)return null;u.push(f)}return new bn(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(const l of this.args){if(r=l.evaluate(e),n=null,r instanceof pi)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:vn(r[0],r[1],r[2],r[3]),!n))return new pi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new xr(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new xr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?rr.fromString(Gn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Vr.fromString(Gn(this.args[0].evaluate(e))):Gn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new us([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hs(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const xp=["Unknown","Point","LineString","Polygon"];class Ju{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:n,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*r-e[0])+this.featureDistanceData.bearing[1]*(l*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=pi.parse(e)),r}}class jr{constructor(e,r,n,l){this.name=e,this.type=r,this._evaluate=n,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],l=jr.definitions[n];if(!l)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,f=p.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let x=null;for(const[b,T]of f){x=new oo(r.registry,r.path,null,r.scope);const I=[];let M=!1;for(let D=1;D<e.length;D++){const U=e[D],$=Array.isArray(b)?b[D-1]:b.type,W=x.parse(U,1+I.length,$);if(!W){M=!0;break}I.push(W)}if(!M)if(Array.isArray(b)&&b.length!==I.length)x.error(`Expected ${b.length} arguments, but found ${I.length} instead.`);else{for(let D=0;D<I.length;D++){const U=Array.isArray(b)?b[D]:b.type,$=I[D];x.concat(D+1).checkSubtype(U,$.type)}if(x.errors.length===0)return new jr(n,u,T,I)}}if(f.length===1)r.errors.push(...x.errors);else{const b=(f.length?f:p).map(([I])=>{return M=I,Array.isArray(M)?`(${M.map(Ri).join(", ")})`:`(${Ri(M.type)}...)`;var M}).join(" | "),T=[];for(let I=1;I<e.length;I++){const M=r.parse(e[I],1+T.length);if(!M)return null;T.push(Ri(M.type))}r.error(`Expected arguments of type ${b}, but found (${T.join(", ")}) instead.`)}return null}static register(e,r){jr.definitions=r;for(const n in r)e[n]=jr}}class Ya{constructor(e,r,n){this.type=Oo,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const l=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Ht);if(!l)return null;const u=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Ht);if(!u)return null;let p=null;return n.locale&&(p=r.parse(n.locale,1,ii),!p)?null:new Ya(l,u,p)}evaluate(e){return new cs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const no=8192;function _c(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Ka(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function eh(i,e){const r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*no),Math.round(n*l*no)]}function Ja(i,e,r){const n=i[0]-e[0],l=i[1]-e[1],u=i[0]-r[0],p=i[1]-r[1];return n*p-u*l==0&&n*u<=0&&l*p<=0}function gc(i,e){let r=!1;for(let p=0,f=e.length;p<f;p++){const x=e[p];for(let b=0,T=x.length;b<T-1;b++){if(Ja(i,x[b],x[b+1]))return!1;(l=x[b])[1]>(n=i)[1]!=(u=x[b+1])[1]>n[1]&&n[0]<(u[0]-l[0])*(n[1]-l[1])/(u[1]-l[1])+l[0]&&(r=!r)}}var n,l,u;return r}function vp(i,e){for(let r=0;r<e.length;r++)if(gc(i,e[r]))return!0;return!1}function th(i,e,r,n){const l=n[0]-r[0],u=n[1]-r[1],p=(i[0]-r[0])*u-l*(i[1]-r[1]),f=(e[0]-r[0])*u-l*(e[1]-r[1]);return p>0&&f<0||p<0&&f>0}function Ap(i,e,r){for(const b of r)for(let T=0;T<b.length-1;++T)if((f=[(p=b[T+1])[0]-(u=b[T])[0],p[1]-u[1]])[0]*(x=[(l=e)[0]-(n=i)[0],l[1]-n[1]])[1]-f[1]*x[0]!=0&&th(n,l,u,p)&&th(u,p,n,l))return!0;var n,l,u,p,f,x;return!1}function ih(i,e){for(let r=0;r<i.length;++r)if(!gc(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Ap(i[r],i[r+1],e))return!1;return!0}function bp(i,e){for(let r=0;r<e.length;r++)if(ih(i,e[r]))return!0;return!1}function el(i,e,r){const n=[];for(let l=0;l<i.length;l++){const u=[];for(let p=0;p<i[l].length;p++){const f=eh(i[l][p],r);_c(e,f),u.push(f)}n.push(u)}return n}function Js(i,e,r){const n=[];for(let l=0;l<i.length;l++){const u=el(i[l],e,r);n.push(u)}return n}function rh(i,e,r,n){if(i[0]<r[0]||i[0]>r[2]){const l=.5*n;let u=i[0]-r[0]>l?-n:r[0]-i[0]>l?n:0;u===0&&(u=i[0]-r[2]>l?-n:r[2]-i[0]>l?n:0),i[0]+=u}_c(e,i)}function nh(i,e,r,n){const l=Math.pow(2,n.z)*no,u=[n.x*no,n.y*no],p=[];if(!i)return p;for(const f of i)for(const x of f){const b=[x.x+u[0],x.y+u[1]];rh(b,e,r,l),p.push(b)}return p}function oh(i,e,r,n){const l=Math.pow(2,n.z)*no,u=[n.x*no,n.y*no],p=[];if(!i)return p;for(const x of i){const b=[];for(const T of x){const I=[T.x+u[0],T.y+u[1]];_c(e,I),b.push(I)}p.push(b)}if(e[2]-e[0]<=l/2){(f=e)[0]=f[1]=1/0,f[2]=f[3]=-1/0;for(const x of p)for(const b of x)rh(b,e,r,l)}var f;return p}class Uo{constructor(e,r){this.type=Ht,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Qa(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let l=0;l<n.features.length;++l){const u=n.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Uo(n,n.features[l].geometry)}else if(n.type==="Feature"){const l=n.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Uo(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Uo(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(n.type==="Polygon"){const f=el(n.coordinates,u,p),x=nh(r.geometry(),l,u,p);if(!Ka(l,u))return!1;for(const b of x)if(!gc(b,f))return!1}if(n.type==="MultiPolygon"){const f=Js(n.coordinates,u,p),x=nh(r.geometry(),l,u,p);if(!Ka(l,u))return!1;for(const b of x)if(!vp(b,f))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(!p)return!1;if(n.type==="Polygon"){const f=el(n.coordinates,u,p),x=oh(r.geometry(),l,u,p);if(!Ka(l,u))return!1;for(const b of x)if(!ih(b,f))return!1}if(n.type==="MultiPolygon"){const f=Js(n.coordinates,u,p),x=oh(r.geometry(),l,u,p);if(!Ka(l,u))return!1;for(const b of x)if(!bp(b,f))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Dr(i){if(i instanceof jr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Uo)return!1;let e=!0;return i.eachChild(r=>{e&&!Dr(r)&&(e=!1)}),e}function ea(i){if(i instanceof jr&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!ea(r)&&(e=!1)}),e}function ta(i,e){if(i instanceof jr&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!ta(n,e)&&(r=!1)}),r}class Vo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Vo(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class oo{constructor(e,r=[],n,l=new Ro,u=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=l,this.errors=u,this.expectedType=n}parse(e,r,n,l,u={}){return r?this.concat(r,n,l)._parse(e,u):this._parse(e,u)}_parse(e,r){function n(l,u,p){return p==="assert"?new An(u,[l]):p==="coerce"?new bn(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const f=this.expectedType,x=p.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||x.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(f,x))return null}else p=n(p,f,r.typeAnnotation||"coerce");else p=n(p,f,r.typeAnnotation||"assert")}if(!(p instanceof Zn)&&p.type.kind!=="resolvedImage"&&tl(p)){const f=new Ju;try{p=new Zn(p.type,p.evaluate(f))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const l=typeof e=="number"?this.path.concat(e):this.path,u=n?this.scope.concat(n):this.scope;return new oo(this.registry,l,r||null,u,this.errors)}error(e,...r){const n=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new mi(n,e))}checkSubtype(e,r){const n=Ks(e,r);return n&&this.error(n),n}}function tl(i){if(i instanceof Vo)return tl(i.boundExpression);if(i instanceof jr&&i.name==="error"||i instanceof Ya||i instanceof Uo)return!1;const e=i instanceof bn||i instanceof An;let r=!0;return i.eachChild(n=>{r=e?r&&tl(n):r&&n instanceof Zn}),!!r&&Dr(i)&&ta(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ia(i,e){const r=i.length-1;let n,l,u=0,p=r,f=0;for(;u<=p;)if(f=Math.floor((u+p)/2),n=i[f],l=i[f+1],n<=e){if(f===r||e<l)return f;u=f+1}else{if(!(n>e))throw new xr("Input is not a number.");p=f-1}return 0}class ra{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,u]of n)this.labels.push(l),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,Je);if(!n)return null;const l=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<e.length;p+=2){const f=p===1?-1/0:e[p],x=e[p+1],b=p,T=p+1;if(typeof f!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=f)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const I=r.parse(x,T,u);if(!I)return null;u=u||I.type,l.push([f,I])}return new ra(u,n,l)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return n[0].evaluate(e);const u=r.length;return l>=r[u-1]?n[u-1].evaluate(e):n[ia(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function St(i,e,r){return i*(1-r)+e*r}var il=Object.freeze({__proto__:null,number:St,color:function(i,e,r){return new pi(St(i.r,e.r,r),St(i.g,e.g,r),St(i.b,e.b,r),St(i.a,e.a,r))},array:function(i,e,r){return i.map((n,l)=>St(n,e[l],r))}});const sh=.95047,ah=1.08883,yc=4/29,xc=6/29,vc=3*xc*xc,lh=Math.PI/180,ch=180/Math.PI;function rl(i){return i>.008856451679035631?Math.pow(i,1/3):i/vc+yc}function so(i){return i>xc?i*i*i:vc*(i-yc)}function ds(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ac(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function nl(i){const e=Ac(i.r),r=Ac(i.g),n=Ac(i.b),l=rl((.4124564*e+.3575761*r+.1804375*n)/sh),u=rl((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-rl((.0193339*e+.119192*r+.9503041*n)/ah)),alpha:i.a}}function bc(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*so(e),r=sh*so(r),n=ah*so(n),new pi(ds(3.2404542*r-1.5371385*e-.4985314*n),ds(-.969266*r+1.8760108*e+.041556*n),ds(.0556434*r-.2040259*e+1.0572252*n),i.alpha)}function wp(i,e,r){const n=e-i;return i+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const na={forward:nl,reverse:bc,interpolate:function(i,e,r){return{l:St(i.l,e.l,r),a:St(i.a,e.a,r),b:St(i.b,e.b,r),alpha:St(i.alpha,e.alpha,r)}}},oa={forward:function(i){const{l:e,a:r,b:n}=nl(i),l=Math.atan2(n,r)*ch;return{h:l<0?l+360:l,c:Math.sqrt(r*r+n*n),l:e,alpha:i.a}},reverse:function(i){const e=i.h*lh,r=i.c;return bc({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:wp(i.h,e.h,r),c:St(i.c,e.c,r),l:St(i.l,e.l,r),alpha:St(i.alpha,e.alpha,r)}}};var wc=Object.freeze({__proto__:null,lab:na,hcl:oa});class Nr{constructor(e,r,n,l,u){this.type=e,this.operator=r,this.interpolation=n,this.input=l,this.labels=[],this.outputs=[];for(const[p,f]of u)this.labels.push(p),this.outputs.push(f)}static interpolationFactor(e,r,n,l){let u=0;if(e.name==="exponential")u=ol(r,e.base,n,l);else if(e.name==="linear")u=ol(r,1,n,l);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new j(p[0],p[1],p[2],p[3]).solve(ol(r,1,n,l))}return u}static parse(e,r){let[n,l,u,...p]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(T=>typeof T!="number"||T<0||T>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,Je),!u)return null;const f=[];let x=null;n==="interpolate-hcl"||n==="interpolate-lab"?x=Dn:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let b=0;b<p.length;b+=2){const T=p[b],I=p[b+1],M=b+3,D=b+4;if(typeof T!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=T)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const U=r.parse(I,D,x);if(!U)return null;x=x||U.type,f.push([T,U])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Nr(x,n,l,u,f):r.error(`Type ${Ri(x)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return n[0].evaluate(e);const u=r.length;if(l>=r[u-1])return n[u-1].evaluate(e);const p=ia(r,l),f=Nr.interpolationFactor(this.interpolation,l,r[p],r[p+1]),x=n[p].evaluate(e),b=n[p+1].evaluate(e);return this.operator==="interpolate"?il[this.type.kind.toLowerCase()](x,b,f):this.operator==="interpolate-hcl"?oa.reverse(oa.interpolate(oa.forward(x),oa.forward(b),f)):na.reverse(na.interpolate(na.forward(x),na.forward(b),f))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function ol(i,e,r,n){const l=n-r,u=i-r;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}class sa{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const l=r.expectedType;l&&l.kind!=="value"&&(n=l);const u=[];for(const f of e.slice(1)){const x=r.parse(f,1+u.length,n,void 0,{typeAnnotation:"omit"});if(!x)return null;n=n||x.type,u.push(x)}const p=l&&u.some(f=>Ks(l,f.type));return new sa(p?Kt:n,u)}evaluate(e){let r,n=null,l=0;for(const u of this.args){if(l++,n=u.evaluate(e),n&&n instanceof Vr&&!n.available&&(r||(r=n),n=null,l===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class aa{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const f=r.parse(e[u+1],u+1);if(!f)return null;n.push([p,f])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return l?new aa(n,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class Ec{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Je),l=r.parse(e[2],2,Kr(r.expectedType||Kt));return n&&l?new Ec(l.type.itemType,n,l):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new xr(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new xr(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new xr(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class sl{constructor(e,r){this.type=Ht,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Kt),l=r.parse(e[2],2,Kt);return n&&l?Xa(n.type,[Ht,ii,Je,$n,Kt])?new sl(n,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!ls(r,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(Ki(r))} instead.`);if(!ls(n,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Ri(Ki(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class al{constructor(e,r,n){this.type=Je,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Kt),l=r.parse(e[2],2,Kt);if(!n||!l)return null;if(!Xa(n.type,[Ht,ii,Je,$n,Kt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(n.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Je);return u?new al(n,l,u):null}return new al(n,l)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!ls(r,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(Ki(r))} instead.`);if(!ls(n,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${Ri(Ki(n))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return n.indexOf(r,l)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ll{constructor(e,r,n,l,u,p){this.inputType=e,this.type=r,this.input=n,this.cases=l,this.outputs=u,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u={},p=[];for(let b=2;b<e.length-1;b+=2){let T=e[b];const I=e[b+1];Array.isArray(T)||(T=[T]);const M=r.concat(b);if(T.length===0)return M.error("Expected at least one branch label.");for(const U of T){if(typeof U!="number"&&typeof U!="string")return M.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return M.error("Numeric branch labels must be integer values.");if(n){if(M.checkSubtype(n,Ki(U)))return null}else n=Ki(U);if(u[String(U)]!==void 0)return M.error("Branch labels must be unique.");u[String(U)]=p.length}const D=r.parse(I,b,l);if(!D)return null;l=l||D.type,p.push(D)}const f=r.parse(e[1],1,Kt);if(!f)return null;const x=r.parse(e[e.length-1],e.length-1,l);return x?f.type.kind!=="value"&&r.concat(1).checkSubtype(n,f.type)?null:new ll(n,l,f,u,p,x):null}evaluate(e){const r=this.input.evaluate(e);return(Ki(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],l={};for(const p of r){const f=l[this.cases[p]];f===void 0?(l[this.cases[p]]=n.length,n.push([this.cases[p],[p]])):n[f][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,f]of n)e.push(f.length===1?u(f[0]):f.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class cl{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const l=[];for(let p=1;p<e.length-1;p+=2){const f=r.parse(e[p],p,Ht);if(!f)return null;const x=r.parse(e[p+1],p+1,n);if(!x)return null;l.push([f,x]),n=n||x.type}const u=r.parse(e[e.length-1],e.length-1,n);return u?new cl(n,l,u):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ul{constructor(e,r,n,l){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Kt),l=r.parse(e[2],2,Je);if(!n||!l)return null;if(!Xa(n.type,[Kr(Kt),ii,Kt]))return r.error(`Expected first argument to be of type array or string, but found ${Ri(n.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Je);return u?new ul(n.type,n,l,u):null}return new ul(n.type,n,l)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!ls(r,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${Ri(Ki(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(n,l)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function uh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function hh(i,e,r,n){return n.compare(e,r)===0}function ps(i,e,r){const n=i!=="=="&&i!=="!=";return class L0{constructor(u,p,f){this.type=Ht,this.lhs=u,this.rhs=p,this.collator=f,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const f=u[0];let x=p.parse(u[1],1,Kt);if(!x)return null;if(!uh(f,x.type))return p.concat(1).error(`"${f}" comparisons are not supported for type '${Ri(x.type)}'.`);let b=p.parse(u[2],2,Kt);if(!b)return null;if(!uh(f,b.type))return p.concat(2).error(`"${f}" comparisons are not supported for type '${Ri(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return p.error(`Cannot compare types '${Ri(x.type)}' and '${Ri(b.type)}'.`);n&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new An(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new An(x.type,[b])));let T=null;if(u.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(T=p.parse(u[3],3,Oo),!T)return null}return new L0(x,b,T)}evaluate(u){const p=this.lhs.evaluate(u),f=this.rhs.evaluate(u);if(n&&this.hasUntypedArgument){const x=Ki(p),b=Ki(f);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new xr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const x=Ki(p),b=Ki(f);if(x.kind!=="string"||b.kind!=="string")return e(u,p,f)}return this.collator?r(u,p,f,this.collator.evaluate(u)):e(u,p,f)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[i];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const Ep=ps("==",function(i,e,r){return e===r},hh),Tp=ps("!=",function(i,e,r){return e!==r},function(i,e,r,n){return!hh(0,e,r,n)}),dh=ps("<",function(i,e,r){return e<r},function(i,e,r,n){return n.compare(e,r)<0}),Sp=ps(">",function(i,e,r){return e>r},function(i,e,r,n){return n.compare(e,r)>0}),Ip=ps("<=",function(i,e,r){return e<=r},function(i,e,r,n){return n.compare(e,r)<=0}),Cp=ps(">=",function(i,e,r){return e>=r},function(i,e,r,n){return n.compare(e,r)>=0});class Tc{constructor(e,r,n,l,u){this.type=ii,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Je);if(!n)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,ii),!u))return null;let p=null;if(l.currency&&(p=r.parse(l.currency,1,ii),!p))return null;let f=null;if(l["min-fraction-digits"]&&(f=r.parse(l["min-fraction-digits"],1,Je),!f))return null;let x=null;return l["max-fraction-digits"]&&(x=r.parse(l["max-fraction-digits"],1,Je),!x)?null:new Tc(n,u,p,f,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hl{constructor(e){this.type=Je,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Ri(n.type)} instead.`):new hl(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new xr(`Expected value to be of type string or array, but found ${Ri(Ki(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const jo={"==":Ep,"!=":Tp,">":Sp,"<":dh,">=":Cp,"<=":Ip,array:An,at:Ec,boolean:An,case:cl,coalesce:sa,collator:Ya,format:us,image:hs,in:sl,"index-of":al,interpolate:Nr,"interpolate-hcl":Nr,"interpolate-lab":Nr,length:hl,let:aa,literal:Zn,match:ll,number:An,"number-format":Tc,object:An,slice:ul,step:ra,string:An,"to-boolean":bn,"to-color":bn,"to-number":bn,"to-string":bn,var:Vo,within:Uo};function Sc(i,[e,r,n,l]){e=e.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);const u=l?l.evaluate(i):1,p=vn(e,r,n,u);if(p)throw new xr(p);return new pi(e/255*u,r/255*u,n/255*u,u)}function ph(i,e){return i in e}function Ic(i,e){const r=e[i];return r===void 0?null:r}function ao(i){return{type:i}}function Cc(i){return{result:"success",value:i}}function No(i){return{result:"error",value:i}}function fs(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function fh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Mc(i){return!!i.expression&&i.expression.interpolated}function Ai(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function $o(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function mh(i){return i}function kc(i,e){const r=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),u=i.type||(Mc(e)?"exponential":"interval");if(r&&((i=fi({},i)).stops&&(i.stops=i.stops.map(b=>[b[0],pi.parse(b[1])])),i.default=pi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!wc[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,f,x;if(u==="exponential")p=zc;else if(u==="interval")p=kp;else if(u==="categorical"){p=Mp,f=Object.create(null);for(const b of i.stops)f[b[0]]=b[1];x=typeof i.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=_h}if(n){const b={},T=[];for(let D=0;D<i.stops.length;D++){const U=i.stops[D],$=U[0].zoom;b[$]===void 0&&(b[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},T.push($)),b[$].stops.push([U[0].value,U[1]])}const I=[];for(const D of T)I.push([b[D].zoom,kc(b[D],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Nr.interpolationFactor.bind(void 0,M),zoomStops:I.map(D=>D[0]),evaluate:({zoom:D},U)=>zc({stops:I,base:i.base},e,D).evaluate(D,U)}}if(l){const b=u==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Nr.interpolationFactor.bind(void 0,b),zoomStops:i.stops.map(T=>T[0]),evaluate:({zoom:T})=>p(i,e,T,f,x)}}return{kind:"source",evaluate(b,T){const I=T&&T.properties?T.properties[i.property]:void 0;return I===void 0?la(i.default,e.default):p(i,e,I,f,x)}}}function la(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Mp(i,e,r,n,l){return la(typeof r===l?n[r]:void 0,i.default,e.default)}function kp(i,e,r){if(Ai(r)!=="number")return la(i.default,e.default);const n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];const l=ia(i.stops.map(u=>u[0]),r);return i.stops[l][1]}function zc(i,e,r){const n=i.base!==void 0?i.base:1;if(Ai(r)!=="number")return la(i.default,e.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const u=ia(i.stops.map(T=>T[0]),r),p=function(T,I,M,D){const U=D-M,$=T-M;return U===0?0:I===1?$/U:(Math.pow(I,$)-1)/(Math.pow(I,U)-1)}(r,n,i.stops[u][0],i.stops[u+1][0]),f=i.stops[u][1],x=i.stops[u+1][1];let b=il[e.type]||mh;if(i.colorSpace&&i.colorSpace!=="rgb"){const T=wc[i.colorSpace];b=(I,M)=>T.reverse(T.interpolate(T.forward(I),T.forward(M),p))}return typeof f.evaluate=="function"?{evaluate(...T){const I=f.evaluate.apply(void 0,T),M=x.evaluate.apply(void 0,T);if(I!==void 0&&M!==void 0)return b(I,M,p)}}:b(f,x,p)}function _h(i,e,r){return e.type==="color"?r=pi.parse(r):e.type==="formatted"?r=rr.fromString(r.toString()):e.type==="resolvedImage"?r=Vr.fromString(r.toString()):Ai(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),la(r,i.default,e.default)}jr.register(jo,{error:[{kind:"error"},[ii],(i,[e])=>{throw new xr(e.evaluate(i))}],typeof:[ii,[Kt],(i,[e])=>Ri(Ki(e.evaluate(i)))],"to-rgba":[Kr(Je,4),[Dn],(i,[e])=>e.evaluate(i).toArray()],rgb:[Dn,[Je,Je,Je],Sc],rgba:[Dn,[Je,Je,Je,Je],Sc],has:{type:Ht,overloads:[[[ii],(i,[e])=>ph(e.evaluate(i),i.properties())],[[ii,Fo],(i,[e,r])=>ph(e.evaluate(i),r.evaluate(i))]]},get:{type:Kt,overloads:[[[ii],(i,[e])=>Ic(e.evaluate(i),i.properties())],[[ii,Fo],(i,[e,r])=>Ic(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Kt,[ii],(i,[e])=>Ic(e.evaluate(i),i.featureState||{})],properties:[Fo,[],i=>i.properties()],"geometry-type":[ii,[],i=>i.geometryType()],id:[Kt,[],i=>i.id()],zoom:[Je,[],i=>i.globals.zoom],pitch:[Je,[],i=>i.globals.pitch||0],"distance-from-center":[Je,[],i=>i.distanceFromCenter()],"heatmap-density":[Je,[],i=>i.globals.heatmapDensity||0],"line-progress":[Je,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Je,[],i=>i.globals.skyRadialProgress||0],accumulated:[Kt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Je,ao(Je),(i,e)=>{let r=0;for(const n of e)r+=n.evaluate(i);return r}],"*":[Je,ao(Je),(i,e)=>{let r=1;for(const n of e)r*=n.evaluate(i);return r}],"-":{type:Je,overloads:[[[Je,Je],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Je],(i,[e])=>-e.evaluate(i)]]},"/":[Je,[Je,Je],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Je,[Je,Je],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Je,[Je],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))],log2:[Je,[Je],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Je,[Je],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Je,[Je],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Je,[Je],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Je,[Je],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Je,[Je],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Je,[Je],(i,[e])=>Math.atan(e.evaluate(i))],min:[Je,ao(Je),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Je,ao(Je),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Je,[Je],(i,[e])=>Math.abs(e.evaluate(i))],round:[Je,[Je],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Je,[Je],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Je,[Je],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Ht,[ii,Kt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[Ht,[Kt],(i,[e])=>i.id()===e.value],"filter-type-==":[Ht,[ii],(i,[e])=>i.geometryType()===e.value],"filter-<":[Ht,[ii,Kt],(i,[e,r])=>{const n=i.properties()[e.value],l=r.value;return typeof n==typeof l&&n<l}],"filter-id-<":[Ht,[Kt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[Ht,[ii,Kt],(i,[e,r])=>{const n=i.properties()[e.value],l=r.value;return typeof n==typeof l&&n>l}],"filter-id->":[Ht,[Kt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[Ht,[ii,Kt],(i,[e,r])=>{const n=i.properties()[e.value],l=r.value;return typeof n==typeof l&&n<=l}],"filter-id-<=":[Ht,[Kt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[Ht,[ii,Kt],(i,[e,r])=>{const n=i.properties()[e.value],l=r.value;return typeof n==typeof l&&n>=l}],"filter-id->=":[Ht,[Kt],(i,[e])=>{const r=i.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[Ht,[Kt],(i,[e])=>e.value in i.properties()],"filter-has-id":[Ht,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ht,[Kr(ii)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ht,[Kr(Kt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Ht,[ii,Kr(Kt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Ht,[ii,Kr(Kt)],(i,[e,r])=>function(n,l,u,p){for(;u<=p;){const f=u+p>>1;if(l[f]===n)return!0;l[f]>n?p=f-1:u=f+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ht,overloads:[[[Ht,Ht],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[ao(Ht),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ht,overloads:[[[Ht,Ht],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[ao(Ht),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[Ht,[Ht],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Ht,[ii],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[ii,[ii],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[ii,[ii],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[ii,ao(Kt),(i,e)=>e.map(r=>Gn(r.evaluate(i))).join("")],"resolved-locale":[ii,[Oo],(i,[e])=>e.evaluate(i).resolvedLocale()]});class dl{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Ju,this._defaultValue=r?function(n){return n.type==="color"&&$o(n.default)?new pi(0,0,0,0):n.type==="color"?pi.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,l,u,p,f,x){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,l,u,p,f,x){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=f||null,this._evaluator.featureDistanceData=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console!="undefined"&&console.warn(b.message)),this._defaultValue}}}function ms(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in jo}function ca(i,e){const r=new oo(jo,[],e?function(l){const u={color:Dn,string:ii,number:Je,enum:ii,boolean:Ht,formatted:as,resolvedImage:Cr};return l.type==="array"?Kr(u[l.value]||Kt,l.length):u[l.type]}(e):void 0),n=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Cc(new dl(n,e)):No(r.errors)}class Pc{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ea(r.expression)}evaluateWithoutErrorHandling(e,r,n,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,l,u,p)}evaluate(e,r,n,l,u,p){return this._styleExpression.evaluate(e,r,n,l,u,p)}}class Dc{constructor(e,r,n,l){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ea(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,n,l,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,l,u,p)}evaluate(e,r,n,l,u,p){return this._styleExpression.evaluate(e,r,n,l,u,p)}interpolationFactor(e,r,n){return this.interpolationType?Nr.interpolationFactor(this.interpolationType,e,r,n):0}}function gh(i,e){if((i=ca(i,e)).result==="error")return i;const r=i.value.expression,n=Dr(r);if(!n&&!fs(e))return No([new mi("","data expressions not supported")]);const l=ta(r,["zoom","pitch","distance-from-center"]);if(!l&&!fh(e))return No([new mi("","zoom expressions not supported")]);const u=fl(r);return u||l?u instanceof mi?No([u]):u instanceof Nr&&!Mc(e)?No([new mi("",'"interpolate" expressions cannot be used with this property')]):Cc(u?new Dc(n?"camera":"composite",i.value,u.labels,u instanceof Nr?u.interpolation:void 0):new Pc(n?"constant":"source",i.value)):No([new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pl{constructor(e,r){this._parameters=e,this._specification=r,fi(this,kc(this._parameters,this._specification))}static deserialize(e){return new pl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function fl(i){let e=null;if(i instanceof aa)e=fl(i.result);else if(i instanceof sa){for(const r of i.args)if(e=fl(r),e)break}else(i instanceof ra||i instanceof Nr)&&i.input instanceof jr&&i.input.name==="zoom"&&(e=i);return e instanceof mi||i.eachChild(r=>{const n=fl(r);n instanceof mi?e=n:!e&&n?e=new mi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new mi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class rt{constructor(e,r,n,l){this.message=(e?`${e}: `:"")+n,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Jr(i){const e=i.key,r=i.value,n=i.valueSpec||{},l=i.objectElementValidators||{},u=i.style,p=i.styleSpec;let f=[];const x=Ai(r);if(x!=="object")return[new rt(e,r,`object expected, ${x} found`)];for(const b in r){const T=b.split(".")[0],I=n[T]||n["*"];let M;l[T]?M=l[T]:n[T]?M=lr:l["*"]?M=l["*"]:n["*"]&&(M=lr),M?f=f.concat(M({key:(e&&`${e}.`)+b,value:r[b],valueSpec:I,style:u,styleSpec:p,object:r,objectKey:b},r)):f.push(new rt(e,r[b],`unknown property "${b}"`))}for(const b in n)l[b]||n[b].required&&n[b].default===void 0&&r[b]===void 0&&f.push(new rt(e,r,`missing required property "${b}"`));return f}function ua(i){const e=i.value,r=i.valueSpec,n=i.style,l=i.styleSpec,u=i.key,p=i.arrayElementValidator||lr;if(Ai(e)!=="array")return[new rt(u,e,`array expected, ${Ai(e)} found`)];if(r.length&&e.length!==r.length)return[new rt(u,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new rt(u,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let f={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};l.$version<7&&(f.function=r.function),Ai(r.value)==="object"&&(f=r.value);let x=[];for(let b=0;b<e.length;b++)x=x.concat(p({array:e,arrayIndex:b,value:e[b],valueSpec:f,style:n,styleSpec:l,key:`${u}[${b}]`}));return x}function yh(i){const e=i.key,r=i.value,n=i.valueSpec;let l=Ai(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new rt(e,r,`number expected, ${l} found`)];if("minimum"in n){let u=n.minimum;if(Ai(n.minimum)==="array"&&(u=n.minimum[i.arrayIndex]),r<u)return[new rt(e,r,`${r} is less than the minimum value ${u}`)]}if("maximum"in n){let u=n.maximum;if(Ai(n.maximum)==="array"&&(u=n.maximum[i.arrayIndex]),r>u)return[new rt(e,r,`${r} is greater than the maximum value ${u}`)]}return[]}function xh(i){const e=i.valueSpec,r=pt(i.value.type);let n,l,u,p={};const f=r!=="categorical"&&i.value.property===void 0,x=!f,b=Ai(i.value.stops)==="array"&&Ai(i.value.stops[0])==="array"&&Ai(i.value.stops[0][0])==="object",T=Jr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(D){if(r==="identity")return[new rt(D.key,D.value,'identity function may not have a "stops" property')];let U=[];const $=D.value;return U=U.concat(ua({key:D.key,value:$,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:I})),Ai($)==="array"&&$.length===0&&U.push(new rt(D.key,$,"array must have at least one stop")),U},default:function(D){return lr({key:D.key,value:D.value,valueSpec:e,style:D.style,styleSpec:D.styleSpec})}}});return r==="identity"&&f&&T.push(new rt(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||T.push(new rt(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Mc(i.valueSpec)&&T.push(new rt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!fs(i.valueSpec)?T.push(new rt(i.key,i.value,"property functions not supported")):f&&!fh(i.valueSpec)&&T.push(new rt(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!b||i.value.property!==void 0||T.push(new rt(i.key,i.value,'"property" property is required')),T;function I(D){let U=[];const $=D.value,W=D.key;if(Ai($)!=="array")return[new rt(W,$,`array expected, ${Ai($)} found`)];if($.length!==2)return[new rt(W,$,`array length 2 expected, length ${$.length} found`)];if(b){if(Ai($[0])!=="object")return[new rt(W,$,`object expected, ${Ai($[0])} found`)];if($[0].zoom===void 0)return[new rt(W,$,"object stop key must have zoom")];if($[0].value===void 0)return[new rt(W,$,"object stop key must have value")];const K=pt($[0].zoom);if(typeof K!="number")return[new rt(W,$[0].zoom,"stop zoom values must be numbers")];if(u&&u>K)return[new rt(W,$[0].zoom,"stop zoom values must appear in ascending order")];K!==u&&(u=K,l=void 0,p={}),U=U.concat(Jr({key:`${W}[0]`,value:$[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:yh,value:M}}))}else U=U.concat(M({key:`${W}[0]`,value:$[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},$));return ms(di($[1]))?U.concat([new rt(`${W}[1]`,$[1],"expressions are not allowed in function stops.")]):U.concat(lr({key:`${W}[1]`,value:$[1],valueSpec:e,style:D.style,styleSpec:D.styleSpec}))}function M(D,U){const $=Ai(D.value),W=pt(D.value),K=D.value!==null?D.value:U;if(n){if($!==n)return[new rt(D.key,K,`${$} stop domain type must match previous stop domain type ${n}`)]}else n=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new rt(D.key,K,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let ae=`number expected, ${$} found`;return fs(e)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(D.key,K,ae)]}return r!=="categorical"||$!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?r!=="categorical"&&$==="number"&&typeof W=="number"&&typeof l=="number"&&l!==void 0&&W<l?[new rt(D.key,K,"stop domain values must appear in ascending order")]:(l=W,r==="categorical"&&W in p?[new rt(D.key,K,"stop domain values must be unique")]:(p[W]=!0,[])):[new rt(D.key,K,`integer expected, found ${String(W)}`)]}}function _s(i){const e=(i.expressionContext==="property"?gh:ca)(di(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new rt(`${i.key}${n.key}`,i.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new rt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ea(r))return[new rt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return qn(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ta(r,["zoom","feature-state"]))return[new rt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Dr(r))return[new rt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qn(i,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const n=[];return i instanceof jr&&r.has(i.name)?[new rt(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(l=>{n.push(...qn(l,e))}),n)}function ha(i){const e=i.key,r=i.value,n=i.valueSpec,l=[];return Array.isArray(n.values)?n.values.indexOf(pt(r))===-1&&l.push(new rt(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(pt(r))===-1&&l.push(new rt(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function lo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!lo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function co(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};lo(i)||(i=da(i));const r=i;let n=!0;try{n=function(b){if(!uo(b))return b;let T=di(b);return vh(T),T=Bc(T),T}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=we[`filter_${e}`],u=ca(n,l);let p=null;if(u.result==="error")throw new Error(u.value.map(b=>`${b.key}: ${b.message}`).join(", "));p=(b,T,I)=>u.value.evaluate(b,T,{},I);let f=null,x=null;if(n!==r){const b=ca(r,l);if(b.result==="error")throw new Error(b.value.map(T=>`${T.key}: ${T.message}`).join(", "));f=(T,I,M,D,U)=>b.value.evaluate(T,I,{},M,void 0,void 0,D,U),x=!Dr(b.value.expression)}return p=p,{filter:p,dynamicFilter:f||void 0,needGeometry:ml(n),needFeature:!!x}}function Bc(i){if(!Array.isArray(i))return i;const e=function(r){if(Ah.has(r[0])){for(let n=1;n<r.length;n++)if(uo(r[n]))return!0}return r}(i);return e===!0?e:e.map(r=>Bc(r))}function vh(i){let e=!1;const r=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||uo(i[n]),r.push(i[n+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||uo(i[1]);for(let n=2;n<i.length-1;n+=2)r.push(i[n+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||uo(i[1]);for(let n=1;n<i.length-1;n+=2)r.push(i[n+1])}e&&(i.length=0,i.push("any",...r));for(let n=1;n<i.length;n++)vh(i[n])}function uo(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(uo(i[r]))return!0;return!1}const Ah=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lc(i,e){return i<e?-1:i>e?1:0}function ml(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(ml(i[e]))return!0;return!1}function da(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?pa(i[1],i[2],"=="):e==="!="?fa(pa(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?pa(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(da))):e==="all"?["all"].concat(i.slice(1).map(da)):e==="none"?["all"].concat(i.slice(1).map(da).map(fa)):e==="in"?Rc(i[1],i.slice(2)):e==="!in"?fa(Rc(i[1],i.slice(2))):e==="has"?Fc(i[1]):e==="!has"?fa(Fc(i[1])):e!=="within"||i;var r}function pa(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Rc(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Lc)]]:["filter-in-small",i,["literal",e]]}}function Fc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function fa(i){return["!",i]}function ho(i){return lo(di(i.value))?_s(fi({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Oc(i)}function Oc(i){const e=i.value,r=i.key;if(Ai(e)!=="array")return[new rt(r,e,`array expected, ${Ai(e)} found`)];const n=i.styleSpec;let l,u=[];if(e.length<1)return[new rt(r,e,"filter array must have at least 1 element")];switch(u=u.concat(ha({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),pt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&pt(e[1])==="$type"&&u.push(new rt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new rt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Ai(e[1]),l!=="string"&&u.push(new rt(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let p=2;p<e.length;p++)l=Ai(e[p]),pt(e[1])==="$type"?u=u.concat(ha({key:`${r}[${p}]`,value:e[p],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new rt(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(Oc({key:`${r}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Ai(e[1]),e.length!==2?u.push(new rt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new rt(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Ai(e[1]),e.length!==2?u.push(new rt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new rt(`${r}[1]`,e[1],`object expected, ${l} found`))}return u}function Uc(i,e){const r=i.key,n=i.style,l=i.styleSpec,u=i.value,p=i.objectKey,f=l[`${e}_${i.layerType}`];if(!f)return[];const x=p.match(/^(.*)-transition$/);if(e==="paint"&&x&&f[x[1]]&&f[x[1]].transition)return lr({key:r,value:u,valueSpec:l.transition,style:n,styleSpec:l});const b=i.valueSpec||f[p];if(!b)return[new rt(r,u,`unknown property "${p}"`)];let T;if(Ai(u)==="string"&&fs(b)&&!b.tokens&&(T=/^{([^}]+)}$/.exec(u)))return[new rt(r,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(T[1])} }\`.`)];const I=[];return i.layerType==="symbol"&&(p==="text-field"&&n&&!n.glyphs&&I.push(new rt(r,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&$o(di(u))&&pt(u.type)==="identity"&&I.push(new rt(r,u,'"text-font" does not support identity functions'))),I.concat(lr({key:i.key,value:u,valueSpec:b,style:n,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:p}))}function _l(i){return Uc(i,"paint")}function Vc(i){return Uc(i,"layout")}function bh(i){let e=[];const r=i.value,n=i.key,l=i.style,u=i.styleSpec;r.type||r.ref||e.push(new rt(n,r,'either "type" or "ref" is required'));let p=pt(r.type);const f=pt(r.ref);if(r.id){const x=pt(r.id);for(let b=0;b<i.arrayIndex;b++){const T=l.layers[b];pt(T.id)===x&&e.push(new rt(n,r.id,`duplicate layer id "${r.id}", previously used at line ${T.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&e.push(new rt(n,r[b],`"${b}" is prohibited for ref layers`))}),l.layers.forEach(b=>{pt(b.id)===f&&(x=b)}),x?x.ref?e.push(new rt(n,r.ref,"ref cannot reference another ref layer")):p=pt(x.type):typeof f=="string"&&e.push(new rt(n,r.ref,`ref layer "${f}" not found`))}else if(p!=="background"&&p!=="sky")if(r.source){const x=l.sources&&l.sources[r.source],b=x&&pt(x.type);x?b==="vector"&&p==="raster"?e.push(new rt(n,r.source,`layer "${r.id}" requires a raster source`)):b==="raster"&&p!=="raster"?e.push(new rt(n,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&p!=="hillshade"?e.push(new rt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||b==="geojson"&&x.lineMetrics||e.push(new rt(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new rt(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new rt(n,r.source,`source "${r.source}" not found`))}else e.push(new rt(n,r,'missing required property "source"'));return e=e.concat(Jr({key:n,value:r,valueSpec:u.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>lr({key:`${n}.type`,value:r.type,valueSpec:u.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:x=>ho(fi({layerType:p},x)),layout:x=>Jr({layer:r,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>Vc(fi({layerType:p},b))}}),paint:x=>Jr({layer:r,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>_l(fi({layerType:p},b))}})}})),e}function Wn(i){const e=i.value,r=i.key,n=Ai(e);return n!=="string"?[new rt(r,e,`string expected, ${n} found`)]:[]}const wh={promoteId:function({key:i,value:e}){if(Ai(e)==="string")return Wn({key:i,value:e});{const r=[];for(const n in e)r.push(...Wn({key:`${i}.${n}`,value:e[n]}));return r}}};function Eh(i){const e=i.value,r=i.key,n=i.styleSpec,l=i.style;if(!e.type)return[new rt(r,e,'"type" is required')];const u=pt(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=Jr({key:r,value:e,valueSpec:n[`source_${u.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:wh}),p;case"geojson":if(p=Jr({key:r,value:e,valueSpec:n.source_geojson,style:l,styleSpec:n,objectElementValidators:wh}),e.cluster)for(const f in e.clusterProperties){const[x,b]=e.clusterProperties[f],T=typeof x=="string"?[x,["accumulated"],["get",f]]:x;p.push(..._s({key:`${r}.${f}.map`,value:b,expressionContext:"cluster-map"})),p.push(..._s({key:`${r}.${f}.reduce`,value:T,expressionContext:"cluster-reduce"}))}return p;case"video":return Jr({key:r,value:e,valueSpec:n.source_video,style:l,styleSpec:n});case"image":return Jr({key:r,value:e,valueSpec:n.source_image,style:l,styleSpec:n});case"canvas":return[new rt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ha({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:n})}}function Th(i){const e=i.value,r=i.styleSpec,n=r.light,l=i.style;let u=[];const p=Ai(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new rt("light",e,`object expected, ${p} found`)]),u;for(const f in e){const x=f.match(/^(.*)-transition$/);u=u.concat(x&&n[x[1]]&&n[x[1]].transition?lr({key:f,value:e[f],valueSpec:r.transition,style:l,styleSpec:r}):n[f]?lr({key:f,value:e[f],valueSpec:n[f],style:l,styleSpec:r}):[new rt(f,e[f],`unknown property "${f}"`)])}return u}function Sh(i){const e=i.value,r=i.key,n=i.style,l=i.styleSpec,u=l.terrain;let p=[];const f=Ai(e);if(e===void 0)return p;if(f!=="object")return p=p.concat([new rt("terrain",e,`object expected, ${f} found`)]),p;for(const x in e){const b=x.match(/^(.*)-transition$/);p=p.concat(b&&u[b[1]]&&u[b[1]].transition?lr({key:x,value:e[x],valueSpec:l.transition,style:n,styleSpec:l}):u[x]?lr({key:x,value:e[x],valueSpec:u[x],style:n,styleSpec:l}):[new rt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=n.sources&&n.sources[e.source],b=x&&pt(x.type);x?b!=="raster-dem"&&p.push(new rt(r,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):p.push(new rt(r,e.source,`source "${e.source}" not found`))}else p.push(new rt(r,e,'terrain is missing required property "source"'));return p}function Ih(i){const e=i.value,r=i.style,n=i.styleSpec,l=n.fog;let u=[];const p=Ai(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new rt("fog",e,`object expected, ${p} found`)]),u;for(const f in e){const x=f.match(/^(.*)-transition$/);u=u.concat(x&&l[x[1]]&&l[x[1]].transition?lr({key:f,value:e[f],valueSpec:n.transition,style:r,styleSpec:n}):l[f]?lr({key:f,value:e[f],valueSpec:l[f],style:r,styleSpec:n}):[new rt(f,e[f],`unknown property "${f}"`)])}return u}const ma={"*":()=>[],array:ua,boolean:function(i){const e=i.value,r=i.key,n=Ai(e);return n!=="boolean"?[new rt(r,e,`boolean expected, ${n} found`)]:[]},number:yh,color:function(i){const e=i.key,r=i.value,n=Ai(r);return n!=="string"?[new rt(e,r,`color expected, ${n} found`)]:pc.parseCSSColor(r)===null?[new rt(e,r,`color expected, "${r}" found`)]:[]},enum:ha,filter:ho,function:xh,layer:bh,object:Jr,source:Eh,light:Th,terrain:Sh,fog:Ih,string:Wn,formatted:function(i){return Wn(i).length===0?[]:_s(i)},resolvedImage:function(i){return Wn(i).length===0?[]:_s(i)},projection:function(i){const e=i.value,r=i.styleSpec,n=r.projection,l=i.style;let u=[];const p=Ai(e);if(p==="object")for(const f in e)u=u.concat(lr({key:f,value:e[f],valueSpec:n[f],style:l,styleSpec:r}));else p!=="string"&&(u=u.concat([new rt("projection",e,`object or string expected, ${p} found`)]));return u}};function lr(i){const e=i.value,r=i.valueSpec,n=i.styleSpec;return r.expression&&$o(pt(e))?xh(i):r.expression&&ms(di(e))?_s(i):r.type&&ma[r.type]?ma[r.type](i):Jr(fi({},i,{valueSpec:r.type?n[r.type]:r}))}function $r(i){const e=i.value,r=i.key,n=Wn(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new rt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new rt(r,e,'"glyphs" url must include a "{range}" token'))),n}function _a(i,e=we){return Xn(lr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:$r,"*":()=>[]}}))}const zp=i=>Xn(_l(i)),Pp=i=>Xn(Vc(i));function Xn(i){return i.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Ch(i,e){let r=!1;if(e&&e.length)for(const n of e)i.fire(new wt(new Error(n.message))),r=!0;return r}var po=Bn;function Bn(i,e,r){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var l=new Int32Array(this.arrayBuffer);i=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var u=0;u<this.d*this.d;u++){var p=l[3+u],f=l[3+u+1];n.push(p===f?null:l.subarray(p,f))}var x=l[3+n.length+1];this.keys=l.subarray(l[3+n.length],x),this.bboxes=l.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var b=0;b<this.d*this.d;b++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var T=r/e*i;this.min=-T,this.max=i+T}Bn.prototype.insert=function(i,e,r,n,l){this._forEachCell(e,r,n,l,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(l)},Bn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Bn.prototype._insertCell=function(i,e,r,n,l,u){this.cells[l].push(u)},Bn.prototype.query=function(i,e,r,n,l){var u=this.min,p=this.max;if(i<=u&&e<=u&&p<=r&&p<=n&&!l)return Array.prototype.slice.call(this.keys);var f=[];return this._forEachCell(i,e,r,n,this._queryCell,f,{},l),f},Bn.prototype._queryCell=function(i,e,r,n,l,u,p,f){var x=this.cells[l];if(x!==null)for(var b=this.keys,T=this.bboxes,I=0;I<x.length;I++){var M=x[I];if(p[M]===void 0){var D=4*M;(f?f(T[D+0],T[D+1],T[D+2],T[D+3]):i<=T[D+2]&&e<=T[D+3]&&r>=T[D+0]&&n>=T[D+1])?(p[M]=!0,u.push(b[M])):p[M]=!1}}},Bn.prototype._forEachCell=function(i,e,r,n,l,u,p,f){for(var x=this._convertToCellCoord(i),b=this._convertToCellCoord(e),T=this._convertToCellCoord(r),I=this._convertToCellCoord(n),M=x;M<=T;M++)for(var D=b;D<=I;D++){var U=this.d*D+M;if((!f||f(this._convertFromCellCoord(M),this._convertFromCellCoord(D),this._convertFromCellCoord(M+1),this._convertFromCellCoord(D+1)))&&l.call(this,i,e,r,n,U,u,p,f))return}},Bn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Bn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Bn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,p=0;p<i.length;p++){var f=i[p];l[3+p]=u,l.set(f,u),u+=f.length}return l[3+i.length]=u,l.set(this.keys,u),l[3+i.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const gs={};function st(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),gs[e]={klass:i,omit:r.omit||[]}}st(Object,"Object"),po.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},po.deserialize=function(i){return new po(i.buffer)},Object.defineProperty(po,"name",{value:"Grid"}),st(po,"Grid"),st(pi,"Color"),st(Error,"Error"),st(R,"AJAXError"),st(Vr,"ResolvedImage"),st(pl,"StylePropertyFunction"),st(dl,"StyleExpression",{omit:["_evaluator"]}),st(Dc,"ZoomDependentExpression"),st(Pc,"ZoomConstantExpression"),st(jr,"CompoundExpression",{omit:["_evaluate"]});for(const i in jo)gs[jo[i]._classRegistryKey]||st(jo[i],`Expression${i}`);function Mh(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function gl(i){return Q.ImageBitmap&&i instanceof Q.ImageBitmap}function ga(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Mh(i)||gl(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof Q.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const n of i)r.push(ga(n,e));return r}if(typeof i=="object"){const r=i.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const l=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const u in i)i.hasOwnProperty(u)&&(gs[n].omit.indexOf(u)>=0||(l[u]=ga(i[u],e)));i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(l.$name=n),l}throw new Error("can't serialize object of type "+typeof i)}function ys(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Mh(i)||gl(i)||ArrayBuffer.isView(i)||i instanceof Q.ImageData)return i;if(Array.isArray(i))return i.map(ys);if(typeof i=="object"){const e=i.$name||"Object",{klass:r}=gs[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const n=Object.create(r.prototype);for(const l of Object.keys(i))l!=="$name"&&(n[l]=ys(i[l]));return n}throw new Error("can't deserialize object of type "+typeof i)}class jc{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const kh=i=>i>=1536&&i<=1791,yl=i=>i>=1872&&i<=1919,ya=i=>i>=2208&&i<=2303,Nc=i=>i>=11904&&i<=12031,zh=i=>i>=12032&&i<=12255,$c=i=>i>=12272&&i<=12287,xl=i=>i>=12288&&i<=12351,xa=i=>i>=12352&&i<=12447,vl=i=>i>=12448&&i<=12543,Ph=i=>i>=12544&&i<=12591,Dh=i=>i>=12704&&i<=12735,Bh=i=>i>=12736&&i<=12783,Gc=i=>i>=12784&&i<=12799,Lh=i=>i>=12800&&i<=13055,Rh=i=>i>=13056&&i<=13311,Fh=i=>i>=13312&&i<=19903,Zc=i=>i>=19968&&i<=40959,Oh=i=>i>=40960&&i<=42127,Uh=i=>i>=42128&&i<=42191,Vh=i=>i>=44032&&i<=55215,va=i=>i>=63744&&i<=64255,qc=i=>i>=64336&&i<=65023,jh=i=>i>=65040&&i<=65055,xs=i=>i>=65072&&i<=65103,Nh=i=>i>=65104&&i<=65135,Al=i=>i>=65136&&i<=65279,Wc=i=>i>=65280&&i<=65519;function bl(i){for(const e of i)if(wl(e.charCodeAt(0)))return!0;return!1}function $h(i){for(const e of i)if(!Gh(e.charCodeAt(0)))return!1;return!0}function Gh(i){return!(kh(i)||yl(i)||ya(i)||qc(i)||Al(i))}function wl(i){return!(i!==746&&i!==747&&(i<4352||!(Dh(i)||Ph(i)||xs(i)&&!(i>=65097&&i<=65103)||va(i)||Rh(i)||Nc(i)||Bh(i)||!(!xl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Fh(i)||Zc(i)||Lh(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Vh(i)||xa(i)||$c(i)||(e=>e>=12688&&e<=12703)(i)||zh(i)||Gc(i)||vl(i)&&i!==12540||!(!Wc(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Nh(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||jh(i)||(e=>e>=19904&&e<=19967)(i)||Oh(i)||Uh(i))))}function El(i){return!(wl(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xl(e)||vl(e)||(r=>r>=57344&&r<=63743)(e)||xs(e)||Nh(e)||Wc(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Tl(i){return i>=1424&&i<=2303||qc(i)||Al(i)}function Dp(i,e){return!(!e&&Tl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function Bp(i){for(const e of i)if(Tl(e.charCodeAt(0)))return!0;return!1}const Xc="deferred",Aa="loading",Hc="loaded";let Qc=null,Br="unavailable",Gr=null;const ba=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Br="error"),Qc&&Qc(i)};function Go(){Yc.fire(new bt("pluginStateChange",{pluginStatus:Br,pluginURL:Gr}))}const Yc=new Ot,Sl=function(){return Br},vs=function(){if(Br!==Xc||!Gr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Br=Aa,Go(),Gr&&ne({url:Gr},i=>{i?ba(i):(Br=Hc,Go())})},en={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Br===Hc||en.applyArabicShaping!=null,isLoading:()=>Br===Aa,setState(i){Br=i.pluginStatus,Gr=i.pluginURL},isParsed:()=>en.applyArabicShaping!=null&&en.processBidirectionalText!=null&&en.processStyledBidirectionalText!=null,getPluginURL:()=>Gr};class zi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jc,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,n){for(const l of r)if(!Dp(l.charCodeAt(0),n))return!1;return!0}(e,en.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class wa{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,l){if($o(n))return new pl(n,l);if(ms(n)){const u=gh(n,l);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=n;return typeof n=="string"&&l.type==="color"&&(u=pi.parse(n)),{kind:"constant",evaluate:()=>u}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class As{constructor(e){this.property=e,this.value=new wa(e,void 0)}transitioned(e,r){return new t(this.property,this.value,r,It({},e.transition,this.transition),e.now)}untransitioned(){return new t(this.property,this.value,null,{},0)}}class c{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Qi(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new As(this._values[e].property)),this._values[e].value=new wa(this._values[e].property,r===null?void 0:Qi(r))}getTransition(e){return Qi(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new As(this._values[e].property)),this._values[e].transition=Qi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const n=new s(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].transitioned(e,r._values[l]);return n}untransitioned(){const e=new s(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class t{constructor(e,r,n,l,u){const p=l.delay||0,f=l.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+p,this.end=this.begin+f,e.specification.transition&&(l.delay||l.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const l=e.now||0,u=this.value.possiblyEvaluate(e,r,n),p=this.prior;if(p){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return p.possiblyEvaluate(e,r,n);{const f=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,n),u,Pt(f))}}return u}}class s{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const l=new y(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,n);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class h{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Qi(this._values[e].value)}setValue(e,r){this._values[e]=new wa(this._values[e].property,r===null?void 0:Qi(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const l=new y(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,n);return l}}class m{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,l){return this.property.evaluate(this.value,this.parameters,e,r,n,l)}}class y{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class v{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const l=il[this.specification.type];return l?l(e,r,n):e}}class E{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,l){return new m(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,l)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new m(this,{kind:"constant",value:void 0},e.parameters);const l=il[this.specification.type];return l?new m(this,{kind:"constant",value:l(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,l,u,p){return e.kind==="constant"?e.value:e.evaluate(r,n,l,u,p)}}class C extends E{possiblyEvaluate(e,r,n,l){if(e.value===void 0)return new m(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},n,l),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,f=this._calculate(p,p,p,r);return new m(this,{kind:"constant",value:f},r)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new m(this,{kind:"constant",value:u},r)}return new m(this,e.expression,r)}evaluate(e,r,n,l,u,p){if(e.kind==="source"){const f=e.evaluate(r,n,l,u,p);return this._calculate(f,f,f,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,l),e.evaluate({zoom:Math.floor(r.zoom)},n,l),e.evaluate({zoom:Math.floor(r.zoom)+1},n,l),r):e.value}_calculate(e,r,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class k{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},n,l);return this._calculate(u,u,u,r)}return this._calculate(e.expression.evaluate(new zi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new zi(Math.floor(r.zoom),r)),e.expression.evaluate(new zi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class P{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,l){return!!e.expression.evaluate(r,null,{},n,l)}interpolate(){return!1}}class F{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new wa(n,void 0),u=this.defaultTransitionablePropertyValues[r]=new As(n);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}function G(i,e){return 256*(i=Ke(Math.floor(i),0,255))+Ke(Math.floor(e),0,255)}st(E,"DataDrivenProperty"),st(v,"DataConstantProperty"),st(C,"CrossFadedDataDrivenProperty"),st(k,"CrossFadedProperty"),st(P,"ColorRampProperty");const X={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class q{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class N{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function re(i,e=1){let r=0,n=0;return{members:i.map(l=>{const u=X[l.type].BYTES_PER_ELEMENT,p=r=Y(r,Math.max(e,u)),f=l.components||1;return n=Math.max(n,u),r+=u*f,{name:l.name,type:l.type,components:f,offset:p}}),size:Y(r,Math.max(n,e)),alignment:e}}function Y(i,e){return Math.ceil(i/e)*e}class te extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=n,e}}te.prototype.bytesPerElement=4,st(te,"StructArrayLayout2i4");class ie extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n)}emplace(e,r,n,l){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=n,this.int16[u+2]=l,e}}ie.prototype.bytesPerElement=6,st(ie,"StructArrayLayout3i6");class oe extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=n,this.int16[p+2]=l,this.int16[p+3]=u,e}}oe.prototype.bytesPerElement=8,st(oe,"StructArrayLayout4i8");class ee extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,n,l,u,p,f)}emplace(e,r,n,l,u,p,f,x){const b=6*e,T=12*e,I=3*e;return this.int16[b+0]=r,this.int16[b+1]=n,this.uint8[T+4]=l,this.uint8[T+5]=u,this.uint8[T+6]=p,this.uint8[T+7]=f,this.float32[I+2]=x,e}}ee.prototype.bytesPerElement=12,st(ee,"StructArrayLayout2i4ub1f12");class le extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=n,this.float32[p+2]=l,this.float32[p+3]=u,e}}le.prototype.bytesPerElement=16,st(le,"StructArrayLayout4f16");class xe extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f,x,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,n,l,u,p,f,x,b,T)}emplace(e,r,n,l,u,p,f,x,b,T,I){const M=10*e;return this.uint16[M+0]=r,this.uint16[M+1]=n,this.uint16[M+2]=l,this.uint16[M+3]=u,this.uint16[M+4]=p,this.uint16[M+5]=f,this.uint16[M+6]=x,this.uint16[M+7]=b,this.uint16[M+8]=T,this.uint16[M+9]=I,e}}xe.prototype.bytesPerElement=20,st(xe,"StructArrayLayout10ui20");class Se extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,n,l,u,p,f,x)}emplace(e,r,n,l,u,p,f,x,b){const T=8*e;return this.uint16[T+0]=r,this.uint16[T+1]=n,this.uint16[T+2]=l,this.uint16[T+3]=u,this.uint16[T+4]=p,this.uint16[T+5]=f,this.uint16[T+6]=x,this.uint16[T+7]=b,e}}Se.prototype.bytesPerElement=16,st(Se,"StructArrayLayout8ui16");class ze extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,n,l,u,p)}emplace(e,r,n,l,u,p,f){const x=6*e;return this.int16[x+0]=r,this.int16[x+1]=n,this.int16[x+2]=l,this.int16[x+3]=u,this.int16[x+4]=p,this.int16[x+5]=f,e}}ze.prototype.bytesPerElement=12,st(ze,"StructArrayLayout6i12");class Me extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W){const K=this.length;return this.resize(K+1),this.emplace(K,e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W)}emplace(e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K){const ae=16*e;return this.int16[ae+0]=r,this.int16[ae+1]=n,this.int16[ae+2]=l,this.int16[ae+3]=u,this.uint16[ae+4]=p,this.uint16[ae+5]=f,this.uint16[ae+6]=x,this.uint16[ae+7]=b,this.int16[ae+8]=T,this.int16[ae+9]=I,this.int16[ae+10]=M,this.int16[ae+11]=D,this.int16[ae+12]=U,this.int16[ae+13]=$,this.int16[ae+14]=W,this.int16[ae+15]=K,e}}Me.prototype.bytesPerElement=32,st(Me,"StructArrayLayout4i4ui4i4i32");class Ze extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n)}emplace(e,r,n,l){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=n,this.float32[u+2]=l,e}}Ze.prototype.bytesPerElement=12,st(Ze,"StructArrayLayout3f12");class ve extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}ve.prototype.bytesPerElement=4,st(ve,"StructArrayLayout1ul4");class qe extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f,x,b,T,I,M,D){const U=this.length;return this.resize(U+1),this.emplace(U,e,r,n,l,u,p,f,x,b,T,I,M,D)}emplace(e,r,n,l,u,p,f,x,b,T,I,M,D,U){const $=20*e,W=10*e;return this.int16[$+0]=r,this.int16[$+1]=n,this.int16[$+2]=l,this.int16[$+3]=u,this.int16[$+4]=p,this.float32[W+3]=f,this.float32[W+4]=x,this.float32[W+5]=b,this.float32[W+6]=T,this.int16[$+14]=I,this.uint32[W+8]=M,this.uint16[$+18]=D,this.uint16[$+19]=U,e}}qe.prototype.bytesPerElement=40,st(qe,"StructArrayLayout5i4f1i1ul2ui40");class $e extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,n,l,u,p,f)}emplace(e,r,n,l,u,p,f,x){const b=8*e;return this.int16[b+0]=r,this.int16[b+1]=n,this.int16[b+2]=l,this.int16[b+4]=u,this.int16[b+5]=p,this.int16[b+6]=f,this.int16[b+7]=x,e}}$e.prototype.bytesPerElement=16,st($e,"StructArrayLayout3i2i2i16");class dt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,n,l,u)}emplace(e,r,n,l,u,p){const f=4*e,x=8*e;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=l,this.int16[x+6]=u,this.int16[x+7]=p,e}}dt.prototype.bytesPerElement=16,st(dt,"StructArrayLayout2f1f2i16");class Pe extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const p=12*e,f=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=n,this.float32[f+1]=l,this.float32[f+2]=u,e}}Pe.prototype.bytesPerElement=12,st(Pe,"StructArrayLayout2ub2f12");class lt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n)}emplace(e,r,n,l){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=n,this.uint16[u+2]=l,e}}lt.prototype.bytesPerElement=6,st(lt,"StructArrayLayout3ui6");class Et extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K,ae,he,pe,fe){const me=this.length;return this.resize(me+1),this.emplace(me,e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K,ae,he,pe,fe)}emplace(e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K,ae,he,pe,fe,me){const Ie=30*e,ke=15*e,Le=60*e;return this.int16[Ie+0]=r,this.int16[Ie+1]=n,this.int16[Ie+2]=l,this.float32[ke+2]=u,this.float32[ke+3]=p,this.uint16[Ie+8]=f,this.uint16[Ie+9]=x,this.uint32[ke+5]=b,this.uint32[ke+6]=T,this.uint32[ke+7]=I,this.uint16[Ie+16]=M,this.uint16[Ie+17]=D,this.uint16[Ie+18]=U,this.float32[ke+10]=$,this.float32[ke+11]=W,this.uint8[Le+48]=K,this.uint8[Le+49]=ae,this.uint8[Le+50]=he,this.uint32[ke+13]=pe,this.int16[Ie+28]=fe,this.uint8[Le+58]=me,e}}Et.prototype.bytesPerElement=60,st(Et,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ct extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K,ae,he,pe,fe,me,Ie,ke,Le,Oe,Te,De,je,Qe){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K,ae,he,pe,fe,me,Ie,ke,Le,Oe,Te,De,je,Qe)}emplace(e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W,K,ae,he,pe,fe,me,Ie,ke,Le,Oe,Te,De,je,Qe,Ge){const He=38*e,jt=19*e;return this.int16[He+0]=r,this.int16[He+1]=n,this.int16[He+2]=l,this.float32[jt+2]=u,this.float32[jt+3]=p,this.int16[He+8]=f,this.int16[He+9]=x,this.int16[He+10]=b,this.int16[He+11]=T,this.int16[He+12]=I,this.int16[He+13]=M,this.uint16[He+14]=D,this.uint16[He+15]=U,this.uint16[He+16]=$,this.uint16[He+17]=W,this.uint16[He+18]=K,this.uint16[He+19]=ae,this.uint16[He+20]=he,this.uint16[He+21]=pe,this.uint16[He+22]=fe,this.uint16[He+23]=me,this.uint16[He+24]=Ie,this.uint16[He+25]=ke,this.uint16[He+26]=Le,this.uint16[He+27]=Oe,this.uint16[He+28]=Te,this.uint32[jt+15]=De,this.float32[jt+16]=je,this.float32[jt+17]=Qe,this.float32[jt+18]=Ge,e}}ct.prototype.bytesPerElement=76,st(ct,"StructArrayLayout3i2f6i15ui1ul3f76");class ut extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ut.prototype.bytesPerElement=4,st(ut,"StructArrayLayout1f4");class kt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,n,l,u,p,f)}emplace(e,r,n,l,u,p,f,x){const b=7*e;return this.float32[b+0]=r,this.float32[b+1]=n,this.float32[b+2]=l,this.float32[b+3]=u,this.float32[b+4]=p,this.float32[b+5]=f,this.float32[b+6]=x,e}}kt.prototype.bytesPerElement=28,st(kt,"StructArrayLayout7f28");class qt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,n,l,u)}emplace(e,r,n,l,u,p){const f=5*e;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=l,this.float32[f+3]=u,this.float32[f+4]=p,e}}qt.prototype.bytesPerElement=20,st(qt,"StructArrayLayout5f20");class vt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=n,this.uint16[p+3]=l,this.uint16[p+4]=u,e}}vt.prototype.bytesPerElement=12,st(vt,"StructArrayLayout1ul3ui12");class Ut extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=n,e}}Ut.prototype.bytesPerElement=4,st(Ut,"StructArrayLayout2ui4");class oi extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}oi.prototype.bytesPerElement=2,st(oi,"StructArrayLayout1ui2");class Fi extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=n,e}}Fi.prototype.bytesPerElement=8,st(Fi,"StructArrayLayout2f8");class Ar extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,p,f){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,n,l,u,p,f)}emplace(e,r,n,l,u,p,f,x){const b=8*e,T=4*e;return this.int16[b+0]=r,this.int16[b+1]=n,this.int16[b+2]=l,this.int16[b+3]=u,this.int16[b+4]=p,this.int16[b+5]=f,this.float32[T+3]=x,e}}Ar.prototype.bytesPerElement=16,st(Ar,"StructArrayLayout6i1f16");class br extends q{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}br.prototype.size=12;class Zr extends ze{get(e){return new br(this,e)}}st(Zr,"FillExtrusionExtArray");class wn extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wn.prototype.size=40;class Hn extends qe{get(e){return new wn(this,e)}}st(Hn,"CollisionBoxArray");class fo extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}fo.prototype.size=60;class Qn extends Et{get(e){return new fo(this,e)}}st(Qn,"PlacedSymbolArray");class $i extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}$i.prototype.size=76;class qi extends ct{get(e){return new $i(this,e)}}st(qi,"SymbolInstanceArray");class _i extends ut{getoffsetX(e){return this.float32[1*e+0]}}st(_i,"GlyphOffsetArray");class Ji extends ie{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}st(Ji,"SymbolLineVertexArray");class qr extends q{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qr.prototype.size=12;class Oi extends vt{get(e){return new qr(this,e)}}st(Oi,"FeatureIndexArray");class tn extends q{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}tn.prototype.size=4;class Ea extends Ut{get(e){return new tn(this,e)}}st(Ea,"FillExtrusionCentroidArray");class Wr extends q{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Wr.prototype.size=16;class Zo extends Ar{get(e){return new Wr(this,e)}}st(Zo,"CircleGlobeExtArray");const Zh=re([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Kc=re([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var bs=Ha(function(i){i.exports=function(e,r){var n,l,u,p,f,x,b,T;for(l=e.length-(n=3&e.length),u=r,f=3432918353,x=461845907,T=0;T<l;)b=255&e.charCodeAt(T)|(255&e.charCodeAt(++T))<<8|(255&e.charCodeAt(++T))<<16|(255&e.charCodeAt(++T))<<24,++T,u=27492+(65535&(p=5*(65535&(u=(u^=b=(65535&(b=(b=(65535&b)*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*x+(((b>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,n){case 3:b^=(255&e.charCodeAt(T+2))<<16;case 2:b^=(255&e.charCodeAt(T+1))<<8;case 1:u^=b=(65535&(b=(b=(65535&(b^=255&e.charCodeAt(T)))*f+(((b>>>16)*f&65535)<<16)&4294967295)<<15|b>>>17))*x+(((b>>>16)*x&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),Lp=Ha(function(i){i.exports=function(e,r){for(var n,l=e.length,u=r^l,p=0;l>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),mo=bs,Jc=Lp;mo.murmur3=bs,mo.murmur2=Jc;class qh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,l){this.ids.push(A_(e)),this.positions.push(r,n,l)}getPositions(e){const r=A_(e);let n=0,l=this.ids.length-1;for(;n<l;){const p=n+l>>1;this.ids[p]>=r?l=p:n=p+1}const u=[];for(;this.ids[n]===r;)u.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return u}static serialize(e,r){const n=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Rp(n,l,0,n.length-1),r&&r.push(n.buffer,l.buffer),{ids:n,positions:l}}static deserialize(e){const r=new qh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function A_(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:mo(String(i))}function Rp(i,e,r,n){for(;r<n;){const l=i[r+n>>1];let u=r-1,p=n+1;for(;;){do u++;while(i[u]<l);do p--;while(i[p]>l);if(u>=p)break;Wh(i,u,p),Wh(e,3*u,3*p),Wh(e,3*u+1,3*p+1),Wh(e,3*u+2,3*p+2)}p-r<n-p?(Rp(i,e,r,p),r=p+1):(Rp(i,e,p+1,n),n=p)}}function Wh(i,e,r){const n=i[e];i[e]=i[r],i[r]=n}st(qh,"FeaturePositionMap");class qo{constructor(e,r){this.gl=e.gl,this.location=r}}class Xh extends qo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class b_ extends qo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class w_ extends qo{constructor(e,r){super(e,r),this.current=pi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const eA=new Float32Array(16),tA=new Float32Array(9),iA=new Float32Array(4);function Fp(i){return[G(255*i.r,255*i.g),G(255*i.b,255*i.a)]}class eu{constructor(e,r,n){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new w_(e,r):new Xh(e,r)}}class Il{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,l){const u=l==="u_pattern_to"||l==="u_dash_to"?this.patternTo:l==="u_pattern_from"||l==="u_dash_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new b_(e,r):new Xh(e,r)}}class Wo{constructor(e,r,n,l){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,n,l,u,p){const f=this.paintVertexArray.length,x=this.expression.evaluate(new zi(0),r,{},u,l,p);this.paintVertexArray.resize(e),this._setPaintValue(f,e,x)}updatePaintArray(e,r,n,l,u){const p=this.expression.evaluate({zoom:0},n,l,void 0,u);this._setPaintValue(e,r,p)}_setPaintValue(e,r,n){if(this.type==="color"){const l=Fp(n);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yn{constructor(e,r,n,l,u,p){this.expression=e,this.uniformNames=r.map(f=>`u_${f}_t`),this.type=n,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,n,l,u,p){const f=this.expression.evaluate(new zi(this.zoom),r,{},u,l,p),x=this.expression.evaluate(new zi(this.zoom+1),r,{},u,l,p),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,f,x)}updatePaintArray(e,r,n,l,u){const p=this.expression.evaluate({zoom:this.zoom},n,l,void 0,u),f=this.expression.evaluate({zoom:this.zoom+1},n,l,void 0,u);this._setPaintValue(e,r,p,f)}_setPaintValue(e,r,n,l){if(this.type==="color"){const u=Fp(n),p=Fp(l);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1],p[0],p[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,n,l);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Ke(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,n){return new Xh(e,r)}}class ws{constructor(e,r,n,l,u,p,f){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=u,this.layerId=f,this.paintVertexAttributes=(n==="array"?Kc:Zh).members;for(let x=0;x<r.length;++x);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,n){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,l,u,p){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(e,r,n,l){if(!l||!n)return;const{min:u,mid:p,max:f}=n,x=l[u],b=l[p],T=l[f];if(x&&b&&T)for(let I=e;I<r;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,b,x),this._setPaintValue(this.zoomOutPaintVertexArray,I,b,T)}_setPaintValue(e,r,n,l){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],n.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Es{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!n(u))continue;const p=e.paint.get(u);if(!(p instanceof m&&fs(p.property.specification)))continue;const f=nA(u,e.type),x=p.value,b=p.property.specification.type,T=p.property.useIntegerZoom,I=p.property.specification["property-type"],M=I==="cross-faded"||I==="cross-faded-data-driven",D=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||D)if(x.kind==="source"||D||M){const U=E_(u,b,"source");this.binders[u]=M?new ws(x,f,b,T,r,U,e.id):new Wo(x,f,b,U),l.push(`/a_${u}`)}else{const U=E_(u,b,"composite");this.binders[u]=new Yn(x,f,b,T,r,U),l.push(`/z_${u}`)}else this.binders[u]=M?new Il(x.value,f):new eu(x.value,f,b),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Wo||r instanceof Yn?r.maxValue:0}populatePaintArrays(e,r,n,l,u,p){for(const f in this.binders){const x=this.binders[f];(x instanceof Wo||x instanceof Yn||x instanceof ws)&&x.populatePaintArray(e,r,n,l,u,p)}}setConstantPatternPositions(e,r){for(const n in this.binders){const l=this.binders[n];l instanceof Il&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,l,u,p){let f=!1;for(const x in e){const b=r.getPositions(x);for(const T of b){const I=n.feature(T.index);for(const M in this.binders){const D=this.binders[M];if((D instanceof Wo||D instanceof Yn||D instanceof ws)&&D.expression.isStateDependent===!0){const U=l.paint.get(M);D.expression=U.value,D.updatePaintArray(T.start,T.end,I,e[x],u,p),f=!0}}}}return f}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof eu||n instanceof Il)&&e.push(...n.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Wo||n instanceof Yn||n instanceof ws)for(let l=0;l<n.paintVertexAttributes.length;l++)e.push(n.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof eu||n instanceof Il||n instanceof Yn)for(const l of n.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof eu||u instanceof Il||u instanceof Yn){for(const p of u.uniformNames)if(r[p]){const f=u.getBinding(e,r[p],p);n.push({name:p,property:l,binding:f})}}}return n}setUniforms(e,r,n,l){for(const{name:u,property:p,binding:f}of r)this.binders[p].setUniform(f,l,n.get(p),u)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof ws){const l=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(n instanceof Wo||n instanceof Yn)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof Wo||n instanceof Yn||n instanceof ws)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Wo||r instanceof Yn||r instanceof ws)&&r.destroy()}}}class Ta{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Es(l,r,n);this.needsUpload=!1,this._featureMap=new qh,this._bufferOffset=0}populatePaintArrays(e,r,n,l,u,p,f){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,r,l,u,p,f);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,l,u){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const rA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function nA(i,e){return rA[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const oA={"line-pattern":{source:xe,composite:xe},"fill-pattern":{source:xe,composite:xe},"fill-extrusion-pattern":{source:xe,composite:xe},"line-dasharray":{source:Se,composite:Se}},sA={color:{source:Fi,composite:le},number:{source:ut,composite:Fi}};function E_(i,e,r){const n=oA[i];return n&&n[r]||sA[e][r]}st(eu,"ConstantBinder"),st(Il,"CrossFadedConstantBinder"),st(Wo,"SourceExpressionBinder"),st(ws,"CrossFadedCompositeBinder"),st(Yn,"CompositeExpressionBinder"),st(Es,"ProgramConfiguration",{omit:["_buffers"]}),st(Ta,"ProgramConfigurationSet");const Hh="-transition";class Kn extends Ot{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new h(r.layout)),r.paint)){this._transitionablePaint=new c(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new y(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(Pp,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Bt(e,Hh)?this._transitionablePaint.getTransition(e.slice(0,-Hh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(zp,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(Bt(e,Hh))return this._transitionablePaint.setTransition(e.slice(0,-Hh.length),r||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),f=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,f,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Sr(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,l,u={}){return(!u||u.validate!==!1)&&Ch(this,e.call(_a,{key:r,layerType:this.type,objectKey:n,value:l,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof m&&fs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=co(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const aA=re([{name:"a_pos",components:2,type:"Int16"}],4),lA=re([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Wi{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,l){let u=this.segments[this.segments.length-1];return e>Wi.MAX_VERTEX_ARRAY_LENGTH&&Yt(`Max vertices per segment is ${Wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Wi.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,l){return new Wi([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:l,vaos:{},sortKey:0}])}}Wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,st(Wi,"SegmentVector");var Gt=8192;class Ts{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ei?new Ei(e.lng,e.lat):Ei.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ei?new Ei(e.lng,e.lat):Ei.convert(e),this}extend(e){const r=this._sw,n=this._ne;let l,u;if(e instanceof Ei)l=e,u=e;else{if(!(e instanceof Ts))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ts.convert(e)):this.extend(Ei.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return r||n?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),n.lng=Math.max(u.lng,n.lng),n.lat=Math.max(u.lat,n.lat)):(this._sw=new Ei(l.lng,l.lat),this._ne=new Ei(u.lng,u.lat)),this}getCenter(){return new Ei((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ei(this.getWest(),this.getNorth())}getSouthEast(){return new Ei(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=Ei.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&l}static convert(e){return!e||e instanceof Ts?e:new Ts(e)}}const Op=63710088e-1;class Ei{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ei(gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,l=e.lat*r,u=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return Op*Math.acos(Math.min(u,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new Ts(new Ei(this.lng-n,this.lat-r),new Ei(this.lng+n,this.lat+r))}static convert(e){if(e instanceof Ei)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ei(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ei(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const T_=2*Math.PI*Op;function Up(i){return T_*Math.cos(i*Math.PI/180)}function tu(i){return(180+i)/360}function Cl(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ml(i,e){return i/Up(e)}function Ln(i){return 360*i-180}function wr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function S_(i,e){return i*Up(wr(e))}const _o=85.051129;class Qh{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=Ei.convert(e);return new Qh(tu(n.lng),Cl(n.lat),Ml(r,n.lat))}toLngLat(){return new Ei(Ln(this.x),wr(this.y))}toAltitude(){return S_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/T_*(e=wr(this.y),1/Math.cos(e*Math.PI/180));var e}}function Vp(i,e,r,n,l,u,p,f,x){const b=(e+n)/2,T=(r+l)/2,I=new B(b,T);f(I),function(M,D,U,$,W,K){const ae=U-W,he=$-K;return Math.abs(($-D)*ae-(U-M)*he)/Math.hypot(ae,he)}(I.x,I.y,u.x,u.y,p.x,p.y)>=x?(Vp(i,e,r,b,T,u,I,f,x),Vp(i,b,T,n,l,I,p,f,x)):i.push(p)}function cA(i,e,r){let n=i[0],l=n.x,u=n.y;e(n);const p=[n];for(let f=1;f<i.length;f++){const x=i[f],{x:b,y:T}=x;e(x),Vp(p,l,u,b,T,n,x,e,r),l=b,u=T,n=x}return p}const jp=Math.pow(2,14)-1,I_=-jp-1;function uA(i,e){const r=Math.round(i.x*e),n=Math.round(i.y*e);return i.x=Ke(r,I_,jp),i.y=Ke(n,I_,jp),(r<i.x||r>i.x+1||n<i.y||n>i.y+1)&&Yt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Xo(i,e,r){const n=i.loadGeometry(),l=i.extent,u=Gt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:f,x,y:b,projection:T}=r,I=M=>{const D=Ln((e.x+M.x/l)/p),U=wr((e.y+M.y/l)/p),$=T.project(D,U);M.x=($.x*f-x)*l,M.y=($.y*f-b)*l};for(let M=0;M<n.length;M++)if(i.type!==1)n[M]=cA(n[M],I,1);else{const D=[];for(const U of n[M])U.x<0||U.x>=l||U.y<0||U.y>=l||(I(U),D.push(U));n[M]=D}}for(const p of n)for(const f of p)uA(f,u);return n}function Sa(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Xo(i):[]}}function Yh(i,e,r,n,l){i.emplaceBack(2*e+(n+1)/2,2*r+(l+1)/2)}function Kh(i,e,r,n){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384,n)}class Np{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new te,this.indexArray=new lt,this.segments=new Wi,this.programConfigurations=new Ta(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,l){const u=this.layers[0],p=[];let f=null;u.type==="circle"&&(f=u.layout.get("circle-sort-key"));for(const{feature:b,id:T,index:I,sourceLayerIndex:M}of e){const D=this.layers[0]._featureFilter.needGeometry,U=Sa(b,D);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),U,n))continue;const $=f?f.evaluate(U,{},n):void 0,W={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:I,geometry:D?U.geometry:Xo(b,n,l),patterns:{},sortKey:$};p.push(W)}f&&p.sort((b,T)=>b.sortKey-T.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Zo,x=l.projection);for(const b of p){const{geometry:T,index:I,sourceLayerIndex:M}=b,D=e[I].feature;this.addFeature(b,T,I,r.availableImages,n,x),r.featureIndex.insert(D,T,I,M,this.index)}}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lA.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,n,l,u,p){for(const f of r)for(const x of f){const b=x.x,T=x.y;if(b<0||b>=Gt||T<0||T>=Gt)continue;if(p){const D=p.projectTilePoint(b,T,u),U=p.upVector(u,b,T),$=wr((T/Gt+u.y)/(1<<u.z)),W=p.pixelsPerMeter($,1)/Ml(1,$),K=this.globeExtVertexArray;Kh(K,D,U,W),Kh(K,D,U,W),Kh(K,D,U,W),Kh(K,D,U,W)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),M=I.vertexLength;Yh(this.layoutVertexArray,b,T,-1,-1),Yh(this.layoutVertexArray,b,T,1,-1),Yh(this.layoutVertexArray,b,T,1,1),Yh(this.layoutVertexArray,b,T,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},l,u)}}function C_(i,e){for(let r=0;r<i.length;r++)if(kl(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(kl(i,e[r]))return!0;return!!$p(i,e)}function hA(i,e,r){return!!kl(i,e)||!!Gp(e,i,r)}function M_(i,e){if(i.length===1)return z_(e,i[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let l=0;l<n.length;l++)if(kl(i,n[l]))return!0}for(let r=0;r<i.length;r++)if(z_(e,i[r]))return!0;for(let r=0;r<e.length;r++)if($p(i,e[r]))return!0;return!1}function dA(i,e,r){if(i.length>1){if($p(i,e))return!0;for(let n=0;n<e.length;n++)if(Gp(e[n],i,r))return!0}for(let n=0;n<i.length;n++)if(Gp(i[n],e,r))return!0;return!1}function $p(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const n=i[r],l=i[r+1];for(let u=0;u<e.length-1;u++)if(pA(n,l,e[u],e[u+1]))return!0}return!1}function pA(i,e,r,n){return ir(i,r,n)!==ir(e,r,n)&&ir(i,e,r)!==ir(i,e,n)}function Gp(i,e,r){const n=r*r;if(e.length===1)return i.distSqr(e[0])<n;for(let l=1;l<e.length;l++)if(k_(i,e[l-1],e[l])<n)return!0;return!1}function k_(i,e,r){const n=e.distSqr(r);if(n===0)return i.distSqr(e);const l=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/n;return i.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function z_(i,e){let r,n,l,u=!1;for(let p=0;p<i.length;p++){r=i[p];for(let f=0,x=r.length-1;f<r.length;x=f++)n=r[f],l=r[x],n.y>e.y!=l.y>e.y&&e.x<(l.x-n.x)*(e.y-n.y)/(l.y-n.y)+n.x&&(u=!u)}return u}function kl(i,e){let r=!1;for(let n=0,l=i.length-1;n<i.length;l=n++){const u=i[n],p=i[l];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function P_(i,e,r,n,l){for(const p of i)if(e<=p.x&&r<=p.y&&n>=p.x&&l>=p.y)return!0;const u=[new B(e,r),new B(e,l),new B(n,l),new B(n,r)];if(i.length>2){for(const p of u)if(kl(i,p))return!0}for(let p=0;p<i.length-1;p++)if(fA(i[p],i[p+1],u))return!0;return!1}function fA(i,e,r){const n=r[0],l=r[2];if(i.x<n.x&&e.x<n.x||i.x>l.x&&e.x>l.x||i.y<n.y&&e.y<n.y||i.y>l.y&&e.y>l.y)return!1;const u=ir(i,e,r[0]);return u!==ir(i,e,r[1])||u!==ir(i,e,r[2])||u!==ir(i,e,r[3])}function zl(i,e,r){const n=e.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Jh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function D_(i,e,r,n,l){if(!e[0]&&!e[1])return i;const u=B.convert(e)._mult(l);r==="viewport"&&u._rotate(-n);const p=[];for(let f=0;f<i.length;f++)p.push(i[f].sub(u));return p}function B_(i,e,r,n){const l=B.convert(i)._mult(n);return e==="viewport"&&l._rotate(-r),l}st(Np,"CircleBucket",{omit:["layers"]});const mA=new F({"circle-sort-key":new E(we.layout_circle["circle-sort-key"])});var _A={paint:new F({"circle-radius":new E(we.paint_circle["circle-radius"]),"circle-color":new E(we.paint_circle["circle-color"]),"circle-blur":new E(we.paint_circle["circle-blur"]),"circle-opacity":new E(we.paint_circle["circle-opacity"]),"circle-translate":new v(we.paint_circle["circle-translate"]),"circle-translate-anchor":new v(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new v(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new v(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new E(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new E(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new E(we.paint_circle["circle-stroke-opacity"])}),layout:mA},Zp=1e-6,rn=typeof Float32Array!="undefined"?Float32Array:Array;function L_(){var i=new rn(9);return rn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function go(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qp(i,e,r){var n=e[0],l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=e[9],D=e[10],U=e[11],$=e[12],W=e[13],K=e[14],ae=e[15],he=r[0],pe=r[1],fe=r[2],me=r[3];return i[0]=he*n+pe*f+fe*I+me*$,i[1]=he*l+pe*x+fe*M+me*W,i[2]=he*u+pe*b+fe*D+me*K,i[3]=he*p+pe*T+fe*U+me*ae,i[4]=(he=r[4])*n+(pe=r[5])*f+(fe=r[6])*I+(me=r[7])*$,i[5]=he*l+pe*x+fe*M+me*W,i[6]=he*u+pe*b+fe*D+me*K,i[7]=he*p+pe*T+fe*U+me*ae,i[8]=(he=r[8])*n+(pe=r[9])*f+(fe=r[10])*I+(me=r[11])*$,i[9]=he*l+pe*x+fe*M+me*W,i[10]=he*u+pe*b+fe*D+me*K,i[11]=he*p+pe*T+fe*U+me*ae,i[12]=(he=r[12])*n+(pe=r[13])*f+(fe=r[14])*I+(me=r[15])*$,i[13]=he*l+pe*x+fe*M+me*W,i[14]=he*u+pe*b+fe*D+me*K,i[15]=he*p+pe*T+fe*U+me*ae,i}function Ia(i,e,r){var n,l,u,p,f,x,b,T,I,M,D,U,$=r[0],W=r[1],K=r[2];return e===i?(i[12]=e[0]*$+e[4]*W+e[8]*K+e[12],i[13]=e[1]*$+e[5]*W+e[9]*K+e[13],i[14]=e[2]*$+e[6]*W+e[10]*K+e[14],i[15]=e[3]*$+e[7]*W+e[11]*K+e[15]):(l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=e[9],D=e[10],U=e[11],i[0]=n=e[0],i[1]=l,i[2]=u,i[3]=p,i[4]=f,i[5]=x,i[6]=b,i[7]=T,i[8]=I,i[9]=M,i[10]=D,i[11]=U,i[12]=n*$+f*W+I*K+e[12],i[13]=l*$+x*W+M*K+e[13],i[14]=u*$+b*W+D*K+e[14],i[15]=p*$+T*W+U*K+e[15]),i}function Ss(i,e,r){var n=r[0],l=r[1],u=r[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*l,i[5]=e[5]*l,i[6]=e[6]*l,i[7]=e[7]*l,i[8]=e[8]*u,i[9]=e[9]*u,i[10]=e[10]*u,i[11]=e[11]*u,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Wp(i,e,r){var n=Math.sin(r),l=Math.cos(r),u=e[4],p=e[5],f=e[6],x=e[7],b=e[8],T=e[9],I=e[10],M=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=u*l+b*n,i[5]=p*l+T*n,i[6]=f*l+I*n,i[7]=x*l+M*n,i[8]=b*l-u*n,i[9]=T*l-p*n,i[10]=I*l-f*n,i[11]=M*l-x*n,i}function Xp(i,e,r){var n=Math.sin(r),l=Math.cos(r),u=e[0],p=e[1],f=e[2],x=e[3],b=e[8],T=e[9],I=e[10],M=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l-b*n,i[1]=p*l-T*n,i[2]=f*l-I*n,i[3]=x*l-M*n,i[8]=u*n+b*l,i[9]=p*n+T*l,i[10]=f*n+I*l,i[11]=x*n+M*l,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var gA=qp;function Hp(){var i=new rn(3);return rn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function R_(i){var e=new rn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function F_(i){return Math.hypot(i[0],i[1],i[2])}function iu(i,e,r){var n=new rn(3);return n[0]=i,n[1]=e,n[2]=r,n}function O_(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function U_(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function V_(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function Qp(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function Yp(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function ru(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Kp(i,e,r,n){return i[0]=e[0]+r[0]*n,i[1]=e[1]+r[1]*n,i[2]=e[2]+r[2]*n,i}function nu(i,e){var r=e[0],n=e[1],l=e[2],u=r*r+n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),i[0]=e[0]*u,i[1]=e[1]*u,i[2]=e[2]*u,i}function ou(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function j_(i,e,r){var n=e[0],l=e[1],u=e[2],p=r[0],f=r[1],x=r[2];return i[0]=l*x-u*f,i[1]=u*p-n*x,i[2]=n*f-l*p,i}function Ca(i,e,r){var n=e[0],l=e[1],u=e[2],p=r[3]*n+r[7]*l+r[11]*u+r[15];return i[0]=(r[0]*n+r[4]*l+r[8]*u+r[12])/(p=p||1),i[1]=(r[1]*n+r[5]*l+r[9]*u+r[13])/p,i[2]=(r[2]*n+r[6]*l+r[10]*u+r[14])/p,i}function N_(i,e,r){var n=r[0],l=r[1],u=r[2],p=e[0],f=e[1],x=e[2],b=l*x-u*f,T=u*p-n*x,I=n*f-l*p,M=l*I-u*T,D=u*b-n*I,U=n*T-l*b,$=2*r[3];return T*=$,I*=$,D*=2,U*=2,i[0]=p+(b*=$)+(M*=2),i[1]=f+T+D,i[2]=x+I+U,i}var su,Pl=U_,yA=V_,xA=F_;function Dl(i,e,r){var n=e[0],l=e[1],u=e[2],p=e[3];return i[0]=r[0]*n+r[4]*l+r[8]*u+r[12]*p,i[1]=r[1]*n+r[5]*l+r[9]*u+r[13]*p,i[2]=r[2]*n+r[6]*l+r[10]*u+r[14]*p,i[3]=r[3]*n+r[7]*l+r[11]*u+r[15]*p,i}function $_(){var i=new rn(4);return rn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function G_(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Z_(i,e,r){r*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(r),x=Math.cos(r);return i[0]=n*x+p*f,i[1]=l*x+u*f,i[2]=u*x-l*f,i[3]=p*x-n*f,i}Hp(),su=new rn(4),rn!=Float32Array&&(su[0]=0,su[1]=0,su[2]=0,su[3]=0),Hp(),iu(1,0,0),iu(0,1,0),$_(),$_(),L_();class Jp{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,n,l){const u=Math.pow(2,n),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const b=Dl([],x,e),T=1/b[3]/r*u;return function(I,M,D){return I[0]=M[0]*D[0],I[1]=M[1]*D[1],I[2]=M[2]*D[2],I[3]=M[3]*D[3],I}(b,b,[T,T,l?1/b[3]:T,T])}),f=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const b=nu([],j_([],Pl([],p[x[0]],p[x[1]]),Pl([],p[x[2]],p[x[1]]))),T=-ou(b,p[x[1]]);return b.concat(T)});return new Jp(p,f)}}class En{constructor(e,r){this.min=e,this.max=r,this.center=ru([],O_([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=R_(this.min),l=R_(this.max);for(let u=0;u<r.length;u++)n[u]=r[u]?this.min[u]:this.center[u],l[u]=r[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new En(n,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let n=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let p=0;for(let f=0;f<r.length;f++)p+=ou(u,r[f])+u[3]>=0;if(p===0)return 0;p!==r.length&&(n=!1)}if(n)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let f=0;f<e.points.length;f++){const x=e.points[f][l]-this.min[l];u=Math.min(u,x),p=Math.max(p,x)}if(p<0||u>this.max[l]-this.min[l])return 0}return 1}}function q_(i,e,r,n,l,u,p,f,x){if(u&&i.queryGeometry.isAboveHorizon)return!1;u&&(x*=i.pixelToTileUnitsFactor);for(const b of e)for(const T of b){const I=T.add(f),M=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(I.x,I.y,!0):0,D=u?I:vA(I,M,n),U=u?i.tilespaceRays.map(W=>bA(W,M)):i.queryGeometry.screenGeometry,$=Dl([],[T.x,T.y,M,1],n);if(!p&&u?x*=$[3]/r.cameraToCenterDistance:p&&!u&&(x*=r.cameraToCenterDistance/$[3]),hA(U,D,x))return!0}return!1}function vA(i,e,r){const n=Dl([],[i.x,i.y,e,1],r);return new B(n[0]/n[3],n[1]/n[3])}const W_=iu(0,0,0),AA=iu(0,0,1);function bA(i,e){const r=Hp();return W_[2]=e,i.intersectsPlane(W_,AA,r),new B(r[0],r[1])}class X_ extends Np{}function H_(i,{width:e,height:r},n,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*n)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*n);return i.width=e,i.height=r,i.data=l,i}function Q_(i,e,r){const{width:n,height:l}=e;n===i.width&&l===i.height||(ef(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,l)},r),i.width=n,i.height=l,i.data=e.data)}function ef(i,e,r,n,l,u){if(l.width===0||l.height===0)return e;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||n.x>e.width-l.width||n.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,f=e.data;for(let x=0;x<l.height;x++){const b=((r.y+x)*i.width+r.x)*u,T=((n.y+x)*e.width+n.x)*u;for(let I=0;I<l.width*u;I++)f[T+I]=p[b+I]}return e}st(X_,"HeatmapBucket",{omit:["layers"]});class Ho{constructor(e,r){H_(this,e,1,r)}resize(e){Q_(this,new Ho(e),1)}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,l,u){ef(e,r,n,l,u,1)}}class nn{constructor(e,r){H_(this,e,4,r)}resize(e){Q_(this,new nn(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new nn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,l,u){ef(e,r,n,l,u,4)}}st(Ho,"AlphaImage"),st(nn,"RGBAImage");var wA={paint:new F({"heatmap-radius":new E(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new E(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new v(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new P(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new v(we.paint_heatmap["heatmap-opacity"])})};function tf(i){const e={},r=i.resolution||256,n=i.clips?i.clips.length:1,l=i.image||new nn({width:r,height:n}),u=(p,f,x)=>{e[i.evaluationKey]=x;const b=i.expression.evaluate(e);l.data[p+f+0]=Math.floor(255*b.r/b.a),l.data[p+f+1]=Math.floor(255*b.g/b.a),l.data[p+f+2]=Math.floor(255*b.b/b.a),l.data[p+f+3]=Math.floor(255*b.a)};if(i.clips)for(let p=0,f=0;p<n;++p,f+=4*r)for(let x=0,b=0;x<r;x++,b+=4){const T=x/(r-1),{start:I,end:M}=i.clips[p];u(f,b,I*(1-T)+M*T)}else for(let p=0,f=0;p<r;p++,f+=4)u(0,f,p/(r-1));return l}var EA={paint:new F({"hillshade-illumination-direction":new v(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new v(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new v(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new v(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new v(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new v(we.paint_hillshade["hillshade-accent-color"])})};const TA=re([{name:"a_pos",components:2,type:"Int16"}],4),{members:SA}=TA;var ed=td,IA=td;function td(i,e,r){r=r||2;var n,l,u,p,f,x,b,T=e&&e.length,I=T?e[0]*r:i.length,M=Y_(i,0,I,r,!0),D=[];if(!M||M.next===M.prev)return D;if(T&&(M=function($,W,K,ae){var he,pe,fe,me=[];for(he=0,pe=W.length;he<pe;he++)(fe=Y_($,W[he]*ae,he<pe-1?W[he+1]*ae:$.length,ae,!1))===fe.next&&(fe.steiner=!0),me.push(LA(fe));for(me.sort(PA),he=0;he<me.length;he++)K=Is(K=DA(me[he],K),K.next);return K}(i,e,M,r)),i.length>80*r){n=u=i[0],l=p=i[1];for(var U=r;U<I;U+=r)(f=i[U])<n&&(n=f),(x=i[U+1])<l&&(l=x),f>u&&(u=f),x>p&&(p=x);b=(b=Math.max(u-n,p-l))!==0?1/b:0}return au(M,D,r,n,l,b),D}function Y_(i,e,r,n,l){var u,p;if(l===of(i,e,r,n)>0)for(u=e;u<r;u+=n)p=eg(u,i[u],i[u+1],p);else for(u=r-n;u>=e;u-=n)p=eg(u,i[u],i[u+1],p);return p&&id(p,p.next)&&(cu(p),p=p.next),p}function Is(i,e){if(!i)return i;e||(e=i);var r,n=i;do if(r=!1,n.steiner||!id(n,n.next)&&er(n.prev,n,n.next)!==0)n=n.next;else{if(cu(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function au(i,e,r,n,l,u,p){if(i){!p&&u&&function(T,I,M,D){var U=T;do U.z===null&&(U.z=rf(U.x,U.y,I,M,D)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==T);U.prevZ.nextZ=null,U.prevZ=null,function($){var W,K,ae,he,pe,fe,me,Ie,ke=1;do{for(K=$,$=null,pe=null,fe=0;K;){for(fe++,ae=K,me=0,W=0;W<ke&&(me++,ae=ae.nextZ);W++);for(Ie=ke;me>0||Ie>0&&ae;)me!==0&&(Ie===0||!ae||K.z<=ae.z)?(he=K,K=K.nextZ,me--):(he=ae,ae=ae.nextZ,Ie--),pe?pe.nextZ=he:$=he,he.prevZ=pe,pe=he;K=ae}pe.nextZ=null,ke*=2}while(fe>1)}(U)}(i,n,l,u);for(var f,x,b=i;i.prev!==i.next;)if(f=i.prev,x=i.next,u?MA(i,n,l,u):CA(i))e.push(f.i/r),e.push(i.i/r),e.push(x.i/r),cu(i),i=x.next,b=x.next;else if((i=x)===b){p?p===1?au(i=kA(Is(i),e,r),e,r,n,l,u,2):p===2&&zA(i,e,r,n,l,u):au(Is(i),e,r,n,l,u,1);break}}}function CA(i){var e=i.prev,r=i,n=i.next;if(er(e,r,n)>=0)return!1;for(var l=i.next.next;l!==i.prev;){if(Bl(e.x,e.y,r.x,r.y,n.x,n.y,l.x,l.y)&&er(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function MA(i,e,r,n){var l=i.prev,u=i,p=i.next;if(er(l,u,p)>=0)return!1;for(var f=l.x>u.x?l.x>p.x?l.x:p.x:u.x>p.x?u.x:p.x,x=l.y>u.y?l.y>p.y?l.y:p.y:u.y>p.y?u.y:p.y,b=rf(l.x<u.x?l.x<p.x?l.x:p.x:u.x<p.x?u.x:p.x,l.y<u.y?l.y<p.y?l.y:p.y:u.y<p.y?u.y:p.y,e,r,n),T=rf(f,x,e,r,n),I=i.prevZ,M=i.nextZ;I&&I.z>=b&&M&&M.z<=T;){if(I!==i.prev&&I!==i.next&&Bl(l.x,l.y,u.x,u.y,p.x,p.y,I.x,I.y)&&er(I.prev,I,I.next)>=0||(I=I.prevZ,M!==i.prev&&M!==i.next&&Bl(l.x,l.y,u.x,u.y,p.x,p.y,M.x,M.y)&&er(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;I&&I.z>=b;){if(I!==i.prev&&I!==i.next&&Bl(l.x,l.y,u.x,u.y,p.x,p.y,I.x,I.y)&&er(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;M&&M.z<=T;){if(M!==i.prev&&M!==i.next&&Bl(l.x,l.y,u.x,u.y,p.x,p.y,M.x,M.y)&&er(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function kA(i,e,r){var n=i;do{var l=n.prev,u=n.next.next;!id(l,u)&&K_(l,n,n.next,u)&&lu(l,u)&&lu(u,l)&&(e.push(l.i/r),e.push(n.i/r),e.push(u.i/r),cu(n),cu(n.next),n=i=u),n=n.next}while(n!==i);return Is(n)}function zA(i,e,r,n,l,u){var p=i;do{for(var f=p.next.next;f!==p.prev;){if(p.i!==f.i&&RA(p,f)){var x=J_(p,f);return p=Is(p,p.next),x=Is(x,x.next),au(p,e,r,n,l,u),void au(x,e,r,n,l,u)}f=f.next}p=p.next}while(p!==i)}function PA(i,e){return i.x-e.x}function DA(i,e){var r=function(u,p){var f,x=p,b=u.x,T=u.y,I=-1/0;do{if(T<=x.y&&T>=x.next.y&&x.next.y!==x.y){var M=x.x+(T-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(M<=b&&M>I){if(I=M,M===b){if(T===x.y)return x;if(T===x.next.y)return x.next}f=x.x<x.next.x?x:x.next}}x=x.next}while(x!==p);if(!f)return null;if(b===I)return f;var D,U=f,$=f.x,W=f.y,K=1/0;x=f;do b>=x.x&&x.x>=$&&b!==x.x&&Bl(T<W?b:I,T,$,W,T<W?I:b,T,x.x,x.y)&&(D=Math.abs(T-x.y)/(b-x.x),lu(x,u)&&(D<K||D===K&&(x.x>f.x||x.x===f.x&&BA(f,x)))&&(f=x,K=D)),x=x.next;while(x!==U);return f}(i,e);if(!r)return e;var n=J_(r,i),l=Is(r,r.next);return Is(n,n.next),e===r?l:e}function BA(i,e){return er(i.prev,i,e.prev)<0&&er(e.next,i,i.next)<0}function rf(i,e,r,n,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*l)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*l)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function LA(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function Bl(i,e,r,n,l,u,p,f){return(l-p)*(e-f)-(i-p)*(u-f)>=0&&(i-p)*(n-f)-(r-p)*(e-f)>=0&&(r-p)*(u-f)-(l-p)*(n-f)>=0}function RA(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,n){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==n.i&&l.next.i!==n.i&&K_(l,l.next,r,n))return!0;l=l.next}while(l!==r);return!1}(i,e)&&(lu(i,e)&&lu(e,i)&&function(r,n){var l=r,u=!1,p=(r.x+n.x)/2,f=(r.y+n.y)/2;do l.y>f!=l.next.y>f&&l.next.y!==l.y&&p<(l.next.x-l.x)*(f-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(i,e)&&(er(i.prev,i,e.prev)||er(i,e.prev,e))||id(i,e)&&er(i.prev,i,i.next)>0&&er(e.prev,e,e.next)>0)}function er(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function id(i,e){return i.x===e.x&&i.y===e.y}function K_(i,e,r,n){var l=nd(er(i,e,r)),u=nd(er(i,e,n)),p=nd(er(r,n,i)),f=nd(er(r,n,e));return l!==u&&p!==f||!(l!==0||!rd(i,r,e))||!(u!==0||!rd(i,n,e))||!(p!==0||!rd(r,i,n))||!(f!==0||!rd(r,e,n))}function rd(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function nd(i){return i>0?1:i<0?-1:0}function lu(i,e){return er(i.prev,i,i.next)<0?er(i,e,i.next)>=0&&er(i,i.prev,e)>=0:er(i,e,i.prev)<0||er(i,i.next,e)<0}function J_(i,e){var r=new nf(i.i,i.x,i.y),n=new nf(e.i,e.x,e.y),l=i.next,u=e.prev;return i.next=e,e.prev=i,r.next=l,l.prev=r,n.next=r,r.prev=n,u.next=n,n.prev=u,n}function eg(i,e,r,n){var l=new nf(i,e,r);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function cu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function nf(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function of(i,e,r,n){for(var l=0,u=e,p=r-n;u<r;u+=n)l+=(i[p]-i[u])*(i[u+1]+i[p+1]),p=u;return l}function FA(i,e,r,n,l){tg(i,e,r||0,n||i.length-1,l||OA)}function tg(i,e,r,n,l){for(;n>r;){if(n-r>600){var u=n-r+1,p=e-r+1,f=Math.log(u),x=.5*Math.exp(2*f/3),b=.5*Math.sqrt(f*x*(u-x)/u)*(p-u/2<0?-1:1);tg(i,e,Math.max(r,Math.floor(e-p*x/u+b)),Math.min(n,Math.floor(e+(u-p)*x/u+b)),l)}var T=i[e],I=r,M=n;for(uu(i,r,e),l(i[n],T)>0&&uu(i,r,n);I<M;){for(uu(i,I,M),I++,M--;l(i[I],T)<0;)I++;for(;l(i[M],T)>0;)M--}l(i[r],T)===0?uu(i,r,M):uu(i,++M,n),M<=e&&(r=M+1),e<=M&&(n=M-1)}}function uu(i,e,r){var n=i[e];i[e]=i[r],i[r]=n}function OA(i,e){return i<e?-1:i>e?1:0}function sf(i,e){const r=i.length;if(r<=1)return[i];const n=[];let l,u;for(let p=0;p<r;p++){const f=Ue(i[p]);f!==0&&(i[p].area=Math.abs(f),u===void 0&&(u=f<0),u===f<0?(l&&n.push(l),l=[i[p]]):l.push(i[p]))}if(l&&n.push(l),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(FA(n[p],e,1,n[p].length-1,UA),n[p]=n[p].slice(0,e));return n}function UA(i,e){return e.area-i.area}function af(i,e,r){const n=r.patternDependencies;let l=!1;for(const u of e){const p=u.paint.get(`${i}-pattern`);p.isConstant()||(l=!0);const f=p.constantOr(null);f&&(l=!0,n[f.to]=!0,n[f.from]=!0)}return l}function lf(i,e,r,n,l){const u=l.patternDependencies;for(const p of e){const f=p.paint.get(`${i}-pattern`).value;if(f.kind!=="constant"){let x=f.evaluate({zoom:n-1},r,{},l.availableImages),b=f.evaluate({zoom:n},r,{},l.availableImages),T=f.evaluate({zoom:n+1},r,{},l.availableImages);x=x&&x.name?x.name:x,b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,u[x]=!0,u[b]=!0,u[T]=!0,r.patterns[p.id]={min:x,mid:b,max:T}}}return r}td.deviation=function(i,e,r,n){var l=e&&e.length,u=Math.abs(of(i,0,l?e[0]*r:i.length,r));if(l)for(var p=0,f=e.length;p<f;p++)u-=Math.abs(of(i,e[p]*r,p<f-1?e[p+1]*r:i.length,r));var x=0;for(p=0;p<n.length;p+=3){var b=n[p]*r,T=n[p+1]*r,I=n[p+2]*r;x+=Math.abs((i[b]-i[I])*(i[T+1]-i[b+1])-(i[b]-i[T])*(i[I+1]-i[b+1]))}return u===0&&x===0?0:Math.abs((x-u)/u)},td.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,l=0;l<i.length;l++){for(var u=0;u<i[l].length;u++)for(var p=0;p<e;p++)r.vertices.push(i[l][u][p]);l>0&&r.holes.push(n+=i[l-1].length)}return r},ed.default=IA;class od{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new te,this.indexArray=new lt,this.indexArray2=new Ut,this.programConfigurations=new Ta(e.layers,e.zoom),this.segments=new Wi,this.segments2=new Wi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,n,l){this.hasPattern=af("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:f,id:x,index:b,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,M=Sa(f,I);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),M,n))continue;const D=u?u.evaluate(M,{},n,r.availableImages):void 0,U={id:x,properties:f.properties,type:f.type,sourceLayerIndex:T,index:b,geometry:I?M.geometry:Xo(f,n,l),patterns:{},sortKey:D};p.push(U)}u&&p.sort((f,x)=>f.sortKey-x.sortKey);for(const f of p){const{geometry:x,index:b,sourceLayerIndex:T}=f;if(this.hasPattern){const I=lf("fill",this.layers,f,this.zoom,r);this.patternFeatures.push(I)}else this.addFeature(f,x,b,n,{},r.availableImages);r.featureIndex.insert(e[b].feature,x,b,T,this.index)}}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}addFeatures(e,r,n,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,l,u,p=[]){for(const f of sf(r,500)){let x=0;for(const U of f)x+=U.length;const b=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),T=b.vertexLength,I=[],M=[];for(const U of f){if(U.length===0)continue;U!==f[0]&&M.push(I.length/2);const $=this.segments2.prepareSegment(U.length,this.layoutVertexArray,this.indexArray2),W=$.vertexLength;this.layoutVertexArray.emplaceBack(U[0].x,U[0].y),this.indexArray2.emplaceBack(W+U.length-1,W),I.push(U[0].x),I.push(U[0].y);for(let K=1;K<U.length;K++)this.layoutVertexArray.emplaceBack(U[K].x,U[K].y),this.indexArray2.emplaceBack(W+K-1,W+K),I.push(U[K].x),I.push(U[K].y);$.vertexLength+=U.length,$.primitiveLength+=U.length}const D=ed(I,M);for(let U=0;U<D.length;U+=3)this.indexArray.emplaceBack(T+D[U],T+D[U+1],T+D[U+2]);b.vertexLength+=x,b.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}}st(od,"FillBucket",{omit:["layers","patternFeatures"]});const VA=new F({"fill-sort-key":new E(we.layout_fill["fill-sort-key"])});var jA={paint:new F({"fill-antialias":new v(we.paint_fill["fill-antialias"]),"fill-opacity":new E(we.paint_fill["fill-opacity"]),"fill-color":new E(we.paint_fill["fill-color"]),"fill-outline-color":new E(we.paint_fill["fill-outline-color"]),"fill-translate":new v(we.paint_fill["fill-translate"]),"fill-translate-anchor":new v(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new C(we.paint_fill["fill-pattern"])}),layout:VA};const NA=re([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),$A=re([{name:"a_centroid_pos",components:2,type:"Uint16"}]),GA=re([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ZA}=NA;var ig=Ll;function Ll(i,e,r,n,l){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=l,i.readFields(qA,this,e)}function qA(i,e,r){i==1?e.id=r.readVarint():i==2?function(n,l){for(var u=n.readVarint()+n.pos;n.pos<u;){var p=l._keys[n.readVarint()],f=l._values[n.readVarint()];l.properties[p]=f}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function WA(i){for(var e,r,n=0,l=0,u=i.length,p=u-1;l<u;p=l++)n+=((r=i[p]).x-(e=i[l]).x)*(e.y+r.y);return n}Ll.types=["Unknown","Point","LineString","Polygon"],Ll.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,n=1,l=0,u=0,p=0,f=[];i.pos<r;){if(l<=0){var x=i.readVarint();n=7&x,l=x>>3}if(l--,n===1||n===2)u+=i.readSVarint(),p+=i.readSVarint(),n===1&&(e&&f.push(e),e=[]),e.push(new B(u,p));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&f.push(e),f},Ll.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,n=0,l=0,u=0,p=1/0,f=-1/0,x=1/0,b=-1/0;i.pos<e;){if(n<=0){var T=i.readVarint();r=7&T,n=T>>3}if(n--,r===1||r===2)(l+=i.readSVarint())<p&&(p=l),l>f&&(f=l),(u+=i.readSVarint())<x&&(x=u),u>b&&(b=u);else if(r!==7)throw new Error("unknown command "+r)}return[p,x,f,b]},Ll.prototype.toGeoJSON=function(i,e,r){var n,l,u=this.extent*Math.pow(2,r),p=this.extent*i,f=this.extent*e,x=this.loadGeometry(),b=Ll.types[this.type];function T(D){for(var U=0;U<D.length;U++){var $=D[U];D[U]=[360*($.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+f)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(n=0;n<x.length;n++)I[n]=x[n][0];T(x=I);break;case 2:for(n=0;n<x.length;n++)T(x[n]);break;case 3:for(x=function(D){var U=D.length;if(U<=1)return[D];for(var $,W,K=[],ae=0;ae<U;ae++){var he=WA(D[ae]);he!==0&&(W===void 0&&(W=he<0),W===he<0?($&&K.push($),$=[D[ae]]):$.push(D[ae]))}return $&&K.push($),K}(x),n=0;n<x.length;n++)for(l=0;l<x[n].length;l++)T(x[n][l])}x.length===1?x=x[0]:b="Multi"+b;var M={type:"Feature",geometry:{type:b,coordinates:x},properties:this.properties};return"id"in this&&(M.id=this.id),M};var rg=ng;function ng(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(XA,this,e),this.length=this._features.length}function XA(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(n){for(var l=null,u=n.readVarint()+n.pos;n.pos<u;){var p=n.readVarint()>>3;l=p===1?n.readString():p===2?n.readFloat():p===3?n.readDouble():p===4?n.readVarint64():p===5?n.readVarint():p===6?n.readSVarint():p===7?n.readBoolean():null}return l}(r))}function HA(i,e,r){if(i===3){var n=new rg(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}ng.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new ig(this._pbf,e,this.extent,this._keys,this._values)};var Ma={VectorTile:function(i,e){this.layers=i.readFields(HA,{},e)},VectorTileFeature:ig,VectorTileLayer:rg};function sd(i,e,r,n){const l=[],u=n===0?(p,f,x,b,T,I)=>{p.push(new B(I,x+(I-f)/(b-f)*(T-x)))}:(p,f,x,b,T,I)=>{p.push(new B(f+(I-x)/(T-x)*(b-f),I))};for(const p of i){const f=[];for(const x of p){if(x.length<=2)continue;const b=[];for(let M=0;M<x.length-1;M++){const D=x[M].x,U=x[M].y,$=x[M+1].x,W=x[M+1].y,K=n===0?D:U,ae=n===0?$:W;K<e?ae>e&&u(b,D,U,$,W,e):K>r?ae<r&&u(b,D,U,$,W,r):b.push(x[M]),ae<e&&K>=e&&u(b,D,U,$,W,e),ae>r&&K<=r&&u(b,D,U,$,W,r)}let T=x[x.length-1];const I=n===0?T.x:T.y;I>=e&&I<=r&&b.push(T),b.length&&(T=b[b.length-1],b[0].x===T.x&&b[0].y===T.y||b.push(b[0]),f.push(b))}f.length&&l.push(f)}return l}const QA=Ma.VectorTileFeature.types,YA=Math.pow(2,13);function hu(i,e,r,n,l,u,p,f){i.emplaceBack((e<<1)+p,(r<<1)+u,(Math.floor(n*YA)<<1)+l,Math.round(f))}function du(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class og{constructor(){this.acc=new B(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new B(e.x,e.y),this.max=new B(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,l=this.max;e.x<n.x?n.x=e.x:e.x>l.x&&(l.x=e.x),e.y<n.y?n.y=e.y:e.y>l.y&&(l.y=e.y),((e.x===0||e.x===Gt)&&e.x===r.x)!=((e.y===0||e.y===Gt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,St(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Gt!=e.x>Gt&&this.addBorderIntersection(1,St(r.y,e.y,(Gt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,St(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Gt!=e.y>Gt&&this.addBorderIntersection(3,St(r.x,e.x,(Gt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new B(0,0)}span(){return new B(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class pu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new oe,this.centroidVertexArray=new Ea,this.indexArray=new lt,this.programConfigurations=new Ta(e.layers,e.zoom),this.segments=new Wi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n,l){this.features=[],this.hasPattern=af("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const p=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*p/(p*p+1)/Gt/(1<<u.z)}(n);for(const{feature:u,id:p,index:f,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,T=Sa(u,b);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),T,n))continue;const I={id:p,sourceLayerIndex:x,index:f,geometry:b?T.geometry:Xo(u,n,l),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(lf("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,f,n,{},r.availableImages,l),r.featureIndex.insert(u,I.geometry,f,x,this.index,M)}this.sortBorders()}addFeatures(e,r,n,l,u){for(const p of this.features){const{geometry:f}=p;this.addFeature(p,f,p.index,r,n,l,u)}this.sortBorders()}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ZA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,GA.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,$A.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,l,u,p,f){const x=[new B(0,0),new B(Gt,Gt)],b=f.projection,T=b.name==="globe",I=this.enableTerrain&&!T?new og:null;T&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Zr);const M=sf(r,500);for(let $=M.length-1;$>=0;$--){const W=M[$];(W.length===0||(D=W[0]).every(K=>K.x<=0)||D.every(K=>K.x>=Gt)||D.every(K=>K.y<=0)||D.every(K=>K.y>=Gt))&&M.splice($,1)}var D;let U;if(T){const W=1<<l.z,K=Ln(l.x/W),ae=Ln((l.x+1)/W),he=wr(l.y/W),pe=wr((l.y+1)/W);U=function(fe,me,Ie,ke,Le=0,Oe){const Te=[];if(!fe.length||!Ie||!ke)return Te;const De=(Nt,Wt)=>{for(const _t of Nt)Te.push({polygon:_t,bounds:Wt})},je=Math.ceil(Math.log2(Ie)),Qe=Math.ceil(Math.log2(ke)),Ge=je-Qe,He=[];for(let Nt=0;Nt<Math.abs(Ge);Nt++)He.push(Ge>0?0:1);for(let Nt=0;Nt<Math.min(je,Qe);Nt++)He.push(0),He.push(1);let jt=fe;if(jt=sd(jt,me[0].y-Le,me[1].y+Le,1),jt=sd(jt,me[0].x-Le,me[1].x+Le,0),!jt.length)return Te;const Qt=[];for(He.length?Qt.push({polygons:jt,bounds:me,depth:0}):De(jt,me);Qt.length;){const Nt=Qt.pop(),Wt=Nt.depth,_t=He[Wt],ot=Nt.bounds[0],ei=Nt.bounds[1],gi=_t===0?ot.x:ot.y,nr=_t===0?ei.x:ei.y,Pi=Oe?Oe(_t,gi,nr):.5*(gi+nr),or=sd(Nt.polygons,gi-Le,Pi+Le,_t),yi=sd(Nt.polygons,Pi-Le,nr+Le,_t);if(or.length){const ri=[ot,new B(_t===0?Pi:ei.x,_t===1?Pi:ei.y)];He.length>Wt+1?Qt.push({polygons:or,bounds:ri,depth:Wt+1}):De(or,ri)}if(yi.length){const ri=[new B(_t===0?Pi:ot.x,_t===1?Pi:ot.y),ei];He.length>Wt+1?Qt.push({polygons:yi,bounds:ri,depth:Wt+1}):De(yi,ri)}}return Te}(M,x,Math.ceil((ae-K)/11.25),Math.ceil((he-pe)/11.25),1,(fe,me,Ie)=>{if(fe===0)return .5*(me+Ie);{const ke=wr((l.y+me/Gt)/W);return(Cl(.5*(wr((l.y+Ie/Gt)/W)+ke))*W-l.y)*Gt}})}else{U=[];for(const $ of M)U.push({polygon:$,bounds:x})}for(const $ of U){const W=$.polygon;let K=0,ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Ie=0;Ie<W.length;Ie++){const ke=W[Ie];if(ke.length===0)continue;K+=ke.length;let Le=0;I&&I.startRing(ke[0]);for(let Oe=0;Oe<ke.length;Oe++){const Te=ke[Oe];if(Oe>=1){const De=ke[Oe-1];if(!KA(Te,De,$.bounds)){I&&I.append(Te,De),ae.vertexLength+4>Wi.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const je=Te.sub(De)._perp(),Qe=je.x/(Math.abs(je.x)+Math.abs(je.y)),Ge=je.y>0?1:0,He=De.dist(Te);Le+He>32768&&(Le=0),hu(this.layoutVertexArray,Te.x,Te.y,Qe,Ge,0,0,Le),hu(this.layoutVertexArray,Te.x,Te.y,Qe,Ge,0,1,Le),Le+=He,hu(this.layoutVertexArray,De.x,De.y,Qe,Ge,0,0,Le),hu(this.layoutVertexArray,De.x,De.y,Qe,Ge,0,1,Le);const jt=ae.vertexLength;if(this.indexArray.emplaceBack(jt,jt+2,jt+1),this.indexArray.emplaceBack(jt+1,jt+2,jt+3),ae.vertexLength+=4,ae.primitiveLength+=2,T){const Qt=this.layoutVertexExtArray,Nt=b.projectTilePoint(Te.x,Te.y,l),Wt=b.projectTilePoint(De.x,De.y,l),_t=b.upVector(l,Te.x,Te.y),ot=b.upVector(l,De.x,De.y);du(Qt,Nt,_t),du(Qt,Nt,_t),du(Qt,Wt,ot),du(Qt,Wt,ot)}}}}}if(ae.vertexLength+K>Wi.MAX_VERTEX_ARRAY_LENGTH&&(ae=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray)),QA[e.type]!=="Polygon")continue;const he=[],pe=[],fe=ae.vertexLength;for(let Ie=0;Ie<W.length;Ie++){const ke=W[Ie];if(ke.length!==0){ke!==W[0]&&pe.push(he.length/2);for(let Le=0;Le<ke.length;Le++){const Oe=ke[Le];hu(this.layoutVertexArray,Oe.x,Oe.y,0,0,1,1,0),he.push(Oe.x),he.push(Oe.y),I&&I.currentPolyCount.top++,T&&du(this.layoutVertexExtArray,b.projectTilePoint(Oe.x,Oe.y,l),b.upVector(l,Oe.x,Oe.y))}}}const me=ed(he,pe);for(let Ie=0;Ie<me.length;Ie+=3)this.indexArray.emplaceBack(fe+me[Ie],fe+me[Ie+2],fe+me[Ie+1]);ae.primitiveLength+=me.length/3,ae.vertexLength+=K}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const $=I.borders,W=this.featuresOnBorder.push(I)-1;for(let K=0;K<4;K++)$[K][0]!==Number.MAX_VALUE&&this.borders[K].push(W)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let l,u;if(e)if(e.y!==0){const f=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(f.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(f.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+n;let p=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(const f of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*f.edges+f.top);for(let x=0;x<2*f.edges;x++)this.centroidVertexArray.emplace(p++,0,u),this.centroidVertexArray.emplace(p++,l,u);for(let x=0;x<f.top;x++)this.centroidVertexArray.emplace(p++,l,u)}}}function KA(i,e,r){return i.x===e.x&&(i.x<r[0].x||i.x>r[1].x)||i.y===e.y&&(i.y<r[0].y||i.y>r[1].y)}st(pu,"FillExtrusionBucket",{omit:["layers","features"]}),st(og,"PartMetadata");var JA={paint:new F({"fill-extrusion-opacity":new v(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new E(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new v(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new v(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new C(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new E(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new E(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new v(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function fu(i,e){return i.x*e.x+i.y*e.y}function sg(i,e){if(i.length===1){let r=0;const n=e[r++];let l;for(;!l||n.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const u=e[r],p=i[0],f=l.sub(n),x=u.sub(n),b=p.sub(n),T=fu(f,f),I=fu(f,x),M=fu(x,x),D=fu(b,f),U=fu(b,x),$=T*M-I*I,W=(M*D-I*U)/$,K=(T*U-I*D)/$,ae=n.z*(1-W-K)+l.z*W+u.z*K;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function ag(i){const e=new B(i[0],i[1]);return e.z=i[2],e}function e1(i,e,r,n,l,u,p,f){const x=p*l.getElevationAt(i,e,!0,!0),b=u[0]!==0,T=b?u[1]===0?p*(u[0]/7-450):p*function(I,M,D){const U=Math.floor(M[0]/8),$=Math.floor(M[1]/8),W=10*(M[0]-8*U),K=10*(M[1]-8*$),ae=I.getElevationAt(U,$,!0,!0),he=I.getMeterToDEM(D),pe=Math.floor(.5*(W*he-1)),fe=Math.floor(.5*(K*he-1)),me=I.tileCoordToPixel(U,$),Ie=2*pe+1,ke=2*fe+1,Le=function(Ge,He,jt,Qt,Nt){return[Ge.getElevationAtPixel(He,jt,!0),Ge.getElevationAtPixel(He+Nt,jt,!0),Ge.getElevationAtPixel(He,jt+Nt,!0),Ge.getElevationAtPixel(He+Qt,jt+Nt,!0)]}(I,me.x-pe,me.y-fe,Ie,ke),Oe=Math.abs(Le[0]-Le[1]),Te=Math.abs(Le[2]-Le[3]),De=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),je=Math.min(.25,.5*he*(Oe+Te)/Ie),Qe=Math.min(.25,.5*he*De/ke);return ae+Math.max(je*W,Qe*K)}(l,u,f):x;return{base:x+(r===0)?-1:r,top:b?Math.max(T+n,x+r+2):x+n}}const t1=re([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:i1}=t1,r1=re([{name:"a_packed",components:3,type:"Float32"}]),{members:n1}=r1,o1=Ma.VectorTileFeature.types,s1=Math.cos(Math.PI/180*37.5);class ad{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ee,this.layoutVertexArray2=new Ze,this.indexArray=new lt,this.programConfigurations=new Ta(e.layers,e.zoom),this.segments=new Wi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,l){this.hasPattern=af("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:T,id:I,index:M,sourceLayerIndex:D}of e){const U=this.layers[0]._featureFilter.needGeometry,$=Sa(T,U);if(!this.layers[0]._featureFilter.filter(new zi(this.zoom),$,n))continue;const W=u?u.evaluate($,{},n):void 0,K={id:I,properties:T.properties,type:T.type,sourceLayerIndex:D,index:M,geometry:U?$.geometry:Xo(T,n,l),patterns:{},sortKey:W};p.push(K)}u&&p.sort((T,I)=>T.sortKey-I.sortKey);const{lineAtlas:f,featureIndex:x}=r,b=this.addConstantDashes(f);for(const T of p){const{geometry:I,index:M,sourceLayerIndex:D}=T;if(b&&this.addFeatureDashes(T,f),this.hasPattern){const U=lf("line",this.layers,T,this.zoom,r);this.patternFeatures.push(U)}else this.addFeature(T,I,M,n,f.positions,r.availableImages);x.insert(e[M].feature,I,M,D,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const l=n.paint.get("line-dasharray").value,u=n.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")r=!0;else{const p=u.value,f=l.value;if(!f)continue;e.addDash(f.from,p),e.addDash(f.to,p),f.other&&e.addDash(f.other,p)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let f,x,b,T,I,M;if(u.kind==="constant"){const W=u.value;if(!W)continue;f=W.other||W.to,x=W.to,b=W.from}else f=u.evaluate({zoom:n-1},e),x=u.evaluate({zoom:n},e),b=u.evaluate({zoom:n+1},e);p.kind==="constant"?T=I=M=p.value:(T=p.evaluate({zoom:n-1},e),I=p.evaluate({zoom:n},e),M=p.evaluate({zoom:n+1},e)),r.addDash(f,T),r.addDash(x,I),r.addDash(b,M);const D=r.getKey(f,T),U=r.getKey(x,I),$=r.getKey(b,M);e.patterns[l.id]={min:D,mid:U,max:$}}}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}addFeatures(e,r,n,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,n1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,i1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,l,u,p){const f=this.layers[0].layout,x=f.get("line-join").evaluate(e,{}),b=f.get("line-cap").evaluate(e,{}),T=f.get("line-miter-limit"),I=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of r)this.addLine(M,e,x,b,T,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,l)}addLine(e,r,n,l,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let K=0;K<e.length-1;K++)this.totalDistance+=e[K].dist(e[K+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const f=o1[r.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let b=0;for(;b<x-1&&e[b].equals(e[b+1]);)b++;if(x<(f?3:2))return;n==="bevel"&&(u=1.05);const T=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,D,U,$,W;this.e1=this.e2=-1,f&&(M=e[x-2],W=e[b].sub(M)._unit()._perp());for(let K=b;K<x;K++){if(U=K===x-1?f?e[b+1]:void 0:e[K+1],U&&e[K].equals(U))continue;W&&($=W),M&&(D=M),M=e[K],W=U?U.sub(M)._unit()._perp():$,$=$||W;let ae=$.add(W);ae.x===0&&ae.y===0||ae._unit();const he=$.x*W.x+$.y*W.y,pe=ae.x*W.x+ae.y*W.y,fe=pe!==0?1/pe:1/0,me=2*Math.sqrt(2-2*pe),Ie=pe<s1&&D&&U,ke=$.x*W.y-$.y*W.x>0;if(Ie&&K>b){const Te=M.dist(D);if(Te>2*T){const De=M.sub(M.sub(D)._mult(T/Te)._round());this.updateDistance(D,De),this.addCurrentVertex(De,$,0,0,I),D=De}}const Le=D&&U;let Oe=Le?n:f?"butt":l;if(Le&&Oe==="round"&&(fe<p?Oe="miter":fe<=2&&(Oe="fakeround")),Oe==="miter"&&fe>u&&(Oe="bevel"),Oe==="bevel"&&(fe>2&&(Oe="flipbevel"),fe<u&&(Oe="miter")),D&&this.updateDistance(D,M),Oe==="miter")ae._mult(fe),this.addCurrentVertex(M,ae,0,0,I);else if(Oe==="flipbevel"){if(fe>100)ae=W.mult(-1);else{const Te=fe*$.add(W).mag()/$.sub(W).mag();ae._perp()._mult(Te*(ke?-1:1))}this.addCurrentVertex(M,ae,0,0,I),this.addCurrentVertex(M,ae.mult(-1),0,0,I)}else if(Oe==="bevel"||Oe==="fakeround"){const Te=-Math.sqrt(fe*fe-1),De=ke?Te:0,je=ke?0:Te;if(D&&this.addCurrentVertex(M,$,De,je,I),Oe==="fakeround"){const Qe=Math.round(180*me/Math.PI/20);for(let Ge=1;Ge<Qe;Ge++){let He=Ge/Qe;if(He!==.5){const Qt=He-.5;He+=He*Qt*(He-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Qt*Qt+(.848013+he*(.215638*he-1.06021)))}const jt=W.sub($)._mult(He)._add($)._unit()._mult(ke?-1:1);this.addHalfVertex(M,jt.x,jt.y,!1,ke,0,I)}}U&&this.addCurrentVertex(M,W,-De,-je,I)}else if(Oe==="butt")this.addCurrentVertex(M,ae,0,0,I);else if(Oe==="square"){const Te=D?1:-1;D||this.addCurrentVertex(M,ae,Te,Te,I),this.addCurrentVertex(M,ae,0,0,I),D&&this.addCurrentVertex(M,ae,Te,Te,I)}else Oe==="round"&&(D&&(this.addCurrentVertex(M,$,0,0,I),this.addCurrentVertex(M,$,1,1,I,!0)),U&&(this.addCurrentVertex(M,W,-1,-1,I,!0),this.addCurrentVertex(M,W,0,0,I)));if(Ie&&K<x-1){const Te=M.dist(U);if(Te>2*T){const De=M.add(U.sub(M)._mult(T/Te)._round());this.updateDistance(M,De),this.addCurrentVertex(De,W,0,0,I),M=De}}}}addCurrentVertex(e,r,n,l,u,p=!1){const f=r.y*l-r.x,x=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,p,!1,n,u),this.addHalfVertex(e,f,x,p,!0,-l,u)}addHalfVertex({x:e,y:r},n,l,u,p,f,x){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*n)+128,Math.round(63*l)+128,1+(f===0?0:f<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const b=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),x.primitiveLength++),p?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}st(ad,"LineBucket",{omit:["layers","patternFeatures"]});const a1=new F({"line-cap":new E(we.layout_line["line-cap"]),"line-join":new E(we.layout_line["line-join"]),"line-miter-limit":new v(we.layout_line["line-miter-limit"]),"line-round-limit":new v(we.layout_line["line-round-limit"]),"line-sort-key":new E(we.layout_line["line-sort-key"])});var lg={paint:new F({"line-opacity":new E(we.paint_line["line-opacity"]),"line-color":new E(we.paint_line["line-color"]),"line-translate":new v(we.paint_line["line-translate"]),"line-translate-anchor":new v(we.paint_line["line-translate-anchor"]),"line-width":new E(we.paint_line["line-width"]),"line-gap-width":new E(we.paint_line["line-gap-width"]),"line-offset":new E(we.paint_line["line-offset"]),"line-blur":new E(we.paint_line["line-blur"]),"line-dasharray":new C(we.paint_line["line-dasharray"]),"line-pattern":new C(we.paint_line["line-pattern"]),"line-gradient":new P(we.paint_line["line-gradient"])}),layout:a1};const cg=new class extends E{possiblyEvaluate(i,e){return e=new zi(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,n){return e=It({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,n)}}(lg.paint.properties["line-width"].specification);function ug(i,e){return e>0?e+2*i:i}cg.useIntegerZoom=!0;const l1=re([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),c1=re([{name:"a_projected_pos",components:3,type:"Float32"}],4);re([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const u1=re([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),h1=re([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hg=re([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),d1=re([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);re([{name:"triangle",components:3,type:"Uint16"}]),re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),re([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),re([{type:"Float32",name:"offsetX"}]),re([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Er=24;const yo=128;function cf(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new zi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:l}=r;let u=0;for(;u<n.length&&n[u]<=i;)u++;u=Math.max(0,u-1);let p=u;for(;p<n.length&&n[p]<i+1;)p++;p=Math.min(n.length-1,p);const f=n[u],x=n[p];return r.kind==="composite"?{kind:"composite",minZoom:f,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:f,maxZoom:x,minSize:r.evaluate(new zi(f)),maxSize:r.evaluate(new zi(x)),interpolationType:l}}}function ld(i,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:l}){return i.kind==="source"?n/yo:i.kind==="composite"?St(n/yo,l/yo,r):e}function Rl(i,e){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:p}=i,f=l?Ke(Nr.interpolationFactor(l,e,u,p),0,1):0;i.kind==="camera"?n=St(i.minSize,i.maxSize,f):r=f}return{uSizeT:r,uSize:n}}var p1=Object.freeze({__proto__:null,getSizeData:cf,evaluateSizeForFeature:ld,evaluateSizeForZoom:Rl,SIZE_PACK_FACTOR:yo});function f1(i,e,r){return i.sections.forEach(n=>{n.text=function(l,u,p){const f=u.layout.get("text-transform").evaluate(p,{});return f==="uppercase"?l=l.toLocaleUpperCase():f==="lowercase"&&(l=l.toLocaleLowerCase()),en.applyArabicShaping&&(l=en.applyArabicShaping(l)),l}(n.text,e,r)}),i}const mu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function m1(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function _1(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var dg=function(i,e,r,n,l){var u,p,f=8*l-n-1,x=(1<<f)-1,b=x>>1,T=-7,I=r?l-1:0,M=r?-1:1,D=i[e+I];for(I+=M,u=D&(1<<-T)-1,D>>=-T,T+=f;T>0;u=256*u+i[e+I],I+=M,T-=8);for(p=u&(1<<-T)-1,u>>=-T,T+=n;T>0;p=256*p+i[e+I],I+=M,T-=8);if(u===0)u=1-b;else{if(u===x)return p?NaN:1/0*(D?-1:1);p+=Math.pow(2,n),u-=b}return(D?-1:1)*p*Math.pow(2,u-n)},pg=function(i,e,r,n,l,u){var p,f,x,b=8*u-l-1,T=(1<<b)-1,I=T>>1,M=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=n?0:u-1,U=n?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(f=isNaN(e)?1:0,p=T):(p=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-p))<1&&(p--,x*=2),(e+=p+I>=1?M/x:M*Math.pow(2,1-I))*x>=2&&(p++,x/=2),p+I>=T?(f=0,p=T):p+I>=1?(f=(e*x-1)*Math.pow(2,l),p+=I):(f=e*Math.pow(2,I-1)*Math.pow(2,l),p=0));l>=8;i[r+D]=255&f,D+=U,f/=256,l-=8);for(p=p<<l|f,b+=l;b>0;i[r+D]=255&p,D+=U,p/=256,b-=8);i[r+D-U]|=128*$},_u=Mi;function Mi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Mi.Varint=0,Mi.Fixed64=1,Mi.Bytes=2,Mi.Fixed32=5;var uf=4294967296,fg=1/uf,mg=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Qo(i){return i.type===Mi.Bytes?i.readVarint()+i.pos:i.pos+1}function Fl(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function _g(i,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var l=r.pos-1;l>=i;l--)r.buf[l+n]=r.buf[l]}function g1(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function y1(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function x1(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function v1(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function A1(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function b1(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function w1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function E1(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function T1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function cd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ol(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function gg(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function S1(i,e,r){e.glyphs=[],i===1&&r.readMessage(I1,e)}function I1(i,e,r){if(i===3){const{id:n,bitmap:l,width:u,height:p,left:f,top:x,advance:b}=r.readMessage(C1,{});e.glyphs.push({id:n,bitmap:new Ho({width:u+6,height:p+6},l),metrics:{width:u,height:p,left:f,top:x,advance:b}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function C1(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function hf(i){let e=0,r=0;for(const p of i)e+=p.w*p.h,r=Math.max(r,p.w);i.sort((p,f)=>f.h-p.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,u=0;for(const p of i)for(let f=n.length-1;f>=0;f--){const x=n[f];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,u=Math.max(u,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===x.w&&p.h===x.h){const b=n.pop();f<n.length&&(n[f]=b)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(n.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}Mi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),l=n>>3,u=this.pos;this.type=7&n,i(l,e,this),this.pos===u&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=cd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=gg(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=cd(this.buf,this.pos)+cd(this.buf,this.pos+4)*uf;return this.pos+=8,i},readSFixed64:function(){var i=cd(this.buf,this.pos)+gg(this.buf,this.pos+4)*uf;return this.pos+=8,i},readFloat:function(){var i=dg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=dg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(l,u,p){var f,x,b=p.buf;if(f=(112&(x=b[p.pos++]))>>4,x<128||(f|=(127&(x=b[p.pos++]))<<3,x<128)||(f|=(127&(x=b[p.pos++]))<<10,x<128)||(f|=(127&(x=b[p.pos++]))<<17,x<128)||(f|=(127&(x=b[p.pos++]))<<24,x<128)||(f|=(1&(x=b[p.pos++]))<<31,x<128))return Fl(l,f,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&mg?function(r,n,l){return mg.decode(r.subarray(n,l))}(this.buf,e,i):function(r,n,l){for(var u="",p=n;p<l;){var f,x,b,T=r[p],I=null,M=T>239?4:T>223?3:T>191?2:1;if(p+M>l)break;M===1?T<128&&(I=T):M===2?(192&(f=r[p+1]))==128&&(I=(31&T)<<6|63&f)<=127&&(I=null):M===3?(x=r[p+2],(192&(f=r[p+1]))==128&&(192&x)==128&&((I=(15&T)<<12|(63&f)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):M===4&&(x=r[p+2],b=r[p+3],(192&(f=r[p+1]))==128&&(192&x)==128&&(192&b)==128&&((I=(15&T)<<18|(63&f)<<12|(63&x)<<6|63&b)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,M=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),p+=M}return u}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Mi.Bytes)return i.push(this.readVarint(e));var r=Qo(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Mi.Bytes)return i.push(this.readSVarint());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Mi.Bytes)return i.push(this.readBoolean());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Mi.Bytes)return i.push(this.readFloat());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Mi.Bytes)return i.push(this.readDouble());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Mi.Bytes)return i.push(this.readFixed32());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Mi.Bytes)return i.push(this.readSFixed32());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Mi.Bytes)return i.push(this.readFixed64());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Mi.Bytes)return i.push(this.readSFixed64());var e=Qo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Mi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Mi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Mi.Fixed32)this.pos+=4;else{if(e!==Mi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ol(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ol(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ol(this.buf,-1&i,this.pos),Ol(this.buf,Math.floor(i*fg),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ol(this.buf,-1&i,this.pos),Ol(this.buf,Math.floor(i*fg),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var n,l;if(e>=0?(n=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,p,f){f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,u>>>=7,f.buf[f.pos++]=127&u|128,f.buf[f.pos]=127&(u>>>=7)}(n,0,r),function(u,p){var f=(7&u)<<4;p.buf[p.pos++]|=f|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(l,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,l,u){for(var p,f,x=0;x<l.length;x++){if((p=l.charCodeAt(x))>55295&&p<57344){if(!f){p>56319||x+1===l.length?(n[u++]=239,n[u++]=191,n[u++]=189):f=p;continue}if(p<56320){n[u++]=239,n[u++]=191,n[u++]=189,f=p;continue}p=f-55296<<10|p-56320|65536,f=null}else f&&(n[u++]=239,n[u++]=191,n[u++]=189,f=null);p<128?n[u++]=p:(p<2048?n[u++]=p>>6|192:(p<65536?n[u++]=p>>12|224:(n[u++]=p>>18|240,n[u++]=p>>12&63|128),n[u++]=p>>6&63|128),n[u++]=63&p|128)}return u}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&_g(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),pg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),pg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var n=this.pos-r;n>=128&&_g(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,r){this.writeTag(i,Mi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,g1,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,y1,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,A1,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,x1,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,v1,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,b1,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,w1,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,E1,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,T1,e)},writeBytesField:function(i,e){this.writeTag(i,Mi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Mi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Mi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Mi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Mi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Mi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Mi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Mi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Mi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Mi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class df{constructor(e,{pixelRatio:r,version:n,stretchX:l,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=p,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class yg{constructor(e,r){const n={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,n,u),this.addImages(r,l,u);const{w:p,h:f}=hf(u),x=new nn({width:p||1,height:f||1});for(const b in e){const T=e[b],I=n[b].paddedRect;nn.copy(T.data,x,{x:0,y:0},{x:I.x+1,y:I.y+1},T.data)}for(const b in r){const T=r[b],I=l[b].paddedRect,M=I.x+1,D=I.y+1,U=T.data.width,$=T.data.height;nn.copy(T.data,x,{x:0,y:0},{x:M,y:D},T.data),nn.copy(T.data,x,{x:0,y:$-1},{x:M,y:D-1},{width:U,height:1}),nn.copy(T.data,x,{x:0,y:0},{x:M,y:D+$},{width:U,height:1}),nn.copy(T.data,x,{x:U-1,y:0},{x:M-1,y:D},{width:1,height:$}),nn.copy(T.data,x,{x:0,y:0},{x:M+U,y:D},{width:1,height:$})}this.image=x,this.iconPositions=n,this.patternPositions=l}addImages(e,r,n){for(const l in e){const u=e[l],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};n.push(p),r[l]=new df(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,u]=e.tl;n.update(r.data,void 0,{x:l,y:u})}}st(df,"ImagePosition"),st(yg,"ImageAtlas");const Tn={horizontal:1,vertical:2,horizontalOnly:3};class gu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new gu;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new gu;return r.imageName=e,r}}class Ul{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new Ul;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?n.addImageSection(u):n.addTextSection(u,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,n){let l="";for(let u=0;u<r.length;u++){const p=r.charCodeAt(u+1)||null,f=r.charCodeAt(u-1)||null;l+=!n&&(p&&El(p)&&!mu[r[u+1]]||f&&El(f)&&!mu[r[u-1]])||!mu[r[u]]?r[u]:mu[r[u]]}return l}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&ud[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&ud[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new Ul;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(gu.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Yt("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(gu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Yt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pf(i,e,r,n,l,u,p,f,x,b,T,I,M,D,U,$){const W=Ul.fromFeature(i,l);let K;I===Tn.vertical&&W.verticalizePunctuation(M);const{processBidirectionalText:ae,processStyledBidirectionalText:he}=en;if(ae&&W.sections.length===1){K=[];const me=ae(W.toString(),ff(W,b,u,e,n,D,U));for(const Ie of me){const ke=new Ul;ke.text=Ie,ke.sections=W.sections;for(let Le=0;Le<Ie.length;Le++)ke.sectionIndex.push(0);K.push(ke)}}else if(he){K=[];const me=he(W.text,W.sectionIndex,ff(W,b,u,e,n,D,U));for(const Ie of me){const ke=new Ul;ke.text=Ie[0],ke.sectionIndex=Ie[1],ke.sections=W.sections,K.push(ke)}}else K=function(me,Ie){const ke=[],Le=me.text;let Oe=0;for(const Te of Ie)ke.push(me.substring(Oe,Te)),Oe=Te;return Oe<Le.length&&ke.push(me.substring(Oe,Le.length)),ke}(W,ff(W,b,u,e,n,D,U));const pe=[],fe={positionedLines:pe,text:W.toString(),top:T[1],bottom:T[1],left:T[0],right:T[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,Ie,ke,Le,Oe,Te,De,je,Qe,Ge,He,jt){let Qt=0,Nt=0,Wt=0;const _t=je==="right"?1:je==="left"?0:.5;let ot=!1;for(const yi of Oe){const ri=yi.getSections();for(const Ti of ri){if(Ti.imageName)continue;const Gi=Ie[Ti.fontStack];if(Gi&&(ot=Gi.ascender!==void 0&&Gi.descender!==void 0,!ot))break}if(!ot)break}let ei=0;for(const yi of Oe){yi.trim();const ri=yi.getMaxScale(),Ti=(ri-1)*Er,Gi={positionedGlyphs:[],lineOffset:0};me.positionedLines[ei]=Gi;const Xi=Gi.positionedGlyphs;let sr=0;if(!yi.length()){Nt+=Te,++ei;continue}let ur=0,an=0;for(let Si=0;Si<yi.length();Si++){const Rr=yi.getSection(Si),ln=yi.getSectionIndex(Si),vr=yi.getCharCode(Si);let hr=Rr.scale,Li=null,Di=null,Hr=null,Fr=Er,tr=0;const Or=!(Qe===Tn.horizontal||!He&&!wl(vr)||He&&(ud[vr]||(gi=vr,kh(gi)||yl(gi)||ya(gi)||qc(gi)||Al(gi))));if(Rr.imageName){const Mr=Le[Rr.imageName];if(!Mr)continue;Hr=Rr.imageName,me.iconsInText=me.iconsInText||!0,Di=Mr.paddedRect;const dr=Mr.displaySize;hr=hr*Er/jt,Li={width:dr[0],height:dr[1],left:1,top:-3,advance:Or?dr[1]:dr[0],localGlyph:!1},tr=ot?-Li.height*hr:ri*Er-17-dr[1]*hr,Fr=Li.advance;const Fn=(Or?dr[0]:dr[1])*hr-Er*ri;Fn>0&&Fn>sr&&(sr=Fn)}else{const Mr=ke[Rr.fontStack];if(!Mr)continue;Mr[vr]&&(Di=Mr[vr]);const dr=Ie[Rr.fontStack];if(!dr)continue;const Fn=dr.glyphs[vr];if(!Fn)continue;if(Li=Fn.metrics,Fr=vr!==8203?Er:0,ot){const Bs=dr.ascender!==void 0?Math.abs(dr.ascender):0,Iu=dr.descender!==void 0?Math.abs(dr.descender):0,Cu=(Bs+Iu)*hr;ur<Cu&&(ur=Cu,an=(Bs-Iu)/2*hr),tr=-Bs*hr}else tr=(ri-hr)*Er-17}Or?(me.verticalizable=!0,Xi.push({glyph:vr,imageName:Hr,x:Qt,y:Nt+tr,vertical:Or,scale:hr,localGlyph:Li.localGlyph,fontStack:Rr.fontStack,sectionIndex:ln,metrics:Li,rect:Di}),Qt+=Fr*hr+Ge):(Xi.push({glyph:vr,imageName:Hr,x:Qt,y:Nt+tr,vertical:Or,scale:hr,localGlyph:Li.localGlyph,fontStack:Rr.fontStack,sectionIndex:ln,metrics:Li,rect:Di}),Qt+=Li.advance*hr+Ge)}Xi.length!==0&&(Wt=Math.max(Qt-Ge,Wt),ot?wg(Xi,_t,sr,an,Te*ri/2):wg(Xi,_t,sr,0,Te/2)),Qt=0;const Xr=Te*ri+sr;Gi.lineOffset=Math.max(sr,Ti),Nt+=Xr,++ei}var gi;const nr=Nt,{horizontalAlign:Pi,verticalAlign:or}=mf(De);(function(yi,ri,Ti,Gi,Xi,sr){const ur=(ri-Ti)*Xi,an=-sr*Gi;for(const Xr of yi)for(const Si of Xr.positionedGlyphs)Si.x+=ur,Si.y+=an})(me.positionedLines,_t,Pi,or,Wt,nr),me.top+=-or*nr,me.bottom=me.top+nr,me.left+=-Pi*Wt,me.right=me.left+Wt,me.hasBaseline=ot}(fe,e,r,n,K,p,f,x,I,b,M,$),!function(me){for(const Ie of me)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(pe)&&fe}const ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function xg(i,e,r,n,l,u){if(e.imageName){const p=n[e.imageName];return p?p.displaySize[0]*e.scale*Er/u+l:0}{const p=r[e.fontStack],f=p&&p.glyphs[i];return f?f.metrics.advance*e.scale+l:0}}function vg(i,e,r,n){const l=Math.pow(i-e,2);return n?i<e?l/2:2*l:l+Math.abs(r)*r}function k1(i,e,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function Ag(i,e,r,n,l,u){let p=null,f=vg(e,r,l,u);for(const x of n){const b=vg(e-x.x,r,l,u)+x.badness;b<=f&&(p=x,f=b)}return{index:i,x:e,priorBreak:p,badness:f}}function bg(i){return i?bg(i.priorBreak).concat(i.index):[]}function ff(i,e,r,n,l,u,p){if(u!=="point")return[];if(!i)return[];const f=[],x=function(M,D,U,$,W,K){let ae=0;for(let he=0;he<M.length();he++){const pe=M.getSection(he);ae+=xg(M.getCharCode(he),pe,$,W,D,K)}return ae/Math.max(1,Math.ceil(ae/U))}(i,e,r,n,l,p),b=i.text.indexOf("\u200B")>=0;let T=0;for(let M=0;M<i.length();M++){const D=i.getSection(M),U=i.getCharCode(M);if(ud[U]||(T+=xg(U,D,n,l,e,p)),M<i.length()-1){const $=!((I=U)<11904||!(Dh(I)||Ph(I)||xs(I)||va(I)||Rh(I)||Nc(I)||Bh(I)||xl(I)||Fh(I)||Zc(I)||Lh(I)||Wc(I)||xa(I)||$c(I)||zh(I)||Gc(I)||vl(I)||jh(I)||Uh(I)||Oh(I)));(M1[U]||$||D.imageName)&&f.push(Ag(M+1,T,x,f,k1(U,i.getCharCode(M+1),$&&b),!1))}}var I;return bg(Ag(i.length(),T,x,f,0,!0))}function mf(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function wg(i,e,r,n,l){if(!(e||r||n||l))return;const u=i.length-1,p=i[u],f=(p.x+p.metrics.advance*p.scale)*e;for(let x=0;x<=u;x++)i[x].x-=f,i[x].y+=r+n+l}function z1(i,e,r){const{horizontalAlign:n,verticalAlign:l}=mf(r),u=e[0]-i.displaySize[0]*n,p=e[1]-i.displaySize[1]*l;return{image:i,top:p,bottom:p+i.displaySize[1],left:u,right:u+i.displaySize[0]}}function Eg(i,e,r,n,l,u){const p=i.image;let f;if(p.content){const W=p.content,K=p.pixelRatio||1;f=[W[0]/K,W[1]/K,p.displaySize[0]-W[2]/K,p.displaySize[1]-W[3]/K]}const x=e.left*u,b=e.right*u;let T,I,M,D;r==="width"||r==="both"?(D=l[0]+x-n[3],I=l[0]+b+n[1]):(D=l[0]+(x+b-p.displaySize[0])/2,I=D+p.displaySize[0]);const U=e.top*u,$=e.bottom*u;return r==="height"||r==="both"?(T=l[1]+U-n[0],M=l[1]+$+n[2]):(T=l[1]+(U+$-p.displaySize[1])/2,M=T+p.displaySize[1]),{image:p,top:T,right:I,bottom:M,left:D,collisionPadding:f}}class Yo extends B{constructor(e,r,n,l,u){super(e,r),this.angle=l,this.z=n,u!==void 0&&(this.segment=u)}clone(){return new Yo(this.x,this.y,this.z,this.angle,this.segment)}}function Tg(i,e,r,n,l){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,f=0;for(;f>-r/2;){if(p--,p<0)return!1;f-=i[p].dist(u),u=i[p]}f+=i[p].dist(i[p+1]),p++;const x=[];let b=0;for(;f<r/2;){const T=i[p],I=i[p+1];if(!I)return!1;let M=i[p-1].angleTo(T)-T.angleTo(I);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:f,angleDelta:M}),b+=M;f-x[0].distance>n;)b-=x.shift().angleDelta;if(b>l)return!1;p++,f+=T.dist(I)}return!0}function Sg(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Ig(i,e,r){return i?.6*e*r:0}function Cg(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function P1(i,e,r,n,l,u){const p=Ig(r,l,u),f=Cg(r,n)*u;let x=0;const b=Sg(i)/2;for(let T=0;T<i.length-1;T++){const I=i[T],M=i[T+1],D=I.dist(M);if(x+D>b){const U=(b-x)/D,$=St(I.x,M.x,U),W=St(I.y,M.y,U),K=new Yo($,W,0,M.angleTo(I),T);return!p||Tg(i,K,f,p,e)?K:void 0}x+=D}}function D1(i,e,r,n,l,u,p,f,x){const b=Ig(n,u,p),T=Cg(n,l),I=T*p,M=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return e-I<e/4&&(e=I+e/4),Mg(i,M?e/2*f%e:(T/2+2*u)*p*f%e,e,b,r,I,M,!1,x)}function Mg(i,e,r,n,l,u,p,f,x){const b=u/2,T=Sg(i);let I=0,M=e-r,D=[];for(let U=0;U<i.length-1;U++){const $=i[U],W=i[U+1],K=$.dist(W),ae=W.angleTo($);for(;M+r<I+K;){M+=r;const he=(M-I)/K,pe=St($.x,W.x,he),fe=St($.y,W.y,he);if(pe>=0&&pe<x&&fe>=0&&fe<x&&M-b>=0&&M+b<=T){const me=new Yo(pe,fe,0,ae,U);me._round(),n&&!Tg(i,me,u,n,l)||D.push(me)}}I+=K}return f||D.length||p||(D=Mg(i,I/2,r,n,l,u,p,!0,x)),D}function kg(i,e,r,n,l){const u=[];for(let p=0;p<i.length;p++){const f=i[p];let x;for(let b=0;b<f.length-1;b++){let T=f[b],I=f[b+1];T.x<e&&I.x<e||(T.x<e?T=new B(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x<e&&(I=new B(e,T.y+(e-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y<r&&I.y<r||(T.y<r?T=new B(T.x+(r-T.y)/(I.y-T.y)*(I.x-T.x),r)._round():I.y<r&&(I=new B(T.x+(r-T.y)/(I.y-T.y)*(I.x-T.x),r)._round()),T.x>=n&&I.x>=n||(T.x>=n?T=new B(n,T.y+(n-T.x)/(I.x-T.x)*(I.y-T.y))._round():I.x>=n&&(I=new B(n,T.y+(n-T.x)/(I.x-T.x)*(I.y-T.y))._round()),T.y>=l&&I.y>=l||(T.y>=l?T=new B(T.x+(l-T.y)/(I.y-T.y)*(I.x-T.x),l)._round():I.y>=l&&(I=new B(T.x+(l-T.y)/(I.y-T.y)*(I.x-T.x),l)._round()),x&&T.equals(x[x.length-1])||(x=[T],u.push(x)),x.push(I)))))}}return u}st(Yo,"Anchor");const yu=1e20;function zg(i,e,r,n,l,u,p,f,x){for(let b=e;b<e+n;b++)Pg(i,r*u+b,u,l,p,f,x);for(let b=r;b<r+l;b++)Pg(i,b*u+e,1,n,p,f,x)}function Pg(i,e,r,n,l,u,p){u[0]=0,p[0]=-yu,p[1]=yu,l[0]=i[e];for(let f=1,x=0,b=0;f<n;f++){l[f]=i[e+f*r];const T=f*f;do{const I=u[x];b=(l[f]-l[I]+T-I*I)/(f-I)/2}while(b<=p[x]&&--x>-1);x++,u[x]=f,p[x]=b,p[x+1]=yu}for(let f=0,x=0;f<n;f++){for(;p[x+1]<f;)x++;const b=u[x],T=f-b;i[e+f*r]=l[b]+T*T}}const _f={none:0,ideographs:1,all:2};class Vl{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const n=[];for(const l in e)for(const u of e[l])n.push({stack:l,id:u});Tt(n,({stack:l,id:u},p)=>{let f=this.entries[l];f||(f=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=f.glyphs[u];if(x!==void 0)return void p(null,{stack:l,id:u,glyph:x});if(x=this._tinySDF(f,l,u),x)return f.glyphs[u]=x,void p(null,{stack:l,id:u,glyph:x});const b=Math.floor(u/256);if(256*b>65535)return void p(new Error("glyphs > 65535 not supported"));if(f.ranges[b])return void p(null,{stack:l,id:u,glyph:x});let T=f.requests[b];T||(T=f.requests[b]=[],Vl.loadGlyphRange(l,b,this.url,this.requestManager,(I,M)=>{if(M){f.ascender=M.ascender,f.descender=M.descender;for(const D in M.glyphs)this._doesCharSupportLocalGlyph(+D)||(f.glyphs[+D]=M.glyphs[+D]);f.ranges[b]=!0}for(const D of T)D(I,M);delete f.requests[b]})),T.push((I,M)=>{I?p(I):M&&p(null,{stack:l,id:u,glyph:M.glyphs[u]||null})})},(l,u)=>{if(l)r(l);else if(u){const p={};for(const{stack:f,id:x,glyph:b}of u)p[f]===void 0&&(p[f]={}),p[f].glyphs===void 0&&(p[f].glyphs={}),p[f].glyphs[x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},p[f].ascender=this.entries[f].ascender,p[f].descender=this.entries[f].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==_f.none&&(this.localGlyphMode===_f.all?!!this.localFontFamily:!!this.localFontFamily&&(Zc(e)||Vh(e)||xa(e)||vl(e)||xl(e)))}_tinySDF(e,r,n){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(n))return;let u=e.tinySDF;if(!u){let $="400";/bold/i.test(r)?$="900":/medium/i.test(r)?$="500":/light/i.test(r)&&($="200"),u=e.tinySDF=new Vl.TinySDF({fontFamily:l,fontWeight:$,fontSize:48,buffer:6,radius:16}),u.fontWeight=$}if(this.localGlyphs[u.fontWeight][n])return this.localGlyphs[u.fontWeight][n];const p=String.fromCharCode(n),{data:f,width:x,height:b,glyphWidth:T,glyphHeight:I,glyphLeft:M,glyphTop:D,glyphAdvance:U}=u.draw(p);return this.localGlyphs[u.fontWeight][n]={id:n,bitmap:new Ho({width:x,height:b},f),metrics:{width:T/2,height:I/2,left:M/2,top:D/2-27,advance:U/2,localGlyph:!0}}}}function Dg(i,e,r,n){const l=[],u=i.image,p=u.pixelRatio,f=u.paddedRect.w-2,x=u.paddedRect.h-2,b=i.right-i.left,T=i.bottom-i.top,I=u.stretchX||[[0,f]],M=u.stretchY||[[0,x]],D=(Te,De)=>Te+De[1]-De[0],U=I.reduce(D,0),$=M.reduce(D,0),W=f-U,K=x-$;let ae=0,he=U,pe=0,fe=$,me=0,Ie=W,ke=0,Le=K;if(u.content&&n){const Te=u.content;ae=hd(I,0,Te[0]),pe=hd(M,0,Te[1]),he=hd(I,Te[0],Te[2]),fe=hd(M,Te[1],Te[3]),me=Te[0]-ae,ke=Te[1]-pe,Ie=Te[2]-Te[0]-he,Le=Te[3]-Te[1]-fe}const Oe=(Te,De,je,Qe)=>{const Ge=dd(Te.stretch-ae,he,b,i.left),He=pd(Te.fixed-me,Ie,Te.stretch,U),jt=dd(De.stretch-pe,fe,T,i.top),Qt=pd(De.fixed-ke,Le,De.stretch,$),Nt=dd(je.stretch-ae,he,b,i.left),Wt=pd(je.fixed-me,Ie,je.stretch,U),_t=dd(Qe.stretch-pe,fe,T,i.top),ot=pd(Qe.fixed-ke,Le,Qe.stretch,$),ei=new B(Ge,jt),gi=new B(Nt,jt),nr=new B(Nt,_t),Pi=new B(Ge,_t),or=new B(He/p,Qt/p),yi=new B(Wt/p,ot/p),ri=e*Math.PI/180;if(ri){const Xi=Math.sin(ri),sr=Math.cos(ri),ur=[sr,-Xi,Xi,sr];ei._matMult(ur),gi._matMult(ur),Pi._matMult(ur),nr._matMult(ur)}const Ti=Te.stretch+Te.fixed,Gi=De.stretch+De.fixed;return{tl:ei,tr:gi,bl:Pi,br:nr,tex:{x:u.paddedRect.x+1+Ti,y:u.paddedRect.y+1+Gi,w:je.stretch+je.fixed-Ti,h:Qe.stretch+Qe.fixed-Gi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:or,pixelOffsetBR:yi,minFontScaleX:Ie/p/b,minFontScaleY:Le/p/T,isSDF:r}};if(n&&(u.stretchX||u.stretchY)){const Te=Bg(I,W,U),De=Bg(M,K,$);for(let je=0;je<Te.length-1;je++){const Qe=Te[je],Ge=Te[je+1];for(let He=0;He<De.length-1;He++)l.push(Oe(Qe,De[He],Ge,De[He+1]))}}else l.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:f+1},{fixed:0,stretch:x+1}));return l}function hd(i,e,r){let n=0;for(const l of i)n+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return n}function Bg(i,e,r){const n=[{fixed:-1,stretch:0}];for(const[l,u]of i){const p=n[n.length-1];n.push({fixed:l-p.stretch,stretch:p.stretch}),n.push({fixed:l-p.stretch,stretch:p.stretch+(u-l)})}return n.push({fixed:e+1,stretch:r}),n}function dd(i,e,r,n){return i/e*r+n}function pd(i,e,r,n){return i-e*r/n}function B1(i,e,r,n){const l=e+i.positionedLines[n].lineOffset;return n===0?r+l/2:r+(l+(e+i.positionedLines[n-1].lineOffset))/2}Vl.loadGlyphRange=function(i,e,r,n,l){const u=256*e,p=u+255,f=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${u}-${p}`),J.Glyphs);ne(f,(x,b)=>{if(x)l(x);else if(b){const T={},I=function(M){return new _u(M).readFields(S1,{})}(b);for(const M of I.glyphs)T[M.id]=M;l(null,{glyphs:T,ascender:I.ascender,descender:I.descender})}})},Vl.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}){this.buffer=e,this.cutoff=n,this.radius=r;const f=this.size=i+4*e,x=this._createCanvas(f),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${p} ${u} ${i}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(i),p=Math.floor(r),f=Math.min(this.size-this.buffer,Math.ceil(u-l)),x=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(n)),b=f+2*this.buffer,T=x+2*this.buffer,I=b*T,M=new Uint8ClampedArray(I),D={data:M,width:b,height:T,glyphWidth:f,glyphHeight:x,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(f===0||x===0)return D;const{ctx:U,buffer:$,gridInner:W,gridOuter:K}=this;U.clearRect($,$,f,x),U.fillText(i,$,$+p+1);const ae=U.getImageData($,$,f,x);K.fill(yu,0,I),W.fill(0,0,I);for(let he=0;he<x;he++)for(let pe=0;pe<f;pe++){const fe=ae.data[4*(he*f+pe)+3]/255;if(fe===0)continue;const me=(he+$)*b+pe+$;if(fe===1)K[me]=0,W[me]=yu;else{const Ie=.5-fe;K[me]=Ie>0?Ie*Ie:0,W[me]=Ie<0?Ie*Ie:0}}zg(K,0,0,b,T,b,this.f,this.v,this.z),zg(W,$,$,f,x,b,this.f,this.v,this.z);for(let he=0;he<I;he++){const pe=Math.sqrt(K[he])-Math.sqrt(W[he]);M[he]=Math.round(255-255*(pe/this.radius+this.cutoff))}return D}};class L1{constructor(e=[],r=R1){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,l=r[e];for(;e>0;){const u=e-1>>1,p=r[u];if(n(l,p)>=0)break;r[e]=p,e=u}r[e]=l}_down(e){const{data:r,compare:n}=this,l=this.length>>1,u=r[e];for(;e<l;){let p=1+(e<<1),f=r[p];const x=p+1;if(x<this.length&&n(r[x],f)<0&&(p=x,f=r[x]),n(f,u)>=0)break;r[e]=f,e=p}r[e]=u}}function R1(i,e){return i<e?-1:i>e?1:0}function F1(i,e=1,r=!1){let n=1/0,l=1/0,u=-1/0,p=-1/0;const f=i[0];for(let D=0;D<f.length;D++){const U=f[D];(!D||U.x<n)&&(n=U.x),(!D||U.y<l)&&(l=U.y),(!D||U.x>u)&&(u=U.x),(!D||U.y>p)&&(p=U.y)}const x=Math.min(u-n,p-l);let b=x/2;const T=new L1([],O1);if(x===0)return new B(n,l);for(let D=n;D<u;D+=x)for(let U=l;U<p;U+=x)T.push(new jl(D+b,U+b,b,i));let I=function(D){let U=0,$=0,W=0;const K=D[0];for(let ae=0,he=K.length,pe=he-1;ae<he;pe=ae++){const fe=K[ae],me=K[pe],Ie=fe.x*me.y-me.x*fe.y;$+=(fe.x+me.x)*Ie,W+=(fe.y+me.y)*Ie,U+=3*Ie}return new jl($/U,W/U,0,D)}(i),M=T.length;for(;T.length;){const D=T.pop();(D.d>I.d||!I.d)&&(I=D,r&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,M)),D.max-I.d<=e||(b=D.h/2,T.push(new jl(D.p.x-b,D.p.y-b,b,i)),T.push(new jl(D.p.x+b,D.p.y-b,b,i)),T.push(new jl(D.p.x-b,D.p.y+b,b,i)),T.push(new jl(D.p.x+b,D.p.y+b,b,i)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${I.d}`)),I.p}function O1(i,e){return e.max-i.max}function jl(i,e,r,n){this.p=new B(i,e),this.h=r,this.d=function(l,u){let p=!1,f=1/0;for(let x=0;x<u.length;x++){const b=u[x];for(let T=0,I=b.length,M=I-1;T<I;M=T++){const D=b[T],U=b[M];D.y>l.y!=U.y>l.y&&l.x<(U.x-D.x)*(l.y-D.y)/(U.y-D.y)+D.x&&(p=!p),f=Math.min(f,k_(l,D,U))}}return(p?1:-1)*Math.sqrt(f)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const gf=Number.POSITIVE_INFINITY,U1=Math.sqrt(2);function Lg(i,e){return e[1]!==gf?function(r,n,l){let u=0,p=0;switch(n=Math.abs(n),l=Math.abs(l),r){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(r){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}return[u,p]}(i,e[0],e[1]):function(r,n){let l=0,u=0;n<0&&(n=0);const p=n/U1;switch(r){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-n;break;case"top":u=n-7}switch(r){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=n;break;case"right":l=-n}return[l,u]}(i,e[0])}function V1(i,e,r,n,l,u,p,f,x,b){i.createArrays(),i.tilePixelRatio=Gt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const T=i.layers[0].layout,I=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:W}=i.textSizeData;M.compositeTextSizes=[I["text-size"].possiblyEvaluate(new zi($),f),I["text-size"].possiblyEvaluate(new zi(W),f)]}if(i.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:W}=i.iconSizeData;M.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new zi($),f),I["icon-size"].possiblyEvaluate(new zi(W),f)]}M.layoutTextSize=I["text-size"].possiblyEvaluate(new zi(x+1),f),M.layoutIconSize=I["icon-size"].possiblyEvaluate(new zi(x+1),f),M.textMaxSize=I["text-size"].possiblyEvaluate(new zi(18),f);const D=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",U=T.get("text-size");for(const $ of i.features){const W=T.get("text-font").evaluate($,{},f).join(","),K=U.evaluate($,{},f),ae=M.layoutTextSize.evaluate($,{},f),he=(M.layoutIconSize.evaluate($,{},f),{horizontal:{},vertical:void 0}),pe=$.text;let fe,me=[0,0];if(pe){const Le=pe.toString(),Oe=T.get("text-letter-spacing").evaluate($,{},f)*Er,Te=T.get("text-line-height").evaluate($,{},f)*Er,De=$h(Le)?Oe:0,je=T.get("text-anchor").evaluate($,{},f),Qe=T.get("text-variable-anchor");if(!Qe){const Wt=T.get("text-radial-offset").evaluate($,{},f);me=Wt?Lg(je,[Wt*Er,gf]):T.get("text-offset").evaluate($,{},f).map(_t=>_t*Er)}let Ge=D?"center":T.get("text-justify").evaluate($,{},f);const He=T.get("symbol-placement"),jt=He==="point",Qt=He==="point"?T.get("text-max-width").evaluate($,{},f)*Er:0,Nt=Wt=>{i.allowVerticalPlacement&&bl(Le)&&(he.vertical=pf(pe,e,r,l,W,Qt,Te,je,Wt,De,me,Tn.vertical,!0,He,ae,K))};if(!D&&Qe){const Wt=Ge==="auto"?Qe.map(ot=>yf(ot)):[Ge];let _t=!1;for(let ot=0;ot<Wt.length;ot++){const ei=Wt[ot];if(!he.horizontal[ei])if(_t)he.horizontal[ei]=he.horizontal[0];else{const gi=pf(pe,e,r,l,W,Qt,Te,"center",ei,De,me,Tn.horizontal,!1,He,ae,K);gi&&(he.horizontal[ei]=gi,_t=gi.positionedLines.length===1)}}Nt("left")}else{if(Ge==="auto"&&(Ge=yf(je)),jt||T.get("text-writing-mode").indexOf("horizontal")>=0||!bl(Le)){const Wt=pf(pe,e,r,l,W,Qt,Te,je,Ge,De,me,Tn.horizontal,!1,He,ae,K);Wt&&(he.horizontal[Ge]=Wt)}Nt(He==="point"?"left":Ge)}}let Ie=!1;if($.icon&&$.icon.name){const Le=n[$.icon.name];Le&&(fe=z1(l[$.icon.name],T.get("icon-offset").evaluate($,{},f),T.get("icon-anchor").evaluate($,{},f)),Ie=Le.sdf,i.sdfIcons===void 0?i.sdfIcons=Le.sdf:i.sdfIcons!==Le.sdf&&Yt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Le.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const ke=Fg(he.horizontal)||he.vertical;i.iconsInText||(i.iconsInText=!!ke&&ke.iconsInText),(ke||fe)&&j1(i,$,he,fe,n,M,ae,0,me,Ie,p,f,b)}u&&i.generateCollisionDebugBuffers(x,i.collisionBoxArray)}function yf(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function j1(i,e,r,n,l,u,p,f,x,b,T,I,M){let D=u.textMaxSize.evaluate(e,{},I);D===void 0&&(D=p);const U=i.layers[0].layout,$=U.get("icon-offset").evaluate(e,{},I),W=Fg(r.horizontal)||r.vertical,K=p/24,ae=i.tilePixelRatio*D/24,he=(Te=i.overscaling,i.zoom>18&&Te>2&&(Te>>=1),Math.max(Gt/(512*Te),1)*U.get("symbol-spacing")),pe=U.get("text-padding")*i.tilePixelRatio,fe=U.get("icon-padding")*i.tilePixelRatio,me=Ae(U.get("text-max-angle")),Ie=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",ke=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Le=U.get("symbol-placement"),Oe=he/2;var Te;const De=U.get("icon-text-fit");let je;n&&De!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(je=Eg(n,r.vertical,De,U.get("icon-text-fit-padding"),$,K)),W&&(n=Eg(n,W,De,U.get("icon-text-fit-padding"),$,K)));const Qe=(Ge,He,jt)=>{if(He.x<0||He.x>=Gt||He.y<0||He.y>=Gt)return;const{x:Qt,y:Nt,z:Wt}=M.projectTilePoint(He.x,He.y,jt),_t=new Yo(Qt,Nt,Wt,0,void 0);(function(ot,ei,gi,nr,Pi,or,yi,ri,Ti,Gi,Xi,sr,ur,an,Xr,Si,Rr,ln,vr,hr,Li,Di,Hr,Fr,tr){const Or=ot.addToLineVertexArray(ei,nr);let Mr,dr,Fn,Bs,Iu,Cu,xy,vy=0,Ay=0,by=0,wy=0,Lf=-1,Rf=-1;const bo={};let Ey=mo(""),Ff=0,Of=0;if(Ti._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Ff,Of]=Ti.layout.get("text-offset").evaluate(Li,{},tr).map(cn=>cn*Er):(Ff=Ti.layout.get("text-radial-offset").evaluate(Li,{},tr)*Er,Of=gf),ot.allowVerticalPlacement&&Pi.vertical){const cn=Pi.vertical;if(Xr)Cu=xf(cn),ri&&(xy=xf(ri));else{const un=Ti.layout.get("text-rotate").evaluate(Li,{},tr)+90;Fn=fd(Gi,gi,ei,Xi,sr,ur,cn,an,un,Si),ri&&(Bs=fd(Gi,gi,ei,Xi,sr,ur,ri,ln,un))}}if(or){const cn=Ti.layout.get("icon-rotate").evaluate(Li,{},tr),un=Ti.layout.get("icon-text-fit")!=="none",Mu=Dg(or,cn,Hr,un),Vf=ri?Dg(ri,cn,Hr,un):void 0;dr=fd(Gi,gi,ei,Xi,sr,ur,or,ln,cn),vy=4*Mu.length;const Ty=ot.iconSizeData;let Pa=null;Ty.kind==="source"?(Pa=[yo*Ti.layout.get("icon-size").evaluate(Li,{},tr)],Pa[0]>Cs&&Yt(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ty.kind==="composite"&&(Pa=[yo*Di.compositeIconSizes[0].evaluate(Li,{},tr),yo*Di.compositeIconSizes[1].evaluate(Li,{},tr)],(Pa[0]>Cs||Pa[1]>Cs)&&Yt(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,Mu,Pa,hr,vr,Li,!1,gi,ei,Or.lineStartIndex,Or.lineLength,-1,Fr,tr),Lf=ot.icon.placedSymbolArray.length-1,Vf&&(Ay=4*Vf.length,ot.addSymbols(ot.icon,Vf,Pa,hr,vr,Li,Tn.vertical,gi,ei,Or.lineStartIndex,Or.lineLength,-1,Fr,tr),Rf=ot.icon.placedSymbolArray.length-1)}for(const cn in Pi.horizontal){const un=Pi.horizontal[cn];Mr||(Ey=mo(un.text),Xr?Iu=xf(un):Mr=fd(Gi,gi,ei,Xi,sr,ur,un,an,Ti.layout.get("text-rotate").evaluate(Li,{},tr),Si));const Mu=un.positionedLines.length===1;if(by+=Rg(ot,gi,ei,un,yi,Ti,Xr,Li,Si,Or,Pi.vertical?Tn.horizontal:Tn.horizontalOnly,Mu?Object.keys(Pi.horizontal):[cn],bo,Lf,Di,Fr,tr),Mu)break}Pi.vertical&&(wy+=Rg(ot,gi,ei,Pi.vertical,yi,Ti,Xr,Li,Si,Or,Tn.vertical,["vertical"],bo,Rf,Di,Fr,tr));let Ls=-1;const Uf=(cn,un)=>cn?Math.max(cn,un):un;Ls=Uf(Iu,Ls),Ls=Uf(Cu,Ls),Ls=Uf(xy,Ls);const Ab=Ls>-1?1:0;ot.glyphOffsetArray.length>=Ms.MAX_GLYPHS&&Yt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Li.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,Li.sortKey),ot.symbolInstances.emplaceBack(gi.x,gi.y,gi.z,ei.x,ei.y,bo.right>=0?bo.right:-1,bo.center>=0?bo.center:-1,bo.left>=0?bo.left:-1,bo.vertical>=0?bo.vertical:-1,Lf,Rf,Ey,Mr!==void 0?Mr:ot.collisionBoxArray.length,Mr!==void 0?Mr+1:ot.collisionBoxArray.length,Fn!==void 0?Fn:ot.collisionBoxArray.length,Fn!==void 0?Fn+1:ot.collisionBoxArray.length,dr!==void 0?dr:ot.collisionBoxArray.length,dr!==void 0?dr+1:ot.collisionBoxArray.length,Bs||ot.collisionBoxArray.length,Bs?Bs+1:ot.collisionBoxArray.length,Xi,by,wy,vy,Ay,Ab,0,Ff,Of,Ls)})(i,He,_t,Ge,r,n,l,je,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,pe,Ie,x,0,fe,ke,$,e,u,b,T,I)};if(Le==="line")for(const Ge of kg(e.geometry,0,0,Gt,Gt)){const He=D1(Ge,he,me,r.vertical||W,n,24,ae,i.overscaling,Gt);for(const jt of He){const Qt=W;Qt&&N1(i,Qt.text,Oe,jt)||Qe(Ge,jt,I)}}else if(Le==="line-center"){for(const Ge of e.geometry)if(Ge.length>1){const He=P1(Ge,me,r.vertical||W,n,24,ae);He&&Qe(Ge,He,I)}}else if(e.type==="Polygon")for(const Ge of sf(e.geometry,0)){const He=F1(Ge,16);Qe(Ge[0],new Yo(He.x,He.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Ge of e.geometry)Qe(Ge,new Yo(Ge[0].x,Ge[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Ge of e.geometry)for(const He of Ge)Qe([He],new Yo(He.x,He.y,0,0,void 0),I)}const Cs=32640;function Rg(i,e,r,n,l,u,p,f,x,b,T,I,M,D,U,$,W){const K=function(pe,fe,me,Ie,ke,Le,Oe,Te){const De=[];if(fe.positionedLines.length===0)return De;const je=Ie.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,Qe=function(Nt){const Wt=Nt[0],_t=Nt[1],ot=Wt*_t;return ot>0?[Wt,-_t]:ot<0?[-Wt,_t]:Wt===0?[_t,Wt]:[_t,-Wt]}(me);let Ge=Math.abs(fe.top-fe.bottom);for(const Nt of fe.positionedLines)Ge-=Nt.lineOffset;const He=fe.positionedLines.length,jt=Ge/He;let Qt=fe.top-me[1];for(let Nt=0;Nt<He;++Nt){const Wt=fe.positionedLines[Nt];Qt=B1(fe,jt,Qt,Nt);for(const _t of Wt.positionedGlyphs){if(!_t.rect)continue;const ot=_t.rect||{};let ei=4,gi=!0,nr=1,Pi=0;if(_t.imageName){const Di=Oe[_t.imageName];if(!Di)continue;if(Di.sdf){Yt("SDF images are not supported in formatted text and will be ignored.");continue}gi=!1,nr=Di.pixelRatio,ei=1/nr}const or=(ke||Te)&&_t.vertical,yi=_t.metrics.advance*_t.scale/2,ri=_t.metrics,Ti=_t.rect;if(Ti===null)continue;Te&&fe.verticalizable&&(Pi=_t.imageName?yi-_t.metrics.width*_t.scale/2:0);const Gi=ke?[_t.x+yi,_t.y]:[0,0];let Xi=[0,0],sr=[0,0],ur=!1;ke||(or?(sr=[_t.x+yi+Qe[0],_t.y+Qe[1]-Pi],ur=!0):Xi=[_t.x+yi+me[0],_t.y+me[1]-Pi]);const an=Ti.w*_t.scale/(nr*(_t.localGlyph?2:1)),Xr=Ti.h*_t.scale/(nr*(_t.localGlyph?2:1));let Si,Rr,ln,vr;if(or){const Di=_t.y-Qt,Hr=new B(-yi,yi-Di),Fr=-Math.PI/2,tr=new B(...sr);Si=new B(-yi+Xi[0],Xi[1]),Si._rotateAround(Fr,Hr)._add(tr),Si.x+=-Di+yi,Si.y-=(ri.left-ei)*_t.scale;const Or=_t.imageName?ri.advance*_t.scale:Er*_t.scale,Mr=String.fromCharCode(_t.glyph);m1(Mr)?Si.x+=(1-ei)*_t.scale:_1(Mr)?Si.x+=Or-ri.height*_t.scale+(-ei-1)*_t.scale:Si.x+=_t.imageName||ri.width+2*ei===Ti.w&&ri.height+2*ei===Ti.h?(Or-Xr)/2:(Or-(ri.height+2*ei)*_t.scale)/2,Rr=new B(Si.x,Si.y-an),ln=new B(Si.x+Xr,Si.y),vr=new B(Si.x+Xr,Si.y-an)}else{const Di=(ri.left-ei)*_t.scale-yi+Xi[0],Hr=(-ri.top-ei)*_t.scale+Xi[1],Fr=Di+an,tr=Hr+Xr;Si=new B(Di,Hr),Rr=new B(Fr,Hr),ln=new B(Di,tr),vr=new B(Fr,tr)}if(je){let Di;Di=ke?new B(0,0):ur?new B(Qe[0],Qe[1]):new B(me[0],me[1]),Si._rotateAround(je,Di),Rr._rotateAround(je,Di),ln._rotateAround(je,Di),vr._rotateAround(je,Di)}const hr=new B(0,0),Li=new B(0,0);De.push({tl:Si,tr:Rr,bl:ln,br:vr,tex:ot,writingMode:fe.writingMode,glyphOffset:Gi,sectionIndex:_t.sectionIndex,isSDF:gi,pixelOffsetTL:hr,pixelOffsetBR:Li,minFontScaleX:0,minFontScaleY:0})}}return De}(0,n,x,u,p,f,l,i.allowVerticalPlacement),ae=i.textSizeData;let he=null;ae.kind==="source"?(he=[yo*u.layout.get("text-size").evaluate(f,{},W)],he[0]>Cs&&Yt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(he=[yo*U.compositeTextSizes[0].evaluate(f,{},W),yo*U.compositeTextSizes[1].evaluate(f,{},W)],(he[0]>Cs||he[1]>Cs)&&Yt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,K,he,x,p,f,T,e,r,b.lineStartIndex,b.lineLength,D,$,W);for(const pe of I)M[pe]=i.text.placedSymbolArray.length-1;return 4*K.length}function Fg(i){for(const e in i)return i[e];return null}function fd(i,e,r,n,l,u,p,f,x,b){let T=p.top,I=p.bottom,M=p.left,D=p.right;const U=p.collisionPadding;if(U&&(M-=U[0],T-=U[1],D+=U[2],I+=U[3]),x){const $=new B(M,T),W=new B(D,T),K=new B(M,I),ae=new B(D,I),he=Ae(x);let pe=new B(0,0);b&&(pe=new B(b[0],b[1])),$._rotateAround(he,pe),W._rotateAround(he,pe),K._rotateAround(he,pe),ae._rotateAround(he,pe),M=Math.min($.x,W.x,K.x,ae.x),D=Math.max($.x,W.x,K.x,ae.x),T=Math.min($.y,W.y,K.y,ae.y),I=Math.max($.y,W.y,K.y,ae.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,T,D,I,f,n,l,u),i.length-1}function xf(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function N1(i,e,r,n){const l=i.compareText;if(e in l){const u=l[e];for(let p=u.length-1;p>=0;p--)if(n.dist(u[p])<r)return!0}else l[e]=[];return l[e].push(n),!1}const $1=Ma.VectorTileFeature.types,G1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function md(i,e,r,n,l,u,p,f,x,b,T,I,M,D,U,$){const W=T?Math.min(Cs,Math.round(T[0])):0,K=T?Math.min(Cs,Math.round(T[1])):0;i.emplaceBack(e,r,Math.round(32*p),Math.round(32*f),x,b,(W<<1)+(I?1:0),K,16*M,16*D,256*U,256*$,n,l,u,0)}function vf(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function Z1(i){for(const e of i.sections)if(Bp(e.text))return!0;return!1}class Af{constructor(e){this.layoutVertexArray=new Me,this.indexArray=new lt,this.programConfigurations=e,this.segments=new Wi,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new ve,this.placedSymbolArray=new Qn}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,c1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,G1,!0),this.opacityVertexBuffer.itemSize=1),(n||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}st(Af,"SymbolBuffers");class bf{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new Wi,this.collisionVertexArray=new Pe,this.collisionVertexArrayExt=new Ze}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,u1.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,h1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}st(bf,"CollisionBuffers");class Ms{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=go([]),this.placementViewportMatrix=go([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cf(this.zoom,r["text-size"]),this.iconSizeData=cf(this.zoom,r["icon-size"]);const n=this.layers[0].layout,l=n.get("symbol-sort-key"),u=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(p=>Tn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Af(new Ta(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Af(new Ta(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new _i,this.lineVertexArray=new Ji,this.symbolInstances=new qi}calculateGlyphDependencies(e,r,n,l,u){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,l&&u){const f=mu[e.charAt(p)];f&&(r[f.charCodeAt(0)]=!0)}}populate(e,r,n,l){const u=this.layers[0],p=u.layout,f=p.get("text-font"),x=p.get("text-field"),b=p.get("icon-image"),T=(x.value.kind!=="constant"||x.value.value instanceof rr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),I=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,M=p.get("symbol-sort-key");if(this.features=[],!T&&!I)return;const D=r.iconDependencies,U=r.glyphDependencies,$=r.availableImages,W=new zi(this.zoom);for(const{feature:K,id:ae,index:he,sourceLayerIndex:pe}of e){const fe=u._featureFilter.needGeometry,me=Sa(K,fe);if(!u._featureFilter.filter(W,me,n))continue;let Ie,ke;if(fe||(me.geometry=Xo(K,n,l)),T){const Oe=u.getValueAndResolveTokens("text-field",me,n,$),Te=rr.factory(Oe);Z1(Te)&&(this.hasRTLText=!0),(!this.hasRTLText||Sl()==="unavailable"||this.hasRTLText&&en.isParsed())&&(Ie=f1(Te,u,me))}if(I){const Oe=u.getValueAndResolveTokens("icon-image",me,n,$);ke=Oe instanceof Vr?Oe:Vr.fromString(Oe)}if(!Ie&&!ke)continue;const Le=this.sortFeaturesByKey?M.evaluate(me,{},n):void 0;if(this.features.push({id:ae,text:Ie,icon:ke,index:he,sourceLayerIndex:pe,geometry:me.geometry,properties:K.properties,type:$1[K.type],sortKey:Le}),ke&&(D[ke.name]=!0),Ie){const Oe=f.evaluate(me,{},n).join(","),Te=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Tn.vertical)>=0;for(const De of Ie.sections)if(De.image)D[De.image.name]=!0;else{const je=bl(Ie.toString()),Qe=De.fontStack||Oe,Ge=U[Qe]=U[Qe]||{};this.calculateGlyphDependencies(De.text,Ge,Te,this.allowVerticalPlacement,je)}}}p.get("symbol-placement")==="line"&&(this.features=function(K){const ae={},he={},pe=[];let fe=0;function me(Oe){pe.push(K[Oe]),fe++}function Ie(Oe,Te,De){const je=he[Oe];return delete he[Oe],he[Te]=je,pe[je].geometry[0].pop(),pe[je].geometry[0]=pe[je].geometry[0].concat(De[0]),je}function ke(Oe,Te,De){const je=ae[Te];return delete ae[Te],ae[Oe]=je,pe[je].geometry[0].shift(),pe[je].geometry[0]=De[0].concat(pe[je].geometry[0]),je}function Le(Oe,Te,De){const je=De?Te[0][Te[0].length-1]:Te[0][0];return`${Oe}:${je.x}:${je.y}`}for(let Oe=0;Oe<K.length;Oe++){const Te=K[Oe],De=Te.geometry,je=Te.text?Te.text.toString():null;if(!je){me(Oe);continue}const Qe=Le(je,De),Ge=Le(je,De,!0);if(Qe in he&&Ge in ae&&he[Qe]!==ae[Ge]){const He=ke(Qe,Ge,De),jt=Ie(Qe,Ge,pe[He].geometry);delete ae[Qe],delete he[Ge],he[Le(je,pe[jt].geometry,!0)]=jt,pe[He].geometry=null}else Qe in he?Ie(Qe,Ge,De):Ge in ae?ke(Qe,Ge,De):(me(Oe),ae[Qe]=fe-1,he[Ge]=fe-1)}return pe.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ae)=>K.sortKey-ae.sortKey)}update(e,r,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length,l=e.segment;if(l!==void 0){let u=e.dist(r[l+1]),p=e.dist(r[l]);const f={};for(let x=l+1;x<r.length;x++)f[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:u},x<r.length-1&&(u+=r[x+1].dist(r[x]));for(let x=l||0;x>=0;x--)f[x]={x:r[x].x,y:r[x].y,tileUnitDistanceFromAnchor:p},x>0&&(p+=r[x-1].dist(r[x]));for(let x=0;x<r.length;x++){const b=f[x];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,l,u,p,f,x,b,T,I,M,D,U){const $=e.indexArray,W=e.layoutVertexArray,K=e.segments.prepareSegment(4*r.length,W,$,this.canOverlap?p.sortKey:void 0),ae=this.glyphOffsetArray.length,he=K.vertexLength,pe=this.allowVerticalPlacement&&f===Tn.vertical?Math.PI/2:0,fe=p.text&&p.text.sections;for(let me=0;me<r.length;me++){const{tl:Ie,tr:ke,bl:Le,br:Oe,tex:Te,pixelOffsetTL:De,pixelOffsetBR:je,minFontScaleX:Qe,minFontScaleY:Ge,glyphOffset:He,isSDF:jt,sectionIndex:Qt}=r[me],Nt=K.vertexLength,Wt=He[1];md(W,x.x,x.y,x.z,b.x,b.y,Ie.x,Wt+Ie.y,Te.x,Te.y,n,jt,De.x,De.y,Qe,Ge),md(W,x.x,x.y,x.z,b.x,b.y,ke.x,Wt+ke.y,Te.x+Te.w,Te.y,n,jt,je.x,De.y,Qe,Ge),md(W,x.x,x.y,x.z,b.x,b.y,Le.x,Wt+Le.y,Te.x,Te.y+Te.h,n,jt,De.x,je.y,Qe,Ge),md(W,x.x,x.y,x.z,b.x,b.y,Oe.x,Wt+Oe.y,Te.x+Te.w,Te.y+Te.h,n,jt,je.x,je.y,Qe,Ge),vf(e.dynamicLayoutVertexArray,x,pe),$.emplaceBack(Nt,Nt+1,Nt+2),$.emplaceBack(Nt+1,Nt+2,Nt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(He[0]),me!==r.length-1&&Qt===r[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,p,p.index,{},D,U,fe&&fe[Qt])}e.placedSymbolArray.emplaceBack(x.x,x.y,x.z,b.x,b.y,ae,this.glyphOffsetArray.length-ae,he,T,I,b.segment,n?n[0]:0,n?n[1]:0,l[0],l[1],f,0,!1,0,M,0)}_commitLayoutVertex(e,r,n,l,u,p,f){e.emplaceBack(r,n,l,u,p,Math.round(f.x),Math.round(f.y))}_addCollisionDebugVertices(e,r,n,l,u,p,f){const x=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),b=x.vertexLength,T=f.tileAnchorX,I=f.tileAnchorY;for(let D=0;D<4;D++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,I,new B(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,I,new B(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,I,new B(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,l,u,p,T,I,new B(e.x1,e.y2)),x.vertexLength+=4;const M=n.indexArray;M.emplaceBack(b,b+1),M.emplaceBack(b+1,b+2),M.emplaceBack(b+2,b+3),M.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),b=this.getSymbolInstanceTextSize(e,p,r,f);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),b=this.getSymbolInstanceIconSize(e,r,f);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bf($e,hg.members,Ut),this.iconCollisionBox=new bf($e,hg.members,Ut);const n=Rl(this.iconSizeData,e),l=Rl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,n,l){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),p=ld(this.textSizeData,e,u)/Er;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,n){const l=this.icon.placedSymbolArray.get(n),u=ld(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,l,u,p){for(let f=l;f<u;f++){const x=n.get(f),b=this.getSymbolInstanceTextSize(e,p,r,f);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,x.padding)}}_updateIconDebugCollisionBoxes(e,r,n,l,u){for(let p=l;p<u;p++){const f=n.get(p),x=this.getSymbolInstanceIconSize(e,r,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,f.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Rl(this.iconSizeData,e),l=Rl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(l,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(n,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,l,u,p,f,x,b){const T={};for(let I=r;I<n;I++){const M=e.get(I);T.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.textFeatureIndex=M.featureIndex;break}for(let I=l;I<u;I++){const M=e.get(I);T.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalTextFeatureIndex=M.featureIndex;break}for(let I=p;I<f;I++){const M=e.get(I);T.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.iconFeatureIndex=M.featureIndex;break}for(let I=x;I<b;I++){const M=e.get(I);T.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},T.verticalIconFeatureIndex=M.featureIndex;break}return T}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),l=n.vertexStartIndex+4*n.numGlyphs;for(let u=n.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),l=[],u=[],p=[];for(let f=0;f<this.symbolInstances.length;++f){p.push(f);const x=this.symbolInstances.get(f);l.push(0|Math.round(r*x.tileAnchorX+n*x.tileAnchorY)),u.push(x.featureIndex)}return p.sort((f,x)=>l[f]-l[x]||u[x]-u[f]),p}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((l,u,p)=>{l>=0&&p.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}st(Ms,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ms.MAX_GLYPHS=65535,Ms.addDynamicAttributes=vf;const q1=new F({"symbol-placement":new v(we.layout_symbol["symbol-placement"]),"symbol-spacing":new v(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new v(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new E(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new v(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new v(we.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new v(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new v(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new v(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new E(we.layout_symbol["icon-size"]),"icon-text-fit":new v(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new v(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new E(we.layout_symbol["icon-image"]),"icon-rotate":new E(we.layout_symbol["icon-rotate"]),"icon-padding":new v(we.layout_symbol["icon-padding"]),"icon-keep-upright":new v(we.layout_symbol["icon-keep-upright"]),"icon-offset":new E(we.layout_symbol["icon-offset"]),"icon-anchor":new E(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new v(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new v(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new v(we.layout_symbol["text-rotation-alignment"]),"text-field":new E(we.layout_symbol["text-field"]),"text-font":new E(we.layout_symbol["text-font"]),"text-size":new E(we.layout_symbol["text-size"]),"text-max-width":new E(we.layout_symbol["text-max-width"]),"text-line-height":new E(we.layout_symbol["text-line-height"]),"text-letter-spacing":new E(we.layout_symbol["text-letter-spacing"]),"text-justify":new E(we.layout_symbol["text-justify"]),"text-radial-offset":new E(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new v(we.layout_symbol["text-variable-anchor"]),"text-anchor":new E(we.layout_symbol["text-anchor"]),"text-max-angle":new v(we.layout_symbol["text-max-angle"]),"text-writing-mode":new v(we.layout_symbol["text-writing-mode"]),"text-rotate":new E(we.layout_symbol["text-rotate"]),"text-padding":new v(we.layout_symbol["text-padding"]),"text-keep-upright":new v(we.layout_symbol["text-keep-upright"]),"text-transform":new E(we.layout_symbol["text-transform"]),"text-offset":new E(we.layout_symbol["text-offset"]),"text-allow-overlap":new v(we.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new v(we.layout_symbol["text-ignore-placement"]),"text-optional":new v(we.layout_symbol["text-optional"])});var wf={paint:new F({"icon-opacity":new E(we.paint_symbol["icon-opacity"]),"icon-color":new E(we.paint_symbol["icon-color"]),"icon-halo-color":new E(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new E(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new E(we.paint_symbol["icon-halo-blur"]),"icon-translate":new v(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new v(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new E(we.paint_symbol["text-opacity"]),"text-color":new E(we.paint_symbol["text-color"],{runtimeType:Dn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new E(we.paint_symbol["text-halo-color"]),"text-halo-width":new E(we.paint_symbol["text-halo-width"]),"text-halo-blur":new E(we.paint_symbol["text-halo-blur"]),"text-translate":new v(we.paint_symbol["text-translate"]),"text-translate-anchor":new v(we.paint_symbol["text-translate-anchor"])}),layout:q1};class Og{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:$n,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}st(Og,"FormatSectionOverride",{omit:["defaultValue"]});class _d extends Kn{constructor(e){super(e,wf)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const l=[];for(const u of n)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,l){const u=this.layout.get(e).evaluate(r,{},n,l),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ms(p.value)||!u?u:function(f,x){return x.replace(/{([^{}]+)}/g,(b,T)=>T in f?String(f[T]):"")}(r.properties,u)}createBucket(e){return new Ms(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of wf.paint.overridableProperties){if(!_d.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new Og(r),l=new dl(n,r.property.specification);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Pc("source",l):new Dc("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new m(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&_d.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),l=wf.paint.properties[r];let u=!1;const p=f=>{for(const x of f)if(l.overrides&&l.overrides.hasOverride(x))return void(u=!0)};if(n.value.kind==="constant"&&n.value.value instanceof rr)p(n.value.value.sections);else if(n.value.kind==="source"){const f=b=>{u||(b instanceof Zn&&Ki(b.value)===as?p(b.value.sections):b instanceof us?p(b.sections):b.eachChild(f))},x=n.value;x._styleExpression&&f(x._styleExpression.expression)}return u}getProgramConfiguration(e){return new Es(this,e)}}var W1={paint:new F({"background-color":new v(we.paint_background["background-color"]),"background-pattern":new k(we.paint_background["background-pattern"]),"background-opacity":new v(we.paint_background["background-opacity"])})},X1={paint:new F({"raster-opacity":new v(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new v(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new v(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new v(we.paint_raster["raster-brightness-max"]),"raster-saturation":new v(we.paint_raster["raster-saturation"]),"raster-contrast":new v(we.paint_raster["raster-contrast"]),"raster-resampling":new v(we.paint_raster["raster-resampling"]),"raster-fade-duration":new v(we.paint_raster["raster-fade-duration"])})};class H1 extends Kn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Q1={paint:new F({"sky-type":new v(we.paint_sky["sky-type"]),"sky-atmosphere-sun":new v(we.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new v(we.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new v(we.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new v(we.paint_sky["sky-gradient-radius"]),"sky-gradient":new P(we.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new v(we.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new v(we.paint_sky["sky-atmosphere-color"]),"sky-opacity":new v(we.paint_sky["sky-opacity"])})};function Ef(i,e,r){const n=[0,0,1],l=G_([]);return function(u,p,f){f*=.5;var x=p[0],b=p[1],T=p[2],I=p[3],M=Math.sin(f),D=Math.cos(f);u[0]=x*D-T*M,u[1]=b*D+I*M,u[2]=T*D+x*M,u[3]=I*D-b*M}(l,l,r?-Ae(i)+Math.PI:Ae(i)),Z_(l,l,-Ae(e)),N_(n,n,l),nu(n,n)}const Y1={circle:class extends Kn{constructor(i){super(i,_A)}createBucket(i){return new Np(i)}queryRadius(i){const e=i;return zl("circle-radius",this,e)+zl("circle-stroke-width",this,e)+Jh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,n,l,u,p,f){const x=B_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return q_(i,n,u,p,f,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Es(this,i)}},heatmap:class extends Kn{createBucket(i){return new X_(i)}constructor(i){super(i,wA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return zl("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,n,l,u,p,f){const x=this.paint.get("heatmap-radius").evaluate(e,r);return q_(i,n,u,p,f,!0,!0,new B(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Es(this,i)}},hillshade:class extends Kn{constructor(i){super(i,EA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Kn{constructor(i){super(i,jA)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new Es(this,i)}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new od(i)}queryRadius(){return Jh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,n,l,u){return!i.queryGeometry.isAboveHorizon&&M_(D_(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Kn{constructor(i){super(i,JA)}createBucket(i){return new pu(i)}queryRadius(){return Jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Es(this,i)}queryIntersectsFeature(i,e,r,n,l,u,p,f,x){const b=B_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),T=this.paint.get("fill-extrusion-height").evaluate(e,r),I=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],D=f&&u.elevation,U=u.elevation?u.elevation.exaggeration():1,$=i.tile.getBucket(this);if(D&&$ instanceof pu){const ae=$.centroidVertexArray,he=x+1;if(he<ae.length){const pe=ae.get(he);M[0]=pe.a_centroid_pos0,M[1]=pe.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;const W=function(ae,he,pe,fe,me,Ie,ke,Le,Oe){return Ie?function(Te,De,je,Qe,Ge,He,jt,Qt,Nt){const Wt=[],_t=[],ot=[0,0,0,1];for(const ei of Te){const gi=[],nr=[];for(const Pi of ei){const or=Pi.x+Qe.x,yi=Pi.y+Qe.y,ri=e1(or,yi,De,je,He,jt,Qt,Nt);ot[0]=or,ot[1]=yi,ot[2]=ri.base,ot[3]=1,Dl(ot,ot,Ge),ot[3]=Math.max(ot[3],1e-5);const Ti=ag([ot[0]/ot[3],ot[1]/ot[3],ot[2]/ot[3]]);ot[0]=or,ot[1]=yi,ot[2]=ri.top,ot[3]=1,Dl(ot,ot,Ge),ot[3]=Math.max(ot[3],1e-5);const Gi=ag([ot[0]/ot[3],ot[1]/ot[3],ot[2]/ot[3]]);gi.push(Ti),nr.push(Gi)}Wt.push(gi),_t.push(nr)}return[Wt,_t]}(ae,he,pe,fe,me,Ie,ke,Le,Oe):function(Te,De,je,Qe,Ge){const He=[],jt=[],Qt=Ge[8]*De,Nt=Ge[9]*De,Wt=Ge[10]*De,_t=Ge[11]*De,ot=Ge[8]*je,ei=Ge[9]*je,gi=Ge[10]*je,nr=Ge[11]*je;for(const Pi of Te){const or=[],yi=[];for(const ri of Pi){const Ti=ri.x+Qe.x,Gi=ri.y+Qe.y,Xi=Ge[0]*Ti+Ge[4]*Gi+Ge[12],sr=Ge[1]*Ti+Ge[5]*Gi+Ge[13],ur=Ge[2]*Ti+Ge[6]*Gi+Ge[14],an=Ge[3]*Ti+Ge[7]*Gi+Ge[15],Xr=Xi+Qt,Si=sr+Nt,Rr=ur+Wt,ln=Math.max(an+_t,1e-5),vr=Xi+ot,hr=sr+ei,Li=ur+gi,Di=Math.max(an+nr,1e-5),Hr=new B(Xr/ln,Si/ln);Hr.z=Rr/ln,or.push(Hr);const Fr=new B(vr/Di,hr/Di);Fr.z=Li/Di,yi.push(Fr)}He.push(or),jt.push(yi)}return[He,jt]}(ae,he,pe,fe,me)}(n,I,T,b,p,D?f:null,M,U,u.center.lat),K=i.queryGeometry;return function(ae,he,pe){let fe=1/0;M_(pe,he)&&(fe=sg(pe,he[0]));for(let me=0;me<he.length;me++){const Ie=he[me],ke=ae[me];for(let Le=0;Le<Ie.length-1;Le++){const Oe=Ie[Le],Te=[Oe,Ie[Le+1],ke[Le+1],ke[Le],Oe];C_(pe,Te)&&(fe=Math.min(fe,sg(pe,Te)))}}return fe!==1/0&&fe}(W[0],W[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Kn{constructor(i){super(i,lg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ra,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=cg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ad(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Es(this,i)}queryRadius(i){const e=i,r=ug(zl("line-width",this,e),zl("line-gap-width",this,e)),n=zl("line-offset",this,e);return r/2+Math.abs(n)+Jh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,n,l,u){if(i.queryGeometry.isAboveHorizon)return!1;const p=D_(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,i.pixelToTileUnitsFactor),f=i.pixelToTileUnitsFactor/2*ug(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),x=this.paint.get("line-offset").evaluate(e,r);return x&&(n=function(b,T){const I=[],M=new B(0,0);for(let D=0;D<b.length;D++){const U=b[D],$=[];for(let W=0;W<U.length;W++){const K=U[W-1],ae=U[W],he=U[W+1],pe=W===0?M:ae.sub(K)._unit()._perp(),fe=W===U.length-1?M:he.sub(ae)._unit()._perp(),me=pe._add(fe)._unit();me._mult(1/(me.x*fe.x+me.y*fe.y)),$.push(me._mult(T)._add(ae))}I.push($)}return I}(n,x*i.pixelToTileUnitsFactor)),function(b,T,I){for(let M=0;M<T.length;M++){const D=T[M];if(b.length>=3){for(let U=0;U<D.length;U++)if(kl(b,D[U]))return!0}if(dA(b,D,I))return!0}return!1}(p,n,f)}isTileClipped(){return!0}},symbol:_d,background:class extends Kn{constructor(i){super(i,W1)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Kn{constructor(i){super(i,X1)}getProgramIds(){return["raster"]}},sky:class extends Kn{constructor(i){super(i,Q1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=tf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),l=!n,u=i.style.light,p=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&Yt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Ef(p.azimuthal,90-p.polar,e):Ef(n[0],90-n[1],e)}const r=this.paint.get("sky-gradient-center");return Ef(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class xu{constructor(e,r,n,l){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,n){const{width:l,height:u}=e,{context:p}=this,{gl:f}=p,{HTMLImageElement:x,HTMLCanvasElement:b,HTMLVideoElement:T,ImageData:I,ImageBitmap:M}=Q;if(f.bindTexture(f.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===l&&this.size[1]===u){const{x:D,y:U}=n||{x:0,y:0};e instanceof x||e instanceof b||e instanceof T||e instanceof I||M&&e instanceof M?f.texSubImage2D(f.TEXTURE_2D,0,D,U,f.RGBA,f.UNSIGNED_BYTE,e):f.texSubImage2D(f.TEXTURE_2D,0,D,U,l,u,f.RGBA,f.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof x||e instanceof b||e instanceof T||e instanceof I||M&&e instanceof M?f.texImage2D(f.TEXTURE_2D,0,this.format,this.format,f.UNSIGNED_BYTE,e):f.texImage2D(f.TEXTURE_2D,0,this.format,l,u,0,this.format,f.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,r){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Tf{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Ho({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=_r(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const l=[];let u=e.length%2==1?-e[e.length-1]*n:0,p=e[0]*n,f=!0;l.push({left:u,right:p,isDash:f,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){f=!f;const T=e[b];u=x*n,x+=T,p=x*n,l.push({left:u,right:p,isDash:f,zeroLength:T===0})}return l}addRoundDash(e,r,n){const l=r/2;for(let u=-n;u<=n;u++){const p=this.width*(this.nextRow+n+u);let f=0,x=e[f];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++f]);const T=Math.abs(b-x.left),I=Math.abs(b-x.right),M=Math.min(T,I);let D;const U=u/n*(l+1);if(x.isDash){const $=l-Math.abs(U);D=Math.sqrt(M*M+$*$)}else D=l-Math.sqrt(M*M+U*U);this.image.data[p+b]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,r){for(let x=e.length-1;x>=0;--x){const b=e[x],T=e[x+1];b.zeroLength?e.splice(x,1):T&&T.isDash===b.isDash&&(T.left=b.left,e.splice(x,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let p=0,f=e[p];for(let x=0;x<this.width;x++){x/f.right>1&&(f=e[++p]);const b=Math.abs(x-f.left),T=Math.abs(x-f.right),I=Math.min(b,T);this.image.data[u+x]=Math.max(0,Math.min(255,(f.isDash?I:-I)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const l=r==="round",u=l?7:0,p=2*u+1;if(this.nextRow+p>this.height)return Yt("LineAtlas out of space"),null;e.length===0&&e.push(1);let f=0;for(let T=0;T<e.length;T++)e[T]<0&&(Yt("Negative value is found in line dasharray, replacing values with 0"),e[T]=0),f+=e[T];if(f!==0){const T=this.width/f,I=this.getDashRanges(e,this.width,T);l?this.addRoundDash(I,T,u):this.addRegularDash(I,r==="square"?.5*T:0)}const x=this.nextRow+u;this.nextRow+=p;const b={tl:[x,u],br:[f,0]};return this.positions[n]=b,b}}st(Tf,"LineAtlas");class K1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const J1=Q.performance;function Ug(i){const e=i?i.url.toString():void 0;return J1.getEntriesByName(e)}class eb{constructor(){this.tasks={},this.taskQueue=[],ui(["process"],this),this.invoker=new K1(this.process),this.nextId=0}add(e,r){const n=this.nextId++,l=function({type:u,isSymbolTile:p,zoom:f}){return f=f||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-f:u==="maybePrepare"&&p?400-f:500:200-f:100-f}(r);if(l===0){xt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:l,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){xt();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<r&&(r=u.priority,e=l)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}const tb=re([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),ib=re([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Vg}=tb,jg=re([{name:"a_pos_3",components:3,type:"Int16"}]);var vu=re([{name:"a_pos",type:"Int16",components:2}]);const Nl=Gt/Math.PI/2,on=-Nl,sn=Nl,rb=[new En([on,on,on],[sn,sn,sn]),new En([on,on,on],[0,0,sn]),new En([0,on,on],[sn,0,sn]),new En([on,0,on],[0,sn,sn]),new En([0,0,on],[sn,sn,sn])];class nb{constructor(e,r,n){this.a=Pl([],e,n),this.b=Pl([],r,n),this.center=n;const l=nu([],this.a),u=nu([],this.b);this.angle=Math.acos(ou(l,u))}}function Sf(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(n,l,u,p){const f=Math.sin(u);return n*(Math.sin((1-p)*u)/f)+l*(Math.sin(p*u)/f)}(i.a[e],i.b[e],i.angle,Ke(r,0,1))+i.center[e]}function Au(i){if(i.z<=1)return rb[i.z+2*i.y+i.x];const[e,r]=If(i),n=[Ko(e[0],e[1]),Ko(e[0],r[1]),Ko(r[0],e[1]),Ko(r[0],r[1])],l=[sn,sn,sn],u=[on,on,on];for(const p of n)l[0]=Math.min(l[0],p[0]),l[1]=Math.min(l[1],p[1]),l[2]=Math.min(l[2],p[2]),u[0]=Math.max(u[0],p[0]),u[1]=Math.max(u[1],p[1]),u[2]=Math.max(u[2],p[2]);return new En(l,u)}function ob(i,e,r){const n=e/i.worldSize,l=(De,je)=>{ru(De,De,n),ru(je,je,n)},u=Number.MAX_VALUE,p=[-u,-u,-u],f=[u,u,u],x=qg(i);if(r.z<=1){const De=Au(r).getCorners();for(let je=0;je<De.length;je++)Ca(De[je],De[je],x),Qp(f,f,De[je]),Yp(p,p,De[je]);return l(f,p),new En(f,p)}const[b,T]=If(r),I=new Ts;I.setSouthWest([b[1],T[0]]),I.setNorthEast([T[1],b[0]]);const M=[Ko(I.getSouth(),I.getWest()),Ko(I.getSouth(),I.getEast()),Ko(I.getNorth(),I.getEast()),Ko(I.getNorth(),I.getWest())];for(let De=0;De<M.length;De++)Ca(M[De],M[De],x),Qp(f,f,M[De]),Yp(p,p,M[De]);if(I.contains(i.center))return p[2]=0,l(f,p),new En(f,p);const D=[x[12],x[13],x[14]],U=i.center.lng,$=Ke(i.center.lat,-85.051129,_o),W=[tu(U),Cl($)],K=I.getCenter().lng,ae=Ke(I.getCenter().lat,-85.051129,_o),he=[tu(K),Cl(ae)];let pe=new Array(3),fe=0;const me=W[0]-he[0],Ie=W[1]-he[1];if(Math.abs(me)>Math.abs(Ie))fe=me>=0?1:3,pe=D;else{fe=Ie>=0?0:2;const De=[x[4],x[5],x[6]];let je;je=Ie>=0?-Math.sin(Ae(I.getSouth()))*Nl:-Math.sin(Ae(I.getNorth()))*Nl,pe=Kp(pe,D,De,je)}const ke=M[fe],Le=M[(fe+1)%4],Oe=new nb(ke,Le,pe),Te=[Sf(Oe,0)||ke[0],Sf(Oe,1)||ke[1],Sf(Oe,2)||ke[2]];return f[2]=Math.min(ke[2],Le[2]),Qp(f,f,Te),Yp(p,p,Te),l(f,p),new En(f,p)}function If(i){const e=1<<i.z,r=i.x/e,n=(i.x+1)/e,l=(i.y+1)/e;return[[wr(i.y/e),Ln(r)],[wr(l),Ln(n)]]}function Ng(i,e,r,n=Nl){return r=Ae(r),[i*Math.sin(r)*n,-e*n,i*Math.cos(r)*n]}function Ko(i,e,r){return Ng(Math.cos(Ae(i)),Math.sin(Ae(i)),e,r)}function $g(i,e,r){const n=Math.pow(2,r.z),l=(i/Gt+r.x)/n;return Ko(wr((e/Gt+r.y)/n),Ln(l))}function Cf(i){return 16383/Math.max(...Pl([],i.max,i.min))}function Gg(i){const e=go(new Float64Array(16)),r=Cf(i);var n,l;return Ss(e,e,[r,r,r]),Ia(e,e,((n=[])[0]=-(l=i.min)[0],n[1]=-l[1],n[2]=-l[2],n)),e}function Zg(i,e,r,n,l){const u=function(x){const b=Gt/(2*Math.PI);return x/(2*Math.PI)/b}(r),p=[i,e,-r/(2*Math.PI)],f=go(new Float64Array(16));return Ia(f,f,p),Ss(f,f,[u,u,u]),Wp(f,f,Ae(-l)),Xp(f,f,Ae(-n)),f}function qg(i){const{x:e,y:r}=i.point,{lng:n,lat:l}=i._center;return Zg(e,r,i.worldSize,n,l)}const Wg=Ae(85),sb=Math.cos(Wg),ab=Math.sin(Wg);function Xg(i,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class gd{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=bu(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=function(u,p,f){var x=Xg(256*u,256*(p=Math.pow(2,f)-p-1),f),b=Xg(256*(u+1),256*(p+1),f);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),l=function(u,p,f){let x,b="";for(let T=u;T>0;T--)x=1<<T-1,b+=(p&x?1:0)+(f&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hg{constructor(e,r){this.wrap=e,this.canonical=r,this.key=bu(e,r.z,r.z,r.x,r.y)}}class Lr{constructor(e,r,n,l,u){this.overscaledZ=e,this.wrap=r,this.canonical=new gd(n,+l,+u),this.key=r===0&&e===n?this.canonical.key:bu(r,e,n,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Lr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return bu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return bu(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Lr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,l=2*this.canonical.y;return[new Lr(r,this.wrap,r,n,l),new Lr(r,this.wrap,r,n+1,l),new Lr(r,this.wrap,r,n,l+1),new Lr(r,this.wrap,r,n+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Lr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Lr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bu(i,e,r,n,l){const u=1<<Math.min(r,22);let p=u*(l%u)+n%u;return i&&r<22&&(p+=u*u*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}function ka(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const r=Math.pow(2,-i.z),n=i.x*r,l=(i.x+1)*r,u=i.y*r,p=(i.y+1)*r,f=Ln(n),x=Ln(l),b=wr(u),T=wr(p),I=e.project(f,b),M=e.project(x,b),D=e.project(x,T),U=e.project(f,T);let $=Math.min(I.x,M.x,D.x,U.x),W=Math.min(I.y,M.y,D.y,U.y),K=Math.max(I.x,M.x,D.x,U.x),ae=Math.max(I.y,M.y,D.y,U.y);const he=r/16;function pe(me,Ie,ke,Le,Oe,Te){const De=(ke+Oe)/2,je=(Le+Te)/2,Qe=e.project(Ln(De),wr(je)),Ge=Math.max(0,$-Qe.x,W-Qe.y,Qe.x-K,Qe.y-ae);$=Math.min($,Qe.x),K=Math.max(K,Qe.x),W=Math.min(W,Qe.y),ae=Math.max(ae,Qe.y),Ge>he&&(pe(me,Qe,ke,Le,De,je),pe(Qe,Ie,De,je,Oe,Te))}pe(I,M,n,u,l,u),pe(M,D,l,u,l,p),pe(D,U,l,p,n,p),pe(U,I,n,p,n,u),$-=he,W-=he,K+=he,ae+=he;const fe=1/Math.max(K-$,ae-W);return{scale:fe,x:$*fe,y:W*fe,x2:K*fe,y2:ae*fe,projection:e}}st(gd,"CanonicalTileID"),st(Lr,"OverscaledTileID",{omit:["projMatrix"]});class Qg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const lb=["tile","layer","source","sourceLayer","state"];class Yg{constructor(e,r,n,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=n,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of lb)this[r]!==void 0&&(e[r]=this[r]);return e}}const Rn=32,xo=33,ks=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,n=0,l=0,u=0,p=0,f=0;for(1&e?l=u=p=Rn:r=n=f=Rn;(e>>=1)>1;){const b=r+l>>1,T=n+u>>1;1&e?(l=r,u=n,r=p,n=f):(r=l,n=u,l=p,u=f),p=b,f=T}const x=4*i;ks[x+0]=r,ks[x+1]=n,ks[x+2]=l,ks[x+3]=u}const vo=new Uint16Array(2178),zs=new Uint8Array(1089),yd=new Uint16Array(1089);function Kg(i){return i===0?-.03125:i===32?.03125:0}var Jg=re([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ey={type:2,extent:Gt,loadGeometry:()=>[[new B(0,0),new B(8193,0),new B(8193,8193),new B(0,8193),new B(0,0)]]};class Mf{constructor(e,r,n,l,u){this.tileID=e,this.uid=ti(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Ce.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ka(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const p={};if(!u)return p;for(const f of l){const x=f.layerIds.map(b=>u.getLayer(b)).filter(Boolean);if(x.length!==0){f.layers=x,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(b=>x.filter(T=>T.id===b)[0]));for(const b of x)p[b.id]=f}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Ms){if(this.hasSymbolBuckets=!0,!n)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof Ms&&u.hasRTLText){this.hasRTLText=!0,en.isLoading()||en.isLoaded()||Sl()!=="deferred"||vs();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Hn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const l=this.buckets[n];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xu(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xu(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new xu(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,l,u,p,f,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:f,transform:p,params:u,tileTransform:this.tileTransform},e,r,n):{}}querySourceFeatures(e,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const l=n.loadVTLayers(),u=r?r.sourceLayer:"",p=l._geojsonTileLayer||l[u];if(!p)return;const f=co(r&&r.filter),{z:x,x:b,y:T}=this.tileID.canonical,I={z:x,x:b,y:T};for(let M=0;M<p.length;M++){const D=p.feature(M);if(f.needGeometry){const W=Sa(D,!0);if(!f.filter(new zi(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!f.filter(new zi(this.tileID.overscaledZ),D))continue;const U=n.getId(D,u),$=new Yg(D,x,b,T,U);$.tile=I,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const n=nt(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let l=!1;if(this.expirationTime>n)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const u=this.expirationTime-r;u?this.expirationTime=n+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const n=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const p=this.buckets[u],f=p.layers[0].sourceLayer||"_geojsonTileLayer",x=n[f],b=e[f];if(!x||!b||Object.keys(b).length===0)continue;if(p.update(b,x,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof ad||p instanceof od){const I=r.style._getSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&I&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(I.id,this.tileID)}const T=r&&r.style&&r.style.getLayer(u);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ce.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ce.now()+e}setTexture(e,r){const n=r.context,l=n.gl;this.texture=r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new xu(n,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,r){const n={};for(const l of r)n[l]=!0;this.dependencies[e]=n}hasDependency(e,r){for(const n of e){const l=this.dependencies[n];if(l){for(const u of r)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const n=Xo(ey,this.tileID.canonical,this.tileTransform)[0],l=new te,u=new oi;for(let p=0;p<n.length;p++){const{x:f,y:x}=n[p];l.emplaceBack(f,x),u.emplaceBack(p)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,vu.members),this._tileDebugSegments=Wi.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const n=Xo(ey,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const p=function(f,x){const b=ka(f,x),T=Math.pow(2,f.z);for(let W=0;W<xo;W++)for(let K=0;K<xo;K++){const ae=Ln((f.x+(K+Kg(K))/Rn)/T),he=wr((f.y+(W+Kg(W))/Rn)/T),pe=x.project(ae,he),fe=W*xo+K;vo[2*fe+0]=Math.round((pe.x*b.scale-b.x)*Gt),vo[2*fe+1]=Math.round((pe.y*b.scale-b.y)*Gt)}zs.fill(0),yd.fill(0);for(let W=2045;W>=0;W--){const K=4*W,ae=ks[K+0],he=ks[K+1],pe=ks[K+2],fe=ks[K+3],me=ae+pe>>1,Ie=he+fe>>1,ke=me+Ie-he,Le=Ie+ae-me,Oe=he*xo+ae,Te=fe*xo+pe,De=Ie*xo+me,je=Math.hypot((vo[2*Oe+0]+vo[2*Te+0])/2-vo[2*De+0],(vo[2*Oe+1]+vo[2*Te+1])/2-vo[2*De+1])>=16;if(zs[De]=zs[De]||(je?1:0),W<1022){const Qe=(he+Le>>1)*xo+(ae+ke>>1),Ge=(fe+Le>>1)*xo+(pe+ke>>1);zs[De]=zs[De]||zs[Qe]||zs[Ge]}}const I=new oe,M=new lt;let D=0;function U(W,K){const ae=K*xo+W;return yd[ae]===0&&(I.emplaceBack(vo[2*ae+0],vo[2*ae+1],W*Gt/Rn,K*Gt/Rn),yd[ae]=++D),yd[ae]-1}function $(W,K,ae,he,pe,fe){const me=W+ae>>1,Ie=K+he>>1;if(Math.abs(W-pe)+Math.abs(K-fe)>1&&zs[Ie*xo+me])$(pe,fe,W,K,me,Ie),$(ae,he,pe,fe,me,Ie);else{const ke=U(W,K),Le=U(ae,he),Oe=U(pe,fe);M.emplaceBack(ke,Le,Oe)}}return $(0,0,Rn,Rn,Rn,0),$(Rn,Rn,0,0,0,Rn),{vertices:I,indices:M}}(this.tileID.canonical,r);l=p.vertices,u=p.indices}else{l=new oe,u=new lt;for(const{x:f,y:x}of n)l.emplaceBack(f,x,0,0);const p=ed(l.int16,void 0,4);for(let f=0;f<p.length;f+=3)u.emplaceBack(p[f],p[f+1],p[f+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,Jg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=Wi.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,r){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!r||r.name!=="globe")return;const n=this.tileID.canonical,l=Gg(Au(n));this._makeGlobeTileDebugBorderBuffer(e,n,l),this._makeGlobeTileDebugTextBuffer(e,n,l)}_makeGlobeTileDebugBorderBuffer(e,r,n){const l=new te,u=new oi,p=new ie,f=(b,T,I,M,D)=>{const U=(I-b)/(D-1),$=(M-T)/(D-1),W=l.length;for(let K=0;K<D;K++){const ae=b+K*U,he=T+K*$;l.emplaceBack(ae,he);const pe=$g(ae,he,r),fe=Ca(pe,pe,n);p.emplaceBack(fe[0],fe[1],fe[2]),u.emplaceBack(W+K)}},x=Gt;f(0,0,x,0,16),f(x,0,x,x,16),f(x,x,0,x,16),f(0,x,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,vu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,jg.members),this._tileDebugSegments=Wi.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugTextBuffer(e,r,n){const l=new te,u=new lt,p=new ie,f=25;u.reserve(32),l.reserve(f),p.reserve(f);const x=(b,T)=>f*b+T;for(let b=0;b<f;b++){const T=2048*b;for(let I=0;I<f;I++){const M=2048*I;l.emplaceBack(M,T);const D=$g(M,T,r),U=Ca(D,D,n);p.emplaceBack(U[0],U[1],U[2])}}for(let b=0;b<4;b++)for(let T=0;T<4;T++){const I=x(b,T),M=x(b,T+1),D=x(b+1,T),U=x(b+1,T+1);u.emplaceBack(I,M,D),u.emplaceBack(D,M,U)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(u),this._tileDebugTextBuffer=e.createVertexBuffer(l,vu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(p,jg.members),this._tileDebugTextSegments=Wi.simpleSegment(0,0,f,32)}}class cb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},It(this.stateChanges[e][l],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])n[u]||(this.deletedStates[e][l][u]=null)}else for(const u in n)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(n in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][n]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const n=String(r),l=It({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][r];if(u===null)return{};for(const p in u)delete l[p]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const n={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const p in this.stateChanges[l])this.state[l][p]||(this.state[l][p]={}),It(this.state[l][p],this.stateChanges[l][p]),u[p]=this.state[l][p];n[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const p in this.state[l])u[p]={},this.state[l][p]={};else for(const p in this.deletedStates[l]){if(this.deletedStates[l][p]===null)this.state[l][p]={};else for(const f of Object.keys(this.deletedStates[l][p]))delete this.state[l][p][f];u[p]=this.state[l][p]}n[l]=n[l]||{},It(n[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const l in e)e[l].setFeatureState(n,r)}}class ty{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function iy(i,e,r,n){let l=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(n[p])<1e-15){if(r[p]<i[p]||r[p]>e[p])return null}else{const f=1/n[p];let x=(i[p]-r[p])*f,b=(e[p]-r[p])*f;if(x>b){const T=x;x=b,b=T}if(x>l&&(l=x),b<u&&(u=b),l>u)return null}return l}function ry(i,e,r,n,l,u,p,f,x,b,T){const I=n-i,M=l-e,D=u-r,U=p-i,$=f-e,W=x-r,K=T[1]*W-T[2]*$,ae=T[2]*U-T[0]*W,he=T[0]*$-T[1]*U,pe=I*K+M*ae+D*he;if(Math.abs(pe)<1e-15)return null;const fe=1/pe,me=b[0]-i,Ie=b[1]-e,ke=b[2]-r,Le=(me*K+Ie*ae+ke*he)*fe;if(Le<0||Le>1)return null;const Oe=Ie*D-ke*M,Te=ke*I-me*D,De=me*M-Ie*I,je=(T[0]*Oe+T[1]*Te+T[2]*De)*fe;return je<0||Le+je>1?null:(U*Oe+$*Te+W*De)*fe}function ny(i,e,r){return(i-e)/(r-e)}function oy(i,e,r,n,l,u,p,f,x){const b=1<<r,T=u-n,I=p-l,M=(i+1)/b*T+n,D=(e+0)/b*I+l,U=(e+1)/b*I+l;f[0]=(i+0)/b*T+n,f[1]=D,x[0]=M,x[1]=U}class sy{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const p=Math.ceil(Math.log2(u.dim/8)),f=[];let x=Math.ceil(Math.pow(2,p));const b=1/x,T=(D,U,$,W,K)=>{const ae=W?1:0,he=(D+1)*$-ae,pe=U*$,fe=(U+1)*$-ae;K[0]=D*$,K[1]=pe,K[2]=he,K[3]=fe};let I=new ty(x);const M=[];for(let D=0;D<x*x;D++){T(D%x,Math.floor(D/x),b,!1,M);const U=Ps(M[0],M[1],u),$=Ps(M[2],M[1],u),W=Ps(M[2],M[3],u),K=Ps(M[0],M[3],u);I.minimums.push(Math.min(U,$,W,K)),I.maximums.push(Math.max(U,$,W,K)),I.leaves.push(1)}for(f.push(I),x/=2;x>=1;x/=2){const D=f[f.length-1];I=new ty(x);for(let U=0;U<x*x;U++){T(U%x,Math.floor(U/x),2,!0,M);const $=D.getElevation(M[0],M[1]),W=D.getElevation(M[2],M[1]),K=D.getElevation(M[2],M[3]),ae=D.getElevation(M[0],M[3]),he=D.isLeaf(M[0],M[1]),pe=D.isLeaf(M[2],M[1]),fe=D.isLeaf(M[2],M[3]),me=D.isLeaf(M[0],M[3]),Ie=Math.min($.min,W.min,K.min,ae.min),ke=Math.max($.max,W.max,K.max,ae.max),Le=he&&pe&&fe&&me;I.maximums.push(ke),I.minimums.push(Ie),I.leaves.push(ke-Ie<=5&&Le?1:0)}f.push(I)}return f}(this.dem),n=r.length-1,l=r[n];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,l,u,p,f=1){return iy([e,r,-100],[n,l,this.maximums[0]*f],u,p)}raycast(e,r,n,l,u,p,f=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,r,n,l,u,p,f);if(x==null)return null;const b=[],T=[],I=[],M=[],D=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:U,t:$,nodex:W,nodey:K,depth:ae}=D.pop();if(this.leaves[U]){oy(W,K,ae,e,r,n,l,I,M);const pe=1<<ae,fe=(W+0)/pe,me=(W+1)/pe,Ie=(K+0)/pe,ke=(K+1)/pe,Le=Ps(fe,Ie,this.dem)*f,Oe=Ps(me,Ie,this.dem)*f,Te=Ps(me,ke,this.dem)*f,De=Ps(fe,ke,this.dem)*f,je=ry(I[0],I[1],Le,M[0],I[1],Oe,M[0],M[1],Te,u,p),Qe=ry(M[0],M[1],Te,I[0],M[1],De,I[0],I[1],Le,u,p),Ge=Math.min(je!==null?je:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(Ge!==Number.MAX_VALUE)return Ge;{const He=Kp([],u,p,$);if(ay(Le,Oe,De,Te,ny(He[0],I[0],M[0]),ny(He[1],I[1],M[1]))>=He[2])return $}continue}let he=0;for(let pe=0;pe<this._siblingOffset.length;pe++){oy((W<<1)+this._siblingOffset[pe][0],(K<<1)+this._siblingOffset[pe][1],ae+1,e,r,n,l,I,M),I[2]=-100,M[2]=this.maximums[this.childOffsets[U]+pe]*f;const fe=iy(I,M,u,p);if(fe!=null){const me=fe;b[pe]=me;let Ie=!1;for(let ke=0;ke<he&&!Ie;ke++)me>=b[T[ke]]&&(T.splice(ke,0,pe),Ie=!0);Ie||(T[he]=pe),he++}}for(let pe=0;pe<he;pe++){const fe=T[pe];D.push({idx:this.childOffsets[U]+fe,t:b[fe],nodex:(W<<1)+this._siblingOffset[fe][0],nodey:(K<<1)+this._siblingOffset[fe][1],depth:ae+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,l,u){if(e[l].isLeaf(r,n)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=l-1,f=e[p];let x=0,b=0;for(let T=0;T<this._siblingOffset.length;T++){const I=2*r+this._siblingOffset[T][0],M=2*n+this._siblingOffset[T][1],D=f.getElevation(I,M),U=f.isLeaf(I,M),$=this._addNode(D.min,D.max,U);U&&(x|=1<<T),b||(b=$)}for(let T=0;T<this._siblingOffset.length;T++)x&1<<T||this._construct(e,2*r+this._siblingOffset[T][0],2*n+this._siblingOffset[T][1],p,b+T)}}function ay(i,e,r,n,l,u){return St(St(i,r,u),St(e,n,u),l)}function Ps(i,e,r){const n=r.dim,l=Ke(i*n-.5,0,n-1),u=Ke(e*n-.5,0,n-1),p=Math.floor(l),f=Math.floor(u),x=Math.min(p+1,n-1),b=Math.min(f+1,n-1);return ay(r.get(p,f),r.get(x,f),r.get(p,b),r.get(x,b),l-p,u-f)}const ly={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class xd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,l=!1,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Yt(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=l,!l){for(let x=0;x<p;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(p,x)]=f[this._idx(p-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,p)]=f[this._idx(x,p-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(p,-1)]=f[this._idx(p-1,0)],f[this._idx(-1,p)]=f[this._idx(0,p-1)],f[this._idx(p,p)]=f[this._idx(p-1,p-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new sy(this)}get(e,r,n=!1){n&&(e=Ke(e,-1,this.dim),r=Ke(r,-1,this.dim));const l=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[l],this.pixels[l+1],this.pixels[l+2])}static getUnpackVector(e){return ly[e]}get unpackVector(){return ly[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){const n=[0,0,0,0],l=xd.getUnpackVector(r);let u=Math.floor((e+l[3])/l[2]);return n[2]=u%256,u=Math.floor(u/256),n[1]=u%256,u=Math.floor(u/256),n[0]=u,n}getPixels(){return new nn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,p=n*this.dim,f=n*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(n){case-1:p=f-1;break;case 1:f=p+1}const x=-r*this.dim,b=-n*this.dim;for(let T=p;T<f;T++)for(let I=l;I<u;I++){const M=4*this._idx(I,T),D=4*this._idx(I+x,T+b);this.pixels[M+0]=e.pixels[D+0],this.pixels[M+1]=e.pixels[D+1],this.pixels[M+2]=e.pixels[D+2],this.pixels[M+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}st(xd,"DEMData"),st(sy,"DemMinMaxQuadTree",{omit:["dem"]});class ub{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:r,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},n)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const n=e.wrapped().key,l=r===void 0?0:this.data[n].indexOf(r),u=this.data[n][l];return this.data[n].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const n in this.data)for(const l of this.data[n])e(l.value)||r.push(l);for(const n of r)this.remove(n.value.tileID,n)}}class $l{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}$l.ReadOnly=!1,$l.ReadWrite=!0,$l.disabled=new $l(519,$l.ReadOnly,[0,1]);const kf=7680;class zf{constructor(e,r,n,l,u,p){this.test=e,this.ref=r,this.mask=n,this.fail=l,this.depthFail=u,this.pass=p}}zf.disabled=new zf({func:519,mask:0},0,0,kf,kf,kf);class Ao{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}Ao.Replace=[1,0],Ao.disabled=new Ao(Ao.Replace,pi.transparent,[!1,!1,!1,!1]),Ao.unblended=new Ao(Ao.Replace,pi.transparent,[!0,!0,!0,!0]),Ao.alphaBlended=new Ao([1,771],pi.transparent,[!0,!0,!0,!0]);const Pf=1029,Df=2305;class Jn{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}Jn.disabled=new Jn(!1,Pf,Df),Jn.backCCW=new Jn(!0,Pf,Df),Jn.backCW=new Jn(!0,Pf,2304),Jn.frontCW=new Jn(!0,1028,2304),Jn.frontCCW=new Jn(!0,1028,Df);class za extends Ot{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new ub(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new cb,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const r in this._tiles){const n=this._tiles[r];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(e),n.prepare(this.map.style.imageManager)}else for(const r in this._tiles){const n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Dt(this._tiles).map(e=>e.tileID).sort(cy).map(e=>e.key)}getRenderableIds(e){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,l)=>{const u=n.tileID,p=l.tileID,f=new B(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),x=new B(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-p.overscaledZ||x.y-f.y||x.x-f.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(cy).map(n=>n.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new wt(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ce.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new bt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const u=r[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const p=this.getTileByID(u);n(e,p),n(p,e)}}function n(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let p=u.tileID.canonical.x-l.tileID.canonical.x;const f=u.tileID.canonical.y-l.tileID.canonical.y,x=Math.pow(2,l.tileID.canonical.z),b=u.tileID.key;p===0&&f===0||Math.abs(f)>1||(Math.abs(p)>1&&(Math.abs(p+x)===1?p+=x:Math.abs(p-x)===1&&(p-=x)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,p,f),l.neighboringTiles&&l.neighboringTiles[b]&&(l.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,l){for(const u in this._tiles){let p=this._tiles[u];if(l[u]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>n)continue;let f=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){const b=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[b.key],p&&p.hasData()&&(f=b)}let x=f;for(;x.overscaledZ>r;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){l[f.key]=f;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){const l=e.scaledTo(n),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const n=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,u=Math.floor(n*l*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(f)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const n={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+r),n[u.tileID.key]=u}this._tiles=n;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(f=>new Lr(f.canonical.z,f.wrap,f.canonical.z,f.canonical.x,f.canonical.y)):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(f=>this._source.hasTile(f)))):l=[];const u=this._updateRetainedTiles(l);if(uy(this._source.type)&&l.length!==0){const f={},x={},b=Object.keys(u);for(const I of b){const M=u[I],D=this._tiles[I];if(!D||D.fadeEndTime&&D.fadeEndTime<=Ce.now())continue;const U=this.findLoadedParent(M,Math.max(M.overscaledZ-za.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),f[U.tileID.key]=U.tileID),x[I]=M}const T=l[l.length-1].overscaledZ;for(const I in this._tiles){const M=this._tiles[I];if(u[I]||!M.hasData())continue;let D=M.tileID;for(;D.overscaledZ>T;){D=D.scaledTo(D.overscaledZ-1);const U=this._tiles[D.key];if(U&&U.hasData()&&x[D.key]){u[I]=M.tileID;break}}}for(const I in f)u[I]||(this._coveredTiles[I]=!0,u[I]=f[I])}for(const f in u)this._tiles[f].clearFadeHold();const p=function(f,x){const b=[];for(const T in f)T in x||b.push(T);return b}(this._tiles,u);for(const f of p){const x=this._tiles[f];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+f)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const n={},l=e.reduce((b,T)=>Math.min(b,T.overscaledZ),1/0),u=e[0].overscaledZ,p=Math.max(u-za.maxOverzooming,this._source.minzoom),f=Math.max(u+za.maxUnderzooming,this._source.minzoom),x={};for(const b of e){const T=this._addTile(b);r[b.key]=b,T.hasData()||l<this._source.maxzoom&&(x[b.key]=b)}this._retainLoadedChildren(x,l,f,r);for(const b of e){let T=this._tiles[b.key];if(T.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const M=b.children(this._source.maxzoom)[0],D=this.getTile(M);if(D&&D.hasData()){r[M.key]=M;continue}}else{const M=b.children(this._source.maxzoom);if(r[M[0].key]&&r[M[1].key]&&r[M[2].key]&&r[M[3].key])continue}let I=T.wasRequested();for(let M=b.overscaledZ-1;M>=p;--M){const D=b.scaledTo(M);if(n[D.key]||(n[D.key]=!0,T=this.getTile(D),!T&&I&&(T=this._addTile(D)),T&&(r[D.key]=D,I=T.wasRequested(),T.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let n,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){n=this._loadedParentTiles[l.key];break}r.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(n=this._getLoadedTile(u),n)break;l=u}for(const u of r)this._loadedParentTiles[u]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const n=Boolean(r);if(!n){const l=this.map?this.map.painter:null;r=new Mf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new bt("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,n){const l=[],u=this.transform;if(!u)return l;for(const p in this._tiles){const f=this._tiles[p];if(n&&f.clearQueryDebugViz(),f.holdingForFade())continue;const x=e.containsTile(f,u,r);x&&l.push(x)}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(uy(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Ce.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){const l=this._tiles[e];l&&l.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(const n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}_preloadTiles(e,r){const n=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,p=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const f of l){const x=f.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of x)n.set(b.key,b);this.usedForTerrain&&f.updateElevation(!1)}Tt(Array.from(n.values()),(f,x)=>{const b=new Mf(f,this._source.tileSize*f.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,T=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),x(T,b)})},r)}}function cy(i,e){const r=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function uy(i){return i==="raster"||i==="image"||i==="video"}za.maxOverzooming=10,za.maxUnderzooming=3;class vd{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const l=n||e.findDEMTileFor(r);if(!l||!l.dem)return;const u=l.dem,p=l.tileID,f=1<<r.canonical.z-p.canonical.z;return new vd(l,l.tileSize/Gt/f,[(r.canonical.x/f-p.canonical.x)*u.dim,(r.canonical.y/f-p.canonical.y)*u.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(n);return new B(l,u)}getElevationAt(e,r,n,l){const u=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],f=Math.floor(u),x=Math.floor(p),b=this._dem;return l=!!l,n?St(St(b.get(f,x,l),b.get(f,x+1,l),p-x),St(b.get(f+1,x,l),b.get(f+1,x+1,l),p-x),u-f):b.get(f,x,l)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ml(1,e)*this._dem.stride}}class hy{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new po(Gt,16,0),this.featureIndexArray=new Oi,this.promoteId=r}insert(e,r,n,l,u,p=0){const f=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,l,u,p);const x=this.grid;for(let b=0;b<r.length;b++){const T=r[b],I=[1/0,1/0,-1/0,-1/0];for(let M=0;M<T.length;M++){const D=T[M];I[0]=Math.min(I[0],D.x),I[1]=Math.min(I[1],D.y),I[2]=Math.max(I[2],D.x),I[3]=Math.max(I[3],D.y)}I[0]<Gt&&I[1]<Gt&&I[2]>=0&&I[3]>=0&&x.insert(f,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ma.VectorTile(new _u(this.rawTileData)).layers,this.sourceLayerCoder=new Qg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,l){this.loadVTLayers();const u=e.params||{},p=co(u.filter),f=e.tileResult,x=e.transform,b=f.bufferedTilespaceBounds,T=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(U,$,W,K)=>P_(f.bufferedTilespaceGeometry,U,$,W,K));T.sort(hb);let I=null;x.elevation&&T.length>0&&(I=vd.create(x.elevation,this.tileID));const M={};let D;for(let U=0;U<T.length;U++){const $=T[U];if($===D)continue;D=$;const W=this.featureIndexArray.get($);let K=null;this.loadMatchingFeature(M,W,p,u.layers,u.availableImages,r,n,l,(ae,he,pe,fe=0)=>(K||(K=Xo(ae,this.tileID.canonical,e.tileTransform)),he.queryIntersectsFeature(f,ae,pe,K,this.z,e.transform,e.pixelPosMatrix,I,fe)))}return M}loadMatchingFeature(e,r,n,l,u,p,f,x,b){const{featureIndex:T,bucketIndex:I,sourceLayerIndex:M,layoutVertexArrayOffset:D}=r,U=this.bucketLayerIDs[I];if(l&&!function(ae,he){for(let pe=0;pe<ae.length;pe++)if(he.indexOf(ae[pe])>=0)return!0;return!1}(l,U))return;const $=this.sourceLayerCoder.decode(M),W=this.vtLayers[$].feature(T);if(n.needGeometry){const ae=Sa(W,!0);if(!n.filter(new zi(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!n.filter(new zi(this.tileID.overscaledZ),W))return;const K=this.getId(W,$);for(let ae=0;ae<U.length;ae++){const he=U[ae];if(l&&l.indexOf(he)<0)continue;const pe=p[he];if(!pe)continue;let fe={};K!==void 0&&x&&(fe=x.getState(pe.sourceLayer||"_geojsonTileLayer",K));const me=It({},f[he]);me.paint=dy(me.paint,pe.paint,W,fe,u),me.layout=dy(me.layout,pe.layout,W,fe,u);const Ie=!b||b(W,pe,fe,D);if(!Ie)continue;const ke=new Yg(W,this.z,this.x,this.y,K);ke.layer=me;let Le=e[he];Le===void 0&&(Le=e[he]=[]),Le.push({featureIndex:T,feature:ke,intersectionZ:Ie})}}lookupSymbolFeatures(e,r,n,l,u,p,f,x){const b={};this.loadVTLayers();const T=co(u);for(const I of e)this.loadMatchingFeature(b,{bucketIndex:n,sourceLayerIndex:l,featureIndex:I,layoutVertexArrayOffset:0},T,p,f,x,r);return b}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(n),u=this.vtFeatures[l];if(u[r])return u[r];const p=this.vtLayers[l].feature(r);return u[r]=p,p}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function dy(i,e,r,n,l){return ki(i,(u,p)=>{const f=e instanceof y?e.get(p):null;return f&&f.evaluate?f.evaluate(r,n,l):f})}function hb(i,e){return e-i}st(hy,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class py{constructor(e){const r={},n=[];for(const f in e){const x=e[f],b=r[f]={};for(const T in x.glyphs){const I=x.glyphs[+T];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const M=I.metrics.localGlyph?2:1,D={x:0,y:0,w:I.bitmap.width+2*M,h:I.bitmap.height+2*M};n.push(D),b[T]=D}}const{w:l,h:u}=hf(n),p=new Ho({width:l||1,height:u||1});for(const f in e){const x=e[f];for(const b in x.glyphs){const T=x.glyphs[+b];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;const I=r[f][b],M=T.metrics.localGlyph?2:1;Ho.copy(T.bitmap,p,{x:0,y:0},{x:I.x+M,y:I.y+M},T.bitmap)}}this.image=p,this.positions=r}}st(py,"GlyphAtlas");class db{constructor(e){this.tileID=new Lr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ka(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,n,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new Hn;const p=new Qg(Object.keys(e.layers).sort()),f=new hy(this.tileID,this.promoteId);f.bucketLayerIDs=[];const x={},b=new Tf(256,256),T={featureIndex:f,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:n},I=r.familiesBySource[this.source];for(const fe in I){const me=e.layers[fe];if(!me)continue;let Ie=!1,ke=!1;for(const Te of I[fe])Te[0].type==="symbol"?Ie=!0:ke=!0;if(this.isSymbolTile===!0&&!Ie||this.isSymbolTile===!1&&!ke)continue;me.version===1&&Yt(`Vector tile source "${this.source}" layer "${fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Le=p.encode(fe),Oe=[];for(let Te=0;Te<me.length;Te++){const De=me.feature(Te),je=f.getId(De,fe);Oe.push({feature:De,id:je,index:Te,sourceLayerIndex:Le})}for(const Te of I[fe]){const De=Te[0];this.isSymbolTile!==void 0&&De.type==="symbol"!==this.isSymbolTile||De.minzoom&&this.zoom<Math.floor(De.minzoom)||De.maxzoom&&this.zoom>=De.maxzoom||De.visibility!=="none"&&(Bf(Te,this.zoom,n),(x[De.id]=De.createBucket({index:f.bucketLayerIDs.length,layers:Te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Le,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:n})).populate(Oe,T,this.tileID.canonical,this.tileTransform),f.bucketLayerIDs.push(Te.map(je=>je.id)))}}let M,D,U,$;b.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},K=ki(T.glyphDependencies,fe=>Object.keys(fe).map(Number));Object.keys(K).length?l.send("getGlyphs",{uid:this.uid,stacks:K},(fe,me)=>{M||(M=fe,D=me,pe.call(this))},void 0,!1,W):D={};const ae=Object.keys(T.iconDependencies);ae.length?l.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(fe,me)=>{M||(M=fe,U=me,pe.call(this))},void 0,!1,W):U={};const he=Object.keys(T.patternDependencies);function pe(){if(M)return u(M);if(D&&U&&$){const fe=new py(D),me=new yg(U,$);for(const Ie in x){const ke=x[Ie];ke instanceof Ms?(Bf(ke.layers,this.zoom,n),V1(ke,D,fe.positions,U,me.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):ke.hasPattern&&(ke instanceof ad||ke instanceof od||ke instanceof pu)&&(Bf(ke.layers,this.zoom,n),ke.addFeatures(T,this.tileID.canonical,me.patternPositions,n,this.tileTransform))}this.status="done",u(null,{buckets:Dt(x).filter(Ie=>!Ie.isEmpty()),featureIndex:f,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fe.image,lineAtlas:b,imageAtlas:me,glyphMap:this.returnDependencies?D:null,iconMap:this.returnDependencies?U:null,glyphPositions:this.returnDependencies?fe.positions:null})}}he.length?l.send("getImages",{icons:he,source:this.source,tileID:this.tileID,type:"patterns"},(fe,me)=>{M||(M=fe,$=me,pe.call(this))},void 0,!1,W):$={},pe.call(this)}}function Bf(i,e,r){const n=new zi(e);for(const l of i)l.recalculate(n,r)}class fy{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[p,f]=u.result;return this.scheduler?this.scheduler.add(()=>{l(p,f)},r):l(p,f),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n((p,f)=>{u.result=[p,f];for(const x of u.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,f)},r):x(p,f);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function my(i,e,r){const n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},l=>{const u=ne(i.request,(p,f,x,b)=>{p?l(p):f&&l(null,{vectorTile:r?void 0:new Ma.VectorTile(new _u(f)),rawData:f,cacheControl:x,expires:b})});return()=>{u.cancel(),l()}},e)}const pb=go(new Float32Array(16));class Ds{constructor(e){this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Ei(0,0)}projectTilePoint(e,r,n){return{x:e,y:r,z:0}}locationPoint(e,r){return e._coordinatePoint(e.locationCoordinate(r),!1)}pixelsPerMeter(e,r){return Ml(1,e)*r}farthestPixelDistance(e){return function(r,n){const l=r.fovAboveCenter,u=r.elevation?r.elevation.getMinElevationBelowMSL()*n:0,p=(r._camera.position[2]*r.worldSize-u)/Math.cos(r._pitch),f=Math.sin(l)*p/Math.sin(Math.max(Math.PI/2-r._pitch-l,.01)),x=Math.sin(r._pitch)*f+p;return Math.min(1.01*x,p*(1/r._horizonShift))}(e,e.pixelsPerMeter)}pointCoordinate(e,r,n,l){const u=e.horizonLineFromTop(!1),p=new B(r,Math.max(u,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,l))}createInversionMatrix(e,r){return pb}createTileMatrix(e,r,n){let l,u,p;const f=n.canonical,x=go(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=ka(f,this);l=1,u=b.x+n.wrap*b.scale,p=b.y,Ss(x,x,[l/b.scale,l/b.scale,e.pixelsPerMeter/r])}else l=r/e.zoomScale(f.z),u=(f.x+Math.pow(2,f.z)*n.wrap)*l,p=f.y*l;return Ia(x,x,[u,p,0]),Ss(x,x,[l/Gt,l/Gt,1]),x}upVector(e,r,n){return[0,0,1]}upVectorScale(e,r,n){return{metersToTile:1,metersToLabelSpace:1}}}class fb extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:tu(e),y:Cl(r),z:0}}unproject(e,r){const n=Ln(e),l=wr(r);return new Ei(n,l)}}class mb extends Ds{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,n]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(Ae(r));this.n=(l+Math.sin(Ae(n)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n,c:l,r0:u}=this,p=Ae(e-this.center[0]),f=Ae(r),x=Math.sqrt(l-2*n*Math.sin(f))/n;return{x:x*Math.sin(p*n),y:x*Math.cos(p*n)-u,z:0}}unproject(e,r){const{n,c:l,r0:u}=this,p=u+r;let f=Math.atan2(e,Math.abs(p))*Math.sign(p);p*n<0&&(f-=Math.PI*Math.sign(e)*Math.sign(p));const x=Ae(this.center[0])*n;f=gt(f,-Math.PI-x,Math.PI-x);const b=Fe(f/n)+this.center[0],T=Math.asin(Ke((l-(e*e+p*p)*n*n)/(2*n),-1,1)),I=Ke(Fe(T),-85.051129,_o);return new Ei(b,I)}}const wu=1.340264,Eu=-.081106,Tu=893e-6,Su=.003796,Ad=Math.sqrt(3)/2;class _b extends Ds{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(Ad*Math.sin(r)),l=n*n,u=l*l*l;return{x:.5*(e*Math.cos(n)/(Ad*(wu+3*Eu*l+u*(7*Tu+9*Su*l)))/Math.PI+.5),y:1-.5*(n*(wu+Eu*l+u*(Tu+Su*l))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,l=n*n,u=l*l*l;for(let T,I,M,D=0;D<12&&(I=n*(wu+Eu*l+u*(Tu+Su*l))-r,M=wu+3*Eu*l+u*(7*Tu+9*Su*l),T=I/M,n=Ke(n-T,-Math.PI/3,Math.PI/3),l=n*n,u=l*l*l,!(Math.abs(T)<1e-12));++D);const p=Ad*e*(wu+3*Eu*l+u*(7*Tu+9*Su*l))/Math.cos(n),f=Math.asin(Math.sin(n)/Ad),x=Ke(180*p/Math.PI,-180,180),b=Ke(180*f/Math.PI,-85.051129,_o);return new Ei(x,b)}}class gb extends Ds{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const n=360*(e-.5),l=Ke(360*(.5-r),-85.051129,_o);return new Ei(n,l)}}const Gl=Math.PI/2;function bd(i){return Math.tan((Gl+i)/2)}class yb extends Ds{constructor(e){super(e),this.center=e.center||[0,30];const[r,n]=this.parallels=e.parallels||[30,30],l=Ae(r),u=Ae(n),p=Math.cos(l);this.n=l===u?Math.sin(l):Math.log(p/Math.cos(u))/Math.log(bd(u)/bd(l)),this.f=p*Math.pow(bd(l),this.n)/this.n}project(e,r){r=Ae(r),e=Ae(e-this.center[0]);const n=1e-6,{n:l,f:u}=this;u>0?r<-Gl+n&&(r=-Gl+n):r>Gl-n&&(r=Gl-n);const p=u/Math.pow(bd(r),l),f=p*Math.sin(l*e),x=u-p*Math.cos(l*e);return{x:.5*(f/Math.PI+.5),y:1-.5*(x/Math.PI+.5),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;const{n,f:l}=this,u=l-r,p=Math.sign(u),f=Math.sign(n)*Math.sqrt(e*e+u*u);let x=Math.atan2(e,Math.abs(u))*p;u*n<0&&(x-=Math.PI*Math.sign(e)*p);const b=Ke(Fe(x/n)+this.center[0],-180,180),T=Ke(Fe(2*Math.atan(Math.pow(l/f,1/n))-Gl),-85.051129,_o);return new Ei(b,T)}}const _y=Ae(_o);class xb extends Ds{project(e,r){const n=(r=Ae(r))*r,l=n*n;return{x:.5*((e=Ae(e))*(.8707-.131979*n+l*(l*(.003971*n-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+n*(.015085+l*(.028874*n-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,l=25,u=0,p=n*n;do{p=n*n;const b=p*p;u=(n*(1.007226+p*(.015085+b*(.028874*p-.044475-.005916*b)))-r)/(1.007226+p*(.045255+b*(.259866*p-.311325-.005916*11*b))),n=Ke(n-u,-_y,_y)}while(Math.abs(u)>1e-6&&--l>0);p=n*n;const f=Ke(Fe(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),x=Fe(n);return new Ei(f,x)}}const gy=Ae(_o);class vb extends Ds{project(e,r){r=Ae(r),e=Ae(e);const n=Math.cos(r),l=2/Math.PI,u=Math.acos(n*Math.cos(e/2)),p=Math.sin(u)/u,f=.5*(e*l+2*n*Math.sin(e/2)/p)||0,x=.5*(r+Math.sin(r)/p)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,r){let n=e=(2*e-.5)*Math.PI,l=r=(2*(1-r)-1)*Math.PI,u=25;const p=1e-6;let f=0,x=0;do{const b=Math.cos(l),T=Math.sin(l),I=2*T*b,M=T*T,D=b*b,U=Math.cos(n/2),$=Math.sin(n/2),W=2*U*$,K=$*$,ae=1-D*U*U,he=ae?1/ae:0,pe=ae?Math.acos(b*U)*Math.sqrt(1/ae):0,fe=.5*(2*pe*b*$+2*n/Math.PI)-e,me=.5*(pe*T+l)-r,Ie=.5*he*(D*K+pe*b*U*M)+1/Math.PI,ke=he*(W*I/4-pe*T*$),Le=.125*he*(I*$-pe*T*D*W),Oe=.5*he*(M*U+pe*K*b)+.5,Te=ke*Le-Oe*Ie;f=(me*ke-fe*Oe)/Te,x=(fe*Le-me*Ie)/Te,n=Ke(n-f,-Math.PI,Math.PI),l=Ke(l-x,-gy,gy)}while((Math.abs(f)>p||Math.abs(x)>p)&&--u>0);return new Ei(Fe(n),Fe(l))}}class yy extends Ds{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:n,cosPhi:l}=this;return{x:Ae(e)*l*n+.5,y:-Math.sin(Ae(r))/l*n+.5,z:0}}unproject(e,r){const{scale:n,cosPhi:l}=this,u=-(r-.5)/n,p=Ke(Fe((e-.5)/n)/l,-180,180),f=Math.asin(Ke(u*l,-1,1)),x=Ke(Fe(f),-85.051129,_o);return new Ei(p,x)}}o.ARRAY_TYPE=rn,o.AUTH_ERR_MSG=Lt,o.Aabb=En,o.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ui(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=xt()?i:Q,this.scheduler=new eb}send(i,e,r,n,l=!1,u){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=u,this.callbacks[p]=r);const f=se(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!r,targetMapId:n,mustQueue:l,sourceMapId:this.mapId,data:ga(e,f)},f),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){const e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||xt()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(ys(e.error)):r(null,ys(e.data)))}else{const r=se(this.globalScope)?void 0:[],n=e.hasCallback?(u,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:u?ga(u):null,data:ga(p,r)},r)}:u=>{},l=ys(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,n);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=gd,o.Color=pi,o.ColorMode=Ao,o.CullFaceMode=Jn,o.DEMData=xd,o.DataConstantProperty=v,o.DedupedRequest=fy,o.DepthMode=$l,o.EXTENT=Gt,o.Elevation=class{isDataAvailableAtPoint(i){const e=this._source();if(!e||i.y<0||i.y>1)return!1;const r=e.getSource().maxzoom,n=1<<r,l=Math.floor(i.x),u=Math.floor((i.x-l)*n),p=Math.floor(i.y*n),f=this.findDEMTileFor(new Lr(r,l,r,u,p));return!(!f||!f.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);const n=this._source();if(!n||i.y<0||i.y>1)return e;const l=n.getSource().maxzoom,u=1<<l,p=Math.floor(i.x),f=i.x-p,x=new Lr(l,p,l,Math.floor(f*u),Math.floor(i.y*u)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;const T=b.dem,I=1<<b.tileID.canonical.z,M=(f*I-b.tileID.canonical.x)*T.dim,D=(i.y*I-b.tileID.canonical.y)*T.dim,U=Math.floor(M),$=Math.floor(D);return(r?this.exaggeration():1)*St(St(T.get(U,$),T.get(U,$+1),D-$),St(T.get(U+1,$),T.get(U+1,$+1),D-$),M-U)}getAtTileOffset(i,e,r){const n=1<<i.canonical.z;return this.getAtPointOrZero(new Qh(i.wrap+(i.canonical.x+e/Gt)/n,(i.canonical.y+r/Gt)/n))}getAtTileOffsetFunc(i,e,r,n){return l=>{const u=this.getAtTileOffset(i,l.x,l.y),p=n.upVector(i.canonical,l.x,l.y);return ru(p,p,u*n.upVectorScale(i.canonical,e,r).metersToTile),p}}getForTilePoints(i,e,r,n){const l=vd.create(this,i,n);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,l=1<<i.canonical.z-n.canonical.z;let u=i.canonical.x/l-n.canonical.x,p=i.canonical.y/l-n.canonical.y,f=0;for(let x=0;x<i.canonical.z-n.canonical.z&&!r.leaves[f];x++){u*=2,p*=2;const b=2*Math.floor(p)+Math.floor(u);f=r.childOffsets[f]+b,u%=1,p%=1}return{min:this.exaggeration()*r.minimums[f],max:this.exaggeration()*r.maximums[f]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=wt,o.EvaluationParameters=zi,o.Event=bt,o.Evented=Ot,o.FillExtrusionBucket=pu,o.Frustum=Jp,o.GLOBE_RADIUS=Nl,o.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i),this._createAtmosphere(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(i){const e=new te,r=new lt,n=65;for(let l=0;l<n;l++)for(let u=0;u<n;u++)e.emplaceBack(u,l);for(let l=0;l<64;l++)for(let u=0;u<64;u++){const p=l*n+u;r.emplaceBack(p+1,p,p+n),r.emplaceBack(p+n,p+n+1,p+1)}this._gridBuffer=i.createVertexBuffer(e,vu.members),this._gridIndexBuffer=i.createIndexBuffer(r,!0),this._gridSegments=Wi.simpleSegment(0,0,4225,8192)}_createPoles(i){const e=new lt;for(let l=0;l<=64;l++)e.emplaceBack(0,l+1,l+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const r=new kt,n=new kt;this._poleSegments=[];for(let l=0,u=0;l<5;l++){const p=1<<l,f=512*p/Math.PI/2,x=360/p;r.emplaceBack(0,-f,0,0,0,.5,0),n.emplaceBack(0,-f,0,0,0,.5,1);for(let b=0;b<=64;b++){const T=b/64,I=St(0,x,T),[M,D,U]=Ng(sb,ab,I,f);r.emplaceBack(M,D,U,0,0,T,0),n.emplaceBack(M,D,U,0,0,T,1)}this._poleSegments.push(Wi.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,Vg,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(n,Vg,!1)}_createAtmosphere(i){const e=new qt;e.emplaceBack(-1,1,1,0,0),e.emplaceBack(1,1,1,1,0),e.emplaceBack(1,-1,1,1,1),e.emplaceBack(-1,-1,1,0,1);const r=new lt;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.atmosphereVertexBuffer=i.createVertexBuffer(e,ib.members),this.atmosphereIndexBuffer=i.createIndexBuffer(r),this.atmosphereSegments=Wi.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i){if(!this._wireframeSegments){const e=new Ut,r=64,n=r+1;for(let l=0;l<r;l++)for(let u=0;u<r;u++){const p=l*n+u;e.emplaceBack(p,p+1),e.emplaceBack(p,p+n),e.emplaceBack(p,p+n+1)}this._wireframeIndexBuffer=i.createIndexBuffer(e),this._wireframeSegments=Wi.simpleSegment(0,0,r*r,e.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},o.GlyphManager=Vl,o.ImagePosition=df,o.LineAtlas=Tf,o.LngLat=Ei,o.LngLatBounds=Ts,o.LocalGlyphMode=_f,o.MAX_MERCATOR_LATITUDE=_o,o.MercatorCoordinate=Qh,o.ONE_EM=Er,o.OverscaledTileID=Lr,o.Properties=F,o.RGBAImage=nn,o.Ray=class{constructor(i,e){this.pos=i,this.dir=e}intersectsPlane(i,e,r){const n=ou(e,this.dir);if(Math.abs(n)<1e-6)return!1;const l=((i[0]-this.pos[0])*e[0]+(i[1]-this.pos[1])*e[1]+(i[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*l,r[1]=this.pos[1]+this.dir[1]*l,r[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(i,e,r){if(function(M,D){var U=M[0],$=M[1],W=M[2],K=D[0],ae=D[1],he=D[2];return Math.abs(U-K)<=Zp*Math.max(1,Math.abs(U),Math.abs(K))&&Math.abs($-ae)<=Zp*Math.max(1,Math.abs($),Math.abs(ae))&&Math.abs(W-he)<=Zp*Math.max(1,Math.abs(W),Math.abs(he))}(this.pos,i)||e===0)return r[0]=r[1]=r[2]=0,!1;const[n,l,u]=this.dir,p=this.pos[0]-i[0],f=this.pos[1]-i[1],x=this.pos[2]-i[2],b=n*n+l*l+u*u,T=2*(p*n+f*l+x*u),I=T*T-4*b*(p*p+f*f+x*x-e*e);if(I<0){const M=Math.max(-T/2,0),D=p+n*M,U=f+l*M,$=x+u*M,W=Math.hypot(D,U,$);return r[0]=D*e/W,r[1]=U*e/W,r[2]=$*e/W,!1}{const M=(-T-Math.sqrt(I))/(2*b);if(M<0){const D=Math.hypot(p,f,x);return r[0]=p*e/D,r[1]=f*e/D,r[2]=x*e/D,!1}return r[0]=p+n*M,r[1]=f+l*M,r[2]=x+u*M,!0}}},o.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",At,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Vt(i))return i;const r=ni(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Vt(i))return i;const r=ni(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!Vt(i))return i;const r=ni(i);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,n){const l=ni(i);return Vt(i)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||n)):(l.path+=`${e}${r}`,vi(l))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Vt(i))return i;const n=ni(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${et.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${Be.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${Be.TILE_URL_VERSION}${n.path}`);const l=this._customAccessToken||function(u){for(const p of u){const f=p.match(/^access_token=(.*)$/);if(f)return f[1]}return null}(n.params)||Be.ACCESS_TOKEN;return Be.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,l)}canonicalizeTileURL(i,e){const r=ni(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${Be.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${Be.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(n+=`?${l.join("&")}`),n}canonicalizeTileset(i,e){const r=!!e&&Vt(e),n=[];for(const l of i.tiles||[])Jt(l)?n.push(this.canonicalizeTileURL(l,r)):n.push(l);return n}_makeAPIURL(i,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=ni(Be.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){const l=i.params.indexOf("secure");l>=0&&i.params.splice(l,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!Be.REQUIRE_ACCESS_TOKEN)return vi(i);if(e=e||Be.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(l=>l.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),vi(i)}},o.ResourceType=J,o.SegmentVector=Wi,o.SourceCache=za,o.StencilMode=zf,o.StructArrayLayout1ui2=oi,o.StructArrayLayout2f1f2i16=dt,o.StructArrayLayout2i4=te,o.StructArrayLayout2ui4=Ut,o.StructArrayLayout3f12=Ze,o.StructArrayLayout3ui6=lt,o.StructArrayLayout4i8=oe,o.Texture=xu,o.Tile=Mf,o.Transitionable=c,o.Uniform1f=Xh,o.Uniform1i=class extends qo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends qo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends qo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=b_,o.UniformColor=w_,o.UniformMatrix2f=class extends qo{constructor(i,e){super(i,e),this.current=iA}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},o.UniformMatrix3f=class extends qo{constructor(i,e){super(i,e),this.current=tA}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},o.UniformMatrix4f=class extends qo{constructor(i,e){super(i,e),this.current=eA}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=Hg,o.ValidationError=rt,o.VectorTileWorkerSource=class extends Ot{constructor(i,e,r,n,l){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||my,this.loading={},this.loaded={},this.deduped=new fy(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){const r=i.uid,n=i&&i.request,l=n&&n.collectResourceTiming,u=this.loading[r]=new db(i);u.abort=this.loadVectorData(i,(p,f)=>{const x=!this.loading[r];if(delete this.loading[r],x||p||!f)return u.status="done",x||(this.loaded[r]=u),e(p);const b=f.rawData,T={};f.expires&&(T.expires=f.expires),f.cacheControl&&(T.cacheControl=f.cacheControl),u.vectorTile=f.vectorTile||new Ma.VectorTile(new _u(b));const I=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,D)=>{if(M||!D)return e(M);const U={};if(l){const $=Ug(n);$.length>0&&(U.resourceTiming=JSON.parse(JSON.stringify($)))}e(null,It({rawTileData:b.slice(0)},D,T,U))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[r]=u})}reloadTile(i,e){const r=this.loaded,n=i.uid,l=this;if(r&&r[n]){const u=r[n];u.showCollisionBoxes=i.showCollisionBoxes,u.enableTerrain=!!i.enableTerrain,u.projection=i.projection,u.tileTransform=ka(i.tileID.canonical,i.projection);const p=(f,x)=>{const b=u.reloadCallback;b&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,b)),e(f,x)};u.status==="parsing"?u.reloadCallback=p:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const r=i.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(i,e){const r=this.loaded,n=i.uid;r&&r[n]&&delete r[n],e()}},o.WritingMode=Tn,o.ZoomHistory=jc,o.add=O_,o.addDynamicAttributes=vf,o.adjoint=function(i,e){var r=e[0],n=e[1],l=e[2],u=e[3],p=e[4],f=e[5],x=e[6],b=e[7],T=e[8];return i[0]=p*T-f*b,i[1]=l*b-n*T,i[2]=n*f-l*p,i[3]=f*x-u*T,i[4]=r*T-l*x,i[5]=l*u-r*f,i[6]=u*b-p*x,i[7]=n*x-r*b,i[8]=r*p-n*u,i},o.asyncAll=Tt,o.bezier=mt,o.bindAll=ui,o.boundsAttributes=Jg,o.bufferConvexPolygon=function(i,e){const r=[];for(let n=0;n<i.length;n++){const l=gt(n-1,-1,i.length-1),u=gt(n+1,-1,i.length-1),p=i[n],f=i[u],x=i[l].sub(p).unit(),b=f.sub(p).unit(),T=b.angleWithSep(x.x,x.y),I=x.add(b).unit().mult(-1*e/Math.sin(T/2));r.push(p.add(I))}return r},o.cacheEntryPossiblyAdded=function(i){ss++,ss>Lo&&(i.getActor().send("enforceCacheSizeLimit",Bo),ss=0)},o.calculateGlobeLabelMatrix=function(i,e){const{lng:r,lat:n}=i._center,l=Zg(0,0,i.worldSize/i._projectionScaler,r,n);return qp(l,l,function(u){const p=go(new Float64Array(16)),f=1/Cf(u);return Ia(p,p,u.min),Ss(p,p,[f,f,f]),p}(Au(e)))},o.calculateGlobeMatrix=qg,o.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,r=i.point,n=Ml(1,i.center.lat)*e,l=i.pixelsPerMeter,u=e/(n/i.pixelsPerMeter),p=go(new Float64Array(16));return Ia(p,p,[r.x,r.y,0]),Ss(p,p,[u,u,l]),Float32Array.from(p)},o.circumferenceAtLatitude=Up,o.clamp=Ke,o.clearTileCache=function(i){const e=Q.caches.delete(Wa);i&&e.catch(i).then(()=>i())},o.clipLine=kg,o.clone=function(i){var e=new rn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=Qi,o.collisionCircleLayout=d1,o.config=Be,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new rn(16);return rn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=L_,o.createExpression=ca,o.createLayout=re,o.createStyleLayer=function(i){return i.type==="custom"?new H1(i):new Y1[i.type](i)},o.cross=j_,o.degToRad=Ae,o.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},o.dot=ou,o.earthRadius=Op,o.ease=Rt,o.easeCubicInOut=Pt,o.emitValidationErrors=Ch,o.endsWith=Bt,o.enforceCacheSizeLimit=function(i){os(),xn&&xn.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-i;n++)e.delete(r[n])})})},o.evaluateSizeForFeature=ld,o.evaluateSizeForZoom=Rl,o.evaluateVariableOffset=Lg,o.evented=Yc,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=Ce,o.exported$1=et,o.extend=It,o.extend$1=fi,o.filterObject=Sr,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var r=e[0],n=e[1],l=e[2],u=e[3],p=r+r,f=n+n,x=l+l,b=r*p,T=n*p,I=n*f,M=l*p,D=l*f,U=l*x,$=u*p,W=u*f,K=u*x;return i[0]=1-I-U,i[1]=T+K,i[2]=M-W,i[3]=0,i[4]=T-K,i[5]=1-b-U,i[6]=D+$,i[7]=0,i[8]=M+W,i[9]=D-$,i[10]=1-b-I,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var r=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=r,i[2]=0,i[3]=-r,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ft[e]},o.getAABBPointSquareDist=function(i,e,r){let n=0;for(let l=0;l<2;++l){const u=r?r[l]:0;i[l]>u&&(n+=(i[l]-u)*(i[l]-u)),e[l]<u&&(n+=(u-e[l])*(u-e[l]))}return n},o.getAnchorAlignment=mf,o.getAnchorJustification=yf,o.getBounds=function(i){let e=1/0,r=1/0,n=-1/0,l=-1/0;for(const u of i)e=Math.min(e,u.x),r=Math.min(r,u.y),n=Math.max(n,u.x),l=Math.max(l,u.y);return{min:new B(e,r),max:new B(n,l)}},o.getColumn=function(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]},o.getGridMatrix=function(i,e){const[r,n]=e,l=.015625;return[0,(n[1]-r[1])*l,1<<i.z,(n[0]-r[0])*l,0,i.y,r[0],r[1],l]},o.getImage=it,o.getJSON=function(i,e){return H(It(i,{type:"json"}),e)},o.getMapSessionAPI=Po,o.getPerformanceMeasurement=Ug,o.getProjection=function(i){const e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new fb(i);case"equirectangular":return new gb(i);case"naturalEarth":return new xb(i);case"equalEarth":return new _b(i);case"winkelTripel":return new vb(i);case"albers":return r?new yy(i):new mb(i);case"lambertConformalConic":return r?new yy(i):new yb(i)}throw new Error(`Invalid projection name: ${i.name}`)},o.getRTLTextPluginStatus=Sl,o.getReferrer=V,o.getTilePoint=function(i,{x:e,y:r},n=0){return new B(((e-n)*i.scale-i.x)*Gt,(r*i.scale-i.y)*Gt)},o.getTileVec3=function(i,e,r=0){return iu(((e.x-r)*i.scale-i.x)*Gt,(e.y*i.scale-i.y)*Gt,S_(e.z,e.y))},o.getVideo=function(i,e){const r=Q.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<i.length;n++){const l=Q.document.createElement("source");ge(i[n])||(r.crossOrigin="Anonymous"),l.src=i[n],r.appendChild(l)}return{cancel:()=>{}}},o.globeECEFOrigin=function(i,e){const r=[0,0,0];return Ca(r,r,Gg(Au(e.canonical))),Ca(r,r,i),r},o.globePixelsToTileUnits=function(i,e){return Gt/(512*Math.pow(2,i))*Cf(Au(e))},o.globePoleMatrixForTile=function(i,e,r){const n=go(new Float64Array(16)),l=1<<i,u=360*(e/l-.5),p=r.point,f=r.worldSize/(r.tileSize*l);return Ia(n,n,[p.x,p.y,-r.worldSize/Math.PI/2]),Ss(n,n,[f,f,f]),Wp(n,n,Ae(-r._center.lat)),Xp(n,n,Ae(-r._center.lng+u)),Float32Array.from(n)},o.globeTileLatLngCorners=If,o.globeToMercatorTransition=function(i){return We(5,6,i)},o.identity=go,o.identity$1=G_,o.invert=function(i,e){var r=e[0],n=e[1],l=e[2],u=e[3],p=e[4],f=e[5],x=e[6],b=e[7],T=e[8],I=e[9],M=e[10],D=e[11],U=e[12],$=e[13],W=e[14],K=e[15],ae=r*f-n*p,he=r*x-l*p,pe=r*b-u*p,fe=n*x-l*f,me=n*b-u*f,Ie=l*b-u*x,ke=T*$-I*U,Le=T*W-M*U,Oe=T*K-D*U,Te=I*W-M*$,De=I*K-D*$,je=M*K-D*W,Qe=ae*je-he*De+pe*Te+fe*Oe-me*Le+Ie*ke;return Qe?(i[0]=(f*je-x*De+b*Te)*(Qe=1/Qe),i[1]=(l*De-n*je-u*Te)*Qe,i[2]=($*Ie-W*me+K*fe)*Qe,i[3]=(M*me-I*Ie-D*fe)*Qe,i[4]=(x*Oe-p*je-b*Le)*Qe,i[5]=(r*je-l*Oe+u*Le)*Qe,i[6]=(W*pe-U*Ie-K*he)*Qe,i[7]=(T*Ie-M*pe+D*he)*Qe,i[8]=(p*De-f*Oe+b*ke)*Qe,i[9]=(n*Oe-r*De-u*ke)*Qe,i[10]=(U*me-$*pe+K*ae)*Qe,i[11]=(I*pe-T*me-D*ae)*Qe,i[12]=(f*Le-p*Te-x*ke)*Qe,i[13]=(r*Te-n*Le+l*ke)*Qe,i[14]=($*he-U*fe-W*ae)*Qe,i[15]=(T*fe-I*he+M*ae)*Qe,i):null},o.isMapAuthenticated=function(i){return Do.has(i)},o.isMapboxURL=Vt,o.isSafariWithAntialiasingBug=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!se(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=wr,o.len=xA,o.length=F_,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=my,o.makeRequest=H,o.mercatorXfromLng=tu,o.mercatorYfromLat=Cl,o.mercatorZfromAltitude=Ml,o.mul=gA,o.mul$1=yA,o.multiply=function(i,e,r){var n=e[0],l=e[1],u=e[2],p=e[3],f=e[4],x=e[5],b=e[6],T=e[7],I=e[8],M=r[0],D=r[1],U=r[2],$=r[3],W=r[4],K=r[5],ae=r[6],he=r[7],pe=r[8];return i[0]=M*n+D*p+U*b,i[1]=M*l+D*f+U*T,i[2]=M*u+D*x+U*I,i[3]=$*n+W*p+K*b,i[4]=$*l+W*f+K*T,i[5]=$*u+W*x+K*I,i[6]=ae*n+he*p+pe*b,i[7]=ae*l+he*f+pe*T,i[8]=ae*u+he*x+pe*I,i},o.multiply$1=qp,o.multiply$2=V_,o.nextPowerOfTwo=_r,o.normalize=nu,o.normalize$1=function(i,e){var r=e[0],n=e[1],l=e[2],u=e[3],p=r*r+n*n+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=r*p,i[1]=n*p,i[2]=l*p,i[3]=u*p,i},o.number=St,o.ortho=function(i,e,r,n,l,u,p){var f=1/(e-r),x=1/(n-l),b=1/(u-p);return i[0]=-2*f,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(e+r)*f,i[13]=(l+n)*x,i[14]=(p+u)*b,i[15]=1,i},o.pbf=_u,o.perspective=function(i,e,r,n,l){var u,p=1/Math.tan(e/2);return i[0]=p/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+n)*(u=1/(n-l)),i[14]=2*l*n*u):(i[10]=-1,i[14]=-2*n),i},o.pick=function(i,e){const r={};for(let n=0;n<e.length;n++){const l=e[n];l in i&&(r[l]=i[l])}return r},o.plugin=en,o.pointGeometry=B,o.polygonIntersectsBox=P_,o.polygonIntersectsPolygon=C_,o.polygonizeBounds=function(i,e,r=0,n=!0){const l=new B(r,r),u=i.sub(l),p=e.add(l),f=[u,new B(p.x,u.y),p,new B(u.x,p.y)];return n&&f.push(u),f},o.posAttributes=vu,o.postMapLoadEvent=cr,o.postTurnstileEvent=Nn,o.potpack=hf,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=Fe,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:Br,pluginURL:Gr}),Yc.on("pluginStateChange",i),i},o.removeAuthState=function(i){Do.delete(i)},o.renderColorRamp=tf,o.rotateX=Wp,o.rotateX$1=Z_,o.rotateY=Xp,o.rotateZ=function(i,e,r){var n=Math.sin(r),l=Math.cos(r),u=e[0],p=e[1],f=e[2],x=e[3],b=e[4],T=e[5],I=e[6],M=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=u*l+b*n,i[1]=p*l+T*n,i[2]=f*l+I*n,i[3]=x*l+M*n,i[4]=b*l-u*n,i[5]=T*l-p*n,i[6]=I*l-f*n,i[7]=M*l-x*n,i},o.rotateZ$1=function(i,e,r){r*=.5;var n=e[0],l=e[1],u=e[2],p=e[3],f=Math.sin(r),x=Math.cos(r);return i[0]=n*x+l*f,i[1]=l*x-n*f,i[2]=u*x+p*f,i[3]=p*x-u*f,i},o.scale=Ss,o.scale$1=function(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i},o.scale$2=ru,o.scaleAndAdd=Kp,o.setCacheLimits=function(i,e){Bo=i,Lo=e},o.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},o.setRTLTextPlugin=function(i,e,r=!1){if(Br===Xc||Br===Aa||Br===Hc)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gr=Ce.resolveURL(i),Br=Xc,Qc=e,Go(),r||vs()},o.smoothstep=We,o.spec=we,o.storeAuthState=function(i,e){e?Do.add(i):Do.delete(i)},o.sub=Pl,o.subtract=U_,o.symbolSize=p1,o.tileAABB=function(i,e,r,n,l,u,p,f,x){if(x.name==="globe")return ob(i,e,new gd(r,n,l));const b=ka({z:r,x:n,y:l},x);return new En([(u+b.x/b.scale)*e,e*(b.y/b.scale),p],[(u+b.x2/b.scale)*e,e*(b.y2/b.scale),f])},o.tileTransform=ka,o.transformMat3=function(i,e,r){var n=e[0],l=e[1],u=e[2];return i[0]=n*r[0]+l*r[3]+u*r[6],i[1]=n*r[1]+l*r[4]+u*r[7],i[2]=n*r[2]+l*r[5]+u*r[8],i},o.transformMat4=Ca,o.transformMat4$1=Dl,o.transformQuat=N_,o.translate=Ia,o.transpose=function(i,e){if(i===e){var r=e[1],n=e[2],l=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=n,i[7]=l}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=ba,o.uniqueId=ti,o.validateCustomStyleLayer=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=i=>Xn(ho(i)),o.validateFog=i=>Xn(Ih(i)),o.validateLayer=i=>Xn(bh(i)),o.validateLight=i=>Xn(Th(i)),o.validateSource=i=>Xn(Eh(i)),o.validateStyle=_a,o.validateTerrain=i=>Xn(Sh(i)),o.values=Dt,o.vectorTile=Ma,o.version=L,o.warnOnce=Yt,o.window=Q,o.wrap=gt}),S(["./shared"],function(o){function L(J){if(typeof J=="number"||typeof J=="boolean"||typeof J=="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let V="[";for(const H of J)V+=`${L(H)},`;return`${V}]`}let R="{";for(const V of Object.keys(J).sort())R+=`${V}:${L(J[V])},`;return`${R}}`}function j(J){let R="";for(const V of o.refProperties)R+=`/${L(J[V])}`;return R}class O{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,V){for(const ne of R)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=o.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of V)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const H=function(ne,ue){const ye={};for(let de=0;de<ne.length;de++){const be=ue&&ue[ne[de].id]||j(ne[de]);ue&&(ue[ne[de].id]=be);let Re=ye[be];Re||(Re=ye[be]=[]),Re.push(ne[de])}const ge=[];for(const de in ye)ge.push(ye[de]);return ge}(o.values(this._layerConfigs),this.keyCache);for(const ne of H){const ue=ne.map(it=>this._layers[it.id]),ye=ue[0];if(ye.visibility==="none")continue;const ge=ye.source||"";let de=this.familiesBySource[ge];de||(de=this.familiesBySource[ge]={});const be=ye.sourceLayer||"_geojsonTileLayer";let Re=de[be];Re||(Re=de[be]=[]),Re.push(ue)}}}class B{loadTile(R,V){const{uid:H,encoding:ne,rawImageData:ue,padding:ye,buildQuadTree:ge}=R,de=o.window.ImageBitmap&&ue instanceof o.window.ImageBitmap?this.getImageData(ue,ye):ue;V(null,new o.DEMData(H,de,ne,ye<1,ge))}getImageData(R,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const H=this.offscreenCanvasContext.getImageData(-V,-V,R.width+2*V,R.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),H}}var Z=function J(R,V){var H,ne=R&&R.type;if(ne==="FeatureCollection")for(H=0;H<R.features.length;H++)J(R.features[H],V);else if(ne==="GeometryCollection")for(H=0;H<R.geometries.length;H++)J(R.geometries[H],V);else if(ne==="Feature")J(R.geometry,V);else if(ne==="Polygon")Q(R.coordinates,V);else if(ne==="MultiPolygon")for(H=0;H<R.coordinates.length;H++)Q(R.coordinates[H],V);return R};function Q(J,R){if(J.length!==0){ce(J[0],R);for(var V=1;V<J.length;V++)ce(J[V],!R)}}function ce(J,R){for(var V=0,H=0,ne=0,ue=J.length,ye=ue-1;ne<ue;ye=ne++){var ge=(J[ne][0]-J[ye][0])*(J[ye][1]+J[ne][1]),de=V+ge;H+=Math.abs(V)>=Math.abs(ge)?V-de+ge:ge-de+V,V=de}V+H>=0!=!!R&&J.reverse()}const Ee=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ae{constructor(R){this._feature=R,this.extent=o.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const V of this._feature.geometry)R.push([new o.pointGeometry(V[0],V[1])]);return R}{const R=[];for(const V of this._feature.geometry){const H=[];for(const ne of V)H.push(new o.pointGeometry(ne[0],ne[1]));R.push(H)}return R}}toGeoJSON(R,V,H){return Ee.call(this,R,V,H)}}class Fe{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=R.length,this._features=R}feature(R){return new Ae(this._features[R])}}var ft=o.vectorTile.VectorTileFeature,Pt=mt;function mt(J,R){this.options=R||{},this.features=J,this.length=J.length}function Rt(J,R){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=R||4096}mt.prototype.feature=function(J){return new Rt(this.features[J],this.options.extent)},Rt.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var R=0;R<J.length;R++){for(var V=J[R],H=[],ne=0;ne<V.length;ne++)H.push(new o.pointGeometry(V[ne][0],V[ne][1]));this.geometry.push(H)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,R=1/0,V=-1/0,H=1/0,ne=-1/0,ue=0;ue<J.length;ue++)for(var ye=J[ue],ge=0;ge<ye.length;ge++){var de=ye[ge];R=Math.min(R,de.x),V=Math.max(V,de.x),H=Math.min(H,de.y),ne=Math.max(ne,de.y)}return[R,H,V,ne]},Rt.prototype.toGeoJSON=ft.prototype.toGeoJSON;var Ke=gt,We=Pt;function gt(J){var R=new o.pbf;return function(V,H){for(var ne in V.layers)H.writeMessage(3,Tt,V.layers[ne])}(J,R),R.finish()}function Tt(J,R){var V;R.writeVarintField(15,J.version||1),R.writeStringField(1,J.name||""),R.writeVarintField(5,J.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<J.length;V++)H.feature=J.feature(V),R.writeMessage(2,Dt,H);var ne=H.keys;for(V=0;V<ne.length;V++)R.writeStringField(3,ne[V]);var ue=H.values;for(V=0;V<ue.length;V++)R.writeMessage(4,_r,ue[V])}function Dt(J,R){var V=J.feature;V.id!==void 0&&R.writeVarintField(1,V.id),R.writeMessage(2,It,J),R.writeVarintField(3,V.type),R.writeMessage(4,li,V)}function It(J,R){var V=J.feature,H=J.keys,ne=J.values,ue=J.keycache,ye=J.valuecache;for(var ge in V.properties){var de=V.properties[ge],be=ue[ge];if(de!==null){be===void 0&&(H.push(ge),ue[ge]=be=H.length-1),R.writeVarint(be);var Re=typeof de;Re!=="string"&&Re!=="boolean"&&Re!=="number"&&(de=JSON.stringify(de));var it=Re+":"+de,Ve=ye[it];Ve===void 0&&(ne.push(de),ye[it]=Ve=ne.length-1),R.writeVarint(Ve)}}}function yt(J,R){return(R<<3)+(7&J)}function ti(J){return J<<1^J>>31}function li(J,R){for(var V=J.loadGeometry(),H=J.type,ne=0,ue=0,ye=V.length,ge=0;ge<ye;ge++){var de=V[ge],be=1;H===1&&(be=de.length),R.writeVarint(yt(1,be));for(var Re=H===3?de.length-1:de.length,it=0;it<Re;it++){it===1&&H!==1&&R.writeVarint(yt(2,Re-1));var Ve=de[it].x-ne,Mt=de[it].y-ue;R.writeVarint(ti(Ve)),R.writeVarint(ti(Mt)),ne+=Ve,ue+=Mt}H===3&&R.writeVarint(yt(7,1))}}function _r(J,R){var V=typeof J;V==="string"?R.writeStringField(1,J):V==="boolean"?R.writeBooleanField(7,J):V==="number"&&(J%1!=0?R.writeDoubleField(3,J):J<0?R.writeSVarintField(6,J):R.writeVarintField(5,J))}function bi(J,R,V,H,ne,ue){if(ne-H<=V)return;const ye=H+ne>>1;ui(J,R,ye,H,ne,ue%2),bi(J,R,V,H,ye-1,ue+1),bi(J,R,V,ye+1,ne,ue+1)}function ui(J,R,V,H,ne,ue){for(;ne>H;){if(ne-H>600){const be=ne-H+1,Re=V-H+1,it=Math.log(be),Ve=.5*Math.exp(2*it/3),Mt=.5*Math.sqrt(it*Ve*(be-Ve)/be)*(Re-be/2<0?-1:1);ui(J,R,V,Math.max(H,Math.floor(V-Re*Ve/be+Mt)),Math.min(ne,Math.floor(V+(be-Re)*Ve/be+Mt)),ue)}const ye=R[2*V+ue];let ge=H,de=ne;for(Bt(J,R,H,V),R[2*ne+ue]>ye&&Bt(J,R,H,ne);ge<de;){for(Bt(J,R,ge,de),ge++,de--;R[2*ge+ue]<ye;)ge++;for(;R[2*de+ue]>ye;)de--}R[2*H+ue]===ye?Bt(J,R,H,de):(de++,Bt(J,R,de,ne)),de<=V&&(H=de+1),V<=de&&(ne=de-1)}}function Bt(J,R,V,H){ki(J,V,H),ki(R,2*V,2*H),ki(R,2*V+1,2*H+1)}function ki(J,R,V){const H=J[R];J[R]=J[V],J[V]=H}function Sr(J,R,V,H){const ne=J-V,ue=R-H;return ne*ne+ue*ue}Ke.fromVectorTileJs=gt,Ke.fromGeojsonVt=function(J,R){R=R||{};var V={};for(var H in J)V[H]=new Pt(J[H].features,R),V[H].name=H,V[H].version=R.version,V[H].extent=R.extent;return gt({layers:V})},Ke.GeoJSONWrapper=We;const Qi=J=>J[0],Ir=J=>J[1];class Yt{constructor(R,V=Qi,H=Ir,ne=64,ue=Float64Array){this.nodeSize=ne,this.points=R;const ye=R.length<65536?Uint16Array:Uint32Array,ge=this.ids=new ye(R.length),de=this.coords=new ue(2*R.length);for(let be=0;be<R.length;be++)ge[be]=be,de[2*be]=V(R[be]),de[2*be+1]=H(R[be]);bi(ge,de,ne,0,ge.length-1,0)}range(R,V,H,ne){return function(ue,ye,ge,de,be,Re,it){const Ve=[0,ue.length-1,0],Mt=[];let bt,wt;for(;Ve.length;){const Ot=Ve.pop(),we=Ve.pop(),fi=Ve.pop();if(we-fi<=it){for(let mi=fi;mi<=we;mi++)bt=ye[2*mi],wt=ye[2*mi+1],bt>=ge&&bt<=be&&wt>=de&&wt<=Re&&Mt.push(ue[mi]);continue}const pt=Math.floor((fi+we)/2);bt=ye[2*pt],wt=ye[2*pt+1],bt>=ge&&bt<=be&&wt>=de&&wt<=Re&&Mt.push(ue[pt]);const di=(Ot+1)%2;(Ot===0?ge<=bt:de<=wt)&&(Ve.push(fi),Ve.push(pt-1),Ve.push(di)),(Ot===0?be>=bt:Re>=wt)&&(Ve.push(pt+1),Ve.push(we),Ve.push(di))}return Mt}(this.ids,this.coords,R,V,H,ne,this.nodeSize)}within(R,V,H){return function(ne,ue,ye,ge,de,be){const Re=[0,ne.length-1,0],it=[],Ve=de*de;for(;Re.length;){const Mt=Re.pop(),bt=Re.pop(),wt=Re.pop();if(bt-wt<=be){for(let di=wt;di<=bt;di++)Sr(ue[2*di],ue[2*di+1],ye,ge)<=Ve&&it.push(ne[di]);continue}const Ot=Math.floor((wt+bt)/2),we=ue[2*Ot],fi=ue[2*Ot+1];Sr(we,fi,ye,ge)<=Ve&&it.push(ne[Ot]);const pt=(Mt+1)%2;(Mt===0?ye-de<=we:ge-de<=fi)&&(Re.push(wt),Re.push(Ot-1),Re.push(pt)),(Mt===0?ye+de>=we:ge+de>=fi)&&(Re.push(Ot+1),Re.push(bt),Re.push(pt))}return it}(this.ids,this.coords,R,V,H,this.nodeSize)}}const ir={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Ue=Math.fround||(xt=new Float32Array(1),J=>(xt[0]=+J,xt[0]));var xt;class nt{constructor(R){this.options=Ce(Object.create(ir),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:V,minZoom:H,maxZoom:ne,nodeSize:ue}=this.options;V&&console.time("total time");const ye=`prepare ${R.length} points`;V&&console.time(ye),this.points=R;let ge=[];for(let de=0;de<R.length;de++)R[de].geometry&&ge.push(wi(R[de],de));this.trees[ne+1]=new Yt(ge,Ne,Be,ue,Float32Array),V&&console.timeEnd(ye);for(let de=ne;de>=H;de--){const be=+Date.now();ge=this._cluster(ge,de),this.trees[de]=new Yt(ge,Ne,Be,ue,Float32Array),V&&console.log("z%d: %d clusters in %dms",de,ge.length,+Date.now()-be)}return V&&console.timeEnd("total time"),this}getClusters(R,V){let H=((R[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,R[1]));let ue=R[2]===180?180:((R[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)H=-180,ue=180;else if(H>ue){const Re=this.getClusters([H,ne,180,ye],V),it=this.getClusters([-180,ne,ue,ye],V);return Re.concat(it)}const ge=this.trees[this._limitZoom(V)],de=ge.range(at(H),se(ye),at(ue),se(ne)),be=[];for(const Re of de){const it=ge.points[Re];be.push(it.numPoints?xi(it):this.points[it.index])}return be}getChildren(R){const V=this._getOriginId(R),H=this._getOriginZoom(R),ne="No cluster with the specified id.",ue=this.trees[H];if(!ue)throw new Error(ne);const ye=ue.points[V];if(!ye)throw new Error(ne);const ge=this.options.radius/(this.options.extent*Math.pow(2,H-1)),de=ue.within(ye.x,ye.y,ge),be=[];for(const Re of de){const it=ue.points[Re];it.parentId===R&&be.push(it.numPoints?xi(it):this.points[it.index])}if(be.length===0)throw new Error(ne);return be}getLeaves(R,V,H){const ne=[];return this._appendLeaves(ne,R,V=V||10,H=H||0,0),ne}getTile(R,V,H){const ne=this.trees[this._limitZoom(R)],ue=Math.pow(2,R),{extent:ye,radius:ge}=this.options,de=ge/ye,be=(H-de)/ue,Re=(H+1+de)/ue,it={features:[]};return this._addTileFeatures(ne.range((V-de)/ue,be,(V+1+de)/ue,Re),ne.points,V,H,ue,it),V===0&&this._addTileFeatures(ne.range(1-de/ue,be,1,Re),ne.points,ue,H,ue,it),V===ue-1&&this._addTileFeatures(ne.range(0,be,de/ue,Re),ne.points,-1,H,ue,it),it.features.length?it:null}getClusterExpansionZoom(R){let V=this._getOriginZoom(R)-1;for(;V<=this.options.maxZoom;){const H=this.getChildren(R);if(V++,H.length!==1)break;R=H[0].properties.cluster_id}return V}_appendLeaves(R,V,H,ne,ue){const ye=this.getChildren(V);for(const ge of ye){const de=ge.properties;if(de&&de.cluster?ue+de.point_count<=ne?ue+=de.point_count:ue=this._appendLeaves(R,de.cluster_id,H,ne,ue):ue<ne?ue++:R.push(ge),R.length===H)break}return ue}_addTileFeatures(R,V,H,ne,ue,ye){for(const ge of R){const de=V[ge],be=de.numPoints;let Re,it,Ve;if(be)Re=Zt(de),it=de.x,Ve=de.y;else{const wt=this.points[de.index];Re=wt.properties,it=at(wt.geometry.coordinates[0]),Ve=se(wt.geometry.coordinates[1])}const Mt={type:1,geometry:[[Math.round(this.options.extent*(it*ue-H)),Math.round(this.options.extent*(Ve*ue-ne))]],tags:Re};let bt;be?bt=de.id:this.options.generateId?bt=de.index:this.points[de.index].id&&(bt=this.points[de.index].id),bt!==void 0&&(Mt.id=bt),ye.features.push(Mt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(+R,this.options.maxZoom+1))}_cluster(R,V){const H=[],{radius:ne,extent:ue,reduce:ye,minPoints:ge}=this.options,de=ne/(ue*Math.pow(2,V));for(let be=0;be<R.length;be++){const Re=R[be];if(Re.zoom<=V)continue;Re.zoom=V;const it=this.trees[V+1],Ve=it.within(Re.x,Re.y,de),Mt=Re.numPoints||1;let bt=Mt;for(const wt of Ve){const Ot=it.points[wt];Ot.zoom>V&&(bt+=Ot.numPoints||1)}if(bt>Mt&&bt>=ge){let wt=Re.x*Mt,Ot=Re.y*Mt,we=ye&&Mt>1?this._map(Re,!0):null;const fi=(be<<5)+(V+1)+this.points.length;for(const pt of Ve){const di=it.points[pt];if(di.zoom<=V)continue;di.zoom=V;const mi=di.numPoints||1;wt+=di.x*mi,Ot+=di.y*mi,di.parentId=fi,ye&&(we||(we=this._map(Re,!0)),ye(we,this._map(di)))}Re.parentId=fi,H.push(Ct(wt/bt,Ot/bt,fi,bt,we))}else if(H.push(Re),bt>1)for(const wt of Ve){const Ot=it.points[wt];Ot.zoom<=V||(Ot.zoom=V,H.push(Ot))}}return H}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,V){if(R.numPoints)return V?Ce({},R.properties):R.properties;const H=this.points[R.index].properties,ne=this.options.map(H);return V&&ne===H?Ce({},ne):ne}}function Ct(J,R,V,H,ne){return{x:Ue(J),y:Ue(R),zoom:1/0,id:V,parentId:-1,numPoints:H,properties:ne}}function wi(J,R){const[V,H]=J.geometry.coordinates;return{x:Ue(at(V)),y:Ue(se(H)),zoom:1/0,index:R,parentId:-1}}function xi(J){return{type:"Feature",id:J.id,properties:Zt(J),geometry:{type:"Point",coordinates:[(R=J.x,360*(R-.5)),_e(J.y)]}};var R}function Zt(J){const R=J.numPoints,V=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return Ce(Ce({},J.properties),{cluster:!0,cluster_id:J.id,point_count:R,point_count_abbreviated:V})}function at(J){return J/360+.5}function se(J){const R=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return V<0?0:V>1?1:V}function _e(J){const R=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function Ce(J,R){for(const V in R)J[V]=R[V];return J}function Ne(J){return J.x}function Be(J){return J.y}function et(J,R,V,H){for(var ne,ue=H,ye=V-R>>1,ge=V-R,de=J[R],be=J[R+1],Re=J[V],it=J[V+1],Ve=R+3;Ve<V;Ve+=3){var Mt=ht(J[Ve],J[Ve+1],de,be,Re,it);if(Mt>ue)ne=Ve,ue=Mt;else if(Mt===ue){var bt=Math.abs(Ve-ye);bt<ge&&(ne=Ve,ge=bt)}}ue>H&&(ne-R>3&&et(J,R,ne,H),J[ne+2]=ue,V-ne>3&&et(J,ne,V,H))}function ht(J,R,V,H,ne,ue){var ye=ne-V,ge=ue-H;if(ye!==0||ge!==0){var de=((J-V)*ye+(R-H)*ge)/(ye*ye+ge*ge);de>1?(V=ne,H=ue):de>0&&(V+=ye*de,H+=ge*de)}return(ye=J-V)*ye+(ge=R-H)*ge}function Ye(J,R,V,H){var ne={id:J===void 0?null:J,type:R,geometry:V,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ue){var ye=ue.geometry,ge=ue.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")tt(ue,ye);else if(ge==="Polygon"||ge==="MultiLineString")for(var de=0;de<ye.length;de++)tt(ue,ye[de]);else if(ge==="MultiPolygon")for(de=0;de<ye.length;de++)for(var be=0;be<ye[de].length;be++)tt(ue,ye[de][be])}(ne),ne}function tt(J,R){for(var V=0;V<R.length;V+=3)J.minX=Math.min(J.minX,R[V]),J.minY=Math.min(J.minY,R[V+1]),J.maxX=Math.max(J.maxX,R[V]),J.maxY=Math.max(J.maxY,R[V+1])}function Xe(J,R,V,H){if(R.geometry){var ne=R.geometry.coordinates,ue=R.geometry.type,ye=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),ge=[],de=R.id;if(V.promoteId?de=R.properties[V.promoteId]:V.generateId&&(de=H||0),ue==="Point")Ft(ne,ge);else if(ue==="MultiPoint")for(var be=0;be<ne.length;be++)Ft(ne[be],ge);else if(ue==="LineString")At(ne,ge,ye,!1);else if(ue==="MultiLineString"){if(V.lineMetrics){for(be=0;be<ne.length;be++)At(ne[be],ge=[],ye,!1),J.push(Ye(de,"LineString",ge,R.properties));return}Lt(ne,ge,ye,!1)}else if(ue==="Polygon")Lt(ne,ge,ye,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(be=0;be<R.geometry.geometries.length;be++)Xe(J,{id:de,geometry:R.geometry.geometries[be],properties:R.properties},V,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(be=0;be<ne.length;be++){var Re=[];Lt(ne[be],Re,ye,!0),ge.push(Re)}}J.push(Ye(de,ue,ge,R.properties))}}function Ft(J,R){R.push(Vt(J[0])),R.push(Jt(J[1])),R.push(0)}function At(J,R,V,H){for(var ne,ue,ye=0,ge=0;ge<J.length;ge++){var de=Vt(J[ge][0]),be=Jt(J[ge][1]);R.push(de),R.push(be),R.push(0),ge>0&&(ye+=H?(ne*be-de*ue)/2:Math.sqrt(Math.pow(de-ne,2)+Math.pow(be-ue,2))),ne=de,ue=be}var Re=R.length-3;R[2]=1,et(R,0,Re,V),R[Re+2]=1,R.size=Math.abs(ye),R.start=0,R.end=R.size}function Lt(J,R,V,H){for(var ne=0;ne<J.length;ne++){var ue=[];At(J[ne],ue,V,H),R.push(ue)}}function Vt(J){return J/360+.5}function Jt(J){var R=Math.sin(J*Math.PI/180),V=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return V<0?0:V>1?1:V}function hi(J,R,V,H,ne,ue,ye,ge){if(H/=R,ue>=(V/=R)&&ye<H)return J;if(ye<V||ue>=H)return null;for(var de=[],be=0;be<J.length;be++){var Re=J[be],it=Re.geometry,Ve=Re.type,Mt=ne===0?Re.minX:Re.minY,bt=ne===0?Re.maxX:Re.maxY;if(Mt>=V&&bt<H)de.push(Re);else if(!(bt<V||Mt>=H)){var wt=[];if(Ve==="Point"||Ve==="MultiPoint")ni(it,wt,V,H,ne);else if(Ve==="LineString")vi(it,wt,V,H,ne,!1,ge.lineMetrics);else if(Ve==="MultiLineString")Pr(it,wt,V,H,ne,!1);else if(Ve==="Polygon")Pr(it,wt,V,H,ne,!0);else if(Ve==="MultiPolygon")for(var Ot=0;Ot<it.length;Ot++){var we=[];Pr(it[Ot],we,V,H,ne,!0),we.length&&wt.push(we)}if(wt.length){if(ge.lineMetrics&&Ve==="LineString"){for(Ot=0;Ot<wt.length;Ot++)de.push(Ye(Re.id,Ve,wt[Ot],Re.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(wt.length===1?(Ve="LineString",wt=wt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=wt.length===3?"Point":"MultiPoint"),de.push(Ye(Re.id,Ve,wt,Re.tags))}}}return de.length?de:null}function ni(J,R,V,H,ne){for(var ue=0;ue<J.length;ue+=3){var ye=J[ue+ne];ye>=V&&ye<=H&&(R.push(J[ue]),R.push(J[ue+1]),R.push(J[ue+2]))}}function vi(J,R,V,H,ne,ue,ye){for(var ge,de,be=gr(J),Re=ne===0?Nn:zo,it=J.start,Ve=0;Ve<J.length-3;Ve+=3){var Mt=J[Ve],bt=J[Ve+1],wt=J[Ve+2],Ot=J[Ve+3],we=J[Ve+4],fi=ne===0?Mt:bt,pt=ne===0?Ot:we,di=!1;ye&&(ge=Math.sqrt(Math.pow(Mt-Ot,2)+Math.pow(bt-we,2))),fi<V?pt>V&&(de=Re(be,Mt,bt,Ot,we,V),ye&&(be.start=it+ge*de)):fi>H?pt<H&&(de=Re(be,Mt,bt,Ot,we,H),ye&&(be.start=it+ge*de)):jn(be,Mt,bt,wt),pt<V&&fi>=V&&(de=Re(be,Mt,bt,Ot,we,V),di=!0),pt>H&&fi<=H&&(de=Re(be,Mt,bt,Ot,we,H),di=!0),!ue&&di&&(ye&&(be.end=it+ge*de),R.push(be),be=gr(J)),ye&&(it+=ge)}var mi=J.length-3;Mt=J[mi],bt=J[mi+1],wt=J[mi+2],(fi=ne===0?Mt:bt)>=V&&fi<=H&&jn(be,Mt,bt,wt),mi=be.length-3,ue&&mi>=3&&(be[mi]!==be[0]||be[mi+1]!==be[1])&&jn(be,be[0],be[1],be[2]),be.length&&R.push(be)}function gr(J){var R=[];return R.size=J.size,R.start=J.start,R.end=J.end,R}function Pr(J,R,V,H,ne,ue){for(var ye=0;ye<J.length;ye++)vi(J[ye],R,V,H,ne,ue,!1)}function jn(J,R,V,H){J.push(R),J.push(V),J.push(H)}function Nn(J,R,V,H,ne,ue){var ye=(ue-R)/(H-R);return J.push(ue),J.push(V+(ne-V)*ye),J.push(1),ye}function zo(J,R,V,H,ne,ue){var ye=(ue-V)/(ne-V);return J.push(R+(H-R)*ye),J.push(ue),J.push(1),ye}function cr(J,R){for(var V=[],H=0;H<J.length;H++){var ne,ue=J[H],ye=ue.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")ne=yr(ue.geometry,R);else if(ye==="MultiLineString"||ye==="Polygon"){ne=[];for(var ge=0;ge<ue.geometry.length;ge++)ne.push(yr(ue.geometry[ge],R))}else if(ye==="MultiPolygon")for(ne=[],ge=0;ge<ue.geometry.length;ge++){for(var de=[],be=0;be<ue.geometry[ge].length;be++)de.push(yr(ue.geometry[ge][be],R));ne.push(de)}V.push(Ye(ue.id,ye,ne,ue.tags))}return V}function yr(J,R){var V=[];V.size=J.size,J.start!==void 0&&(V.start=J.start,V.end=J.end);for(var H=0;H<J.length;H+=3)V.push(J[H]+R,J[H+1],J[H+2]);return V}function Po(J,R){if(J.transformed)return J;var V,H,ne,ue=1<<J.z,ye=J.x,ge=J.y;for(V=0;V<J.features.length;V++){var de=J.features[V],be=de.geometry,Re=de.type;if(de.geometry=[],Re===1)for(H=0;H<be.length;H+=2)de.geometry.push(Do(be[H],be[H+1],R,ue,ye,ge));else for(H=0;H<be.length;H++){var it=[];for(ne=0;ne<be[H].length;ne+=2)it.push(Do(be[H][ne],be[H][ne+1],R,ue,ye,ge));de.geometry.push(it)}}return J.transformed=!0,J}function Do(J,R,V,H,ne,ue){return[Math.round(V*(J*H-ne)),Math.round(V*(R*H-ue))]}function Wa(J,R,V,H,ne){for(var ue=R===ne.maxZoom?0:ne.tolerance/((1<<R)*ne.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:H,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<J.length;ge++){ye.numFeatures++,xn(ye,J[ge],ue,ne);var de=J[ge].minX,be=J[ge].minY,Re=J[ge].maxX,it=J[ge].maxY;de<ye.minX&&(ye.minX=de),be<ye.minY&&(ye.minY=be),Re>ye.maxX&&(ye.maxX=Re),it>ye.maxY&&(ye.maxY=it)}return ye}function xn(J,R,V,H){var ne=R.geometry,ue=R.type,ye=[];if(ue==="Point"||ue==="MultiPoint")for(var ge=0;ge<ne.length;ge+=3)ye.push(ne[ge]),ye.push(ne[ge+1]),J.numPoints++,J.numSimplified++;else if(ue==="LineString")ro(ye,ne,J,V,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(ge=0;ge<ne.length;ge++)ro(ye,ne[ge],J,V,ue==="Polygon",ge===0);else if(ue==="MultiPolygon")for(var de=0;de<ne.length;de++){var be=ne[de];for(ge=0;ge<be.length;ge++)ro(ye,be[ge],J,V,!0,ge===0)}if(ye.length){var Re=R.tags||null;if(ue==="LineString"&&H.lineMetrics){for(var it in Re={},R.tags)Re[it]=R.tags[it];Re.mapbox_clip_start=ne.start/ne.size,Re.mapbox_clip_end=ne.end/ne.size}var Ve={geometry:ye,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:Re};R.id!==null&&(Ve.id=R.id),J.features.push(Ve)}}function ro(J,R,V,H,ne,ue){var ye=H*H;if(H>0&&R.size<(ne?ye:H))V.numPoints+=R.length/3;else{for(var ge=[],de=0;de<R.length;de+=3)(H===0||R[de+2]>ye)&&(V.numSimplified++,ge.push(R[de]),ge.push(R[de+1])),V.numPoints++;ne&&function(be,Re){for(var it=0,Ve=0,Mt=be.length,bt=Mt-2;Ve<Mt;bt=Ve,Ve+=2)it+=(be[Ve]-be[bt])*(be[Ve+1]+be[bt+1]);if(it>0===Re)for(Ve=0,Mt=be.length;Ve<Mt/2;Ve+=2){var wt=be[Ve],Ot=be[Ve+1];be[Ve]=be[Mt-2-Ve],be[Ve+1]=be[Mt-1-Ve],be[Mt-2-Ve]=wt,be[Mt-1-Ve]=Ot}}(ge,ue),J.push(ge)}}function Bo(J,R){var V=(R=this.options=function(ne,ue){for(var ye in ue)ne[ye]=ue[ye];return ne}(Object.create(this.options),R)).debug;if(V&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(ne,ue){var ye=[];if(ne.type==="FeatureCollection")for(var ge=0;ge<ne.features.length;ge++)Xe(ye,ne.features[ge],ue,ge);else Xe(ye,ne.type==="Feature"?ne:{geometry:ne},ue);return ye}(J,R);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(H=function(ne,ue){var ye=ue.buffer/ue.extent,ge=ne,de=hi(ne,1,-1-ye,ye,0,-1,2,ue),be=hi(ne,1,1-ye,2+ye,0,-1,2,ue);return(de||be)&&(ge=hi(ne,1,-ye,1+ye,0,-1,2,ue)||[],de&&(ge=cr(de,1).concat(ge)),be&&(ge=ge.concat(cr(be,-1)))),ge}(H,R)).length&&this.splitTile(H,0,0,0),V&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Lo(J,R,V){return 32*((1<<J)*V+R)+J}function os(J,R){const V=J.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const H=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!H)return R(null,null);const ne=new Fe(H.features);let ue=Ke(ne);ue.byteOffset===0&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),R(null,{vectorTile:ne,rawData:ue.buffer})}Bo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bo.prototype.splitTile=function(J,R,V,H,ne,ue,ye){for(var ge=[J,R,V,H],de=this.options,be=de.debug;ge.length;){H=ge.pop(),V=ge.pop(),R=ge.pop(),J=ge.pop();var Re=1<<R,it=Lo(R,V,H),Ve=this.tiles[it];if(!Ve&&(be>1&&console.time("creation"),Ve=this.tiles[it]=Wa(J,R,V,H,de),this.tileCoords.push({z:R,x:V,y:H}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,V,H,Ve.numFeatures,Ve.numPoints,Ve.numSimplified),console.timeEnd("creation"));var Mt="z"+R;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(Ve.source=J,ne){if(R===de.maxZoom||R===ne)continue;var bt=1<<ne-R;if(V!==Math.floor(ue/bt)||H!==Math.floor(ye/bt))continue}else if(R===de.indexMaxZoom||Ve.numPoints<=de.indexMaxPoints)continue;if(Ve.source=null,J.length!==0){be>1&&console.time("clipping");var wt,Ot,we,fi,pt,di,mi=.5*de.buffer/de.extent,Ro=.5-mi,$n=.5+mi,Je=1+mi;wt=Ot=we=fi=null,pt=hi(J,Re,V-mi,V+$n,0,Ve.minX,Ve.maxX,de),di=hi(J,Re,V+Ro,V+Je,0,Ve.minX,Ve.maxX,de),J=null,pt&&(wt=hi(pt,Re,H-mi,H+$n,1,Ve.minY,Ve.maxY,de),Ot=hi(pt,Re,H+Ro,H+Je,1,Ve.minY,Ve.maxY,de),pt=null),di&&(we=hi(di,Re,H-mi,H+$n,1,Ve.minY,Ve.maxY,de),fi=hi(di,Re,H+Ro,H+Je,1,Ve.minY,Ve.maxY,de),di=null),be>1&&console.timeEnd("clipping"),ge.push(wt||[],R+1,2*V,2*H),ge.push(Ot||[],R+1,2*V,2*H+1),ge.push(we||[],R+1,2*V+1,2*H),ge.push(fi||[],R+1,2*V+1,2*H+1)}}},Bo.prototype.getTile=function(J,R,V){var H=this.options,ne=H.extent,ue=H.debug;if(J<0||J>24)return null;var ye=1<<J,ge=Lo(J,R=(R%ye+ye)%ye,V);if(this.tiles[ge])return Po(this.tiles[ge],ne);ue>1&&console.log("drilling down to z%d-%d-%d",J,R,V);for(var de,be=J,Re=R,it=V;!de&&be>0;)be--,Re=Math.floor(Re/2),it=Math.floor(it/2),de=this.tiles[Lo(be,Re,it)];return de&&de.source?(ue>1&&console.log("found parent tile z%d-%d-%d",be,Re,it),ue>1&&console.time("drilling down"),this.splitTile(de.source,be,Re,it,J,R,V),ue>1&&console.timeEnd("drilling down"),this.tiles[ge]?Po(this.tiles[ge],ne):null):null};class Ys extends o.VectorTileWorkerSource{constructor(R,V,H,ne,ue){super(R,V,H,ne,os),ue&&(this.loadGeoJSON=ue)}loadData(R,V){const H=R&&R.request,ne=H&&H.collectResourceTiming;this.loadGeoJSON(R,(ue,ye)=>{if(ue||!ye)return V(ue);if(typeof ye!="object")return V(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{Z(ye,!0);try{if(R.filter){const de=o.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(de.result==="error")throw new Error(de.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));const be=ye.features.filter(Re=>de.value.evaluate({zoom:0},Re));ye={type:"FeatureCollection",features:be}}this._geoJSONIndex=R.cluster?new nt(function({superclusterOptions:de,clusterProperties:be}){if(!be||!de)return de;const Re={},it={},Ve={accumulated:null,zoom:0},Mt={properties:null},bt=Object.keys(be);for(const wt of bt){const[Ot,we]=be[wt],fi=o.createExpression(we),pt=o.createExpression(typeof Ot=="string"?[Ot,["accumulated"],["get",wt]]:Ot);Re[wt]=fi.value,it[wt]=pt.value}return de.map=wt=>{Mt.properties=wt;const Ot={};for(const we of bt)Ot[we]=Re[we].evaluate(Ve,Mt);return Ot},de.reduce=(wt,Ot)=>{Mt.properties=Ot;for(const we of bt)Ve.accumulated=wt[we],wt[we]=it[we].evaluate(Ve,Mt)},de}(R)).load(ye.features):function(de,be){return new Bo(de,be)}(ye,R.geojsonVtOptions)}catch(de){return V(de)}this.loaded={};const ge={};if(ne){const de=o.getPerformanceMeasurement(H);de&&(ge.resourceTiming={},ge.resourceTiming[R.source]=JSON.parse(JSON.stringify(de)))}V(null,ge)}})}reloadTile(R,V){const H=this.loaded;return H&&H[R.uid]?super.reloadTile(R,V):this.loadTile(R,V)}loadGeoJSON(R,V){if(R.request)o.getJSON(R.request,V);else{if(typeof R.data!="string")return V(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(R.data))}catch{return V(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(R,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch(H){V(H)}}getClusterChildren(R,V){try{V(null,this._geoJSONIndex.getChildren(R.clusterId))}catch(H){V(H)}}getClusterLeaves(R,V){try{V(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch(H){V(H)}}}class ss{constructor(R){this.self=R,this.actor=new o.Actor(R,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Ys},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,H)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=H},this.self.registerRTLTextPlugin=V=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=V.applyArabicShaping,o.plugin.processBidirectionalText=V.processBidirectionalText,o.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(R,V,H){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R],H()}checkIfReady(R,V,H){H()}setReferrer(R,V){this.referrer=V}spriteLoaded(R,V){this.isSpriteLoaded[R]=V;for(const H in this.workerSources[R]){const ne=this.workerSources[R][H];for(const ue in ne)ne[ue]instanceof o.VectorTileWorkerSource&&(ne[ue].isSpriteLoaded=V,ne[ue].fire(new o.Event("isSpriteLoaded")))}}setImages(R,V,H){this.availableImages[R]=V;for(const ne in this.workerSources[R]){const ue=this.workerSources[R][ne];for(const ye in ue)ue[ye].availableImages=V}H()}enableTerrain(R,V,H){this.terrain=V,H()}setProjection(R,V){this.projections[R]=o.getProjection(V)}setLayers(R,V,H){this.getLayerIndex(R).replace(V),H()}updateLayers(R,V,H){this.getLayerIndex(R).update(V.layers,V.removedIds),H()}loadTile(R,V,H){const ne=this.enableTerrain?o.extend({enableTerrain:this.terrain},V):V;ne.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,V.type,V.source).loadTile(ne,H)}loadDEMTile(R,V,H){const ne=this.enableTerrain?o.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(R,V.source).loadTile(ne,H)}reloadTile(R,V,H){const ne=this.enableTerrain?o.extend({enableTerrain:this.terrain},V):V;ne.projection=this.projections[R]||this.defaultProjection,this.getWorkerSource(R,V.type,V.source).reloadTile(ne,H)}abortTile(R,V,H){this.getWorkerSource(R,V.type,V.source).abortTile(V,H)}removeTile(R,V,H){this.getWorkerSource(R,V.type,V.source).removeTile(V,H)}removeSource(R,V,H){if(!this.workerSources[R]||!this.workerSources[R][V.type]||!this.workerSources[R][V.type][V.source])return;const ne=this.workerSources[R][V.type][V.source];delete this.workerSources[R][V.type][V.source],ne.removeSource!==void 0?ne.removeSource(V,H):H()}loadWorkerSource(R,V,H){try{this.self.importScripts(V.url),H()}catch(ne){H(ne.toString())}}syncRTLPluginState(R,V,H){try{o.plugin.setState(V);const ne=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const ue=o.plugin.isParsed();H(ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),ue)}}catch(ne){H(ne.toString())}}getAvailableImages(R){let V=this.availableImages[R];return V||(V=[]),V}getLayerIndex(R){let V=this.layerIndexes[R];return V||(V=this.layerIndexes[R]=new O),V}getWorkerSource(R,V,H){return this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][V]||(this.workerSources[R][V]={}),this.workerSources[R][V][H]||(this.workerSources[R][V][H]=new this.workerSourceTypes[V]({send:(ne,ue,ye,ge,de,be)=>{this.actor.send(ne,ue,ye,R,de,be)},scheduler:this.actor.scheduler},this.getLayerIndex(R),this.getAvailableImages(R),this.isSpriteLoaded[R])),this.workerSources[R][V][H]}getDEMWorkerSource(R,V){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][V]||(this.demWorkerSources[R][V]=new B),this.demWorkerSources[R][V]}enforceCacheSizeLimit(R,V){o.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(R,V,H){H(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ss(self)),ss}),S(["./shared"],function(o){var L=j;function j(c){return!function(t){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,y=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(y);try{m=new Worker(v),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(v),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===h.width}()?(O[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(O[s]=function(h){var m,y=function(v){var E=document.createElement("canvas"),C=Object.create(j.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=v,E.getContext("webgl",C)||E.getContext("experimental-webgl",C)}(h);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(s)),O[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(c)}var O={};function B(c,t){if(Array.isArray(c)){if(!Array.isArray(t)||c.length!==t.length)return!1;for(let s=0;s<c.length;s++)if(!B(c[s],t[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&t!==null){if(typeof t!="object"||Object.keys(c).length!==Object.keys(t).length)return!1;for(const s in c)if(!B(c[s],t[s]))return!1;return!0}return c===t}function Z(c,t,s){const h=o.window.document.createElement(c);return t!==void 0&&(h.className=t),s&&s.appendChild(h),h}function Q(c,t,s){const h=o.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const m of Object.keys(t))h.setAttributeNS(null,m,t[m]);return s&&s.appendChild(h),h}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ce=o.window.document&&o.window.document.documentElement.style,Ee=ce&&ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ae;function Fe(){ce&&Ee&&(Ae=ce[Ee],ce[Ee]="none")}function ft(){ce&&Ee&&(ce[Ee]=Ae)}function Pt(c){c.preventDefault(),c.stopPropagation(),o.window.removeEventListener("click",Pt,!0)}function mt(){o.window.addEventListener("click",Pt,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Pt,!0)},0)}function Rt(c,t){const s=c.getBoundingClientRect();return gt(c,s,t)}function Ke(c,t){const s=c.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(gt(c,s,t[m]));return h}function We(c){return o.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function gt(c,t,s){const h=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new o.pointGeometry((s.clientX-t.left)*h,(s.clientY-t.top)*h)}function Tt(c,t){var s=t[0],h=t[1],m=t[2],y=t[3],v=s*y-m*h;return v?(c[0]=y*(v=1/v),c[1]=-h*v,c[2]=-m*v,c[3]=s*v,c):null}function Dt(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class It extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,s){this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){s.version=this.images[t].version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let h=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const h={};for(const m of t){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const y=this.images[m];y?h[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],h=this.getImage(t);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},y=new o.ImagePosition(m,h);this.patterns[t]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const y in this.patterns)t.push(this.patterns[y].bin);const{w:s,h}=o.potpack(t),m=this.atlasImage;m.resize({width:s||1,height:h||1});for(const y in this.patterns){const{bin:v}=this.patterns[y],E=v.x+1,C=v.y+1,k=this.images[y].data,P=k.width,F=k.height;o.RGBAImage.copy(k,m,{x:0,y:0},{x:E,y:C},{width:P,height:F}),o.RGBAImage.copy(k,m,{x:0,y:F-1},{x:E,y:C-1},{width:P,height:1}),o.RGBAImage.copy(k,m,{x:0,y:0},{x:E,y:C+F},{width:P,height:1}),o.RGBAImage.copy(k,m,{x:P-1,y:0},{x:E-1,y:C},{width:1,height:F}),o.RGBAImage.copy(k,m,{x:0,y:0},{x:E+P,y:C},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];Dt(h)&&this.updateImage(s,h)}}}const yt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(c,t){return function([s,h,m]){const y=o.degToRad(h+90),v=o.degToRad(m);return{x:s*Math.cos(y)*Math.sin(v),y:s*Math.sin(y)*Math.sin(v),z:s*Math.cos(v),azimuthal:h,polar:m}}(c.expression.evaluate(t))}interpolate(c,t,s){return{x:o.number(c.x,t.x,s),y:o.number(c.y,t.y,s),z:o.number(c.z,t.z,s),azimuthal:o.number(c.azimuthal,t.azimuthal,s),polar:o.number(c.polar,t.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ti="-transition";class li extends o.Evented{constructor(t){super(),this._transitionable=new o.Transitionable(yt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(o.validateLight,t,s))for(const h in t){const m=t[h];o.endsWith(h,ti)?this._transitionable.setTransition(h.slice(0,-ti.length),m):this._transitionable.setValue(h,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const _r=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),bi="-transition";class ui extends o.Evented{constructor(t,s){super(),this._transitionable=new o.Transitionable(_r),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(t){for(const s in t){const h=t[s];o.endsWith(s,bi)?this._transitionable.setTransition(s.slice(0,-bi.length),h):this._transitionable.setValue(s,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function Bt(c,t,s,h){const m=o.smoothstep(45,65,s),[y,v]=ki(c,h),E=o.length(t);let C=1-Math.min(1,Math.exp((E-y)/(v-y)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*m*c.alpha}function ki(c,t){const s=.5/Math.tan(.5*t);return[c.range[0]+s,c.range[1]+s]}const Sr=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),Qi="-transition";class Ir extends o.Evented{constructor(t,s){super(),this._transitionable=new o.Transitionable(Sr),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s={}){if(!this._validate(o.validateFog,t,s))for(const h in t){const m=t[h];o.endsWith(h,Qi)?this._transitionable.setTransition(h.slice(0,-Qi.length),m):this._transitionable.setValue(h,m)}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,t)*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,m,y){const v=o.MercatorCoordinate.fromLngLat(m),E=y.elevation?y.elevation.getAtPointOrZero(v):0,C=[v.x,v.y,E];return o.transformMat4(C,C,y.mercatorFogMatrix),Bt(h,C,y.pitch,y._fov)}(this.state,t,s):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ki(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Yt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const y=new Yt.Actor(h[m],s,this.id);y.name=`Worker ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,h){o.asyncAll(this.actors,(m,y)=>{m.send(t,s,y)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ir(c,t,s){return t*(o.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}Yt.Actor=o.Actor;class Ue{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(y=>m.pointCoordinate3D(y)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,s){let h,m;if(t instanceof o.pointGeometry||typeof t[0]=="number"){const y=o.pointGeometry.convert(t);h=[o.pointGeometry.convert(t)],m=s.isPointAboveHorizon(y)}else{const y=o.pointGeometry.convert(t[0]),v=o.pointGeometry.convert(t[1]);h=[y,v],m=o.polygonizeBounds(y,v).every(E=>s.isPointAboveHorizon(E))}return new Ue(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,t)}containsTile(t,s,h){const m=t.queryPadding+1,y=t.tileID.wrap,v=h?this._bufferedCameraMercator(m,s).map(q=>o.getTilePoint(t.tileTransform,q,y)):this._bufferedScreenMercator(m,s).map(q=>o.getTilePoint(t.tileTransform,q,y)),E=this.screenGeometryMercator.map(q=>o.getTileVec3(t.tileTransform,q,y)),C=E.map(q=>new o.pointGeometry(q[0],q[1])),k=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),P=o.getTileVec3(t.tileTransform,k,y),F=E.map(q=>{const N=o.sub(q,q,P);return o.normalize(N,N),new o.Ray(P,N)}),G=ir(t,1,s.zoom);if(o.polygonIntersectsBox(v,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:F,bufferedTilespaceGeometry:v,bufferedTilespaceBounds:(X=o.getBounds(v),X.min.x=o.clamp(X.min.x,0,o.EXTENT),X.min.y=o.clamp(X.min.y,0,o.EXTENT),X.max.x=o.clamp(X.max.x,0,o.EXTENT),X.max.y=o.clamp(X.max.y,0,o.EXTENT),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:G};var X}_bufferedScreenMercator(t,s){const h=xt(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{const m=this.bufferedScreenGeometry(t).map(y=>s.pointCoordinate3D(y));return this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=xt(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{const m=this.bufferedCameraGeometry(t).map(y=>s.pointCoordinate3D(y));return this._cameraRaycastCache[h]=m,m}}}function xt(c){return 100*c|0}function nt(c,t,s){const h=function(m,y){if(m)return s(m);if(y){const v=o.pick(o.extend(y,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(v.vectorLayers=y.vector_layers,v.vectorLayerIds=v.vectorLayers.map(E=>E.id)),v.tiles=t.canonicalizeTileset(v,c.url),s(null,v)}};return c.url?o.getJSON(t.transformRequest(t.normalizeSourceURL(c.url),o.ResourceType.Source),h):o.exported.frame(()=>h(null,c))}class Ct{constructor(t,s,h){this.bounds=o.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),v=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=h&&t.x<y&&t.y>=m&&t.y<v}}class wi{constructor(t,s,h){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zt{constructor(t,s,h,m){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),t.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],v=s.attributes[y.name];v!==void 0&&t.vertexAttribPointer(v,y.components,t[xi[y.type]],!1,this.itemSize,y.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class at{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class se extends at{getDefault(){return o.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _e extends at{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ce extends at{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ne extends at{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Be extends at{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class et extends at{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ht extends at{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ye extends at{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class tt extends at{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Xe extends at{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ft extends at{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class At extends at{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Lt extends at{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Vt extends at{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Jt extends at{getDefault(){return o.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class hi extends at{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class ni extends at{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class vi extends at{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class gr extends at{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Pr extends at{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class jn extends at{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Nn extends at{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zo extends at{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class cr extends at{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class yr extends at{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Po extends at{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Do extends at{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Wa extends at{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class xn extends at{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ro extends at{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Bo extends at{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Lo extends at{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class os extends Lo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ys extends Lo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ss extends Ys{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class J{constructor(t,s,h,m){this.context=t,this.width=s,this.height=h;const y=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new os(t,y),m&&(this.depthAttachment=new Ys(t,y))}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class R{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new se(this),this.clearDepth=new _e(this),this.clearStencil=new Ce(this),this.colorMask=new Ne(this),this.depthMask=new Be(this),this.stencilMask=new et(this),this.stencilFunc=new ht(this),this.stencilOp=new Ye(this),this.stencilTest=new tt(this),this.depthRange=new Xe(this),this.depthTest=new Ft(this),this.depthFunc=new At(this),this.blend=new Lt(this),this.blendFunc=new Vt(this),this.blendColor=new Jt(this),this.blendEquation=new hi(this),this.cullFace=new ni(this),this.cullFaceSide=new vi(this),this.frontFace=new gr(this),this.program=new Pr(this),this.activeTexture=new jn(this),this.viewport=new Nn(this),this.bindFramebuffer=new zo(this),this.bindRenderbuffer=new cr(this),this.bindTexture=new yr(this),this.bindVertexBuffer=new Po(this),this.bindElementBuffer=new Do(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wa(this),this.pixelStoreUnpack=new xn(this),this.pixelStoreUnpackPremultiplyAlpha=new ro(this),this.pixelStoreUnpackFlipY=new Bo(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new wi(this,t,s)}createVertexBuffer(t,s,h){return new Zt(this,t,s,h)}createRenderbuffer(t,s,h){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),y}createFramebuffer(t,s,h){return new J(this,t,s,h)}clear({color:t,depth:s,stencil:h}){const m=this.gl;let y=0;t&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){B(t.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends o.Evented{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=nt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new Ct(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(y,v,E,C)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):y?(t.state="errored",s(y)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:E,expires:C}),t.setTexture(v,this.map.painter),t.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(t,s,h){t.setTexture(s,h)}static unloadTileData(t,s){t.texture&&s.saveTileTexture(t.texture)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let H;function ne(c,t,s,h,m,y,v,E){const C=[c,s,m,t,h,y,1,1,1],k=[v,E,1],P=o.adjoint([],C),[F,G,X]=o.transformMat3(k,k,o.transpose(P,P));return o.multiply(C,[F,0,0,0,G,0,0,0,X],C)}class ue extends o.Evented{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(s,h)=>{if(this._loaded=!0,s)this.fire(new o.ErrorEvent(s));else if(h){const{HTMLImageElement:m}=o.window;this.image=h instanceof m?o.exported.getImageData(h):h,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const s=t.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let m=1/0,y=1/0,v=-1/0,E=-1/0;for(const F of h)m=Math.min(m,F.x),y=Math.min(y,F.y),v=Math.max(v,F.x),E=Math.max(E,F.y);const C=Math.max(v-m,E-y),k=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),P=Math.pow(2,k);return new o.CanonicalTileID(k,Math.floor((m+v)/2*P),Math.floor((y+E)/2*P))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const C in this.tiles){const k=this.tiles[C];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[h,m,y,v]=this.coordinates.map(C=>{const k=s.projection.project(C[0],C[1]);return o.getTilePoint(s,k)._round()});this.perspectiveTransform=function(C,k,P,F,G,X,q,N,re,Y){const te=ne(0,0,C,0,0,k,C,k),ie=ne(P,F,G,X,q,N,re,Y);return o.multiply(ie,o.adjoint(te,te),ie),[ie[6]/ie[8]*C/o.EXTENT,ie[7]/ie[8]*k/o.EXTENT]}(this.width,this.height,h.x,h.y,m.x,m.y,v.x,v.y,y.x,y.y);const E=this._boundsArray=new o.StructArrayLayout4i8;E.emplaceBack(h.x,h.y,0,0),E.emplaceBack(m.x,m.y,o.EXTENT,0),E.emplaceBack(v.x,v.y,0,o.EXTENT),E.emplaceBack(y.x,y.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(E,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ye={vector:class extends o.Evented{constructor(c,t,s,h){if(super(),this.id=c,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(t,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=nt(this._options,this.map._requestManager,(c,t)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.ErrorEvent(c)):t&&(o.extend(this,t),t.bounds&&(this.tileBounds=new Ct(t.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c();const t=this.map.style._getSourceCaches(this.id);for(const s of t)s.clearTiles();this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(c,t){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=t:c.request=c.actor.send("reloadTile",h,m.bind(this));else if(c.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const y=o.loadVectorTile.call({deduped:this._deduped},h,(v,E)=>{v||!E?m.call(this,v):(h.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},c.actor&&c.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);c.request={cancel:y}}function m(y,v){return delete c.request,c.aborted?t(null):y&&y.status!==404?t(y):(v&&v.resourceTiming&&(c.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&v&&c.setExpiryData(v),c.loadVectorData(v,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id})}unloadTile(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:V,"raster-dem":class extends V{constructor(c,t,s,h){super(c,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,y){m&&(c.state="errored",t(m)),y&&(c.dem=y,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(m,y,v,E){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(m)c.state="errored",t(m);else if(y){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:v,expires:E});const C=o.window.ImageBitmap&&y instanceof o.window.ImageBitmap&&(H==null&&(H=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),H),k=1-(y.width-o.prevPowerOfTwo(y.width))/2;k<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const P=C?y:o.exported.getImageData(y,k),F={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:k};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",F,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const t=c.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?c.wrap-1:c.wrap,y=(t.x+1+s)%s,v=t.x+1===s?c.wrap+1:c.wrap,E={};return E[new o.OverscaledTileID(c.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,v,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(E[new o.OverscaledTileID(c.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,v,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<s&&(E[new o.OverscaledTileID(c.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,v,t.z,y,t.y+1).key]={backfilled:!1}),E}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends o.Evented{constructor(c,t,s,h){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=o.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},t),this}getClusterLeaves(c,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:t,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=o.extend({},this.workerOptions),t=this._data;typeof t=="string"?(c.request=this.map._requestManager.transformRequest(o.exported.resolveURL(t),o.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,t){const s=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(s,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete c.request,c.unloadVectorData(),c.aborted?t(null):h?t(h):(c.loadVectorData(m,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ue{constructor(c,t,s,h){super(c,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.ResourceType.Source).url);o.getVideo(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(c,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ue,canvas:class extends ue{constructor(c,t,s,h){super(c,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.Evented{constructor(c,t,s,h){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ct(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:s,z:h}=c.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:s,y:h,z:m}=c.tileID.canonical,y=new o.window.AbortController,v=this._implementation.loadTile({x:s,y:h,z:m},{signal:y.signal});if(!v)return this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null);v.cancel=()=>y.abort(),c.request=v.then(function(E){return delete c.request,c.aborted?(c.state="unloaded",t(null)):E?function(C){return C instanceof o.window.ImageData||C instanceof o.window.ImageBitmap||C instanceof o.window.HTMLCanvasElement}(E)?(this.loadTileData(c,E),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null))}.bind(this)).catch(E=>{E.code!==20&&(c.state="errored",t(E))})}loadTileData(c,t){V.loadTileData(c,t,this._map.painter)}unloadTileData(c){V.unloadTileData(c,this._map.painter)}prepareTile(c){if(!this._implementation.prepareTile)return null;const{x:t,y:s,z:h}=c.tileID.canonical,m=this._implementation.prepareTile({x:t,y:s,z:h});return m?(this.loadTileData(c,m),c.state="loaded",m):null}unloadTile(c,t){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:s,y:h,z:m}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ge=function(c,t,s,h){const m=new ye[t.type](c,t,s,h);if(m.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function de(c,t){const s=o.identity([]);return o.scale(s,s,[.5*c.width,.5*-c.height,1]),o.translate(s,s,[1,-1,0]),o.multiply$1(s,s,c.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(s)}function be(c,t,s,h,m,y,v,E=!1){const C=c.tilesIn(h,v,E);C.sort(it);const k=[];for(const F of C)k.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(t,s,c._state,F,m,y,de(c.transform,F.tile.tileID),E)});const P=function(F){const G={},X={};for(const q of F){const N=q.queryResults,re=q.wrappedTileID,Y=X[re]=X[re]||{};for(const te in N){const ie=N[te],oe=Y[te]=Y[te]||{},ee=G[te]=G[te]||[];for(const le of ie)oe[le.featureIndex]||(oe[le.featureIndex]=!0,ee.push(le))}}return G}(k);for(const F in P)P[F].forEach(G=>{const X=G.feature,q=X.layer;q&&q.type!=="background"&&q.type!=="sky"&&(X.source=q.source,q["source-layer"]&&(X.sourceLayer=q["source-layer"]),X.state=X.id!==void 0?c.getFeatureState(q["source-layer"],X.id):{})});return P}function Re(c,t){const s=c.getRenderableIds().map(y=>c.getTileByID(y)),h=[],m={};for(let y=0;y<s.length;y++){const v=s[y],E=v.tileID.canonical.key;m[E]||(m[E]=!0,v.querySourceFeatures(h,t))}return h}function it(c,t){const s=c.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Ve(){return As.workerClass!=null?new As.workerClass:new o.window.Worker(As.workerUrl)}const Mt="mapboxgl_preloaded_worker_pool";class bt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<bt.workerCount;)this.workers.push(new Ve);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mt]}numActive(){return Object.keys(this.active).length}}let wt;function Ot(){return wt||(wt=new bt),wt}function we(c,t){const s={};for(const h in c)h!=="ref"&&(s[h]=c[h]);return o.refProperties.forEach(h=>{h in t&&(s[h]=t[h])}),s}function fi(c){c=c.slice();const t=Object.create(null);for(let s=0;s<c.length;s++)t[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=we(c[s],t[c[s].ref]));return c}bt.workerCount=2;const pt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function di(c,t,s){s.push({command:pt.addSource,args:[c,t[c]]})}function mi(c,t,s){t.push({command:pt.removeSource,args:[c]}),s[c]=!0}function Ro(c,t,s,h){mi(c,s,h),di(c,t,s)}function $n(c,t,s){let h;for(h in c[s])if(c[s].hasOwnProperty(h)&&h!=="data"&&!B(c[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!B(c[s][h],t[s][h]))return!1;return!0}function Je(c,t,s,h,m,y){let v;for(v in t=t||{},c=c||{})c.hasOwnProperty(v)&&(B(c[v],t[v])||s.push({command:y,args:[h,v,t[v],m]}));for(v in t)t.hasOwnProperty(v)&&!c.hasOwnProperty(v)&&(B(c[v],t[v])||s.push({command:y,args:[h,v,t[v],m]}))}function ii(c){return c.id}function Ht(c,t){return c[t.id]=t,c}class Dn{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const y=s-1,v=this._distances[y],E=h-v,C=E>0?(m-v)/E:0;return this.points[y].mult(1-C).add(this.points[s].mult(C))}}class Fo{constructor(t,s,h){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,y){this._forEachCell(s,h,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,y,v){this.boxCells[y].push(v)}_insertCircleCell(t,s,h,m,y,v){this.circleCells[y].push(v)}_query(t,s,h,m,y,v){if(h<0||t>this.width||m<0||s>this.height)return!y&&[];const E=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(y)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],P=this.circles[3*C+1],F=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:k-F,y1:P-F,x2:k+F,y2:P+F})}return v?E.filter(v):E}return this._forEachCell(t,s,h,m,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},v),y?E.length>0:E}_queryCircle(t,s,h,m,y){const v=t-h,E=t+h,C=s-h,k=s+h;if(E<0||v>this.width||k<0||C>this.height)return!m&&[];const P=[];return this._forEachCell(v,C,E,k,this._queryCellCircle,P,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},y),m?P.length>0:P}query(t,s,h,m,y){return this._query(t,s,h,m,!1,y)}hitTest(t,s,h,m,y){return this._query(t,s,h,m,!0,y)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,y,v,E,C){const k=E.seenUids,P=this.boxCells[y];if(P!==null){const G=this.bboxes;for(const X of P)if(!k.box[X]){k.box[X]=!0;const q=4*X;if(t<=G[q+2]&&s<=G[q+3]&&h>=G[q+0]&&m>=G[q+1]&&(!C||C(this.boxKeys[X]))){if(E.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[X],x1:G[q],y1:G[q+1],x2:G[q+2],y2:G[q+3]})}}}const F=this.circleCells[y];if(F!==null){const G=this.circles;for(const X of F)if(!k.circle[X]){k.circle[X]=!0;const q=3*X;if(this._circleAndRectCollide(G[q],G[q+1],G[q+2],t,s,h,m)&&(!C||C(this.circleKeys[X]))){if(E.hitTest)return v.push(!0),!0;{const N=G[q],re=G[q+1],Y=G[q+2];v.push({key:this.circleKeys[X],x1:N-Y,y1:re-Y,x2:N+Y,y2:re+Y})}}}}}_queryCellCircle(t,s,h,m,y,v,E,C){const k=E.circle,P=E.seenUids,F=this.boxCells[y];if(F!==null){const X=this.bboxes;for(const q of F)if(!P.box[q]){P.box[q]=!0;const N=4*q;if(this._circleAndRectCollide(k.x,k.y,k.radius,X[N+0],X[N+1],X[N+2],X[N+3])&&(!C||C(this.boxKeys[q])))return v.push(!0),!0}}const G=this.circleCells[y];if(G!==null){const X=this.circles;for(const q of G)if(!P.circle[q]){P.circle[q]=!0;const N=3*q;if(this._circlesCollide(X[N],X[N+1],X[N+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[q])))return v.push(!0),!0}}}_forEachCell(t,s,h,m,y,v,E,C){const k=this._convertToXCellCoord(t),P=this._convertToYCellCoord(s),F=this._convertToXCellCoord(h),G=this._convertToYCellCoord(m);for(let X=k;X<=F;X++)for(let q=P;q<=G;q++)if(y.call(this,t,s,h,m,this.xCellCount*q+X,v,E,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,y,v){const E=m-t,C=y-s,k=h+v;return k*k>E*E+C*C}_circleAndRectCollide(t,s,h,m,y,v,E){const C=(v-m)/2,k=Math.abs(t-(m+C));if(k>C+h)return!1;const P=(E-y)/2,F=Math.abs(s-(y+P));if(F>P+h)return!1;if(k<=C||F<=P)return!0;const G=k-C,X=F-P;return G*G+X*X<=h*h}}const Kt=Math.tan(85*Math.PI/180);function Oo(c,t,s,h,m,y){const v=o.create();if(s){if(m.projection.name==="globe")o.multiply$1(v,v,o.calculateGlobeLabelMatrix(m,t));else{const E=Tt([],y);v[0]=E[0],v[1]=E[1],v[4]=E[2],v[5]=E[3]}h||o.rotateZ(v,v,m.angle)}else o.multiply$1(v,m.labelPlaneMatrix,c);return v}function as(c,t,s,h,m,y){if(s){if(m.projection.name==="globe"){const v=Oo(c,t,s,h,m,y);return o.invert(v,v),o.multiply$1(v,c,v),v}{const v=o.clone(c),E=o.identity([]);return E[0]=y[0],E[1]=y[1],E[4]=y[2],E[5]=y[3],o.multiply$1(v,v,E),h||o.rotateZ(v,v,-m.angle),v}}return m.glCoordMatrix}function Cr(c,t,s=0){const h=[c.x,c.y,s,1];s?o.transformMat4$1(h,h,t):Vr(h,h,t);const m=h[3];return{point:new o.pointGeometry(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function Kr(c,t){const s=[c[0],c[1],c[2],1];o.transformMat4$1(s,s,t);const h=s[3];return{point:new o.pointGeometry(s[0]/h,s[1]/h),signedDistanceFromCamera:h}}function Ri(c,t){return Math.min(.5+c/t*.5,1.5)}function gp(c,t){const s=c[0]/c[3],h=c[1]/c[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function Ks(c,t,s,h,m,y,v,E,C,k){const P=s.transform,F=h?c.textSizeData:c.iconSizeData,G=o.evaluateSizeForZoom(F,s.transform.zoom),X=[256/s.width*2+1,256/s.height*2+1],q=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;q.clear();const N=c.lineVertexArray,re=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,Y=s.transform.width/s.transform.height;let te=!1;for(let ie=0;ie<re.length;ie++){const oe=re.get(ie);if(oe.writingMode!==o.WritingMode.vertical||te||ie!==0&&re.get(ie-1).writingMode===o.WritingMode.horizontal||(te=!0),(oe.hidden||oe.writingMode===o.WritingMode.vertical)&&!te){rr(oe.numGlyphs,q);continue}te=!1;const ee=new o.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),le=C?C(ee):[0,0,0],xe=P.projection.projectTilePoint(ee.x,ee.y,k.canonical),Se=[xe.x+le[0],xe.y+le[1],xe.z+le[2]],ze=[...Se,1];if(o.transformMat4$1(ze,ze,t),!gp(ze,X)){rr(oe.numGlyphs,q);continue}const Me=Ri(s.transform.cameraToCenterDistance,ze[3]),Ze=o.evaluateSizeForFeature(F,G,oe),ve=v?Ze/Me:Ze*Me,qe=Cr(new o.pointGeometry(Se[0],Se[1]),m,Se[2]);if(qe.signedDistanceFromCamera<=0){rr(oe.numGlyphs,q);continue}let $e={};const dt=v?null:C,Pe=Ha(oe,ve,!1,E,t,m,y,c.glyphOffsetArray,N,q,qe.point,ee,$e,Y,dt,P.projection,k);te=Pe.useVertical,dt&&Pe.needsFlipping&&($e={}),(Pe.notEnoughRoom||te||Pe.needsFlipping&&Ha(oe,ve,!0,E,t,m,y,c.glyphOffsetArray,N,q,qe.point,ee,$e,Y,dt,P.projection,k).notEnoughRoom)&&rr(oe.numGlyphs,q)}h?c.text.dynamicLayoutVertexBuffer.updateData(q):c.icon.dynamicLayoutVertexBuffer.updateData(q)}function Xa(c,t,s,h,m,y,v,E,C,k,P,F,G,X,q){const N=E.glyphStartIndex+E.numGlyphs,re=E.lineStartIndex,Y=E.lineStartIndex+E.lineLength,te=t.getoffsetX(E.glyphStartIndex),ie=t.getoffsetX(N-1),oe=cs(c*te,s,h,m,y,v,E.segment,re,Y,C,k,P,F,G,!0,X,q);if(!oe)return null;const ee=cs(c*ie,s,h,m,y,v,E.segment,re,Y,C,k,P,F,G,!0,X,q);return ee?{first:oe,last:ee}:null}function ls(c,t,s,h){return c.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*h?{useVertical:!0}:c.writingMode===o.WritingMode.vertical?t.y<s.y?{needsFlipping:!0}:null:c.flipState!==0&&function(m,y,v){const E=(y.x-m.x)*v;return E===0||Math.abs((y.y-m.y)/E)>Kt}(t,s,h)?c.flipState===1?{needsFlipping:!0}:null:t.x>s.x?{needsFlipping:!0}:null}function Ha(c,t,s,h,m,y,v,E,C,k,P,F,G,X,q,N,re){const Y=t/24,te=c.lineOffsetX*Y,ie=c.lineOffsetY*Y;let oe;if(c.numGlyphs>1){const ee=c.glyphStartIndex+c.numGlyphs,le=c.lineStartIndex,xe=c.lineStartIndex+c.lineLength,Se=Xa(Y,E,te,ie,s,P,F,c,C,y,G,q,!1,N,re);if(!Se)return{notEnoughRoom:!0};const ze=Cr(Se.first.point,v).point,Me=Cr(Se.last.point,v).point;if(h&&!s){const Ze=ls(c,ze,Me,X);if(c.flipState=Ze&&Ze.needsFlipping?1:2,Ze)return Ze}oe=[Se.first];for(let Ze=c.glyphStartIndex+1;Ze<ee-1;Ze++)oe.push(cs(Y*E.getoffsetX(Ze),te,ie,s,P,F,c.segment,le,xe,C,y,G,q,!1,!1,N,re));oe.push(Se.last)}else{if(h&&!s){const le=Cr(F,m).point,xe=c.lineStartIndex+c.segment+1,Se=new o.pointGeometry(C.getx(xe),C.gety(xe)),ze=Cr(Se,m),Me=ls(c,le,ze.signedDistanceFromCamera>0?ze.point:pi(F,Se,le,1,m,void 0,N,re.canonical),X);if(c.flipState=Me&&Me.needsFlipping?1:2,Me)return Me}const ee=cs(Y*E.getoffsetX(c.glyphStartIndex),te,ie,s,P,F,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,C,y,G,q,!1,!1,N,re);if(!ee)return{notEnoughRoom:!0};oe=[ee]}for(const ee of oe)o.addDynamicAttributes(k,ee.point,ee.angle);return{}}function pc(c,t,s,h,m){const y=h.projectTilePoint(c.x,c.y,t);if(!m)return Cr(y,s,y.z);const v=m(c);return Cr(new o.pointGeometry(y.x+v[0],y.y+v[1]),s,y.z+v[2])}function pi(c,t,s,h,m,y,v,E){const C=pc(c.add(c.sub(t)._unit()),E,m,v,y).point,k=s.sub(C);return s.add(k._mult(h/k.mag()))}function cs(c,t,s,h,m,y,v,E,C,k,P,F,G,X,q,N,re){const Y=h?c-t:c+t;let te=Y>0?1:-1,ie=0;h&&(te*=-1,ie=Math.PI),te<0&&(ie+=Math.PI);let oe=te>0?E+v:E+v+1,ee=m,le=m,xe=0,Se=0;const ze=Math.abs(Y),Me=[],Ze=[];let ve=y;const qe=()=>{const ct=oe-te;return xe===0?y:new o.pointGeometry(k.getx(ct),k.gety(ct))},$e=()=>pi(qe(),ve,le,ze-xe+1,P,G,N,re.canonical);for(;xe+Se<=ze;){if(oe+=te,oe<E||oe>=C)return null;if(le=ee,Me.push(ee),X&&Ze.push(ve||qe()),ee=F[oe],ee===void 0){ve=new o.pointGeometry(k.getx(oe),k.gety(oe));const ct=pc(ve,re.canonical,P,N,G);ee=ct.signedDistanceFromCamera>0?F[oe]=ct.point:$e()}else ve=null;xe+=Se,Se=le.dist(ee)}q&&G&&(ve=ve||new o.pointGeometry(k.getx(oe),k.gety(oe)),F[oe]=ee=F[oe]===void 0?ee:$e(),Se=le.dist(ee));const dt=(ze-xe)/Se,Pe=ee.sub(le),lt=Pe.mult(dt)._add(le);s&&lt._add(Pe._unit()._perp()._mult(s*te));const Et=ie+Math.atan2(ee.y-le.y,ee.x-le.x);return Me.push(lt),X&&(ve=ve||new o.pointGeometry(k.getx(oe),k.gety(oe)),Ze.push(function(ct,ut,kt){const qt=1-kt;return new o.pointGeometry(ct.x*qt+ut.x*kt,ct.y*qt+ut.y*kt)}(Ze.length>0?Ze[Ze.length-1]:ve,ve,dt))),{point:lt,angle:Et,path:Me,tilePath:Ze}}const fc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function rr(c,t){for(let s=0;s<c;s++){const h=t.length;t.resize(h+4),t.float32.set(fc,3*h)}}function Vr(c,t,s){const h=t[0],m=t[1];return c[0]=s[0]*h+s[4]*m+s[12],c[1]=s[1]*h+s[5]*m+s[13],c[3]=s[3]*h+s[7]*m+s[15],c}const vn=100;class Qa{constructor(t,s,h=new Fo(t.width+200,t.height+200,25),m=new Fo(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+vn,this.screenBottomBoundary=t.height+vn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,y,v,E){let C=s.projectedAnchorX,k=s.projectedAnchorY,P=s.projectedAnchorZ;const F=s.elevation,G=s.tileID;if(F&&G){const oe=this.transform.projection.upVector(G.canonical,s.tileAnchorX,s.tileAnchorY),ee=this.transform.projection.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=oe[0]*F*ee,k+=oe[1]*F*ee,P+=oe[2]*F*ee}const X=this.projectAndGetPerspectiveRatio(v,[C,k,P],s.tileID,this.transform.projection.name==="globe"||!!F||this.transform.pitch>0),q=y*X.perspectiveRatio,N=(s.x1*t+h.x-s.padding)*q+X.point.x,re=(s.y1*t+h.y-s.padding)*q+X.point.y,Y=(s.x2*t+h.x+s.padding)*q+X.point.x,te=(s.y2*t+h.y+s.padding)*q+X.point.y,ie=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(N,re,Y,te)||!m&&this.grid.hitTest(N,re,Y,te,E)||ie?{box:[],offscreen:!1,occluded:X.occluded}:{box:[N,re,Y,te],offscreen:this.isOffscreen(N,re,Y,te),occluded:!1}}placeCollisionCircles(t,s,h,m,y,v,E,C,k,P,F,G,X,q){const N=[],re=this.transform.elevation,Y=re?re.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,this.transform.projection):$e=>[0,0,0],te=new o.pointGeometry(s.tileAnchorX,s.tileAnchorY),ie=this.transform.projection.projectTilePoint(s.tileAnchorX,s.tileAnchorY,q.canonical),oe=Y(te),ee=[ie.x+oe[0],ie.y+oe[1],ie.z+oe[2]],le=this.projectAndGetPerspectiveRatio(v,[ee[0],ee[1],ee[2]],q,this.transform.projection.name==="globe"||!!re||this.transform.pitch>0),{perspectiveRatio:xe}=le,Se=(P?y/xe:y*xe)/o.ONE_EM,ze=Cr(new o.pointGeometry(ee[0],ee[1]),E,ee[2]).point,Me=le.signedDistanceFromCamera>0?Xa(Se,m,s.lineOffsetX*Se,s.lineOffsetY*Se,!1,ze,te,s,h,E,{},re&&!P?Y:null,P&&!!re,this.transform.projection,q):null;let Ze=!1,ve=!1,qe=!0;if(Me&&!le.occluded){const $e=.5*G*xe+X,dt=new o.pointGeometry(-100,-100),Pe=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),lt=new Dn,Et=Me.first,ct=Me.last;let ut=[];for(let vt=Et.path.length-1;vt>=1;vt--)ut.push(Et.path[vt]);for(let vt=1;vt<ct.path.length;vt++)ut.push(ct.path[vt]);const kt=2.5*$e;if(C){const vt=ut.map(re?(Ut,oi)=>{const Fi=Y(oi<Et.path.length-1?Et.tilePath[Et.path.length-1-oi]:ct.tilePath[oi-Et.path.length+2]);return Cr(Ut,C,Fi[2])}:Ut=>Cr(Ut,C));ut=vt.some(Ut=>Ut.signedDistanceFromCamera<=0)?[]:vt.map(Ut=>Ut.point)}let qt=[];if(ut.length>0){const vt=ut[0].clone(),Ut=ut[0].clone();for(let oi=1;oi<ut.length;oi++)vt.x=Math.min(vt.x,ut[oi].x),vt.y=Math.min(vt.y,ut[oi].y),Ut.x=Math.max(Ut.x,ut[oi].x),Ut.y=Math.max(Ut.y,ut[oi].y);qt=vt.x>=dt.x&&Ut.x<=Pe.x&&vt.y>=dt.y&&Ut.y<=Pe.y?[ut]:Ut.x<dt.x||vt.x>Pe.x||Ut.y<dt.y||vt.y>Pe.y?[]:o.clipLine([ut],dt.x,dt.y,Pe.x,Pe.y)}for(const vt of qt){lt.reset(vt,.25*$e);let Ut=0;Ut=lt.length<=.5*$e?1:Math.ceil(lt.paddedLength/kt)+1;for(let oi=0;oi<Ut;oi++){const Fi=oi/Math.max(Ut-1,1),Ar=lt.lerp(Fi),br=Ar.x+vn,Zr=Ar.y+vn;N.push(br,Zr,$e,0);const wn=br-$e,Hn=Zr-$e,fo=br+$e,Qn=Zr+$e;if(qe=qe&&this.isOffscreen(wn,Hn,fo,Qn),ve=ve||this.isInsideGrid(wn,Hn,fo,Qn),!t&&this.grid.hitTestCircle(br,Zr,$e,F)&&(Ze=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ze,occluded:!1}}}}return{circles:!k&&Ze||!ve?[]:N,offscreen:qe,collisionDetected:Ze,occluded:le.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,y=-1/0,v=-1/0;for(const P of t){const F=new o.pointGeometry(P.x+vn,P.y+vn);h=Math.min(h,F.x),m=Math.min(m,F.y),y=Math.max(y,F.x),v=Math.max(v,F.y),s.push(F)}const E=this.grid.query(h,m,y,v).concat(this.ignoredGrid.query(h,m,y,v)),C={},k={};for(const P of E){const F=P.key;if(C[F.bucketInstanceId]===void 0&&(C[F.bucketInstanceId]={}),C[F.bucketInstanceId][F.featureIndex])continue;const G=[new o.pointGeometry(P.x1,P.y1),new o.pointGeometry(P.x2,P.y1),new o.pointGeometry(P.x2,P.y2),new o.pointGeometry(P.x1,P.y2)];o.polygonIntersectsPolygon(s,G)&&(C[F.bucketInstanceId][F.featureIndex]=!0,k[F.bucketInstanceId]===void 0&&(k[F.bucketInstanceId]=[]),k[F.bucketInstanceId].push(F.featureIndex))}return k}insertCollisionBox(t,s,h,m,y){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,y){const v=s?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:m,collisionGroupID:y};for(let C=0;C<t.length;C+=4)v.insertCircle(E,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,h,m){const y=[s[0],s[1],s[2],1];let v=!1;return s[2]||this.transform.pitch>0?(o.transformMat4$1(y,y,t),this.fogState&&h&&(v=function(E,C,k,P,F,G){const X=G.calculateFogTileMatrix(F),q=[C,k,P];return o.transformMat4(q,q,X),Bt(E,q,G.pitch,G._fov)}(this.fogState,s[0],s[1],s[2],h.toUnwrapped(),this.transform)>.9)):Vr(y,y,t),{point:new o.pointGeometry((y[0]/y[3]+1)/2*this.transform.width+vn,(-y[1]/y[3]+1)/2*this.transform.height+vn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/y[3]*.5,1.5),signedDistanceFromCamera:y[3],occluded:m&&y[2]>y[3]||v}}isOffscreen(t,s,h,m){return h<vn||t>=this.screenRightBoundary||m<vn||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}class Ki{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Gn{constructor(t,s,h,m,y,v=!1){this.text=new Ki(t?t.text:null,s,h,y),this.icon=new Ki(t?t.icon:null,s,m,y),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zn{constructor(t,s,h,m=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=m}}class xr{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class mc{constructor(t,s,h,m,y){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=y}}class An{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function us(c,t,s,h,m){const{horizontalAlign:y,verticalAlign:v}=o.getAnchorAlignment(c),E=-(y-.5)*t,C=-(v-.5)*s,k=o.evaluateVariableOffset(c,h);return new o.pointGeometry(E+k[0]*m,C+k[1]*m)}function hs(c,t,s,h,m){const y=new o.pointGeometry(c,t);return s&&y._rotate(h?m:-m),y}class yp{constructor(t,s,h,m,y){this.transform=t.clone(),this.collisionIndex=new Qa(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new An(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m){const y=h.getBucket(s),v=h.latestFeatureIndex;if(!y||!v||s.id!==y.layerIds[0])return;const E=y.layers[0].layout,C=h.collisionBoxArray,k=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),P=h.tileSize/o.EXTENT,F=h.tileID.toUnwrapped(),G=this.transform.calculateProjMatrix(F),X=E.get("text-pitch-alignment")==="map",q=E.get("text-rotation-alignment")==="map";s.compileFilter();const N=s.dynamicFilter(),re=s.dynamicFilterNeedsFeature(),Y=this.transform.calculatePixelsToTileUnitsMatrix(h),te=Oo(G,h.tileID.canonical,X,q,this.transform,Y);let ie=null;if(X){const le=as(G,h.tileID.canonical,X,q,this.transform,Y);ie=o.multiply$1([],this.transform.labelPlaneMatrix,le)}let oe=null;N&&h.latestFeatureIndex&&(oe={unwrappedTileID:F,dynamicFilter:N,dynamicFilterNeedsFeature:re,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new mc(y.bucketInstanceId,v,y.sourceLayerIndex,y.index,h.tileID);const ee={bucket:y,layout:E,posMatrix:G,textLabelPlaneMatrix:te,labelToScreenMatrix:ie,clippingData:oe,scale:k,textPixelRatio:P,holdingForFade:h.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const le of y.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Se,symbolInstanceEnd:ze}=le;t.push({sortKey:xe,symbolInstanceStart:Se,symbolInstanceEnd:ze,parameters:ee})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(t,s,h,m,y,v,E,C,k,P,F,G,X,q,N,re,Y,te){const ie=[G.textOffset0,G.textOffset1],oe=us(t,h,m,ie,y),ee=this.collisionIndex.placeCollisionBox(y,s,hs(oe.x,oe.y,v,E,this.transform.angle),F,C,k,P.predicate);if((!re||this.collisionIndex.placeCollisionBox(q.getSymbolInstanceIconSize(te,this.transform.zoom,X),re,hs(oe.x,oe.y,v,E,this.transform.angle),F,C,k,P.predicate).box.length!==0)&&ee.box.length>0){let le;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(le=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:ie,width:h,height:m,anchor:t,textScale:y,prevAnchor:le},this.markUsedJustification(q,t,G,N),q.allowVerticalPlacement&&(this.markUsedOrientation(q,N,G),this.placedOrientations[G.crossTileID]=N),{shift:oe,placedGlyphBoxes:ee}}}placeLayerBucketPart(t,s,h,m){const{bucket:y,layout:v,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:k,clippingData:P,textPixelRatio:F,holdingForFade:G,collisionBoxArray:X,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:N,collisionGroup:re}=t.parameters,Y=v.get("text-optional"),te=v.get("icon-optional"),ie=v.get("text-allow-overlap"),oe=v.get("icon-allow-overlap"),ee=v.get("text-rotation-alignment")==="map",le=v.get("text-pitch-alignment")==="map",xe=v.get("icon-text-fit")!=="none",Se=v.get("symbol-z-order")==="viewport-y";let ze=ie&&(oe||!y.hasIconData()||te),Me=oe&&(ie||!y.hasTextData()||Y);!y.collisionArrays&&X&&y.deserializeCollisionBoxes(X),h&&m&&y.updateCollisionDebugBuffers(this.transform.zoom,X);const Ze=(ve,qe,$e)=>{if(P){const $i={zoom:this.transform.zoom,pitch:this.transform.pitch};let qi=null;if(P.dynamicFilterNeedsFeature){const _i=this.retainedQueryData[y.bucketInstanceId];qi=P.featureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:_i.bucketIndex,sourceLayerIndex:_i.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)($i,qi,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[ve.crossTileID]=new Zn(!1,!1,!1,!0),void(s[ve.crossTileID]=!0)}if(s[ve.crossTileID])return;if(G)return void(this.placements[ve.crossTileID]=new Zn(!1,!1,!1));let dt=!1,Pe=!1,lt=!0,Et=!1,ct=!1,ut=null,kt={box:null,offscreen:null,occluded:null},qt={box:null,offscreen:null,occluded:null},vt=null,Ut=null,oi=null,Fi=0,Ar=0,br=0;$e.textFeatureIndex?Fi=$e.textFeatureIndex:ve.useRuntimeCollisionCircles&&(Fi=ve.featureIndex),$e.verticalTextFeatureIndex&&(Ar=$e.verticalTextFeatureIndex);const Zr=$i=>{$i.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||$i.elevation)&&($i.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,$i.tileAnchorX,$i.tileAnchorY):0)},wn=$e.textBox;if(wn){Zr(wn);const $i=_i=>{let Ji=o.WritingMode.horizontal;if(y.allowVerticalPlacement&&!_i&&this.prevPlacement){const qr=this.prevPlacement.placedOrientations[ve.crossTileID];qr&&(this.placedOrientations[ve.crossTileID]=qr,Ji=qr,this.markUsedOrientation(y,Ji,ve))}return Ji},qi=(_i,Ji)=>{if(y.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&$e.verticalTextBox){for(const qr of y.writingModes)if(qr===o.WritingMode.vertical?(kt=Ji(),qt=kt):kt=_i(),kt&&kt.box&&kt.box.length)break}else kt=_i()};if(v.get("text-variable-anchor")){let _i=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]){const Oi=this.prevPlacement.variableOffsets[ve.crossTileID];_i.indexOf(Oi.anchor)>0&&(_i=_i.filter(tn=>tn!==Oi.anchor),_i.unshift(Oi.anchor))}const Ji=(Oi,tn,Ea)=>{const Wr=y.getSymbolInstanceTextSize(q,ve,this.transform.zoom,qe),Zo=(Oi.x2-Oi.x1)*Wr+2*Oi.padding,Zh=(Oi.y2-Oi.y1)*Wr+2*Oi.padding,Kc=xe&&!oe?tn:null;Kc&&Zr(Kc);let bs={box:[],offscreen:!1,occluded:!1};const Lp=ie?2*_i.length:_i.length;for(let mo=0;mo<Lp;++mo){const Jc=this.attemptAnchorPlacement(_i[mo%_i.length],Oi,Zo,Zh,Wr,ee,le,F,E,re,mo>=_i.length,ve,qe,y,Ea,Kc,q,N);if(Jc&&(bs=Jc.placedGlyphBoxes,bs&&bs.box&&bs.box.length)){dt=!0,ut=Jc.shift;break}}return bs};qi(()=>Ji(wn,$e.iconBox,o.WritingMode.horizontal),()=>{const Oi=$e.verticalTextBox;return Oi&&Zr(Oi),y.allowVerticalPlacement&&!(kt&&kt.box&&kt.box.length)&&ve.numVerticalGlyphVertices>0&&Oi?Ji(Oi,$e.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),kt&&(dt=kt.box,lt=kt.offscreen,Et=kt.occluded);const qr=$i(kt&&kt.box);if(!dt&&this.prevPlacement){const Oi=this.prevPlacement.variableOffsets[ve.crossTileID];Oi&&(this.variableOffsets[ve.crossTileID]=Oi,this.markUsedJustification(y,Oi.anchor,ve,qr))}}else{const _i=(Ji,qr)=>{const Oi=y.getSymbolInstanceTextSize(q,ve,this.transform.zoom,qe),tn=this.collisionIndex.placeCollisionBox(Oi,Ji,new o.pointGeometry(0,0),ie,F,E,re.predicate);return tn&&tn.box&&tn.box.length&&(this.markUsedOrientation(y,qr,ve),this.placedOrientations[ve.crossTileID]=qr),tn};qi(()=>_i(wn,o.WritingMode.horizontal),()=>{const Ji=$e.verticalTextBox;return y.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&Ji?(Zr(Ji),_i(Ji,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),$i(kt&&kt.box&&kt.box.length)}}if(vt=kt,dt=vt&&vt.box&&vt.box.length>0,lt=vt&&vt.offscreen,Et=vt&&vt.occluded,ve.useRuntimeCollisionCircles){const $i=y.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex>=0?ve.centerJustifiedTextSymbolIndex:ve.verticalPlacedTextSymbolIndex),qi=o.evaluateSizeForFeature(y.textSizeData,q,$i),_i=v.get("text-padding");Ut=this.collisionIndex.placeCollisionCircles(ie,$i,y.lineVertexArray,y.glyphOffsetArray,qi,E,C,k,h,le,re.predicate,ve.collisionCircleDiameter*qi/o.ONE_EM,_i,this.retainedQueryData[y.bucketInstanceId].tileID),dt=ie||Ut.circles.length>0&&!Ut.collisionDetected,lt=lt&&Ut.offscreen,Et=Ut.occluded}if($e.iconFeatureIndex&&(br=$e.iconFeatureIndex),$e.iconBox){const $i=qi=>{Zr(qi);const _i=xe&&ut?hs(ut.x,ut.y,ee,le,this.transform.angle):new o.pointGeometry(0,0),Ji=y.getSymbolInstanceIconSize(N,this.transform.zoom,qe);return this.collisionIndex.placeCollisionBox(Ji,qi,_i,oe,F,E,re.predicate)};qt&&qt.box&&qt.box.length&&$e.verticalIconBox?(oi=$i($e.verticalIconBox),Pe=oi.box.length>0):(oi=$i($e.iconBox),Pe=oi.box.length>0),lt=lt&&oi.offscreen,ct=oi.occluded}const Hn=Y||ve.numHorizontalGlyphVertices===0&&ve.numVerticalGlyphVertices===0,fo=te||ve.numIconVertices===0;if(Hn||fo?fo?Hn||(Pe=Pe&&dt):dt=Pe&&dt:Pe=dt=Pe&&dt,dt&&vt&&vt.box&&this.collisionIndex.insertCollisionBox(vt.box,v.get("text-ignore-placement"),y.bucketInstanceId,qt&&qt.box&&Ar?Ar:Fi,re.ID),Pe&&oi&&this.collisionIndex.insertCollisionBox(oi.box,v.get("icon-ignore-placement"),y.bucketInstanceId,br,re.ID),Ut&&(dt&&this.collisionIndex.insertCollisionCircles(Ut.circles,v.get("text-ignore-placement"),y.bucketInstanceId,Fi,re.ID),h)){const $i=y.bucketInstanceId;let qi=this.collisionCircleArrays[$i];qi===void 0&&(qi=this.collisionCircleArrays[$i]=new xr);for(let _i=0;_i<Ut.circles.length;_i+=4)qi.circles.push(Ut.circles[_i+0]),qi.circles.push(Ut.circles[_i+1]),qi.circles.push(Ut.circles[_i+2]),qi.circles.push(Ut.collisionDetected?1:0)}const Qn=this.transform.projection.name!=="globe";ze=ze&&(Qn||!Et),Me=Me&&(Qn||!ct),this.placements[ve.crossTileID]=new Zn(dt||ze,Pe||Me,lt||y.justReloaded),s[ve.crossTileID]=!0};if(Se){const ve=y.getSortedSymbolIndexes(this.transform.angle);for(let qe=ve.length-1;qe>=0;--qe){const $e=ve[qe];Ze(y.symbolInstances.get($e),$e,y.collisionArrays[$e])}}else for(let ve=t.symbolInstanceStart;ve<t.symbolInstanceEnd;ve++)Ze(y.symbolInstances.get(ve),ve,y.collisionArrays[ve]);if(h&&y.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[y.bucketInstanceId];o.invert(ve.invProjMatrix,E),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,s,h,m){let y;y=m===o.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const E of v)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:h.crossTileID)}markUsedOrientation(t,s,h){const m=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,y=s===o.WritingMode.vertical?s:0,v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const E of v)t.text.placedSymbolArray.get(E).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,y=s?s.opacities:{},v=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],P=y[C];P?(this.opacities[C]=new Gn(P,m,k.text,k.icon,null,k.clipped),h=h||k.text!==P.text.placed||k.icon!==P.icon.placed):(this.opacities[C]=new Gn(null,m,k.text,k.icon,k.skipFade,k.clipped),h=h||k.text||k.icon)}for(const C in y){const k=y[C];if(!this.opacities[C]){const P=new Gn(k,m,!1,!1);P.isHidden()||(this.opacities[C]=P,h=h||k.text.placed||k.icon.placed)}}for(const C in v)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=v[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const h={};for(const m of s){const y=m.getBucket(t);y&&m.latestFeatureIndex&&t.id===y.layerIds[0]&&this.updateBucketOpacities(y,h,m.collisionBoxArray)}}updateBucketOpacities(t,s,h){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,y=!!t.layers[0].dynamicFilter(),v=new Gn(null,0,!1,!1,!0),E=m.get("text-allow-overlap"),C=m.get("icon-allow-overlap"),k=m.get("text-variable-anchor"),P=m.get("text-rotation-alignment")==="map",F=m.get("text-pitch-alignment")==="map",G=m.get("icon-text-fit")!=="none",X=new Gn(null,0,E&&(C||!t.hasIconData()||m.get("icon-optional")),C&&(E||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const q=(re,Y,te)=>{for(let ie=0;ie<Y/4;ie++)re.opacityVertexArray.emplaceBack(te)};let N=0;for(let re=0;re<t.symbolInstances.length;re++){const Y=t.symbolInstances.get(re),{numHorizontalGlyphVertices:te,numVerticalGlyphVertices:ie,crossTileID:oe}=Y;let ee=this.opacities[oe];s[oe]?ee=v:ee||(ee=X,this.opacities[oe]=ee),s[oe]=!0;const le=te>0||ie>0,xe=Y.numIconVertices>0,Se=this.placedOrientations[Y.crossTileID],ze=Se===o.WritingMode.vertical,Me=Se===o.WritingMode.horizontal||Se===o.WritingMode.horizontalOnly;if(!le&&!xe||ee.isHidden()||N++,le){const Ze=eh(ee.text);q(t.text,te,ze?Ja:Ze),q(t.text,ie,Me?Ja:Ze);const ve=ee.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(t.text.placedSymbolArray.get(dt).hidden=ve||ze?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=ve||Me?1:0);const qe=this.variableOffsets[Y.crossTileID];qe&&this.markUsedJustification(t,qe.anchor,Y,Se);const $e=this.placedOrientations[Y.crossTileID];$e&&(this.markUsedJustification(t,"left",Y,$e),this.markUsedOrientation(t,$e,Y))}if(xe){const Ze=eh(ee.icon);Y.placedIconSymbolIndex>=0&&(q(t.icon,Y.numIconVertices,ze?Ja:Ze),t.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ee.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&(q(t.icon,Y.numVerticalIconVertices,Me?Ja:Ze),t.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ee.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ze=t.collisionArrays[re];if(Ze){let ve=new o.pointGeometry(0,0),qe=!0;if(Ze.textBox||Ze.verticalTextBox){if(k){const dt=this.variableOffsets[oe];dt?(ve=us(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textScale),P&&ve._rotate(F?this.transform.angle:-this.transform.angle)):qe=!1}y&&(qe=!ee.clipped),Ze.textBox&&bn(t.textCollisionBox.collisionVertexArray,ee.text.placed,!qe||ze,ve.x,ve.y),Ze.verticalTextBox&&bn(t.textCollisionBox.collisionVertexArray,ee.text.placed,!qe||Me,ve.x,ve.y)}const $e=qe&&Boolean(!Me&&Ze.verticalIconBox);Ze.iconBox&&bn(t.iconCollisionBox.collisionVertexArray,ee.icon.placed,$e,G?ve.x:0,G?ve.y:0),Ze.verticalIconBox&&bn(t.iconCollisionBox.collisionVertexArray,ee.icon.placed,!$e,G?ve.x:0,G?ve.y:0)}}}if(t.fullyClipped=N===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=re.invProjMatrix,t.placementViewportMatrix=re.viewportMatrix,t.collisionCircleArray=re.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function bn(c,t,s,h,m){c.emplaceBack(t?1:0,s?1:0,h||0,m||0),c.emplaceBack(t?1:0,s?1:0,h||0,m||0),c.emplaceBack(t?1:0,s?1:0,h||0,m||0),c.emplaceBack(t?1:0,s?1:0,h||0,m||0)}const xp=Math.pow(2,25),Ju=Math.pow(2,24),jr=Math.pow(2,17),Ya=Math.pow(2,16),no=Math.pow(2,9),_c=Math.pow(2,8),Ka=Math.pow(2,1);function eh(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,s=Math.floor(127*c.opacity);return s*xp+t*Ju+s*jr+t*Ya+s*no+t*_c+s*Ka+t}const Ja=0;class gc{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,h,m,y){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(v,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<v.length;){const E=v[this._currentPartIndex];if(s.placeLayerBucketPart(E,this._seenCrossTileIDs,h,E.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class vp{constructor(t,s,h,m,y,v,E,C){this.placement=new yp(t,y,v,E,C),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h){const m=o.exported.now(),y=()=>{const v=o.exported.now()-m;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=s[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=E)&&(!v.maxzoom||v.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new gc(v)),this._inProgressLayer.continuePlacement(h[v.source],this.placement,this._showCollisionBoxes,v,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const th=512/o.EXTENT/2;class Ap{constructor(t,s,h){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<s.length;m++){const y=s.get(m),v=y.key;this.indexedSymbolInstances[v]||(this.indexedSymbolInstances[v]=[]),this.indexedSymbolInstances[v].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,t)})}}getScaledCoordinates(t,s){const h=th/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+t.tileAnchorX)*h),y:Math.floor((s.canonical.y*o.EXTENT+t.tileAnchorY)*h)}}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<t.length;y++){const v=t.get(y);if(v.crossTileID)continue;const E=this.indexedSymbolInstances[v.key];if(!E)continue;const C=this.getScaledCoordinates(v,s);for(const k of E)if(Math.abs(k.coord.x-C.x)<=m&&Math.abs(k.coord.y-C.y)<=m&&!h[k.crossTileID]){h[k.crossTileID]=!0,v.crossTileID=k.crossTileID;break}}}}class ih{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],y={};for(const v in m){const E=m[v];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),y[E.tileID.key]=E}this.indexes[h]=y}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const v=this.indexes[y];if(Number(y)>t.overscaledZ)for(const E in v){const C=v[E];C.tileID.isChildOf(t)&&C.findMatches(s.symbolInstances,t,m)}else{const E=v[t.scaledTo(Number(y)).key];E&&E.findMatches(s.symbolInstances,t,m)}}for(let y=0;y<s.symbolInstances.length;y++){const v=s.symbolInstances.get(y);v.crossTileID||(v.crossTileID=h.generate(),m[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ap(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const y in m)t[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[y]),delete m[y],s=!0)}return s}}class el{constructor(){this.layerIndexes={},this.crossTileIDs=new ih,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,m){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new bp);let v=!1;const E={};m.name!=="globe"&&y.handleWrapJump(h);for(const C of s){const k=C.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(C.tileID,k,this.crossTileIDs)&&(v=!0),E[k.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const Js=(c,t)=>o.emitValidationErrors(c,t&&t.filter(s=>s.identifier!=="source.canvas")),rh=o.pick(pt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),nh=o.pick(pt,["setCenter","setZoom","setBearing","setPitch"]),oh={version:8,layers:[],sources:{}},Uo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Dr extends o.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new Yt(Ot(),this),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(t._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new el,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const h=this;this._rtlTextPluginCallback=Dr.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,v)=>{if(o.triggerPluginCompletionEvent(y),v&&v.every(E=>E))for(const E in h._sourceCaches){const C=h._sourceCaches[E],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getSource(m.sourceId);if(y&&y.vectorLayerIds)for(const v in this._layers){const E=this._layers[v];E.source===y.id&&this._validateLayer(E)}})}loadURL(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,s.accessToken);const m=this.map._requestManager.transformRequest(t,o.ResourceType.Style);this._request=o.getJSON(m,(y,v)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):v&&this._load(v,h)})}loadJSON(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(oh,!1)}_updateLayerCount(t,s){const h=s?1:-1;t.is3D()&&(this._num3DLayers+=h),t.type==="circle"&&(this._numCircleLayers+=h),t.type==="symbol"&&(this._numSymbolLayers+=h)}_load(t,s){if(s&&Js(this,o.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t,this._updateMapProjection();for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const h=fi(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new li(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(s,h,m){let y,v,E;const C=o.exported.devicePixelRatio>1?"@2x":"";let k=o.getJSON(h.transformRequest(h.normalizeSpriteURL(s,C,".json"),o.ResourceType.SpriteJSON),(G,X)=>{k=null,E||(E=G,y=X,F())}),P=o.getImage(h.transformRequest(h.normalizeSpriteURL(s,C,".png"),o.ResourceType.SpriteImage),(G,X)=>{P=null,E||(E=G,v=X,F())});function F(){if(E)m(E);else if(y&&v){const G=o.exported.getImageData(v),X={};for(const q in y){const{width:N,height:re,x:Y,y:te,sdf:ie,pixelRatio:oe,stretchX:ee,stretchY:le,content:xe}=y[q],Se=new o.RGBAImage({width:N,height:re});o.RGBAImage.copy(G,Se,{x:Y,y:te},{x:0,y:0},{width:N,height:re}),X[q]={data:Se,pixelRatio:oe,sdf:ie,stretchX:ee,stretchY:le,content:xe}}m(null,X)}}return{cancel(){k&&(k.cancel(),k=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.getSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Uo[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const v in this._updatedSources){const E=this._updatedSources[v];E==="reload"?this._reloadSource(v):E==="clear"&&this._clearSource(v)}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const y=this._sourceCaches[m];h[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];if(y.recalculate(t,this._availableImages),!y.isHidden(t.zoom)){const E=this._getLayerSourceCache(y);E&&(E.used=!0)}const v=this.map.painter;if(v){const E=y.getProgramIds();if(!E)continue;const C=y.getProgramConfiguration(t.zoom);for(const k of E)v.useProgram(k,C)}}for(const m in h){const y=this._sourceCaches[m];h[m]!==y.used&&y.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Js(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=fi(t.layers);const s=function(m,y){if(!m)return[{command:pt.setStyle,args:[y]}];let v=[];try{if(!B(m.version,y.version))return[{command:pt.setStyle,args:[y]}];B(m.center,y.center)||v.push({command:pt.setCenter,args:[y.center]}),B(m.zoom,y.zoom)||v.push({command:pt.setZoom,args:[y.zoom]}),B(m.bearing,y.bearing)||v.push({command:pt.setBearing,args:[y.bearing]}),B(m.pitch,y.pitch)||v.push({command:pt.setPitch,args:[y.pitch]}),B(m.sprite,y.sprite)||v.push({command:pt.setSprite,args:[y.sprite]}),B(m.glyphs,y.glyphs)||v.push({command:pt.setGlyphs,args:[y.glyphs]}),B(m.transition,y.transition)||v.push({command:pt.setTransition,args:[y.transition]}),B(m.light,y.light)||v.push({command:pt.setLight,args:[y.light]}),B(m.fog,y.fog)||v.push({command:pt.setFog,args:[y.fog]}),B(m.projection,y.projection)||v.push({command:pt.setProjection,args:[y.projection]});const E={},C=[];(function(F,G,X,q){let N;for(N in G=G||{},F=F||{})F.hasOwnProperty(N)&&(G.hasOwnProperty(N)||mi(N,X,q));for(N in G)G.hasOwnProperty(N)&&(F.hasOwnProperty(N)?B(F[N],G[N])||(F[N].type==="geojson"&&G[N].type==="geojson"&&$n(F,G,N)?X.push({command:pt.setGeoJSONSourceData,args:[N,G[N].data]}):Ro(N,G,X,q)):di(N,G,X))})(m.sources,y.sources,C,E);const k=[];m.layers&&m.layers.forEach(F=>{F.source&&E[F.source]?v.push({command:pt.removeLayer,args:[F.id]}):k.push(F)});let P=m.terrain;P&&E[P.source]&&(v.push({command:pt.setTerrain,args:[void 0]}),P=void 0),v=v.concat(C),B(P,y.terrain)||v.push({command:pt.setTerrain,args:[y.terrain]}),function(F,G,X){G=G||[];const q=(F=F||[]).map(ii),N=G.map(ii),re=F.reduce(Ht,{}),Y=G.reduce(Ht,{}),te=q.slice(),ie=Object.create(null);let oe,ee,le,xe,Se,ze,Me;for(oe=0,ee=0;oe<q.length;oe++)le=q[oe],Y.hasOwnProperty(le)?ee++:(X.push({command:pt.removeLayer,args:[le]}),te.splice(te.indexOf(le,ee),1));for(oe=0,ee=0;oe<N.length;oe++)le=N[N.length-1-oe],te[te.length-1-oe]!==le&&(re.hasOwnProperty(le)?(X.push({command:pt.removeLayer,args:[le]}),te.splice(te.lastIndexOf(le,te.length-ee),1)):ee++,ze=te[te.length-oe],X.push({command:pt.addLayer,args:[Y[le],ze]}),te.splice(te.length-oe,0,le),ie[le]=!0);for(oe=0;oe<N.length;oe++)if(le=N[oe],xe=re[le],Se=Y[le],!ie[le]&&!B(xe,Se))if(B(xe.source,Se.source)&&B(xe["source-layer"],Se["source-layer"])&&B(xe.type,Se.type)){for(Me in Je(xe.layout,Se.layout,X,le,null,pt.setLayoutProperty),Je(xe.paint,Se.paint,X,le,null,pt.setPaintProperty),B(xe.filter,Se.filter)||X.push({command:pt.setFilter,args:[le,Se.filter]}),B(xe.minzoom,Se.minzoom)&&B(xe.maxzoom,Se.maxzoom)||X.push({command:pt.setLayerZoomRange,args:[le,Se.minzoom,Se.maxzoom]}),xe)xe.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Je(xe[Me],Se[Me],X,le,Me.slice(6),pt.setPaintProperty):B(xe[Me],Se[Me])||X.push({command:pt.setLayerProperty,args:[le,Me,Se[Me]]}));for(Me in Se)Se.hasOwnProperty(Me)&&!xe.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Je(xe[Me],Se[Me],X,le,Me.slice(6),pt.setPaintProperty):B(xe[Me],Se[Me])||X.push({command:pt.setLayerProperty,args:[le,Me,Se[Me]]}))}else X.push({command:pt.removeLayer,args:[le]}),ze=te[te.lastIndexOf(le)+1],X.push({command:pt.addLayer,args:[Se,ze]})}(k,y.layers,v)}catch(E){console.warn("Unable to compute style diff:",E),v=[{command:pt.setStyle,args:[y]}]}return v}(this.serialize(),t).filter(m=>!(m.command in nh));if(s.length===0)return!1;const h=s.filter(m=>!(m.command in rh));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,s){return this.getImage(t)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,s),this._afterImageUpdated(t),this)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,s,h={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=ge(t,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:m.serialize(),sourceId:t}));const y=v=>{const E=(v?"symbol:":"other:")+t,C=this._sourceCaches[E]=new o.SourceCache(E,m,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[t]=C,C.style=this,C.onAdd(this.map)};y(!1),s.type!=="vector"&&s.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const s=this.getSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(t);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getSource(t).setData(s),this._changed=!0}getSource(t){const s=this._getSourceCache(t);return s&&s.getSource()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(t.type==="custom"){if(Js(this,o.validateCustomStyleLayer(t)))return;y=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=o.clone$1(t),t=o.extend(t,{source:m})),this._validate(o.validateLayer,`layers.${m}`,t,{arrayIndex:-1},h))return;y=o.createStyleLayer(t),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(v,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const E=this._getLayerSourceCache(y);if(this._removedLayers[m]&&y.source&&E&&y.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const h=this._order.indexOf(t);this._order.splice(h,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,s,h={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!B(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateFilter,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=o.clone$1(s),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const s=this.getLayer(t);return s&&o.clone$1(s.filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const y=this.getLayer(t);y?B(y.getLayoutProperty(s),h)||(y.setLayoutProperty(s,h,m),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,s){const h=this.getLayer(t);if(h)return h.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,s,h,m={}){this._checkLoaded();const y=this.getLayer(t);y?B(y.getPaintProperty(s),h)||(y.setPaintProperty(s,h,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,s){const h=this.getLayer(t);return h&&h.getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const h=t.source,m=t.sourceLayer,y=this.getSource(h);if(!y)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const v=y.type;if(v==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(h);for(const C of E)C.setFeatureState(m,t.id,s)}removeFeatureState(t,s){this._checkLoaded();const h=t.source,m=this.getSource(h);if(!m)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const y=m.type,v=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!v)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(h);for(const C of E)C.removeFeatureState(v,t.id,s)}getFeatureState(t){this._checkLoaded();const s=t.source,h=t.sourceLayer,m=this.getSource(s);if(m){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const s=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",s.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=v=>this._layers[v].type==="fill-extrusion",h={},m=[];for(let v=this._order.length-1;v>=0;v--){const E=this._order[v];if(s(E)){h[E]=v;for(const C of t){const k=C[E];if(k)for(const P of k)m.push(P)}}}m.sort((v,E)=>E.intersectionZ-v.intersectionZ);const y=[];for(let v=this._order.length-1;v>=0;v--){const E=this._order[v];if(s(E))for(let C=m.length-1;C>=0;C--){const k=m[C].feature;if(h[k.layer.id]<v)break;y.push(k),m.pop()}else for(const C of t){const k=C[E];if(k)for(const P of k)y.push(P.feature)}}return y}queryRenderedFeatures(t,s,h){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of s.layers){const k=this._layers[C];if(!k)return this.fire(new o.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[k.source]=!0}}const y=[];s.availableImages=this._availableImages;const v=s&&s.layers?s.layers.some(C=>{const k=this.getLayer(C);return k&&k.is3D()}):this.has3DLayers(),E=Ue.createFromScreenPoints(t,h);for(const C in this._sourceCaches){const k=this._sourceCaches[C].getSource().id;s.layers&&!m[k]||y.push(be(this._sourceCaches[C],this._layers,this._serializedLayers,E,s,h,v,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(C,k,P,F,G,X,q){const N={},re=X.queryRenderedSymbols(F),Y=[];for(const te of Object.keys(re).map(Number))Y.push(q[te]);Y.sort(it);for(const te of Y){const ie=te.featureIndex.lookupSymbolFeatures(re[te.bucketInstanceId],k,te.bucketIndex,te.sourceLayerIndex,G.filter,G.layers,G.availableImages,C);for(const oe in ie){const ee=N[oe]=N[oe]||[],le=ie[oe];le.sort((xe,Se)=>{const ze=te.featureSortOrder;if(ze){const Me=ze.indexOf(xe.featureIndex);return ze.indexOf(Se.featureIndex)-Me}return Se.featureIndex-xe.featureIndex});for(const xe of le)ee.push(xe)}}for(const te in N)N[te].forEach(ie=>{const oe=ie.feature,ee=P(C[te]).getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ee});return N}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(t,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(t);let m=[];for(const y of h)m=m.concat(Re(y,s));return m}addSourceType(t,s,h){return Dr.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(Dr.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const v in t)if(!B(t[v],h[v])){m=!0;break}if(!m)return;const y={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,s=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof t.source=="object"){const h="terrain-dem-src";this.addSource(h,t.source),t=o.clone$1(t),t=o.extend(t,{source:h})}if(this._validate(o.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(t,s);else{const h=this.terrain,m=h.get();for(const y in t)if(!B(t[y],m[y])){h.set(t),this.stylesheet.terrain=t;const v={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(v);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Ir(t,this.map.transform);this.stylesheet.fog=t;const h={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();for(const m in t)if(!B(t[m],h[m])){s.set(t),this.stylesheet.fog=t;const y={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(y);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new ui(t,s);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const m={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,m,y={}){return(!y||y.validate!==!1)&&Js(this,t.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:h,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const s=this._getSourceCaches(t);for(const h of s)h.clearTiles()}_reloadSource(t){const s=this._getSourceCaches(t);for(const h of s)h.resume(),h.reload()}_updateSources(t){for(const s in this._sourceCaches)this._sourceCaches[s].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,y=!1){let v=!1,E=!1;const C={};for(const k of this._order){const P=this._layers[k];if(P.type!=="symbol")continue;if(!C[P.source]){const G=this._getLayerSourceCache(P);if(!G)continue;C[P.source]=G.getRenderableIds(!0).map(X=>G.getTileByID(X)).sort((X,q)=>q.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(q.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(P,C[P.source],t.center.lng,t.projection);v=v||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new vp(t,this._order,y,s,h,m,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),v&&this.pauseablePlacement.placement.setStale()),E||v)for(const k of this._order){const P=this._layers[k];P.type==="symbol"&&this.placement.updateLayerOpacities(P,C[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const m=y=>{y&&y.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(t,s,h){return o.makeRequest(s,h)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this._getSourceCaches(t);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Dr.getSourceType=function(c){return ye[c]},Dr.setSourceType=function(c,t){ye[c]=t},Dr.registerForPluginStateChange=o.registerForPluginStateChange;var ea=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ta="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Vo={},oo={};Vo=St("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),oo=St(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const tl=St(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ia=ea;var ra={background:St(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:St(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:St(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:St("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:St(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:St(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:St("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:St("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:St("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:St(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:St(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:St(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:St(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:St(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:St(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:St(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:St(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:St(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:St(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:St(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:St(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:St(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:St(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:St(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:St(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:St(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ta),skyboxGradient:St(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ta),skyboxCapture:St(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:St(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:St(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function St(c,t,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,y=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v=c.match(m),E=t.match(m),C=ea.match(m);let k=E?E.concat(v):v;s||(Vo.staticUniforms&&(k=Vo.staticUniforms.concat(k)),oo.staticUniforms&&(k=oo.staticUniforms.concat(k))),k&&(k=k.concat(C));const P={};return{fragmentSource:c=c.replace(h,(F,G,X,q,N)=>(P[N]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${X} ${q} ${N};
#else
uniform ${X} ${q} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${X} ${q} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(h,(F,G,X,q,N)=>{const re=q==="float"?"vec2":"vec4",Y=N.match(/color/)?"color":re;return P[N]?G==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${X} ${re} a_${N};
varying ${X} ${q} ${N};
#else
uniform ${X} ${q} u_${N};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${X} ${q} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Y}(a_${N}, u_${N}_t);
#else
    ${X} ${q} ${N} = u_${N};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${X} ${re} a_${N};
#else
uniform ${X} ${q} u_${N};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${X} ${q} ${N} = a_${N};
#else
    ${X} ${q} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${X} ${q} ${N} = unpack_mix_${Y}(a_${N}, u_${N}_t);
#else
    ${X} ${q} ${N} = u_${N};
#endif
`}),staticAttributes:y,staticUniforms:k}}class il{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,h,m,y,v,E,C){this.context=t;let k=this.boundPaintVertexBuffers.length!==m.length;for(let P=0;!k&&P<m.length;P++)this.boundPaintVertexBuffers[P]!==m[P]&&(k=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===h&&!k&&this.boundIndexBuffer===y&&this.boundVertexOffset===v&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===C?(t.bindVertexArrayOES.set(this.vao),E&&E.bind(),y&&y.dynamicDraw&&y.bind(),C&&C.bind()):this.freshBind(s,h,m,y,v,E,C)}freshBind(t,s,h,m,y,v,E){let C;const k=t.numAttributes,P=this.context,F=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=E;else{C=P.currentNumAttributes||0;for(let G=k;G<C;G++)F.disableVertexAttribArray(G)}s.enableAttributes(F,t);for(const G of h)G.enableAttributes(F,t);v&&v.enableAttributes(F,t),E&&E.enableAttributes(F,t),s.bind(),s.setVertexAttribPointers(F,t,y);for(const G of h)G.bind(),G.setVertexAttribPointers(F,t,y);v&&(v.bind(),v.setVertexAttribPointers(F,t,y)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(F,t,y)),P.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sh(c,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new o.MercatorCoordinate(0,h/s).toLngLat().lat,new o.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function ah(c,t,s,h,m,y,v){const E=c.context,C=E.gl,k=s.fbo;if(!k)return;c.prepareDrawTile();const P=c.useProgram("hillshade");E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const F=((N,re,Y,te)=>{const ie=Y.paint.get("hillshade-shadow-color"),oe=Y.paint.get("hillshade-highlight-color"),ee=Y.paint.get("hillshade-accent-color");let le=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(le-=N.transform.angle);const xe=!N.options.moving;return{u_matrix:te||N.transform.calculateProjMatrix(re.tileID.toUnwrapped(),xe),u_image:0,u_latrange:sh(0,re.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),le],u_shadow:ie,u_highlight:oe,u_accent:ee}})(c,s,h,c.terrain?t.projMatrix:null);c.prepareDrawProgram(E,P,t.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:q}=c.getTileBoundsBuffers(s);P.draw(E,C.TRIANGLES,m,y,v,o.CullFaceMode.disabled,F,h.id,G,X,q)}function yc(c,t,s){if(!t.needsDEMTextureUpload)return;const h=c.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(s.stride);const y=s.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new o.Texture(h,y,m.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function xc(c,t,s,h,m,y){const v=c.context,E=v.gl;if(!t.dem)return;const C=t.dem;if(v.activeTexture.set(E.TEXTURE1),yc(c,t,C),!t.demTexture)return;t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=C.dim;v.activeTexture.set(E.TEXTURE0);let P=t.fbo;if(!P){const q=new o.Texture(v,{width:k,height:k,data:null},E.RGBA);q.bind(E.LINEAR,E.CLAMP_TO_EDGE),P=t.fbo=v.createFramebuffer(k,k,!0),P.colorAttachment.set(q.texture)}v.bindFramebuffer.set(P.framebuffer),v.viewport.set([0,0,k,k]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:G,tileBoundsSegments:X}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(v,E.TRIANGLES,h,m,y,o.CullFaceMode.disabled,((q,N)=>{const re=N.stride,Y=o.create();return o.ortho(Y,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Y,Y,[0,-o.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[re,re],u_zoom:q.overscaledZ,u_unpack:N.unpackVector}})(t.tileID,C),s.id,F,G,X),t.needsHillshadePrepare=!1}const vc=(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image0:new o.Uniform1i(c,t.u_image0),u_skirt_height:new o.Uniform1f(c,t.u_skirt_height)}),lh=(c,t)=>({u_matrix:c,u_image0:0,u_skirt_height:t}),ch=(c,t,s,h,m,y)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_merc_matrix:s,u_zoom_transition:h,u_merc_center:m,u_image0:0,u_grid_matrix:y?Float32Array.from(y):new Float32Array(9)});function rl(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const so=new class{constructor(){this.operations={}}newMorphing(c,t,s,h,m){if(c in this.operations){const y=this.operations[c];y.to.tileID.key!==s.tileID.key&&(y.queued=s)}else this.operations[c]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const s=this.operations[t];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},ds={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ac(c,t){const s=1<<c.z;return!t&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}const nl=c=>({u_matrix:c});function bc(c,t,s,h,m){if(m>0){const y=o.exported.now(),v=(y-c.timeAdded)/m,E=t?(y-t.timeAdded)/m:-1,C=s.getSource(),k=h.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(c.tileID.overscaledZ-k),F=P&&c.refreshedUponExpiration?1:o.clamp(P?v:1-E,0,1);return c.refreshedUponExpiration&&v>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const wp=2*o.mercatorZfromAltitude(1,0)*o.GLOBE_RADIUS*Math.PI;class na extends o.SourceCache{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new Yt(Ot(),null),m=ge("mock-dem",s,h,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class oa extends o.SourceCache{constructor(t){const s=ge("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Yt(Ot(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,v)=>{if(y[v.key]="",!this._tiles[v.key]){const E=new o.Tile(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom);E.state="loaded",this._tiles[v.key]=E}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wc extends o.OverscaledTileID{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Nr extends o.Elevation{constructor(t,s){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,y]=function(C){const k=new o.StructArrayLayout4i8,P=new o.StructArrayLayout3ui6,F=131;k.reserve(17161),P.reserve(33800);const G=o.EXTENT/128,X=o.EXTENT+G/2,q=X+G;for(let re=-G;re<q;re+=G)for(let Y=-G;Y<q;Y+=G){const te=Y<0||Y>X||re<0||re>X?24575:0,ie=o.clamp(Math.round(Y),0,o.EXTENT),oe=o.clamp(Math.round(re),0,o.EXTENT);k.emplaceBack(ie+te,oe,ie,oe)}const N=(re,Y)=>{const te=Y*F+re;P.emplaceBack(te+1,te,te+F),P.emplaceBack(te+F,te+F+1,te+1)};for(let re=1;re<129;re++)for(let Y=1;Y<129;Y++)N(Y,re);return[0,129].forEach(re=>{for(let Y=0;Y<130;Y++)N(Y,re),N(re,Y)}),[k,P,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(h,o.boundsAttributes.members),this.gridIndexBuffer=v.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,h.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new oa(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const E=v.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new na(s.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const m=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const y=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const v=this.getScaledDemTileSize();this.sourceCache.update(s,v,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),s.updateElevation(!h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(C=>{const k=s.getTileByID(C).tileID;return k.projMatrix=h.calculateProjMatrix(k.toUnwrapped()),k});(function(C,k){const P=k.transform.pointCoordinate(k.transform.getCameraPoint()),F=new o.pointGeometry(P.x,P.y);C.sort((G,X)=>{if(X.overscaledZ-G.overscaledZ)return X.overscaledZ-G.overscaledZ;const q=new o.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),N=new o.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),re=F.mult(1<<G.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(q)-re.distSqr(N)})})(m,this.painter),this._previousZoom=h.zoom;const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const v=this._style._sourceCaches;for(const C in v){const k=v[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,t[C],y),k.usedForTerrain))continue;const P=t[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[s.id]=m.map(C=>new wc(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const P=k.tileID.key;P in E||(this._visibleDemTiles.push(k),E[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),yc(this.painter,m,y))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const y=t.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-y.z),E=m||"";return h[`u_dem_tl${E}`]=[y.x*v%1,y.y*v%1],h[`u_dem_scale${E}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,s=t.gl;if(!this._emptyDepthBufferTexture){const h=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(t,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const y=m.dem.tree.minimums[0];return y>0&&t++,h+y},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new o.Texture(t,m,s.RGBA,{premultiply:!1}),y}setupElevationDraw(t,s,h){const m=this.painter.context,y=m.gl,v=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;v.u_dem_size=this.sourceCache.getSource().tileSize,v.u_exaggeration=this.exaggeration();const C=this.painter.transform,k=C.projection,P=t.tileID.canonical;v.u_tile_tl_up=k.upVector(P,0,0),v.u_tile_tr_up=k.upVector(P,o.EXTENT,0),v.u_tile_br_up=k.upVector(P,o.EXTENT,o.EXTENT),v.u_tile_bl_up=k.upVector(P,0,o.EXTENT),v.u_tile_up_scale=h&&h.useDenormalizedUpVectorScale?wp:k.upVectorScale(P,C.center.lat,C.worldSize).metersToTile;let F=null,G=null,X=1;if(h&&h.morphing&&this._useVertexMorphing){const q=h.morphing.srcDemTile,N=h.morphing.dstDemTile;X=h.morphing.phase,q&&N&&(this._prepareDemTileUniforms(t,q,v,"_prev")&&(G=q),this._prepareDemTileUniforms(t,N,v)&&(F=N))}if(G&&F?(m.activeTexture.set(y.TEXTURE2),F.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),m.activeTexture.set(y.TEXTURE4),G.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),v.u_dem_lerp=X):(F=this.terrainTileForTile[t.tileID.key],m.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(t,F,v)?F.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),m.activeTexture.set(y.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),this._depthFBO&&(v.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),v.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&F){const q=(1<<F.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=q}h&&h.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,v)}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),this.renderingToTexture=!1,function(m,y,v,E,C){if(m.transform.projection.name==="globe")(function(k,P,F,G,X){const q=k.context,N=q.gl;let re,Y;const te=k.options.showTerrainWireframe?2:0,ie=(Me,Ze)=>{if(Y===Me)return;const ve=[ds[Me],"PROJECTION_GLOBE_VIEW"];Ze&&ve.push(ds[te]),re=k.useProgram("globeRaster",null,ve),Y=Me},oe=k.colorModeForRenderPass(),ee=new o.DepthMode(N.LEQUAL,o.DepthMode.ReadWrite,k.depthRangeFor3D);so.update(X);const le=k.transform,xe=o.calculateGlobeMercatorMatrix(le),Se=[o.mercatorXfromLng(le.center.lng),o.mercatorYfromLat(le.center.lat)],ze=k.globeSharedBuffers;if((te?[!1,!0]:[!1]).forEach(Me=>{Y=-1;const Ze=Me?N.LINES:N.TRIANGLES;for(const ve of G){const qe=F.getTile(ve),$e=o.StencilMode.disabled,dt=P.prevTerrainTileForTile[ve.key],Pe=P.terrainTileForTile[ve.key];rl(dt,Pe)&&so.newMorphing(ve.key,dt,Pe,X,250),q.activeTexture.set(N.TEXTURE0),qe.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const lt=so.getMorphValuesForProxy(ve.key),Et=lt?1:0,ct={useDenormalizedUpVectorScale:!0};lt&&o.extend$1(ct,{morphing:{srcDemTile:lt.from,dstDemTile:lt.to,phase:o.easeCubicInOut(lt.phase)}});const ut=Float32Array.from(le.globeMatrix),kt=o.globeTileLatLngCorners(ve.canonical),qt=o.getGridMatrix(ve.canonical,kt),vt=ch(le.projMatrix,ut,xe,o.globeToMercatorTransition(le.zoom),Se,qt);if(ie(Et,Me),P.setupElevationDraw(qe,re,ct),k.prepareDrawProgram(q,re,ve.toUnwrapped()),ze){const[Ut,oi,Fi]=Me?ze.getWirefameBuffers(k.context):ze.getGridBuffers();re.draw(q,Ze,ee,$e,oe,o.CullFaceMode.backCCW,vt,"globe_raster",Ut,oi,Fi)}}}),ze){re=k.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Me of G){const{x:Ze,y:ve,z:qe}=Me.canonical,$e=ve===0,dt=ve===(1<<qe)-1,[Pe,lt,Et,ct]=ze.getPoleBuffers(qe);if(ct&&($e||dt)){const ut=F.getTile(Me);q.activeTexture.set(N.TEXTURE0),ut.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let kt=o.globePoleMatrixForTile(qe,Ze,le);const qt=(vt,Ut)=>vt.draw(q,N.TRIANGLES,ee,o.StencilMode.disabled,oe,o.CullFaceMode.disabled,ch(le.projMatrix,kt,kt,0,Se),"globe_pole_raster",Ut,Et,ct);P.setupElevationDraw(ut,re,{}),k.prepareDrawProgram(q,re,Me.toUnwrapped()),$e&&qt(re,Pe),dt&&(kt=o.scale(o.create(),kt,[1,-1,1]),qt(re,lt))}}}})(m,y,v,E,C);else{const k=m.context,P=k.gl;let F,G;const X=m.options.showTerrainWireframe?2:0,q=(ie,oe)=>{if(G===ie)return;const ee=[ds[ie]];oe&&ee.push(ds[X]),F=m.useProgram("terrainRaster",null,ee),G=ie},N=m.colorModeForRenderPass(),re=new o.DepthMode(P.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);so.update(C);const Y=m.transform,te=6*Math.pow(1.5,22-Y.zoom)*y.exaggeration();(X?[!1,!0]:[!1]).forEach(ie=>{G=-1;const oe=ie?P.LINES:P.TRIANGLES,[ee,le]=ie?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const xe of E){const Se=v.getTile(xe),ze=o.StencilMode.disabled,Me=y.prevTerrainTileForTile[xe.key],Ze=y.terrainTileForTile[xe.key];rl(Me,Ze)&&so.newMorphing(xe.key,Me,Ze,C,250),k.activeTexture.set(P.TEXTURE0),Se.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const ve=so.getMorphValuesForProxy(xe.key),qe=ve?1:0;let $e;ve&&($e={morphing:{srcDemTile:ve.from,dstDemTile:ve.to,phase:o.easeCubicInOut(ve.phase)}});const dt=lh(xe.projMatrix,Ac(xe.canonical,Y.renderWorldCopies)?te/10:te);q(qe,ie),y.setupElevationDraw(Se,F,$e),m.prepareDrawProgram(k,F,xe.toUnwrapped()),F.draw(k,oe,re,ze,N,o.CullFaceMode.backCCW,dt,"terrain_raster",y.gridBuffer,ee,le)}})}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],v=this._drapedRenderBatches.shift(),E=[],C=s.style.order;let k=0;for(const P of y){const F=m.getTileByID(P.proxyTileKey),G=m.proxyCachedFBO[P.key]?m.proxyCachedFBO[P.key][t]:void 0,X=G!==void 0?m.renderCache[G]:this.pool[k++],q=G!==void 0;if(F.texture=X.tex,q&&!X.dirty){E.push(F.tileID);continue}let N;h.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(h.clear({color:o.Color.transparent,stencil:0}),X.dirty=!1);for(let re=v.start;re<=v.end;++re){const Y=s.style._layers[C[re]];if(Y.isHidden(s.transform.zoom))continue;const te=s.style._getLayerSourceCache(Y),ie=te?this.proxyToSource[P.key][te.id]:[P];if(!ie)continue;const oe=ie;h.viewport.set([0,0,X.fb.width,X.fb.height]),N!==(te?te.id:null)&&(this._setupStencil(X,ie,Y,te),N=te?te.id:null),s.renderLayer(s,te,Y,oe)}this.renderedToTile?(X.dirty=!0,E.push(F.tileID)):q||--k,k===5&&(k=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}renderCacheEfficiency(t){const s=t.order.length;if(s===0)return{efficiency:100};let h,m=0,y=0,v=!1;for(let E=0;E<s;++E){const C=t._layers[t.order[E]];this._style.isLayerDraped(C)?(v&&++m,++y):v||(v=!0,h=C.id)}return y===0?{efficiency:100}:{efficiency:100*(1-m/y),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const v=y.tileID,E=Math.pow(2,v.overscaledZ),{x:C,y:k}=v.canonical,P=C/E,F=(C+1)/E,G=k/E,X=(k+1)/E;return{minx:P,miny:G,maxx:F,maxy:X,t:y.dem.tree.raycastRoot(P,G,F,X,t,s,h),tile:y}});m.sort((y,v)=>(y.t!==null?y.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const v=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,s,h);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new o.Texture(t,{width:h[0],height:h[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const y=t.createFramebuffer(h[0],h[1],!1);return y.colorAttachment.set(m.texture),y.depthAttachment=new ss(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._layers[t],h=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),y=!!m&&m.t!==1,v=s.hasTransition();return s.type!=="custom"&&!h&&(y||v)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof V){t=!0;break}if(t)for(let s=0;s<this._style.order.length;++s){const h=this._style._layers[this._style.order[s]],m=h.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!y)continue;const v=h.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][y.id];if(C)for(const k of C){const P=bc(y.getTile(k),y.findLoadedParent(k,0),y,this.painter.transform,v);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,k)}}}}_setupDrapedRenderBatches(){const t=this._style.order,s=t.length;if(s===0)return;const h=[];let m,y=0,v=this._style._layers[t[y]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++y<s;)v=this._style._layers[t[y]];for(;y<s;++y){const E=this._style._layers[t[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?m===void 0&&(m=y):m!==void 0&&(h.push({start:m,end:y-1}),m=void 0))}m!==void 0&&h.push({start:m,end:y-1}),this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let E=0;E<v.length;++E){const C=Object.values(v[E]);s.renderCachePool.push(...C)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let v=h.length-1;v>=0;v--){const E=h[v];if(s.getTileByID(E.key),s.proxyCachedFBO[E.key]!==void 0){const C=t[E.key],k=this.proxyToSource[E.key];let P=0;for(const F in k){const G=k[F],X=C[F];if(!X||X.length!==G.length||G.some((q,N)=>q!==X[N]||m[F]&&m[F].hasOwnProperty(q.key))){P=-1;break}++P}for(const F in s.proxyCachedFBO[E.key])s.renderCache[s.proxyCachedFBO[E.key][F]].dirty=P<0||P!==Object.values(C).length}}const y=[...this._drapedRenderBatches];y.sort((v,E)=>E.end-E.start-(v.end-v.start));for(const v of y)for(const E of h){if(s.proxyCachedFBO[E.key])continue;let C=s.renderCachePool.pop();C===void 0&&s.renderCache.length<50&&(C=s.renderCache.length,s.renderCache.push(this._createFBO())),C!==void 0&&(s.proxyCachedFBO[E.key]={},s.proxyCachedFBO[E.key][v.start]=C,s.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,v=y.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let E;if(h.isTileClipped())E=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(t.key)||0),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,y=m.gl;h._tileClippingMaskIDs.clear(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const v=h.useProgram("clippingMask");for(const E of t){const C=--s;h._tileClippingMaskIDs.set(E.key,C),v.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},C,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,nl(E.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];o.transformMat4$1(h,h,s.pixelMatrixInverse),o.scale$1(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,y=o.mercatorZfromAltitude(1,s.center.lat),v=[m[0],m[1],m[2]/y,0],E=o.subtract([],h.slice(0,3),v);o.normalize(E,E);const C=this.raycast(v,E,this._exaggeration);return C!==null&&C?(o.scaleAndAdd(v,v,E,C),v[3]=v[2],v[2]*=y,v):null}drawDepth(){const t=this.painter,s=t.context,h=this.proxySourceCache,m=Math.ceil(t.width),y=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===y||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const v=s.gl,E=s.createFramebuffer(m,y,!0);s.activeTexture.set(v.TEXTURE0);const C=new o.Texture(s,{width:m,height:y,data:null},v.RGBA);C.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.colorAttachment.set(C.texture);const k=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,y);E.depthAttachment.set(k),this._depthFBO=E,this._depthTexture=C}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,y]),function(v,E,C,k){if(v.transform.projection.name==="globe")return;const P=v.context,F=P.gl;P.clear({depth:1});const G=v.useProgram("terrainDepth"),X=new o.DepthMode(F.LESS,o.DepthMode.ReadWrite,v.depthRangeFor3D);for(const q of k){const N=C.getTile(q),re=lh(q.projMatrix,0);E.setupElevationDraw(N,G),G.draw(P,F.TRIANGLES,X,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,re,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(t,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof ue)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const C=y[E],k=this._findTileCoveringTileID(C,t);if(k){const P=this._createProxiedId(C,k,h[C.key]&&h[C.key][t.id]);m.push(P),this.proxyToSource[C.key][t.id]=[P]}}let v=!1;for(let E=0;E<s.length;E++){const C=t.getTile(s[E]);if(!C||!C.hasData())continue;const k=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==C.tileID.canonical.z){const P=this.proxyToSource[k.tileID.key][t.id],F=this._createProxiedId(k.tileID,C,h[k.tileID.key]&&h[k.tileID.key][t.id]);P?P.splice(P.length-1,0,F):this.proxyToSource[k.tileID.key][t.id]=[F],m.push(F),v=!0}}this._sourceTilesOverlap[t.id]=v}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],y=this.proxyCoords,v=t.getSource(),E=new o.pointGeometry(v.tileID.x,v.tileID.y)._div(1<<v.tileID.z),C=v.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((P,F)=>(P.min.x=Math.min(P.min.x,F.x-E.x),P.min.y=Math.min(P.min.y,F.y-E.y),P.max.x=Math.max(P.max.x,F.x-E.x),P.max.y=Math.max(P.max.y,F.y-E.y),P),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(P,F)=>{const G=P.wrap+P.canonical.x/(1<<P.canonical.z),X=P.canonical.y/(1<<P.canonical.z),q=o.EXTENT/(1<<P.canonical.z),N=F.wrap+F.canonical.x/(1<<F.canonical.z),re=F.canonical.y/(1<<F.canonical.z);return G+q<N+C.min.x||G>N+C.max.x||X+q<re+C.min.y||X>re+C.max.y};for(let P=0;P<y.length;P++){const F=y[P];for(let G=0;G<s.length;G++){const X=t.getTile(s[G]);if(!X||!X.hasData()||k(F,X.tileID))continue;const q=this._createProxiedId(F,X,h[F.key]&&h[F.key][t.id]),N=this.proxyToSource[F.key][t.id];N?N.push(q):this.proxyToSource[F.key][t.id]=[q],m.push(q)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const y=h.find(v=>v.key===s.tileID.key);if(y)return y}if(s.tileID.key!==t.key){const y=t.canonical.z-s.tileID.canonical.z;let v,E,C;m=o.create();const k=s.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(v=o.EXTENT>>y,E=v*((s.tileID.canonical.x<<y)-t.canonical.x+k),C=v*((s.tileID.canonical.y<<y)-t.canonical.y)):(v=o.EXTENT<<-y,E=o.EXTENT*(s.tileID.canonical.x-(t.canonical.x+k<<-y)),C=o.EXTENT*(s.tileID.canonical.y-(t.canonical.y<<-y))),o.ortho(m,0,v,0,v,0,1),o.translate(m,m,[E,C,0])}return new wc(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],y=m[t.key];if(h=y?s.getTileByID(y):null,h&&h.hasData()||y===null)return h;let v=h?h.tileID:t,E=v.overscaledZ;const C=s.getSource().minzoom,k=[];if(!y){const F=s.getSource().maxzoom;if(t.canonical.z>=F){const G=t.canonical.z-F;s.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,s.transform.tileZoom),v=new o.OverscaledTileID(E,t.wrap,F,t.canonical.x>>G,t.canonical.y>>G)):G!==0&&(E=F,v=new o.OverscaledTileID(E,t.wrap,F,t.canonical.x>>G,t.canonical.y>>G))}v.key!==t.key&&(k.push(v.key),h=s.getTile(v))}const P=F=>{k.forEach(G=>{m[G]=F}),k.length=0};for(E-=1;E>=C&&(!h||!h.hasData());E--){h&&P(h.tileID.key);const F=v.calculateScaledKey(E);if(h=s.getTileByID(F),h&&h.hasData())break;const G=m[F];if(G===null)break;G===void 0?k.push(F):h=s.getTileByID(G)}return P(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(s){let h=0;const m=new o.StructArrayLayout2ui4,y=131;for(let v=1;v<129;v++){for(let E=1;E<129;E++)h=v*y+E,m.emplaceBack(h,h+1),m.emplaceBack(h,h+y),m.emplaceBack(h+1,h+y),v===128&&m.emplaceBack(h+y,h+y+1);m.emplaceBack(h+1,h+1+y)}return m}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ol(c){const t=[];for(let s=0;s<c.length;s++){if(c[s]===null)continue;const h=c[s].split(" ");t.push(h.pop())}return t}class sa{static cacheKey(t,s,h){let m=`${t}${h?h.cacheKey:""}`;for(const y of s)m+=`/${y}`;return m}constructor(t,s,h,m,y,v){const E=t.gl;this.program=E.createProgram();const C=ol(h.staticAttributes),k=m?m.getBinderAttributes():[],P=C.concat(k),F=h.staticUniforms?ol(h.staticUniforms):[],G=m?m.getBinderUniforms():[],X=F.concat(G),q=[];for(const ee of X)q.indexOf(ee)<0&&q.push(ee);let N=m?m.defines():[];N=N.concat(v.map(ee=>`#define ${ee}`));const re=N.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ia,tl.fragmentSource,oo.fragmentSource,h.fragmentSource).join(`
`),Y=N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ia,tl.vertexSource,oo.vertexSource,Vo.vertexSource,h.vertexSource).join(`
`),te=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(te,re),E.compileShader(te),E.attachShader(this.program,te);const ie=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(ie,Y),E.compileShader(ie),E.attachShader(this.program,ie),this.attributes={};const oe={};this.numAttributes=P.length;for(let ee=0;ee<this.numAttributes;ee++)P[ee]&&(E.bindAttribLocation(this.program,ee,P[ee]),this.attributes[P[ee]]=ee);E.linkProgram(this.program),E.deleteShader(ie),E.deleteShader(te);for(let ee=0;ee<q.length;ee++){const le=q[ee];if(le&&!oe[le]){const xe=E.getUniformLocation(this.program,le);xe&&(oe[le]=xe)}}this.fixedUniforms=y(t,oe),this.binderUniforms=m?m.getUniforms(t,oe):[],v.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((ee,le)=>({u_dem:new o.Uniform1i(ee,le.u_dem),u_dem_prev:new o.Uniform1i(ee,le.u_dem_prev),u_dem_unpack:new o.Uniform4f(ee,le.u_dem_unpack),u_dem_tl:new o.Uniform2f(ee,le.u_dem_tl),u_dem_scale:new o.Uniform1f(ee,le.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(ee,le.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(ee,le.u_dem_scale_prev),u_dem_size:new o.Uniform1f(ee,le.u_dem_size),u_dem_lerp:new o.Uniform1f(ee,le.u_dem_lerp),u_exaggeration:new o.Uniform1f(ee,le.u_exaggeration),u_depth:new o.Uniform1i(ee,le.u_depth),u_depth_size_inv:new o.Uniform2f(ee,le.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(ee,le.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(ee,le.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(ee,le.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(ee,le.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(ee,le.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(ee,le.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(ee,le.u_tile_up_scale)}))(t,oe)),v.indexOf("FOG")!==-1&&(this.fogUniforms=((ee,le)=>({u_fog_matrix:new o.UniformMatrix4f(ee,le.u_fog_matrix),u_fog_range:new o.Uniform2f(ee,le.u_fog_range),u_fog_color:new o.Uniform4f(ee,le.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(ee,le.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(ee,le.u_fog_temporal_offset)}))(t,oe))}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].location&&h[m].set(s[m])}}draw(t,s,h,m,y,v,E,C,k,P,F,G,X,q,N,re){const Y=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(m),t.setColorMode(y),t.setCullFace(v);for(const ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(E[ie]);q&&q.setUniforms(t,this.binderUniforms,G,{zoom:X});const te={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[s];for(const ie of F.get()){const oe=ie.vaos||(ie.vaos={});(oe[C]||(oe[C]=new il)).bind(t,this,k,q?q.getPaintVertexBuffers():[],P,ie.vertexOffset,N,re),Y.drawElements(s,ie.primitiveLength*te,Y.UNSIGNED_SHORT,ie.primitiveOffset*te*2)}}}function aa(c,t,s){const h=1/ir(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,v=y*(s.tileID.canonical.x+s.tileID.wrap*m),E=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[v>>16,E>>16],u_pixel_coord_lower:[65535&v,65535&E]}}const Ec=o.create(),sl=(c,t,s,h,m,y,v,E,C)=>{const k=t.style.light,P=k.properties.get("position"),F=[P.x,P.y,P.z],G=o.create$1();k.properties.get("anchor")==="viewport"&&(o.fromRotation(G,-t.transform.angle),o.transformMat3(F,F,G));const X=k.properties.get("color"),q=t.transform,N={u_matrix:c,u_lightpos:F,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ec,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return q.projection.name==="globe"&&(N.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],N.u_zoom_transition=v,N.u_inv_rot_matrix=C,N.u_merc_center=E,N.u_up_dir=q.projection.upVector(new o.CanonicalTileID(0,0,0),E[0]*o.EXTENT,E[1]*o.EXTENT),N.u_height_lift=y),N},al=(c,t,s,h,m,y,v,E,C,k,P)=>{const F=sl(c,t,s,h,m,E,C,k,P),G={u_height_factor:-Math.pow(2,m.overscaledZ)/v.tileSize/8};return o.extend(F,aa(y,t,v),G)},ll=c=>({u_matrix:c}),cl=(c,t,s,h)=>o.extend(ll(c),aa(s,t,h)),ul=(c,t)=>({u_matrix:c,u_world:t}),uh=(c,t,s,h,m)=>o.extend(cl(c,t,s,h),{u_world:m}),hh=o.create(),ps=(c,t,s,h,m,y)=>{const v=c.transform,E=v.projection.name==="globe";let C;if(y.paint.get("circle-pitch-alignment")==="map")if(E){const P=o.globePixelsToTileUnits(v.zoom,t.canonical);C=Float32Array.from([P,0,0,P])}else C=v.calculatePixelsToTileUnitsMatrix(s);else C=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:c.translatePosMatrix(t.projMatrix,s,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:hh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return E&&(k.u_inv_rot_matrix=h,k.u_merc_center=m,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=o.globeToMercatorTransition(v.zoom),k.u_up_dir=v.projection.upVector(t.canonical,m[0],m[1])),k},Ep=c=>{const t=[];return c.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Tp=(c,t,s)=>{const h=o.EXTENT/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/h,t.pixelsToGLUnits[1]/h]}},dh=(c,t,s=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:s}),Sp=o.create(),Ip=(c,t,s,h,m,y,v)=>{const E=c.transform,C=E.projection.name==="globe",k=C?o.globePixelsToTileUnits(E.zoom,t.canonical):ir(s,1,y),P={u_matrix:t.projMatrix,u_extrude_scale:k,u_intensity:v,u_inv_rot_matrix:Sp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return C&&(P.u_inv_rot_matrix=h,P.u_merc_center=m,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=o.globeToMercatorTransition(E.zoom),P.u_up_dir=E.projection.upVector(t.canonical,m[0],m[1])),P},Cp=(c,t,s,h,m,y,v)=>{const E=c.transform,C=E.calculatePixelsToTileUnitsMatrix(t),k={u_matrix:jo(c,t,s,m),u_pixels_to_tile_units:C,u_device_pixel_ratio:v,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Sc(s)){const P=hl(t,c.transform);k.u_texsize=t.lineAtlasTexture.size,k.u_scale=[P,h.fromScale,h.toScale],k.u_mix=h.t}return k},Tc=(c,t,s,h,m,y)=>{const v=c.transform,E=hl(t,v);return{u_matrix:jo(c,t,s,m),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:y,u_image:0,u_scale:[E,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function hl(c,t){return 1/ir(c,1,t.tileZoom)}function jo(c,t,s,h){return c.translatePosMatrix(h||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function Sc(c){const t=c.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const ph=(c,t,s,h,m,y)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:s,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ic(m.paint.get("raster-hue-rotate")),u_perspective_transform:y};var v,E};function Ic(c){c*=Math.PI/180;const t=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const ao=o.create(),Cc=(c,t,s,h,m,y,v,E,C,k,P,F,G,X)=>{const q=m.transform,N={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:q.width/q.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:v,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+h,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ao,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ao};return q.projection.name==="globe"&&(N.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],N.u_zoom_transition=F,N.u_inv_rot_matrix=X,N.u_merc_center=G,N.u_camera_forward=q._camera.forward(),N.u_ecef_origin=o.globeECEFOrigin(q.globeMatrix,P.toUnwrapped()),N.u_tile_matrix=Float32Array.from(q.globeMatrix)),N},No=(c,t,s,h,m,y,v,E,C,k,P,F,G,X,q)=>{const{cameraToCenterDistance:N,_pitch:re}=m.transform;return o.extend(Cc(c,t,s,h,m,y,v,E,C,k,F,G,X,q),{u_gamma_scale:h?N*Math.cos(m.terrain?0:re):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+P})},fs=(c,t,s,h,m,y,v,E,C,k,P,F,G,X)=>o.extend(No(c,t,s,h,m,y,v,E,!0,C,!0,P,F,G,X),{u_texsize_icon:k,u_texture_icon:1}),fh=(c,t,s)=>({u_matrix:c,u_opacity:t,u_color:s}),Mc=(c,t,s,h,m,y)=>o.extend(function(v,E,C,k){const P=C.imageManager.getPattern(v.from.toString()),F=C.imageManager.getPattern(v.to.toString()),{width:G,height:X}=C.imageManager.getPixelSize(),q=Math.pow(2,k.tileID.overscaledZ),N=k.tileSize*Math.pow(2,C.transform.tileZoom)/q,re=N*(k.tileID.canonical.x+k.tileID.wrap*q),Y=N*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[G,X],u_mix:E.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/ir(k,1,C.transform.tileZoom),u_pixel_coord_upper:[re>>16,Y>>16],u_pixel_coord_lower:[65535&re,65535&Y]}}(h,y,s,m),{u_matrix:c,u_opacity:t}),Ai={fillExtrusion:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_lightpos:new o.Uniform3f(c,t.u_lightpos),u_lightintensity:new o.Uniform1f(c,t.u_lightintensity),u_lightcolor:new o.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,t.u_vertical_gradient),u_opacity:new o.Uniform1f(c,t.u_opacity),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_up_dir:new o.Uniform3f(c,t.u_up_dir),u_height_lift:new o.Uniform1f(c,t.u_height_lift)}),fillExtrusionPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_lightpos:new o.Uniform3f(c,t.u_lightpos),u_lightintensity:new o.Uniform1f(c,t.u_lightintensity),u_lightcolor:new o.Uniform3f(c,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(c,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(c,t.u_height_factor),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_up_dir:new o.Uniform3f(c,t.u_up_dir),u_height_lift:new o.Uniform1f(c,t.u_height_lift),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade),u_opacity:new o.Uniform1f(c,t.u_opacity)}),fill:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),fillPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),fillOutline:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world)}),fillOutlinePattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_world:new o.Uniform2f(c,t.u_world),u_image:new o.Uniform1i(c,t.u_image),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade)}),circle:(c,t)=>({u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(c,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_up_dir:new o.Uniform3f(c,t.u_up_dir)}),collisionBox:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(c,t.u_extrude_scale)}),collisionCircle:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(c,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(c,t.u_viewport_size)}),debug:(c,t)=>({u_color:new o.UniformColor(c,t.u_color),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_overlay:new o.Uniform1i(c,t.u_overlay),u_overlay_scale:new o.Uniform1f(c,t.u_overlay_scale)}),clippingMask:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix)}),heatmap:(c,t)=>({u_extrude_scale:new o.Uniform1f(c,t.u_extrude_scale),u_intensity:new o.Uniform1f(c,t.u_intensity),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_up_dir:new o.Uniform3f(c,t.u_up_dir)}),heatmapTexture:(c,t)=>({u_image:new o.Uniform1i(c,t.u_image),u_color_ramp:new o.Uniform1i(c,t.u_color_ramp),u_opacity:new o.Uniform1f(c,t.u_opacity)}),hillshade:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_latrange:new o.Uniform2f(c,t.u_latrange),u_light:new o.Uniform2f(c,t.u_light),u_shadow:new o.UniformColor(c,t.u_shadow),u_highlight:new o.UniformColor(c,t.u_highlight),u_accent:new o.UniformColor(c,t.u_accent)}),hillshadePrepare:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_image:new o.Uniform1i(c,t.u_image),u_dimension:new o.Uniform2f(c,t.u_dimension),u_zoom:new o.Uniform1f(c,t.u_zoom),u_unpack:new o.Uniform4f(c,t.u_unpack)}),line:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(c,t.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_dash_image:new o.Uniform1i(c,t.u_dash_image),u_gradient_image:new o.Uniform1i(c,t.u_gradient_image),u_image_height:new o.Uniform1f(c,t.u_image_height),u_texsize:new o.Uniform2f(c,t.u_texsize),u_scale:new o.Uniform3f(c,t.u_scale),u_mix:new o.Uniform1f(c,t.u_mix),u_alpha_discard_threshold:new o.Uniform1f(c,t.u_alpha_discard_threshold)}),linePattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_texsize:new o.Uniform2f(c,t.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(c,t.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_image:new o.Uniform1i(c,t.u_image),u_units_to_pixels:new o.Uniform2f(c,t.u_units_to_pixels),u_scale:new o.Uniform3f(c,t.u_scale),u_fade:new o.Uniform1f(c,t.u_fade),u_alpha_discard_threshold:new o.Uniform1f(c,t.u_alpha_discard_threshold)}),raster:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_tl_parent:new o.Uniform2f(c,t.u_tl_parent),u_scale_parent:new o.Uniform1f(c,t.u_scale_parent),u_fade_t:new o.Uniform1f(c,t.u_fade_t),u_opacity:new o.Uniform1f(c,t.u_opacity),u_image0:new o.Uniform1i(c,t.u_image0),u_image1:new o.Uniform1i(c,t.u_image1),u_brightness_low:new o.Uniform1f(c,t.u_brightness_low),u_brightness_high:new o.Uniform1f(c,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(c,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(c,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(c,t.u_spin_weights),u_perspective_transform:new o.Uniform2f(c,t.u_perspective_transform)}),symbolIcon:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_camera_forward:new o.Uniform3f(c,t.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(c,t.u_tile_matrix),u_ecef_origin:new o.Uniform3f(c,t.u_ecef_origin),u_texture:new o.Uniform1i(c,t.u_texture)}),symbolSDF:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texture:new o.Uniform1i(c,t.u_texture),u_gamma_scale:new o.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(c,t.u_tile_id),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(c,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_camera_forward:new o.Uniform3f(c,t.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(c,t.u_tile_matrix),u_ecef_origin:new o.Uniform3f(c,t.u_ecef_origin),u_is_halo:new o.Uniform1i(c,t.u_is_halo)}),symbolTextAndIcon:(c,t)=>({u_is_size_zoom_constant:new o.Uniform1i(c,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(c,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(c,t.u_size_t),u_size:new o.Uniform1f(c,t.u_size),u_camera_to_center_distance:new o.Uniform1f(c,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(c,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(c,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(c,t.u_fade_change),u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(c,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(c,t.u_coord_matrix),u_is_text:new o.Uniform1i(c,t.u_is_text),u_pitch_with_map:new o.Uniform1i(c,t.u_pitch_with_map),u_texsize:new o.Uniform2f(c,t.u_texsize),u_texsize_icon:new o.Uniform2f(c,t.u_texsize_icon),u_texture:new o.Uniform1i(c,t.u_texture),u_texture_icon:new o.Uniform1i(c,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(c,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(c,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(c,t.u_is_halo)}),background:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_opacity:new o.Uniform1f(c,t.u_opacity),u_color:new o.UniformColor(c,t.u_color)}),backgroundPattern:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_opacity:new o.Uniform1f(c,t.u_opacity),u_image:new o.Uniform1i(c,t.u_image),u_pattern_tl_a:new o.Uniform2f(c,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(c,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(c,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(c,t.u_pattern_br_b),u_texsize:new o.Uniform2f(c,t.u_texsize),u_mix:new o.Uniform1f(c,t.u_mix),u_pattern_size_a:new o.Uniform2f(c,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(c,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(c,t.u_scale_a),u_scale_b:new o.Uniform1f(c,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(c,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(c,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(c,t.u_tile_units_to_pixels)}),terrainRaster:vc,terrainDepth:vc,skybox:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_sun_direction:new o.Uniform3f(c,t.u_sun_direction),u_cubemap:new o.Uniform1i(c,t.u_cubemap),u_opacity:new o.Uniform1f(c,t.u_opacity),u_temporal_offset:new o.Uniform1f(c,t.u_temporal_offset)}),skyboxGradient:(c,t)=>({u_matrix:new o.UniformMatrix4f(c,t.u_matrix),u_color_ramp:new o.Uniform1i(c,t.u_color_ramp),u_center_direction:new o.Uniform3f(c,t.u_center_direction),u_radius:new o.Uniform1f(c,t.u_radius),u_opacity:new o.Uniform1f(c,t.u_opacity),u_temporal_offset:new o.Uniform1f(c,t.u_temporal_offset)}),skyboxCapture:(c,t)=>({u_matrix_3f:new o.UniformMatrix3f(c,t.u_matrix_3f),u_sun_direction:new o.Uniform3f(c,t.u_sun_direction),u_sun_intensity:new o.Uniform1f(c,t.u_sun_intensity),u_color_tint_r:new o.Uniform4f(c,t.u_color_tint_r),u_color_tint_m:new o.Uniform4f(c,t.u_color_tint_m),u_luminance:new o.Uniform1f(c,t.u_luminance)}),globeRaster:(c,t)=>({u_proj_matrix:new o.UniformMatrix4f(c,t.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(c,t.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(c,t.u_merc_matrix),u_zoom_transition:new o.Uniform1f(c,t.u_zoom_transition),u_merc_center:new o.Uniform2f(c,t.u_merc_center),u_image0:new o.Uniform1i(c,t.u_image0),u_grid_matrix:new o.UniformMatrix3f(c,t.u_grid_matrix)}),globeAtmosphere:(c,t)=>({u_frustum_tl:new o.Uniform3f(c,t.u_frustum_tl),u_frustum_tr:new o.Uniform3f(c,t.u_frustum_tr),u_frustum_br:new o.Uniform3f(c,t.u_frustum_br),u_frustum_bl:new o.Uniform3f(c,t.u_frustum_bl),u_globe_pos:new o.Uniform3f(c,t.u_globe_pos),u_globe_radius:new o.Uniform1f(c,t.u_globe_radius),u_opacity:new o.Uniform1f(c,t.u_opacity),u_fadeout_range:new o.Uniform1f(c,t.u_fadeout_range),u_start_color:new o.Uniform3f(c,t.u_start_color),u_end_color:new o.Uniform3f(c,t.u_end_color)})};let $o;function mh(c,t,s,h,m,y,v){const E=c.context,C=E.gl,k=c.useProgram("collisionBox"),P=[];let F=0,G=0;for(let ie=0;ie<h.length;ie++){const oe=h[ie],ee=t.getTile(oe),le=ee.getBucket(s);if(!le)continue;let xe=oe.projMatrix;m[0]===0&&m[1]===0||(xe=c.translatePosMatrix(oe.projMatrix,ee,m,y));const Se=v?le.textCollisionBox:le.iconCollisionBox,ze=le.collisionCircleArray;if(ze.length>0){const Me=o.create(),Ze=xe;o.mul(Me,le.placementInvProjMatrix,c.transform.glCoordMatrix),o.mul(Me,Me,le.placementViewportMatrix),P.push({circleArray:ze,circleOffset:G,transform:Ze,invTransform:Me}),F+=ze.length/4,G=F}Se&&(c.terrain&&c.terrain.setupElevationDraw(ee,k),k.draw(E,C.LINES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,Tp(xe,c.transform,ee),s.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,c.transform.zoom,null,Se.collisionVertexBuffer,Se.collisionVertexBufferExt))}if(!v||!P.length)return;const X=c.useProgram("collisionCircle"),q=new o.StructArrayLayout2f1f2i16;q.resize(4*F),q._trim();let N=0;for(const ie of P)for(let oe=0;oe<ie.circleArray.length/4;oe++){const ee=4*oe,le=ie.circleArray[ee+0],xe=ie.circleArray[ee+1],Se=ie.circleArray[ee+2],ze=ie.circleArray[ee+3];q.emplace(N++,le,xe,Se,ze,0),q.emplace(N++,le,xe,Se,ze,1),q.emplace(N++,le,xe,Se,ze,2),q.emplace(N++,le,xe,Se,ze,3)}(!$o||$o.length<2*F)&&($o=function(ie){const oe=2*ie,ee=new o.StructArrayLayout3ui6;ee.resize(oe),ee._trim();for(let le=0;le<oe;le++){const xe=6*le;ee.uint16[xe+0]=4*le+0,ee.uint16[xe+1]=4*le+1,ee.uint16[xe+2]=4*le+2,ee.uint16[xe+3]=4*le+2,ee.uint16[xe+4]=4*le+3,ee.uint16[xe+5]=4*le+0}return ee}(F));const re=E.createIndexBuffer($o,!0),Y=E.createVertexBuffer(q,o.collisionCircleLayout.members,!0);for(const ie of P){const oe={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(te=c.transform).cameraToCenterDistance,u_viewport_size:[te.width,te.height]};X.draw(E,C.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,oe,s.id,Y,re,o.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,c.transform.zoom,null,null,null)}var te;Y.destroy(),re.destroy()}const kc=o.create();function la(c,t,s,h,m,y){const{horizontalAlign:v,verticalAlign:E}=o.getAnchorAlignment(c),C=-(v-.5)*t,k=-(E-.5)*s,P=o.evaluateVariableOffset(c,h);return new o.pointGeometry((C/m+P[0])*y,(k/m+P[1])*y)}function Mp(c,t,s,h,m,y,v,E,C,k,P,F){const G=c.text.placedSymbolArray,X=c.text.dynamicLayoutVertexArray,q=c.icon.dynamicLayoutVertexArray,N={},re=E.projMatrix,Y=y.elevation,te=F.upVectorScale(E.canonical,y.center.lat,y.worldSize);X.clear();for(let ie=0;ie<G.length;ie++){const oe=G.get(ie),ee=c.allowVerticalPlacement&&!oe.placedOrientation,le=oe.hidden||!oe.crossTileID||ee?null:h[oe.crossTileID];if(le){const xe=new o.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),Se=F.upVector(E.canonical,xe.x,xe.y),ze=Y?Y.getAtTileOffset(E,xe.x,xe.y):0,Me=Kr([oe.projectedAnchorX+ze*Se[0]*te.metersToTile,oe.projectedAnchorY+ze*Se[1]*te.metersToTile,oe.projectedAnchorZ+ze*Se[2]*te.metersToTile],s?re:v),Ze=Ri(y.cameraToCenterDistance,Me.signedDistanceFromCamera);let ve=m.evaluateSizeForFeature(c.textSizeData,k,oe)*Ze/o.ONE_EM;s&&(ve*=c.tilePixelRatio/C);const{width:qe,height:$e,anchor:dt,textOffset:Pe,textScale:lt}=le,Et=la(dt,qe,$e,Pe,lt,ve),ct=s?Cr(xe.add(Et),v,ze*te.metersToLabelSpace).point:Me.point.add(t?Et.rotate(-y.angle):Et),ut=c.allowVerticalPlacement&&oe.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let kt=0;kt<oe.numGlyphs;kt++)o.addDynamicAttributes(X,ct,ut);P&&oe.associatedIconIndex>=0&&(N[oe.associatedIconIndex]={shiftedAnchor:ct,angle:ut})}else rr(oe.numGlyphs,X)}if(P){q.clear();const ie=c.icon.placedSymbolArray;for(let oe=0;oe<ie.length;oe++){const ee=ie.get(oe);if(ee.hidden)rr(ee.numGlyphs,q);else{const le=N[oe];if(le)for(let xe=0;xe<ee.numGlyphs;xe++)o.addDynamicAttributes(q,le.shiftedAnchor,le.angle);else rr(ee.numGlyphs,q)}}c.icon.dynamicLayoutVertexBuffer.updateData(q)}c.text.dynamicLayoutVertexBuffer.updateData(X)}function kp(c,t,s){return s.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function zc(c,t,s,h,m,y,v,E,C,k,P,F){const G=c.context,X=G.gl,q=c.transform,N=E==="map",re=C==="map",Y=N&&s.layout.get("symbol-placement")!=="point",te=N&&!re&&!Y,ie=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let oe=!1;const ee=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),le=[o.mercatorXfromLng(q.center.lng),o.mercatorYfromLat(q.center.lat)],xe=s.layout.get("text-variable-anchor"),Se=q.projection.name==="globe",ze=Se?o.globeToMercatorTransition(q.zoom):0,Me=[],Ze=[];c.terrain&&re&&Ze.push("PITCH_WITH_MAP_TERRAIN"),Se&&Ze.push("PROJECTION_GLOBE_VIEW");for(const ve of h){const qe=t.getTile(ve),$e=qe.getBucket(s);if(!$e||$e.projection!==q.projection.name)continue;const dt=m?$e.text:$e.icon;if(!dt||$e.fullyClipped||!dt.segments.get().length)continue;const Pe=dt.programConfigurations.get(s.id),lt=m||$e.sdfIcons,Et=m?$e.textSizeData:$e.iconSizeData,ct=re||q.pitch!==0,ut=o.evaluateSizeForZoom(Et,q.zoom);let kt,qt,vt,Ut,oi=[0,0],Fi=null;if(m){if(qt=qe.glyphAtlasTexture,vt=X.LINEAR,kt=qe.glyphAtlasTexture.size,$e.iconsInText){oi=qe.imageAtlasTexture.size,Fi=qe.imageAtlasTexture;const Wr=Et.kind==="composite"||Et.kind==="camera";Ut=ct||c.options.rotating||c.options.zooming||Wr?X.LINEAR:X.NEAREST}}else{const Wr=s.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;qt=qe.imageAtlasTexture,vt=lt||c.options.rotating||c.options.zooming||Wr||ct?X.LINEAR:X.NEAREST,kt=qe.imageAtlasTexture.size}const Ar=c.transform.calculatePixelsToTileUnitsMatrix(qe),br=Oo(ve.projMatrix,qe.tileID.canonical,re,N,c.transform,Ar),Zr=c.terrain&&re&&Y?o.invert(o.create(),br):kc,wn=as(ve.projMatrix,qe.tileID.canonical,re,N,c.transform,Ar),Hn=xe&&$e.hasTextData(),fo=s.layout.get("icon-text-fit")!=="none"&&Hn&&$e.hasIconData();if(Y){const Wr=q.elevation,Zo=Wr?Wr.getAtTileOffsetFunc(ve,q.center.lat,q.worldSize,q.projection):Zh=>[0,0,0];Ks($e,ve.projMatrix,c,m,br,wn,re,k,Zo,ve)}const Qn=Y||m&&xe||fo,$i=c.translatePosMatrix(ve.projMatrix,qe,y,v),qi=Qn?kc:br,_i=c.translatePosMatrix(wn,qe,y,v,!0),Ji=q.projection.createInversionMatrix(q,ve.canonical),qr=Qn?Ze.concat(["PROJECTED_POS_ON_VIEWPORT"]):Ze,Oi=lt&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let tn;tn=lt?$e.iconsInText?fs(Et.kind,ut,te,re,c,$i,qi,_i,kt,oi,ve,ze,le,Ji):No(Et.kind,ut,te,re,c,$i,qi,_i,m,kt,!0,ve,ze,le,Ji):Cc(Et.kind,ut,te,re,c,$i,qi,_i,m,kt,ve,ze,le,Ji);const Ea={program:c.useProgram(kp(lt,m,$e),Pe,qr),buffers:dt,uniformValues:tn,atlasTexture:qt,atlasTextureIcon:Fi,atlasInterpolation:vt,atlasInterpolationIcon:Ut,isSDF:lt,hasHalo:Oi,tile:qe,labelPlaneMatrixInv:Zr};if(ie&&$e.canOverlap){oe=!0;const Wr=dt.segments.get();for(const Zo of Wr)Me.push({segments:new o.SegmentVector([Zo]),sortKey:Zo.sortKey,state:Ea})}else Me.push({segments:dt.segments,sortKey:0,state:Ea})}oe&&Me.sort((ve,qe)=>ve.sortKey-qe.sortKey);for(const ve of Me){const qe=ve.state;if(c.terrain&&c.terrain.setupElevationDraw(qe.tile,qe.program,{useDepthForOcclusion:!Se,labelPlaneMatrixInv:qe.labelPlaneMatrixInv}),G.activeTexture.set(X.TEXTURE0),qe.atlasTexture.bind(qe.atlasInterpolation,X.CLAMP_TO_EDGE),qe.atlasTextureIcon&&(G.activeTexture.set(X.TEXTURE1),qe.atlasTextureIcon&&qe.atlasTextureIcon.bind(qe.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),qe.isSDF){const $e=qe.uniformValues;qe.hasHalo&&($e.u_is_halo=1,_h(qe.buffers,ve.segments,s,c,qe.program,ee,P,F,$e)),$e.u_is_halo=0}_h(qe.buffers,ve.segments,s,c,qe.program,ee,P,F,qe.uniformValues)}}function _h(c,t,s,h,m,y,v,E,C){const k=h.context;m.draw(k,k.gl.TRIANGLES,y,v,E,o.CullFaceMode.disabled,C,s.id,c.layoutVertexBuffer,c.indexBuffer,t,s.paint,h.transform.zoom,c.programConfigurations.get(s.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function dl(c,t,s,h,m,y,v){const E=c.context.gl,C=s.paint.get("fill-pattern"),k=C&&C.constantOr(1),P=s.getCrossfadeParameters();let F,G,X,q,N;v?(G=k&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=E.LINES):(G=k?"fillPattern":"fill",F=E.TRIANGLES);for(const re of h){const Y=t.getTile(re);if(k&&!Y.patternsLoaded())continue;const te=Y.getBucket(s);if(!te)continue;c.prepareDrawTile();const ie=te.programConfigurations.get(s.id),oe=c.useProgram(G,ie);k&&(c.context.activeTexture.set(E.TEXTURE0),Y.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ie.updatePaintBuffers(P));const ee=C.constantOr(null);if(ee&&Y.imageAtlas){const xe=Y.imageAtlas,Se=xe.patternPositions[ee.to.toString()],ze=xe.patternPositions[ee.from.toString()];Se&&ze&&ie.setConstantPatternPositions(Se,ze)}const le=c.translatePosMatrix(re.projMatrix,Y,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){q=te.indexBuffer2,N=te.segments2;const xe=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];X=G==="fillOutlinePattern"&&k?uh(le,c,P,Y,xe):ul(le,xe)}else q=te.indexBuffer,N=te.segments,X=k?cl(le,c,P,Y):ll(le);c.prepareDrawProgram(c.context,oe,re.toUnwrapped()),oe.draw(c.context,F,m,c.stencilModeForClipping(re),y,o.CullFaceMode.disabled,X,s.id,te.layoutVertexBuffer,q,N,s.paint,c.transform.zoom,ie)}}function ms(c,t,s,h,m,y,v){const E=c.context,C=E.gl,k=c.transform,P=s.paint.get("fill-extrusion-pattern"),F=P.constantOr(1),G=s.getCrossfadeParameters(),X=s.paint.get("fill-extrusion-opacity"),q=function(ie){if(ie.projection.name!=="globe")return 0;const oe=Math.PI/32,ee=Math.tan(oe),le=o.earthRadius;return le*Math.sqrt(1+2*ee*ee)-le}(k),N=k.projection.name==="globe",re=N?o.globeToMercatorTransition(k.zoom):0,Y=[o.mercatorXfromLng(k.center.lng),o.mercatorYfromLat(k.center.lat)],te=[];N&&te.push("PROJECTION_GLOBE_VIEW");for(const ie of h){const oe=t.getTile(ie),ee=oe.getBucket(s);if(!ee||ee.projection!==k.projection.name)continue;const le=ee.programConfigurations.get(s.id),xe=c.useProgram(F?"fillExtrusionPattern":"fillExtrusion",le,te);if(c.terrain){const qe=c.terrain;if(c.style.terrainSetForDrapingOnly())qe.setupElevationDraw(oe,xe,{useMeterToDem:!0});else{if(!ee.enableTerrain)continue;if(qe.setupElevationDraw(oe,xe,{useMeterToDem:!0}),ca(E,t,ie,ee,s,qe),!ee.centroidVertexBuffer){const $e=xe.attributes.a_centroid_pos;$e!==void 0&&C.vertexAttrib2f($e,0,0)}}}F&&(c.context.activeTexture.set(C.TEXTURE0),oe.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),le.updatePaintBuffers(G));const Se=P.constantOr(null);if(Se&&oe.imageAtlas){const qe=oe.imageAtlas,$e=qe.patternPositions[Se.to.toString()],dt=qe.patternPositions[Se.from.toString()];$e&&dt&&le.setConstantPatternPositions($e,dt)}const ze=c.translatePosMatrix(ie.projMatrix,oe,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Me=k.projection.createInversionMatrix(k,ie.canonical),Ze=s.paint.get("fill-extrusion-vertical-gradient"),ve=F?al(ze,c,Ze,X,ie,G,oe,q,re,Y,Me):sl(ze,c,Ze,X,ie,q,re,Y,Me);c.prepareDrawProgram(E,xe,ie.toUnwrapped()),xe.draw(E,E.gl.TRIANGLES,m,y,v,o.CullFaceMode.backCCW,ve,s.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,s.paint,c.transform.zoom,le,c.terrain?ee.centroidVertexBuffer:null,N?ee.layoutVertexExtBuffer:null)}}function ca(c,t,s,h,m,y){const v=[Y=>{let te=Y.canonical.x-1,ie=Y.wrap;return te<0&&(te=(1<<Y.canonical.z)-1,ie--),new o.OverscaledTileID(Y.overscaledZ,ie,Y.canonical.z,te,Y.canonical.y)},Y=>{let te=Y.canonical.x+1,ie=Y.wrap;return te===1<<Y.canonical.z&&(te=0,ie++),new o.OverscaledTileID(Y.overscaledZ,ie,Y.canonical.z,te,Y.canonical.y)},Y=>new o.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(Y.canonical.y===0?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new o.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],E=Y=>{const te=t.getSource().minzoom,ie=ee=>{const le=t.getTileByID(ee);if(le&&le.hasData())return le.getBucket(m)},oe=[0,-1,1];for(const ee of oe){if(Y.overscaledZ+ee<te)continue;const le=ie(Y.calculateScaledKey(Y.overscaledZ+ee));if(le)return le}},C=[0,0,0],k=(Y,te)=>(C[0]=Math.min(Y.min.y,te.min.y),C[1]=Math.max(Y.max.y,te.max.y),C[2]=o.EXTENT-te.min.x>Y.max.x?te.min.x-o.EXTENT:Y.max.x,C),P=(Y,te)=>(C[0]=Math.min(Y.min.x,te.min.x),C[1]=Math.max(Y.max.x,te.max.x),C[2]=o.EXTENT-te.min.y>Y.max.y?te.min.y-o.EXTENT:Y.max.y,C),F=[(Y,te)=>k(Y,te),(Y,te)=>k(te,Y),(Y,te)=>P(Y,te),(Y,te)=>P(te,Y)],G=new o.pointGeometry(0,0);let X,q,N;const re=(Y,te,ie,oe,ee)=>{const le=[[oe?ie:Y,oe?Y:ie,0],[oe?ie:te,oe?te:ie,0]],xe=ee<0?o.EXTENT+ee:ee,Se=[oe?xe:(Y+te)/2,oe?(Y+te)/2:xe,0];return ie===0&&ee<0||ie!==0&&ee>0?y.getForTilePoints(N,[Se],!0,q):le.push(Se),y.getForTilePoints(s,le,!0,X),Math.max(le[0][2],le[1][2],Se[2])/y.exaggeration()};for(let Y=0;Y<4;Y++){const te=(Y<2?1:5)-Y,ie=h.borders[Y];if(ie.length===0)continue;const oe=N=v[Y](s),ee=E(oe);if(!(ee&&ee instanceof o.FillExtrusionBucket&&ee.enableTerrain)||h.borderDoneWithNeighborZ[Y]===ee.canonical.z&&ee.borderDoneWithNeighborZ[te]===h.canonical.z||(q=y.findDEMTileFor(oe),!q||!q.dem))continue;if(!X){const ze=y.findDEMTileFor(s);if(!ze||!ze.dem)return;X=ze}const le=ee.borders[te];let xe=0;const Se=ee.borderDoneWithNeighborZ[te]!==h.canonical.z;if(h.canonical.z===ee.canonical.z){for(let ze=0;ze<ie.length;ze++){const Me=h.featuresOnBorder[ie[ze]],Ze=Me.borders[Y];let ve;for(;xe<le.length&&(ve=ee.featuresOnBorder[le[xe]],!(ve.borders[te][1]>Ze[0]+3));)Se&&ee.encodeCentroid(void 0,ve,!1),xe++;if(ve&&xe<le.length){const qe=xe;let $e=0;for(;!(ve.borders[te][0]>Ze[1]-3)&&($e++,++xe!==le.length);)ve=ee.featuresOnBorder[le[xe]];if(ve=ee.featuresOnBorder[le[qe]],Me.intersectsCount()>1||ve.intersectsCount()>1||$e!==1){$e!==1&&(xe=qe),h.encodeCentroid(void 0,Me,!1),Se&&ee.encodeCentroid(void 0,ve,!1);continue}const dt=F[Y](Me,ve),Pe=Y%2?o.EXTENT-1:0;G.x=re(dt[0],Math.min(o.EXTENT-1,dt[1]),Pe,Y<2,dt[2]),G.y=0,h.encodeCentroid(G,Me,!1),Se&&ee.encodeCentroid(G,ve,!1)}else h.encodeCentroid(void 0,Me,!1)}h.borderDoneWithNeighborZ[Y]=ee.canonical.z,h.needsCentroidUpdate=!0,Se&&(ee.borderDoneWithNeighborZ[te]=h.canonical.z,ee.needsCentroidUpdate=!0)}else{for(const ze of ie)h.encodeCentroid(void 0,h.featuresOnBorder[ze],!1);if(Se){for(const ze of le)ee.encodeCentroid(void 0,ee.featuresOnBorder[ze],!1);ee.borderDoneWithNeighborZ[te]=h.canonical.z,ee.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[Y]=ee.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(c)}const Pc=new o.Color(1,0,0,1),Dc=new o.Color(0,1,0,1),gh=new o.Color(0,0,1,1),pl=new o.Color(1,0,1,1),fl=new o.Color(0,1,1,1);function rt(c,t,s,h){ua(c,0,t+s/2,c.transform.width,s,h)}function Jr(c,t,s,h){ua(c,t-s/2,0,s,c.transform.height,h)}function ua(c,t,s,h,m,y){const v=c.context,E=v.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,h*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),v.clear({color:y}),E.disable(E.SCISSOR_TEST)}function yh(c,t,s){const h=c.context,m=h.gl,y=c.transform.projection.name==="globe",v=s.projMatrix,E=c.useProgram("debug",null,y?["PROJECTION_GLOBE_VIEW"]:null),C=t.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(C,E);const k=o.DepthMode.disabled,P=o.StencilMode.disabled,F=c.colorModeForRenderPass(),G="$debug";h.activeTexture.set(m.TEXTURE0),c.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),y?C._makeGlobeTileDebugBuffers(c.context,c.transform.projection):C._makeDebugTileBoundsBuffers(c.context,c.transform.projection);const X=C._tileDebugBuffer||c.debugBuffer,q=C._tileDebugIndexBuffer||c.debugIndexBuffer,N=C._tileDebugSegments||c.debugSegments;E.draw(h,m.LINE_STRIP,k,P,F,o.CullFaceMode.disabled,dh(v,o.Color.red),G,X,q,N,null,null,null,C._globeTileDebugBorderBuffer);const re=C.latestRawTileData,Y=Math.floor((re&&re.byteLength||0)/1024),te=t.getTile(s).tileSize,ie=512/Math.min(te,512)*(s.overscaledZ/c.transform.zoom)*.5;let oe=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(oe+=` => ${s.overscaledZ}`),function(Se,ze){Se.initDebugOverlayCanvas();const Me=Se.debugOverlayCanvas,Ze=Se.context.gl,ve=Se.debugOverlayCanvas.getContext("2d");ve.clearRect(0,0,Me.width,Me.height),ve.shadowColor="white",ve.shadowBlur=2,ve.lineWidth=1.5,ve.strokeStyle="white",ve.textBaseline="top",ve.font="bold 36px Open Sans, sans-serif",ve.fillText(ze,5,5),ve.strokeText(ze,5,5),Se.debugOverlayTexture.update(Me),Se.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(c,`${oe} ${Y}kb`);const ee=C._tileDebugTextBuffer||c.debugBuffer,le=C._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,xe=C._tileDebugTextSegments||c.debugSegments;E.draw(h,m.TRIANGLES,k,P,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,dh(v,o.Color.transparent,ie),G,ee,le,xe,null,null,null,C._globeTileDebugTextBuffer)}const xh=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:_s}=xh;function qn(c,t,s,h){c.emplaceBack(t,s,h)}class ha{constructor(t){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,qn(this.vertexArray,-1,-1,1),qn(this.vertexArray,1,-1,1),qn(this.vertexArray,-1,1,1),qn(this.vertexArray,1,1,1),qn(this.vertexArray,-1,-1,-1),qn(this.vertexArray,1,-1,-1),qn(this.vertexArray,-1,1,-1),qn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,_s),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function lo(c,t,s,h,m,y){const v=c.gl,E=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),k=t.paint.get("sky-atmosphere-sun-intensity"),P=((F,G,X,q,N)=>({u_matrix_3f:F,u_sun_direction:G,u_sun_intensity:X,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[N.r,N.g,N.b,N.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),h),m,k,E,C);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),s.draw(c,v.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}function co(c,t){return o.transformMat4(c,c,t)}const Bc={symbol:function(c,t,s,h,m){if(c.renderPass!=="translucent")return;const y=o.StencilMode.disabled,v=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(E,C,k,P,F,G,X){const q=C.transform,N=F==="map",re=G==="map";for(const Y of E){const te=P.getTile(Y),ie=te.getBucket(k);if(!ie||ie.projection!==q.projection.name||!ie.text||!ie.text.segments.get().length)continue;const oe=o.evaluateSizeForZoom(ie.textSizeData,q.zoom),ee=C.transform.calculatePixelsToTileUnitsMatrix(te),le=Oo(Y.projMatrix,te.tileID.canonical,re,N,C.transform,ee),xe=k.layout.get("icon-text-fit")!=="none"&&ie.hasIconData();if(oe){const Se=Math.pow(2,q.zoom-te.tileID.overscaledZ);Mp(ie,N,re,X,o.symbolSize,q,le,Y,Se,oe,xe,q.projection)}}}(h,c,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&zc(c,t,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),y,v),s.paint.get("text-opacity").constantOr(1)!==0&&zc(c,t,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),y,v),t.map.showCollisionBoxes&&(mh(c,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),mh(c,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),y=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),E=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(y.constantOr(1)===0||v.constantOr(1)===0))return;const C=c.context,k=C.gl,P=c.transform,F=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),G=o.StencilMode.disabled,X=c.colorModeForRenderPass(),q=P.projection.name==="globe",N=[o.mercatorXfromLng(P.center.lng),o.mercatorYfromLat(P.center.lat)],re=[];for(let te=0;te<h.length;te++){const ie=h[te],oe=t.getTile(ie),ee=oe.getBucket(s);if(!ee)continue;const le=ee.programConfigurations.get(s.id),xe=Ep(s);q&&xe.push("PROJECTION_GLOBE_VIEW");const Se=c.useProgram("circle",le,xe),ze=ee.layoutVertexBuffer,Me=ee.globeExtVertexBuffer,Ze=ee.indexBuffer,ve=P.projection.createInversionMatrix(P,ie.canonical),qe={programConfiguration:le,program:Se,layoutVertexBuffer:ze,globeExtVertexBuffer:Me,indexBuffer:Ze,uniformValues:ps(c,ie,oe,ve,N,s),tile:oe};if(E){const $e=ee.segments.get();for(const dt of $e)re.push({segments:new o.SegmentVector([dt]),sortKey:dt.sortKey,state:qe})}else re.push({segments:ee.segments,sortKey:0,state:qe})}E&&re.sort((te,ie)=>te.sortKey-ie.sortKey);const Y={useDepthForOcclusion:!q};for(const te of re){const{programConfiguration:ie,program:oe,layoutVertexBuffer:ee,globeExtVertexBuffer:le,indexBuffer:xe,uniformValues:Se,tile:ze}=te.state,Me=te.segments;c.terrain&&c.terrain.setupElevationDraw(ze,oe,Y),c.prepareDrawProgram(C,oe,ze.tileID.toUnwrapped()),oe.draw(C,k.TRIANGLES,F,G,X,o.CullFaceMode.disabled,Se,s.id,ee,xe,Me,s.paint,P.zoom,ie,q?le:null)}},heatmap:function(c,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const m=c.context,y=m.gl,v=o.StencilMode.disabled,E=new o.ColorMode([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(G,X,q){const N=G.gl;G.activeTexture.set(N.TEXTURE1),G.viewport.set([0,0,X.width/4,X.height/4]);let re=q.heatmapFbo;if(re)N.bindTexture(N.TEXTURE_2D,re.colorAttachment.get()),G.bindFramebuffer.set(re.framebuffer);else{const Y=N.createTexture();N.bindTexture(N.TEXTURE_2D,Y),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),re=q.heatmapFbo=G.createFramebuffer(X.width/4,X.height/4,!1),function(te,ie,oe,ee){const le=te.gl;le.texImage2D(le.TEXTURE_2D,0,le.RGBA,ie.width/4,ie.height/4,0,le.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:le.UNSIGNED_BYTE,null),ee.colorAttachment.set(oe)}(G,X,Y,re)}})(m,c,s),m.clear({color:o.Color.transparent});const C=c.transform,k=C.projection.name==="globe",P=k?["PROJECTION_GLOBE_VIEW"]:null,F=[o.mercatorXfromLng(C.center.lng),o.mercatorYfromLat(C.center.lat)];for(let G=0;G<h.length;G++){const X=h[G];if(t.hasRenderableParent(X))continue;const q=t.getTile(X),N=q.getBucket(s);if(!N)continue;const re=N.programConfigurations.get(s.id),Y=c.useProgram("heatmap",re,P),{zoom:te}=c.transform;c.terrain&&c.terrain.setupElevationDraw(q,Y),c.prepareDrawProgram(m,Y,X.toUnwrapped());const ie=C.projection.createInversionMatrix(C,X.canonical);Y.draw(m,y.TRIANGLES,o.DepthMode.disabled,v,E,o.CullFaceMode.disabled,Ip(c,X,q,ie,F,te,s.paint.get("heatmap-intensity")),s.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,s.paint,c.transform.zoom,re,k?N.globeExtVertexBuffer:null)}m.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(m,y){const v=m.context,E=v.gl,C=y.heatmapFbo;if(!C)return;v.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),v.activeTexture.set(E.TEXTURE1);let k=y.colorRampTexture;k||(k=y.colorRampTexture=new o.Texture(v,y.colorRamp,E.RGBA)),k.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(v,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((P,F,G,X)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(c,s))},line:function(c,t,s,h){if(c.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),y=s.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const v=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=c.colorModeForRenderPass(),C=c.terrain&&c.terrain.renderingToTexture?1:o.exported.devicePixelRatio,k=s.paint.get("line-dasharray"),P=k.constantOr(1),F=s.layout.get("line-cap"),G=s.paint.get("line-pattern"),X=G.constantOr(1),q=s.paint.get("line-gradient"),N=s.getCrossfadeParameters(),re=X?"linePattern":"line",Y=c.context,te=Y.gl,ie=(ee=>{const le=[];Sc(ee)&&le.push("RENDER_LINE_DASH"),ee.paint.get("line-gradient")&&le.push("RENDER_LINE_GRADIENT");const xe=ee.paint.get("line-pattern").constantOr(1),Se=ee.paint.get("line-opacity").constantOr(1)!==1;return!xe&&Se&&le.push("RENDER_LINE_ALPHA_DISCARD"),le})(s);let oe=ie.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(oe=!1);for(const ee of h){const le=t.getTile(ee);if(X&&!le.patternsLoaded())continue;const xe=le.getBucket(s);if(!xe)continue;c.prepareDrawTile();const Se=xe.programConfigurations.get(s.id),ze=c.useProgram(re,Se,ie),Me=G.constantOr(null);if(Me&&le.imageAtlas){const Pe=le.imageAtlas,lt=Pe.patternPositions[Me.to.toString()],Et=Pe.patternPositions[Me.from.toString()];lt&&Et&&Se.setConstantPatternPositions(lt,Et)}const Ze=k.constantOr(null),ve=F.constantOr(null);if(!X&&Ze&&ve&&le.lineAtlas){const Pe=le.lineAtlas,lt=Pe.getDash(Ze.to,ve),Et=Pe.getDash(Ze.from,ve);lt&&Et&&Se.setConstantPatternPositions(lt,Et)}const qe=c.terrain?ee.projMatrix:null,$e=X?Tc(c,le,s,N,qe,C):Cp(c,le,s,N,qe,xe.lineClipsArray.length,C);if(q){const Pe=xe.gradients[s.id];let lt=Pe.texture;if(s.gradientVersion!==Pe.version){let Et=256;if(s.stepInterpolant){const ct=t.getSource().maxzoom,ut=ee.canonical.z===ct?Math.ceil(1<<c.transform.maxZoom-ee.canonical.z):1;Et=o.clamp(o.nextPowerOfTwo(xe.maxLineLength/o.EXTENT*1024*ut),256,Y.maxTextureSize)}Pe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Et,image:Pe.gradient||void 0,clips:xe.lineClipsArray}),Pe.texture?Pe.texture.update(Pe.gradient):Pe.texture=new o.Texture(Y,Pe.gradient,te.RGBA),Pe.version=s.gradientVersion,lt=Pe.texture}Y.activeTexture.set(te.TEXTURE1),lt.bind(s.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}P&&(Y.activeTexture.set(te.TEXTURE0),le.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),Se.updatePaintBuffers(N)),X&&(Y.activeTexture.set(te.TEXTURE0),le.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Se.updatePaintBuffers(N)),c.prepareDrawProgram(Y,ze,ee.toUnwrapped());const dt=Pe=>{ze.draw(Y,te.TRIANGLES,v,Pe,E,o.CullFaceMode.disabled,$e,s.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,s.paint,c.transform.zoom,Se,xe.layoutVertexBuffer2)};if(oe){const Pe=c.stencilModeForClipping(ee).ref;Pe===0&&c.terrain&&Y.clear({stencil:0});const lt={func:te.EQUAL,mask:255};$e.u_alpha_discard_threshold=.8,dt(new o.StencilMode(lt,Pe,255,te.KEEP,te.KEEP,te.INVERT)),$e.u_alpha_discard_threshold=0,dt(new o.StencilMode(lt,Pe,255,te.KEEP,te.KEEP,te.KEEP))}else dt(c.stencilModeForClipping(ee))}oe&&(c.resetStencilClippingMasks(),c.terrain&&Y.clear({stencil:0}))},fill:function(c,t,s,h){const m=s.paint.get("fill-color"),y=s.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const v=c.colorModeForRenderPass(),E=s.paint.get("fill-pattern"),C=c.opaquePassEnabledForLayer()&&!E.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===C){const k=c.depthModeForSublayer(1,c.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);dl(c,t,s,h,k,v,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const k=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);dl(c,t,s,h,k,v,!0)}},"fill-extrusion":function(c,t,s,h){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&c.renderPass==="translucent"){const y=new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))ms(c,t,s,h,y,o.StencilMode.disabled,o.ColorMode.disabled),ms(c,t,s,h,y,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const v=c.colorModeForRenderPass();ms(c,t,s,h,y,o.StencilMode.disabled,v)}}},hillshade:function(c,t,s,h){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const m=c.context,y=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),v=c.colorModeForRenderPass(),E=c.terrain&&c.terrain.renderingToTexture,[C,k]=c.renderPass!=="translucent"||E?[{},h]:c.stencilConfigForOverlap(h);for(const P of k){const F=t.getTile(P);if(F.needsHillshadePrepare&&c.renderPass==="offscreen")xc(c,F,s,y,o.StencilMode.disabled,v);else if(c.renderPass==="translucent"){const G=E&&c.terrain?c.terrain.stencilModeForRTTOverlap(P):C[P.overscaledZ];ah(c,P,F,s,y,G,v)}}m.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,s,h,m,y){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const v=c.context,E=v.gl,C=t.getSource(),k=c.useProgram("raster"),P=c.colorModeForRenderPass(),F=c.terrain&&c.terrain.renderingToTexture,[G,X]=C instanceof ue||F?[{},h]:c.stencilConfigForOverlap(h),q=X[X.length-1].overscaledZ,N=!c.options.moving;for(const re of X){const Y=F?o.DepthMode.disabled:c.depthModeForSublayer(re.overscaledZ-q,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),te=re.toUnwrapped(),ie=t.getTile(re);if(F&&(!ie||!ie.hasData()))continue;const oe=F?re.projMatrix:c.transform.calculateProjMatrix(te,N),ee=c.terrain&&F?c.terrain.stencilModeForRTTOverlap(re):G[re.overscaledZ],le=y?0:s.paint.get("raster-fade-duration");ie.registerFadeDuration(le);const xe=t.findLoadedParent(re,0),Se=bc(ie,xe,t,c.transform,le);let ze,Me;c.terrain&&c.terrain.prepareDrawTile();const Ze=s.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;v.activeTexture.set(E.TEXTURE0),ie.texture.bind(Ze,E.CLAMP_TO_EDGE),v.activeTexture.set(E.TEXTURE1),xe?(xe.texture.bind(Ze,E.CLAMP_TO_EDGE),ze=Math.pow(2,xe.tileID.overscaledZ-ie.tileID.overscaledZ),Me=[ie.tileID.canonical.x*ze%1,ie.tileID.canonical.y*ze%1]):ie.texture.bind(Ze,E.CLAMP_TO_EDGE);const ve=ph(oe,Me||[0,0],ze||1,Se,s,C instanceof ue?C.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(v,k,te),C instanceof ue)C.boundsBuffer&&C.boundsSegments&&k.draw(v,E.TRIANGLES,Y,o.StencilMode.disabled,P,o.CullFaceMode.disabled,ve,s.id,C.boundsBuffer,c.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:$e,tileBoundsSegments:dt}=c.getTileBoundsBuffers(ie);k.draw(v,E.TRIANGLES,Y,ee,P,o.CullFaceMode.disabled,ve,s.id,qe,$e,dt)}}c.resetStencilClippingMasks()},background:function(c,t,s,h){const m=s.paint.get("background-color"),y=s.paint.get("background-opacity");if(y===0)return;const v=c.context,E=v.gl,C=c.transform,k=C.tileSize,P=s.paint.get("background-pattern");if(c.isPatternMissing(P))return;const F=!P&&m.a===1&&y===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==F)return;const G=o.StencilMode.disabled,X=c.depthModeForSublayer(0,F==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),q=c.colorModeForRenderPass(),N=c.useProgram(P?"backgroundPattern":"background");let re,Y=h;Y||(re=c.getBackgroundTiles(),Y=Object.values(re).map(ie=>ie.tileID)),P&&(v.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context));const te=s.getCrossfadeParameters();for(const ie of Y){const oe=ie.toUnwrapped(),ee=h?ie.projMatrix:c.transform.calculateProjMatrix(oe);c.prepareDrawTile();const le=t?t.getTile(ie):re?re[ie.key]:new o.Tile(ie,k,C.zoom,c),xe=P?Mc(ee,y,c,P,{tileID:ie,tileSize:k},te):fh(ee,y,m);c.prepareDrawProgram(v,N,oe);const{tileBoundsBuffer:Se,tileBoundsIndexBuffer:ze,tileBoundsSegments:Me}=c.getTileBoundsBuffers(le);N.draw(v,E.TRIANGLES,X,G,q,o.CullFaceMode.disabled,xe,s.id,Se,ze,Me)}},sky:function(c,t,s){const h=c.transform,m=h.projection.name==="mercator"||h.projection.name==="globe"?1:o.smoothstep(7,8,h.zoom),y=s.paint.get("sky-opacity")*m;if(y===0)return;const v=c.context,E=s.paint.get("sky-type"),C=new o.DepthMode(v.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),k=c.frameCounter/1e3%1;E==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(P,F,G,X){const q=P.context,N=q.gl;let re=F.skyboxFbo;if(!re){re=F.skyboxFbo=q.createFramebuffer(32,32,!1),F.skyboxGeometry=new ha(q),F.skyboxTexture=q.gl.createTexture(),N.bindTexture(N.TEXTURE_CUBE_MAP,F.skyboxTexture),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_CUBE_MAP,N.TEXTURE_MAG_FILTER,N.LINEAR);for(let oe=0;oe<6;++oe)N.texImage2D(N.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,N.RGBA,32,32,0,N.RGBA,N.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(re.framebuffer),q.viewport.set([0,0,32,32]);const Y=F.getCenter(P,!0),te=P.useProgram("skyboxCapture"),ie=new Float64Array(16);o.identity(ie),o.rotateY(ie,ie,.5*-Math.PI),lo(q,F,te,ie,Y,0),o.identity(ie),o.rotateY(ie,ie,.5*Math.PI),lo(q,F,te,ie,Y,1),o.identity(ie),o.rotateX(ie,ie,.5*-Math.PI),lo(q,F,te,ie,Y,2),o.identity(ie),o.rotateX(ie,ie,.5*Math.PI),lo(q,F,te,ie,Y,3),o.identity(ie),lo(q,F,te,ie,Y,4),o.identity(ie),o.rotateY(ie,ie,Math.PI),lo(q,F,te,ie,Y,5),q.viewport.set([0,0,P.width,P.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(P,F,G,X,q){const N=P.context,re=N.gl,Y=P.transform,te=P.useProgram("skybox");N.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,F.skyboxTexture);const ie=((oe,ee,le,xe,Se)=>({u_matrix:oe,u_sun_direction:ee,u_cubemap:0,u_opacity:xe,u_temporal_offset:Se}))(Y.skyboxMatrix,F.getCenter(P,!1),0,X,q);P.prepareDrawProgram(N,te),te.draw(N,re.TRIANGLES,G,o.StencilMode.disabled,P.colorModeForRenderPass(),o.CullFaceMode.backCW,ie,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(c,s,C,y,k):E==="gradient"&&c.renderPass==="sky"&&function(P,F,G,X,q){const N=P.context,re=N.gl,Y=P.transform,te=P.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new ha(N)),N.activeTexture.set(re.TEXTURE0);let ie=F.colorRampTexture;ie||(ie=F.colorRampTexture=new o.Texture(N,F.colorRamp,re.RGBA)),ie.bind(re.LINEAR,re.CLAMP_TO_EDGE);const oe=((ee,le,xe,Se,ze)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:le,u_radius:o.degToRad(xe),u_opacity:Se,u_temporal_offset:ze}))(Y.skyboxMatrix,F.getCenter(P,!1),F.paint.get("sky-gradient-radius"),X,q);P.prepareDrawProgram(N,te),te.draw(N,re.TRIANGLES,G,o.StencilMode.disabled,P.colorModeForRenderPass(),o.CullFaceMode.backCW,oe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(c,s,C,y,k)},debug:function(c,t,s){for(let h=0;h<s.length;h++)yh(c,t,s[h])},custom:function(c,t,s){const h=c.context,m=s.implementation;if(c.transform.projection.unsupportedLayers&&c.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(c.renderPass==="offscreen"){const y=m.prerender;y&&(c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),y.call(m,h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),h.setColorMode(c.colorModeForRenderPass()),h.setStencilMode(o.StencilMode.disabled);const y=m.renderingMode==="3d"?new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,o.DepthMode.ReadOnly);h.setDepthMode(y),m.render(h.gl,c.transform.customLayerMatrix()),h.setDirty(),c.setBaseState(),h.bindFramebuffer.set(null)}}};class vh{constructor(t,s){this.context=new R(t),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new el,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nr(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s)}_updateFog(t){const s=t.fog;if(!s||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const y=h+.78*(m-h);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,s){if(this.width=t*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const t=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const h=new o.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(o.EXTENT,0),h.emplaceBack(0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(h,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(o.EXTENT,0,o.EXTENT,0),y.emplaceBack(0,o.EXTENT,0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(y,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const v=new o.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const E=new o.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])E.emplaceBack(k);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new o.Texture(t,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=o.create();const C=this.context.gl;this.stencilClearMode=new o.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(t,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,nl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;const m=[];let y=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const P of h)if(this._tileClippingMaskIDs.has(P.key)||(y=!0),this._skippedStencilTileIDs.has(P.key)){if(!s.getTile(P).getBucket(t))continue;this._skippedStencilTileIDs.delete(P.key),m.push(P)}if(!y&&m.length===0)return}const v=this.context,E=v.gl;v.setColorMode(o.ColorMode.disabled),v.setDepthMode(o.DepthMode.disabled);const C=this.useProgram("clippingMask"),k=P=>{const F=s.getTile(P),{tileBoundsBuffer:G,tileBoundsIndexBuffer:X,tileBoundsSegments:q}=this.getTileBoundsBuffers(F);C.draw(v,E.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:E.GREATER,mask:255},this._tileClippingMaskIDs.get(P.key)||0,255,E.KEEP,E.KEEP,E.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,nl(P.projMatrix),"$clipping",G,X,q)};if(!y&&m.length>0)for(const P of m)k(P);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+h.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const P of h)this._tileClippingMaskIDs.set(P.key,this.nextStencilID++),s.getTile(P).getBucket(t)?k(P):this._skippedStencilTileIDs.add(P.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=s.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs.get(t.key)||0,0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((v,E)=>E.overscaledZ-v.overscaledZ),m=h[h.length-1].overscaledZ,y=h[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const v={};for(let E=0;E<y;E++)v[E+m]=new o.StencilMode({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[v,h]}return[{[m]:o.StencilMode.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(t,s,h){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new o.DepthMode(h||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const k in m){const P=m[k];P.used&&P.prepare(this.context)}const y={},v={},E={};for(const k in m){const P=m[k];y[k]=P.getVisibleCoordinates(),v[k]=y[k].slice().reverse(),E[k]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<h.length;k++)if(this.style._layers[h[k]].is3D()){this.opaquePassCutoff=k;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const k of h){const P=this.style._layers[k],F=t._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const G=F?v[F.id]:void 0;(P.type==="custom"||P.isSky()||G&&G.length)&&this.renderLayer(this,F,P,G)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let C=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(C=this.style.fog.properties.get("color")),this.context.clear({color:s.showOverdrawInspector?o.Color.black:C,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[h[this.currentLayer]],P=t._getLayerSourceCache(k);if(k.isSky())continue;const F=P?v[P.id]:void 0;this._renderTileClippingMasks(k,P,F),this.renderLayer(this,P,k,F)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const k=this.style._layers[h[this.currentLayer]],P=t._getLayerSourceCache(k);k.isSky()&&this.renderLayer(this,P,k,P?v[P.id]:void 0)}for(this.transform.projection.name==="globe"&&function(k){const P=k.context,F=P.gl,G=k.transform,X=new o.DepthMode(F.LEQUAL,o.DepthMode.ReadOnly,[0,1]),q=k.useProgram("globeAtmosphere"),N=G.centerOffset,re=G._camera.getCameraToClipPerspective(G._fov,G.width/G.height,G._nearZ,G._farZ);re[8]=2*-N.x/G.width,re[9]=2*N.y/G.height;const Y=o.invert([],re),te=o.mul([],Y,G.projMatrix),ie={u_frustum_tl:co([-1,1,1],Y),u_frustum_tr:co([1,1,1],Y),u_frustum_br:co([1,-1,1],Y),u_frustum_bl:co([-1,-1,1],Y),u_globe_pos:co([G.globeMatrix[12],G.globeMatrix[13],G.globeMatrix[14]],te),u_globe_radius:G.worldSize/2/Math.PI-1,u_opacity:1-o.globeToMercatorTransition(G.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};k.prepareDrawProgram(P,q);const oe=k.globeSharedBuffers;oe&&q.draw(P,F.TRIANGLES,X,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,ie,"skybox",oe.atmosphereVertexBuffer,oe.atmosphereIndexBuffer,oe.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const k=this.style._layers[h[this.currentLayer]],P=t._getLayerSourceCache(k);if(k.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(k)){if(k.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const F=P?(k.type==="symbol"?E:v)[P.id]:void 0;this._renderTileClippingMasks(k,P,P?y[P.id]:void 0),this.renderLayer(this,P,k,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let k=null;o.values(this.style._layers).forEach(P=>{const F=t._getLayerSourceCache(P);F&&!P.isHidden(this.transform.zoom)&&(!k||k.getSource().maxzoom<F.getSource().maxzoom)&&(k=F)}),k&&this.options.showTileBoundaries&&Bc.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const P=k.transform.padding;rt(k,k.transform.height-(P.top||0),3,Pc),rt(k,P.bottom||0,3,Dc),Jr(k,P.left||0,3,gh),Jr(k,k.transform.width-(P.right||0),3,pl);const F=k.transform.centerPoint;(function(G,X,q,N){ua(G,X-1,q-10,2,20,N),ua(G,X-10,q-1,20,2,N)})(k,F.x,k.transform.height-F.y,fl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)||Bc[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[t.id];h||(h=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],y=this.context.extTimerQuery,v=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),s[h]=v}return s}translatePosMatrix(t,s,h,m,y){if(!h[0]&&!h[1])return t;const v=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(v){const k=Math.sin(v),P=Math.cos(v);h=[h[0]*P-h[1]*k,h[0]*k+h[1]*P]}const E=[y?h[0]:ir(s,h[0],this.transform.zoom),y?h[1]:ir(s,h[1],this.transform.zoom),0],C=new Float32Array(16);return o.translate(C,t,E),C}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!s||!h}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),s&&!t&&s.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),t&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(t,s,h){this.cache=this.cache||{};const m=h||[],y=this.currentGlobalDefines().concat(m),v=sa.cacheKey(t,y,s);return this.cache[v]||(this.cache[v]=new sa(this.context,t,ra[t],s,Ai[t],y)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const y=m.getOpacity(this.transform.pitch);y!==0&&s.setFogUniformValues(t,((v,E,C,k)=>{const P=E.properties.get("color"),F=v.frameCounter/1e3%1,G=[P.r/P.a,P.g/P.a,P.b/P.a,k];return{u_fog_matrix:C?v.transform.calculateFogTileMatrix(C):v.identityMat,u_fog_range:E.getFovAdjustedRange(v.transform._fov),u_fog_color:G,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:F}})(this,m,h,y))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=t[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class uo{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=o.number(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.number(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=o.number(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=o.number(t.right,s.right,h)),this}getCenter(t,s){const h=o.clamp((this.left+t-this.right)/2,0,t),m=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new uo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ah(c,t){const s=o.getColumn(c,3);o.fromQuat(c,t),o.setColumn(c,3,s)}function Lc(c,t){const s=o.identity$1([]);return o.rotateZ$1(s,s,-t),o.rotateX$1(s,s,-c),s}function ml(c,t){const s=[c[0],c[1],0],h=[t[0],t[1],0];if(o.length(s)>=1e-15){const v=o.normalize([],s);o.scale$2(h,v,o.dot(h,v)),t[0]=h[0],t[1]=h[1]}const m=o.cross([],t,c);if(o.len(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return Lc(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),y)}class da{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof o.MercatorCoordinate?t:new o.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(t)):0,m=this.position,y=o.MercatorCoordinate.fromLngLat(t,h),v=[y.x-m.x,y.y-m.y,y.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=ml(v,s)}setPitchBearing(t,s){this.orientation=Lc(o.degToRad(t),o.degToRad(-s))}}class pa{constructor(t,s){this._transform=o.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new o.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=o.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&o.setColumn(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.identity$1([]),t&&Ah(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Lc(t,s),Ah(this._transform,this._orientation)}forward(){const t=o.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return o.invert(h,this.getWorldToCamera(t,s)),h}getWorldToCameraPosition(t,s,h){const m=this.position;o.scale$2(m,m,-t);const y=new Float64Array(16);return o.fromScaling(y,[h,h,h]),o.translate(y,y,m),y[10]*=s,y}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),y=this.position;return o.conjugate(m,this._orientation),o.scale$2(y,y,-t),o.fromQuat(h,m),o.translate(h,h,y),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const y=new Float64Array(16);return o.perspective(y,t,s,h,m),y}getDistanceToElevation(t){const s=t===0?0:o.mercatorZfromAltitude(t,this.position[1]),h=this.forward();return(s-this.position[2])/h[2]}clone(){return new pa([...this.position],[...this.orientation])}}function Rc(c,t){const s=fa(c),h=function(y,v,E,C,k){const P=new o.LngLat(E.lng-180*ho,E.lat),F=new o.LngLat(E.lng+180*ho,E.lat),G=y.project(P.lng,P.lat),X=y.project(F.lng,F.lat),q=-Math.atan2(X.y-G.y,X.x-G.x),N=o.MercatorCoordinate.fromLngLat(E);N.y=o.clamp(N.y,-.999975,.999975);const re=N.toLngLat(),Y=y.project(re.lng,re.lat),te=o.MercatorCoordinate.fromLngLat(re);te.x+=ho;const ie=te.toLngLat(),oe=y.project(ie.lng,ie.lat),ee=Uc(oe.x-Y.x,oe.y-Y.y,q),le=o.MercatorCoordinate.fromLngLat(re);le.y+=ho;const xe=le.toLngLat(),Se=y.project(xe.lng,xe.lat),ze=Uc(Se.x-Y.x,Se.y-Y.y,q),Me=Math.abs(ee.x)/Math.abs(ze.y),Ze=o.identity([]);o.rotateZ(Ze,Ze,-q*(1-(k?0:C)));const ve=o.identity([]);return o.scale(ve,ve,[1,1-(1-Me)*C,1]),ve[4]=-ze.x/ze.y*C,o.rotateZ(ve,ve,q),o.multiply$1(ve,Ze,ve),ve}(c.projection,0,c.center,s,t),m=Fc(c);return o.scale(h,h,[m,m,1]),h}function Fc(c){const t=c.projection,s=fa(c),h=Oc(t,c.center),m=Oc(t,o.LngLat.convert(t.center));return Math.pow(2,h*s+(1-s)*m)}function fa(c){const t=c.projection.range;if(!t)return 0;const s=Math.max(c.width,c.height),h=Math.log(s/1024)/Math.LN2;return o.smoothstep(t[0]+h,t[1]+h,c.zoom)}const ho=1/4e4;function Oc(c,t){const s=o.clamp(t.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=new o.LngLat(t.lng-180*ho,s),m=new o.LngLat(t.lng+180*ho,s),y=c.project(h.lng,s),v=c.project(m.lng,s),E=o.MercatorCoordinate.fromLngLat(h),C=o.MercatorCoordinate.fromLngLat(m),k=v.x-y.x,P=v.y-y.y,F=C.x-E.x,G=C.y-E.y,X=Math.sqrt((F*F+G*G)/(k*k+P*P));return Math.log(X)/Math.LN2}function Uc(c,t,s){const h=Math.cos(s),m=Math.sin(s);return{x:c*h-t*m,y:c*m+t*h}}class _l{constructor(t,s,h,m,y,v,E){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h==null?0:h,this._maxPitch=m==null?60:m,this.setProjection(v),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new uo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new pa,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const t=new _l(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||s)&&this._updateCameraOnTerrain(),(t||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(t){t==null&&(t={name:"mercator"}),this.projectionOptions=t;const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(t);const h=this.getProjection();return B(s,h)?null:(this._calcMatrices(),h)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,y,v){var E=y[0],C=y[1],k=y[2],P=y[3],F=Math.sin(v),G=Math.cos(v);m[0]=E*G+k*F,m[1]=C*G+P*F,m[2]=E*-F+k*G,m[3]=C*-F+P*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,y=0;for(let v=0;v<s.length;v++){const E=new o.pointGeometry(s[v][0]*this.width,h+s[v][1]*(this.height-h)),C=t.pointCoordinate(E);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);m+=C[3]*k,y+=k}return y===0?NaN:m/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),v=Math.max(m-h,y);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=o.length(o.sub([],this._camera.position,h));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!o.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];o.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new da;return s.position=new o.MercatorCoordinate(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!o.length$1(t))return!1;o.normalize$1(t,t);const s=o.transformQuat([],[0,0,-1],t),h=o.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const m=ml(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=o.clamp(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new o.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),v=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(h.x,m.x,y.x,v.x)),C=Math.floor(Math.max(h.x,m.x,y.x,v.x)),k=1;for(let P=E-k;P<=C+k;P++)P!==0&&s.push(new o.UnwrappedTileID(P,t))}return s}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const v=this.locationCoordinate(this.center),E=this.center.lat,C=1<<s,k=[C*v.x,C*v.y,0],P=this.projection.name==="globe",F=!P,G=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,F),X=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=C*o.mercatorZfromAltitude(1,this.center.lat),N=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),re=[C*X.x,C*X.y,N*(F?1:q)],Y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),te=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,ie=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,oe=t.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=this.projection.isReprojectedInTileSpace?Fc(this):1,le=Pe=>{const Et=new o.MercatorCoordinate(Pe.x+25e-6,Pe.y,Pe.z),ct=new o.MercatorCoordinate(Pe.x,Pe.y+25e-6,Pe.z),ut=Pe.toLngLat(),kt=Et.toLngLat(),qt=ct.toLngLat(),vt=this.locationCoordinate(ut),Ut=this.locationCoordinate(kt),oi=this.locationCoordinate(qt),Fi=Math.hypot(Ut.x-vt.x,Ut.y-vt.y),Ar=Math.hypot(oi.x-vt.x,oi.y-vt.y);return Math.sqrt(Fi*Ar)*ee/25e-6},xe=Pe=>{const lt=ie,Et=oe;return{aabb:o.tileAABB(this,C,0,0,0,Pe,Et,lt,this.projection),zoom:0,x:0,y:0,minZ:Et,maxZ:lt,wrap:Pe,fullyVisible:!1}},Se=[];let ze=[];const Me=s,Ze=t.reparseOverscaled?h:s,ve=Pe=>Pe*Pe,qe=ve((N-this._centerAltitude)*q),$e=Pe=>{if(!this._elevation||!Pe.tileID||!y)return;const lt=this._elevation.getMinMaxForTile(Pe.tileID),Et=Pe.aabb;lt?(Et.min[2]=lt.min,Et.max[2]=lt.max,Et.center[2]=(Et.min[2]+Et.max[2])/2):(Pe.shouldSplit=dt(Pe),Pe.shouldSplit||(Et.min[2]=Et.max[2]=Et.center[2]=this._centerAltitude))},dt=Pe=>{if(Pe.zoom<te)return!0;if(Pe.zoom===Me)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const lt=Pe.aabb.distanceX(re),Et=Pe.aabb.distanceY(re);let ct=qe,ut=1;if(P){ct=ve(Pe.aabb.distanceZ(re));const qt=Math.pow(2,Pe.zoom),vt=o.latFromMercatorY((Pe.y+1)/qt),Ut=o.latFromMercatorY(Pe.y/qt),oi=Math.min(Math.max(E,vt),Ut),Fi=o.circumferenceAtLatitude(oi)/o.circumferenceAtLatitude(E);ut=Math.min(Fi,1)}else if(m&&(ct=ve(Pe.aabb.distanceZ(re)*q)),this.projection.isReprojectedInTileSpace&&h<=5){const qt=Math.pow(2,Pe.zoom),vt=le(new o.MercatorCoordinate((Pe.x+.5)/qt,(Pe.y+.5)/qt));ut=vt>.85?1:vt}const kt=lt*lt+Et*Et+ct;return kt<ve((1<<Me-Pe.zoom)*Y*ut*((qt,vt)=>{if(vt*ve(.707)<qt)return 1;const Ut=Math.sqrt(vt/qt);return Ut/(1.4144271570014144+(Math.pow(1.1,Ut-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ct,qe),kt))};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Se.push(xe(-Pe)),Se.push(xe(Pe));for(Se.push(xe(0));Se.length>0;){const Pe=Se.pop(),lt=Pe.x,Et=Pe.y;let ct=Pe.fullyVisible;if(!ct){const ut=Pe.aabb.intersects(G);if(ut===0)continue;ct=ut===2}if(Pe.zoom!==Me&&dt(Pe))for(let ut=0;ut<4;ut++){const kt=(lt<<1)+ut%2,qt=(Et<<1)+(ut>>1),vt={aabb:y?Pe.aabb.quadrant(ut):o.tileAABB(this,C,Pe.zoom+1,kt,qt,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:kt,y:qt,wrap:Pe.wrap,fullyVisible:ct,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};m&&!P&&(vt.tileID=new o.OverscaledTileID(Pe.zoom+1===Me?Ze:Pe.zoom+1,Pe.wrap,Pe.zoom+1,kt,qt),$e(vt)),Se.push(vt)}else{const ut=Pe.zoom===Me?Ze:Pe.zoom;if(t.minzoom&&t.minzoom>ut)continue;const kt=k[0]-(.5+lt+(Pe.wrap<<Pe.zoom))*(1<<s-Pe.zoom),qt=k[1]-.5-Et,vt=Pe.tileID?Pe.tileID:new o.OverscaledTileID(ut,Pe.wrap,Pe.zoom,lt,Et);ze.push({tileID:vt,distanceSq:kt*kt+qt*qt})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,lt=this.horizonLineFromTop();ze=ze.filter(Et=>{const ct=[0,0,0,1],ut=[o.EXTENT,o.EXTENT,0,1],kt=this.calculateFogTileMatrix(Et.tileID.toUnwrapped());o.transformMat4$1(ct,ct,kt),o.transformMat4$1(ut,ut,kt);const qt=o.getAABBPointSquareDist(ct,ut);if(qt===0)return!0;let vt=!1;const Ut=this._elevation;if(Ut&&qt>Pe&&lt!==0){const oi=this.calculateProjMatrix(Et.tileID.toUnwrapped());let Fi;t.isTerrainDEM||(Fi=Ut.getMinMaxForTile(Et.tileID)),Fi||(Fi={min:oe,max:ie});const Ar=o.furthestTileCorner(this.rotation),br=[Ar[0]*o.EXTENT,Ar[1]*o.EXTENT,Fi.max];o.transformMat4(br,br,oi),vt=(1-br[1])*this.height*.5<lt}return qt<Pe||vt})}return ze.sort((Pe,lt)=>Pe.distanceSq-lt.distanceSq).map(Pe=>Pe.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=o.clamp(t.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=this.projection.project(t.lng,s);return new o.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,s){let h,m;const y=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;h=(s.x-y.x)/E,m=(s.y-y.y)/E}else{const E=this.pointCoordinate(s),C=this.pointCoordinate(y);h=E.x-C.x,m=E.y-C.y}const v=this.locationCoordinate(t);this.setLocation(new o.MercatorCoordinate(v.x-h,v.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,s){const h=s?o.mercatorZfromAltitude(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new o.MercatorCoordinate(m.x,m.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s!=null?s:this._centerAltitude,m=[t.x,t.y,0,1],y=[t.x,t.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse);const v=y[3];o.scale$1(m,m,1/m[3]),o.scale$1(y,y,1/v);const E=m[2],C=y[2];return{p0:m,p1:y,t:E===C?0:(h-E)/(C-E)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(h,h,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(h,h,1/h[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=o.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(h,h,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,y=o.mercatorZfromAltitude(s[2],this._center.lat),v=o.mercatorZfromAltitude(h[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],h[0],m)/this.worldSize,o.number(s[1],h[1],m)/this.worldSize,o.number(y,v,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const s=this.elevation;let h=this.elevation.pointCoordinate(t);if(h)return new o.MercatorCoordinate(h[0],h[1],h[2]);let m=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t);const v=.02*y,E=t.clone();for(let C=0;C<10&&y-m>v;C++){E.y=o.number(m,y,.66);const k=s.pointCoordinate(E);k?(y=E.y,h=k):m=E.y}return h?new o.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const s=this.horizonLineFromTop();return t.y<s}}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,s){const h=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),v=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(h,t),C=this.pointCoordinate(m,t);const k=this.pointCoordinate(y,s),P=this.pointCoordinate(v,s),F=(G,X)=>(X.y-G.y)/(X.x-G.x);return E.y>1&&C.y>=0?E=new o.MercatorCoordinate((1-P.y)/F(P,E)+P.x,1):E.y<0&&C.y<=1&&(E=new o.MercatorCoordinate(-P.y/F(P,E)+P.x,0)),C.y>1&&E.y>=0?C=new o.MercatorCoordinate((1-k.y)/F(k,C)+k.x,1):C.y<0&&E.y<=1&&(C=new o.MercatorCoordinate(-k.y/F(k,C)+k.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(k))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const y=m.dem.tree;h.min=Math.min(h.min,y.minimums[0]),h.max=Math.max(h.max,y.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=t.canonical,y=1/this.height,v=this.cameraWorldSize/this.zoomScale(m.z),E=(m.x+Math.pow(2,m.z)*t.wrap)*v,C=m.y*v,k=this.point,P=this.angle,F=Math.sin(-P),G=-Math.cos(-P);return h[s]={bearing:[F,G],center:[(k.x-E)*y,(k.y-C)*y],scale:v/o.EXTENT*y},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.calculatePosMatrix(t,this.cameraWorldSize);return o.multiply$1(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1){const h=t.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const y=this.calculatePosMatrix(t,this.worldSize);return o.multiply$1(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,y),m[h]=new Float32Array(y),m[h]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=function(y,v){const{scale:E}=y.tileTransform,C=E*o.EXTENT/(y.tileSize*Math.pow(2,v.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return k=new Float32Array(4),G=(P=v.inverseAdjustmentMatrix)[1],X=P[2],q=P[3],re=(F=[C,C])[1],k[0]=P[0]*(N=F[0]),k[1]=G*N,k[2]=X*re,k[3]=q*re,k;var k,P,F,G,X,q,N,re}(t,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),y=o.mercatorZfromAltitude(1,this._center.lat);h[2]/=y,m[2]/=y,o.normalize(m,m);const v=t.raycast(h,m,t.exaggeration());if(v){const E=o.scaleAndAdd([],h,m,v),C=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),k=(C.z+o.length([C.x-h[0],C.y-h[1],C.z-h[2]*y]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=t.getAtPointOrZero(new o.MercatorCoordinate(...h)),y=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),v=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(v<y){const E=this.locationCoordinate(this._center,this._centerAltitude),C=[E.x-h[0],E.y-h[1],E.z-h[2]],k=o.length(C);C[2]-=(y-v)/this._projectionScaler;const P=o.length(C);if(P===0)return;o.scale$2(C,C,k/P*this._projectionScaler),this._camera.position=[E.x-C[0],E.y-C[1],E.z*this._projectionScaler-C[2]],this._camera.orientation=ml(C,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const F=this.center;return F.lat=o.clamp(F.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(F.lng=o.clamp(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const t=this._unmodified,{x:s,y:h}=this.point;let m=0,y=s,v=h;const E=this.width/2,C=this.height/2,k=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(h-C<k&&(v=k+C),h+C>P&&(v=P-C),P-k<this.height&&(m=Math.max(m,this.height/(P-k)),v=(P+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,X=this.worldSize/2-(F+G)/2;y=(s+X+this.worldSize)%this.worldSize-X,y-E<F&&(y=F+E),y+E>G&&(y=G-E),G-F<this.width&&(m=Math.max(m,this.width/(G-F)),y=(G+F)/2)}y===s&&v===h||(this.center=this.unproject(new o.pointGeometry(y,v))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this._fov/2,s=this.centerOffset,h=this.pixelsPerMeter;this._projectionScaler=h/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(t)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?h:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-s.x/this.width,y[9]=2*s.y/this.height;let v=o.mul([],y,m);if(this.projection.isReprojectedInTileSpace){const oe=this.locationCoordinate(this.center),ee=o.identity([]);o.translate(ee,ee,[oe.x*this.worldSize,oe.y*this.worldSize,0]),o.multiply$1(ee,ee,Rc(this)),o.translate(ee,ee,[-oe.x*this.worldSize,-oe.y*this.worldSize,0]),o.multiply$1(v,v,ee),this.inverseAdjustmentMatrix=function(le){const xe=Rc(le,!0);return Tt([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],v,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=v,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=new Float32Array(16);o.identity(E),o.scale(E,E,[1,-1,1]),o.rotateX(E,E,this._pitch),o.rotateZ(E,E,this.angle);const C=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;C[8]=2*-s.x/this.width,C[9]=2*(s.y+k)/this.height,this.skyboxMatrix=o.multiply$1(E,C,E);const P=this.point,F=P.x,G=P.y,X=this.width%2/2,q=this.height%2/2,N=Math.cos(this.angle),re=Math.sin(this.angle),Y=F-Math.round(F)+N*X+re*q,te=G-Math.round(G)+N*q+re*X,ie=new Float64Array(v);if(o.translate(ie,ie,[Y>.5?Y-1:Y,te>.5?te-1:te,0]),this.alignedProjMatrix=ie,v=o.create(),o.scale(v,v,[this.width/2,-this.height/2,1]),o.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=o.create(),o.scale(v,v,[1,-1,1]),o.translate(v,v,[-1,-1,0]),o.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},v=o.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this.globeMatrix=this.projection.name==="globe"?o.calculateGlobeMatrix(this):v,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height,y=[t,t,s];o.scale$2(y,y,m),o.scale$2(h,h,-1),o.multiply$2(h,h,y);const v=o.create();o.translate(v,v,h),o.scale(v,v,y),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*y,m.y/this.worldSize-h[1]*y,t/this.worldSize*this._centerAltitude-h[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=t[2];let m=1;h>0&&(m=Math.min((s-this._camera.position[2])/h,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),y=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((t[2]-y)/Math.cos(h),v),C=this._zoomFromMercatorZ(E);o.scaleAndAdd(t,t,s,E),this._pitch=o.clamp(h,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),y=Math.min(t.y,s.y),v=Math.max(t.y,s.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(h,y),new o.pointGeometry(m,v),new o.pointGeometry(h,v),new o.pointGeometry(m,y)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const P of E){const F=this.pointRayIntersection(P);if(F.t<0)return!0;const G=this.rayIntersectionCoordinate(F);if(G.x<C||G.y<0||G.x>k||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,s){const h=o.length(o.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,t))}}function Vc(c,t){let s=!1,h=null;const m=()=>{h=null,s&&(c(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class bh{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Vc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,o.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){const s=this._map;if(!s)return"";const h=s.getCenter(),m=Math.round(100*s.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),E=Math.round(h.lng*v)/v,C=Math.round(h.lat*v)/v,k=s.getBearing(),P=s.getPitch();let F="";if(F+=t?`/${E}/${C}/${m}`:`${m}/${C}/${E}`,(k||P)&&(F+="/"+Math.round(10*k)/10),P&&(F+=`/${Math.round(P)}`),this._hashName){const G=this._hashName;let X=!1;const q=o.window.location.hash.slice(1).split("&").map(N=>{const re=N.split("=")[0];return re===G?(X=!0,`${re}=${F}`):N}).filter(N=>N);return X||q.push(`${G}=${F}`),`#${q.join("&")}`}return`#${F}`}_getCurrentHash(){const t=o.window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,t)}}const Wn={linearity:.3,easing:o.bezier(0,0,.3,1)},wh=o.extend({deceleration:2500,maxSpeed:1400},Wn),Eh=o.extend({deceleration:20,maxSpeed:1400},Wn),Th=o.extend({deceleration:1e3,maxSpeed:360},Wn),Sh=o.extend({deceleration:1e3,maxSpeed:90},Wn);class Ih{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=o.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const y=lr(s.pan.mag(),h,o.extend({},wh,t||{}));m.offset=s.pan.mult(y.amount/s.pan.mag()),m.center=this._map.transform.center,ma(m,y)}if(s.zoom){const y=lr(s.zoom,h,Eh);m.zoom=this._map.transform.zoom+y.amount,ma(m,y)}if(s.bearing){const y=lr(s.bearing,h,Th);m.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),ma(m,y)}if(s.pitch){const y=lr(s.pitch,h,Sh);m.pitch=this._map.transform.pitch+y.amount,ma(m,y)}if(m.zoom||m.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function ma(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function lr(c,t,s){const{maxSpeed:h,linearity:m,deceleration:y}=s,v=o.clamp(c*m/(t/1e3),-h,h),E=Math.abs(v)/(y*m);return{easing:s.easing,duration:1e3*E,amount:v*(E/2)}}class $r extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const y=Rt(s.getCanvasContainer(),h),v=s.unproject(y);super(t,o.extend({point:y,lngLat:v,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class _a extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,y=Ke(s.getCanvasContainer(),m),v=y.map(C=>s.unproject(C)),E=y.reduce((C,k,P,F)=>C.add(k.div(F.length)),new o.pointGeometry(0,0));super(t,{points:y,point:E,lngLats:v,lngLat:s.unproject(E),originalEvent:h}),this._defaultPrevented=!1}}class zp extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}}class Pp{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new zp(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new $r(t.type,this._map,t))}mouseup(t){this._map.fire(new $r(t.type,this._map,t))}preclick(t){const s=o.extend({},t);s.type="preclick",this._map.fire(new $r(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new $r(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new $r(t.type,this._map,t))}mouseover(t){this._map.fire(new $r(t.type,this._map,t))}mouseout(t){this._map.fire(new $r(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _a(t.type,this._map,t))}touchmove(t){this._map.fire(new _a(t.type,this._map,t))}touchend(t){this._map.fire(new _a(t.type,this._map,t))}touchcancel(t){this._map.fire(new _a(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xn{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new $r(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new $r(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ch{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Fe(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(m.x,h.x),v=Math.max(m.x,h.x),E=Math.min(m.y,h.y),C=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=v-y+"px",this._box.style.height=C-E+"px")})}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const h=this._startPos,m=s;if(this.reset(),mt(),h.x!==m.x||h.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ft(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.Event(t,{originalEvent:s}))}}function po(c,t){const s={};for(let h=0;h<c.length;h++)s[c[h].identifier]=t[h];return s}class Bn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const y=new o.pointGeometry(0,0);for(const v of m)y._add(v);return y.div(m.length)}(s),this.touches=po(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=po(h,s);for(const y in this.touches){const v=this.touches[y],E=m[y];(!E||E.dist(v)>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class gs{constructor(t){this.singleTap=new Bn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const y=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(y&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class st{constructor(){this._zoomIn=new gs({numTouches:1,numTaps:2}),this._zoomOut=new gs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),y=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(m)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mh={0:1,2:2};class gl{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=We(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(m,y){const v=Mh[y];return m.buttons===void 0||(m.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&We(t)===this._eventButton&&(this._moved&&mt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ga extends gl{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class ys extends gl{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class jc extends gl{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class kh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=po(h,s),y=new o.pointGeometry(0,0),v=new o.pointGeometry(0,0);let E=0;for(const k in m){const P=m[k],F=this._touches[k];F&&(y._add(P),v._add(P.sub(F)),E++,m[k]=P)}if(this._touches=m,E<this._minTouches||!v.mag())return;const C=v.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class yl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[y,v]=m,E=ya(h,s,y),C=ya(h,s,v);if(!E||!C)return;const k=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],k,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,v=ya(h,s,m),E=ya(h,s,y);v&&E||(this._active&&mt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ya(c,t,s){for(let h=0;h<c.length;h++)if(c[h].identifier===s)return t[h]}function Nc(c,t){return Math.log(c/t)/Math.LN2}class zh extends yl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Nc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nc(this._distance,h),pinchAround:s}}}function $c(c,t){return 180*c.angleWith(t)/Math.PI}class xl extends yl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$c(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=$c(t,this._startVector);return Math.abs(h)<s}}function xa(c){return Math.abs(c.y)>Math.abs(c.x)}class vl extends yl{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,xa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=this._lastPoints;if(!m)return;const y=t[0].sub(m[0]),v=t[1].sub(m[1]);return this._map._cooperativeGestures&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(y,v,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,y=s.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return xa(t)&&xa(s)&&v}}const Ph={panStep:100,bearingStep:15,pitchStep:10};class Dh{constructor(){const t=Ph;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,y=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Bh,zoom:s?Math.round(C)+s*(t.shiftKey?2:1):C,bearing:E.getBearing()+h*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-v*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bh(c){return c*(2-c)}const Gc=4.000244140625;class Lh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=o.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Gc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Rt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>Gc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&k!==0&&(k=1/k);const P=s(),F=Math.pow(2,P),G=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(G*k))),this._type==="wheel"&&(this._startZoom=s(),this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,y=this._easing;let v,E=!1;if(this._type==="wheel"&&m&&y){const C=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),k=y(C);v=o.number(m,h,k),C<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.ease;if(this._prevEase){const h=this._prevEase,m=(o.exported.now()-h.start)/h.duration,y=h.easing(m+.01)-h.easing(m),v=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-v*v);s=o.bezier(v,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Rh{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zc{constructor(){this._tap=new gs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oh{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Uh{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Vh{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const va=c=>c.zoom||c.drag||c.pitch||c.rotate;class qc extends o.Event{}class jh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=o.sub([],s,t);this.radius=o.length(h[2]<0?o.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){o.div(t,t,this.constants),o.normalize(t,t),o.mul$1(t,t,this.constants);const s=o.scale$2([],t,this.radius);if(s[2]>0){const h=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),m=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),y=o.add([],s,o.scale$2([],o.sub([],o.add([],m,h),s),2));s[0]=y[0],s[1]=y[1]}return s}}function xs(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Nh{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ih(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,y,v]of this._listeners)m.addEventListener(y,m===o.window.document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,s,h]of this._listeners)t.removeEventListener(s,t===o.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Pp(s,t));const m=s.boxZoom=new Ch(s,t);this._add("boxZoom",m);const y=new st,v=new Fh;s.doubleClickZoom=new Rh(v,y),this._add("tapZoom",y),this._add("clickZoom",v);const E=new Zc;this._add("tapDragZoom",E);const C=s.touchPitch=new vl(s);this._add("touchPitch",C);const k=new ys(t),P=new jc(t);s.dragRotate=new Uh(t,k,P),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const F=new ga(t),G=new kh(s,t);s.dragPan=new Oh(h,F,G),this._add("mousePan",F),this._add("touchPan",G,["touchZoom","touchRotate"]);const X=new xl,q=new zh;s.touchZoomRotate=new Vh(h,q,X,E),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Xn(s));const N=s.scrollZoom=new Lh(s,this);this._add("scrollZoom",N,["mousePan"]);const re=s.keyboard=new Dh;this._add("keyboard",re);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Y]&&s[Y].enable(t[Y])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!va(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,y={needsRenderFrame:!1},v={},E={},C=t.touches?this._getMapTouches(t.touches):void 0,k=C?Ke(this._el,C):h?void 0:Rt(this._el,t);for(const{handlerName:G,handler:X,allowed:q}of this._handlers){if(!X.isEnabled())continue;let N;this._blockedByActive(E,q,G)?X.reset():X[s||t.type]&&(N=X[s||t.type](t,k,C),this.mergeHandlerResult(y,v,N,G,m),N&&N.needsRenderFrame&&this._triggerRenderFrame()),(N||X.isActive())&&(E[G]=X)}const P={};for(const G in this._previousActiveHandlers)E[G]||(P[G]=m);this._previousActiveHandlers=E,(Object.keys(P).length||xs(y))&&(this._changes.push([y,v,P]),this._triggerRenderFrame()),(Object.keys(E).length||xs(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=y;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,s,h,m,y){if(!h)return;o.extend(t,h);const v={handlerName:m,originalEvent:h.originalEvent||y};h.zoomDelta!==void 0&&(s.zoom=v),h.panDelta!==void 0&&(s.drag=v),h.pitchDelta!==void 0&&(s.pitch=v),h.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},h={};for(const[m,y,v]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),o.extend(s,y),o.extend(h,v);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,y=m.transform,v=te=>[te.x,te.y,te.z];if((te=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!xs(t)){const te=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",te!==y.zoom&&this._map._update(!0)}if(!xs(t))return void this._fireEvents(s,h,!0);let{panDelta:E,zoomDelta:C,bearingDelta:k,pitchDelta:P,around:F,aroundCoord:G,pinchAround:X}=t;X!==void 0&&(F=X),(te=>s.drag&&!this._eventsInProgress.drag)()&&F&&(this._dragOrigin=v(y.pointCoordinate3D(F)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),F=F||m.transform.centerPoint,k&&(y.bearing+=k),P&&(y.pitch+=P),y._updateCameraState();const q=[0,0,0];if(E){const te=y.pointCoordinate(F);if(y.projection.name==="globe"){const ie=o.latFromMercatorY(te.y),oe=y.center.lat,ee=Math.min(o.mercatorZfromAltitude(1,ie)/o.mercatorZfromAltitude(1,oe),2);E=E.rotate(-y.angle),q[0]=-E.x/y.worldSize*ee,q[1]=-E.y/y.worldSize*ee}else{const ie=y.pointCoordinate(F.sub(E));te&&ie&&(q[0]=ie.x-te.x,q[1]=ie.y-te.y)}}const N=y.zoom,re=[0,0,0];if(C){const te=v(G||y.pointCoordinate3D(F)),ie={dir:o.normalize([],o.sub([],te,y._camera.position))};if(ie.dir[2]<0){const oe=y.zoomDeltaToMovement(te,C);o.scale$2(re,ie.dir,oe)}}const Y=o.add(q,q,re);y._translateCameraConstrained(Y),C&&Math.abs(y.zoom-N)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=va(this._eventsInProgress),y=va(t),v={};for(const P in t){const{originalEvent:F}=t[P];this._eventsInProgress[P]||(v[`${P}start`]=F),this._eventsInProgress[P]=t[P]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const P in v)this._fireEvent(P,v[P]);y&&this._fireEvent("move",y.originalEvent);for(const P in t){const{originalEvent:F}=t[P];this._fireEvent(P,F)}const E={};let C;for(const P in this._eventsInProgress){const{handlerName:F,originalEvent:G}=this._eventsInProgress[P];this._handlersById[F].isActive()||(delete this._eventsInProgress[P],C=s[F]||G,E[`${P}end`]=C)}for(const P in E)this._fireEvent(P,E[P]);const k=va(this._eventsInProgress);if(h&&(m||y)&&!k){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;P?(F(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:C})):(this._map.fire(new o.Event("moveend",{originalEvent:C})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new qc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Al="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Wc extends o.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=o.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},s),h)}panTo(t,s,h){return this.easeTo(o.extend({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(o.extend({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(o.extend({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,o.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=o.LngLatBounds.convert(t);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,s)}_extendCameraOptions(t){const s={top:0,bottom:0,right:0,left:0};if(typeof(t=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const h=t.padding;t.padding={top:h,bottom:h,right:h,left:h}}return t.padding=o.extend(s,t.padding),t}_cameraForBoxAndBearing(t,s,h,m){const y=this._extendCameraOptions(m),v=this.transform,E=v.padding,C=v.project(o.LngLat.convert(t)),k=v.project(o.LngLat.convert(s)),P=new o.pointGeometry(C.x,k.y),F=new o.pointGeometry(k.x,C.y),G=-o.degToRad(h),X=C.rotate(G),q=k.rotate(G),N=P.rotate(G),re=F.rotate(G),Y=new o.pointGeometry(Math.max(X.x,q.x,N.x,re.x),Math.max(X.y,q.y,N.y,re.y)),te=new o.pointGeometry(Math.min(X.x,q.x,N.x,re.x),Math.min(X.y,q.y,N.y,re.y)),ie=Y.sub(te),oe=(v.width-((E.left||0)+(E.right||0)+y.padding.left+y.padding.right))/ie.x,ee=(v.height-((E.top||0)+(E.bottom||0)+y.padding.top+y.padding.bottom))/ie.y;if(ee<0||oe<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const le=Math.min(v.scaleZoom(v.scale*Math.min(oe,ee)),y.maxZoom),xe=typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new o.pointGeometry(y.offset.x,y.offset.y):o.pointGeometry.convert(y.offset),Se=new o.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(h*Math.PI/180),ze=xe.add(Se).mult(v.scale/v.zoomScale(le));return{center:v.unproject(C.add(k).div(2).sub(ze)),zoom:le,bearing:h}}_cameraForBox(t,s,h,m,y){const v=this._extendCameraOptions(y);h=h||0,m=m||0,t=o.LngLat.convert(t),s=o.LngLat.convert(s);const E=this.transform.clone();E.padding=v.padding;const C=this.getFreeCameraOptions(),k=new o.LngLat(.5*(t.lng+s.lng),.5*(t.lat+s.lat)),P=.5*(h+m);if(E._camera.position[2]<o.mercatorZfromAltitude(P,k.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");C.lookAtPoint(k),E.setFreeCameraOptions(C);const F=o.MercatorCoordinate.fromLngLat(t),G=o.MercatorCoordinate.fromLngLat(s),X=E.pointRayIntersection(E.centerPoint,P),q=[(N=E.rayIntersectionCoordinate(X)).x,N.y,N.z];var N;const re=E.screenPointToMercatorRay(E.centerPoint),Y=E.projection.name!=="globe";let te,ie=0;do{const oe=Math.floor(E.zoom),ee=1<<oe,le=Math.min(ee*F.x,ee*G.x),xe=Math.min(ee*F.y,ee*G.y),Se=Math.max(ee*F.x,ee*G.x),ze=Math.max(ee*F.y,ee*G.y),Me=new o.Aabb([le,xe,h],[Se,ze,m]),Ze=o.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,oe,Y);if(Me.intersects(Ze)!==2){te&&(E._camera.position=o.scaleAndAdd([],E._camera.position,re.dir,-te),E._updateStateFromCamera());break}const ve=o.sub([],E._camera.position,q);te=.5*o.length(ve),E._camera.position=o.scaleAndAdd([],E._camera.position,re.dir,te);try{E._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ie<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(t,s,h){return this._fitInternal(this.cameraForBounds(t,s),s,h)}_raycastElevationBox(t,s){const h=this.transform.elevation;if(!h)return;const m=new o.pointGeometry(t.x,s.y),y=new o.pointGeometry(s.x,t.y),v=h.pointCoordinate(t);if(!v)return;const E=h.pointCoordinate(s);if(!E)return;const C=h.pointCoordinate(m);if(!C)return;const k=h.pointCoordinate(y);if(!k)return;const P=new o.MercatorCoordinate(v[0],v[1]).toLngLat(),F=new o.MercatorCoordinate(E[0],E[1]).toLngLat(),G=new o.MercatorCoordinate(C[0],C[1]).toLngLat(),X=new o.MercatorCoordinate(k[0],k[1]).toLngLat(),q=Math.min(P.lng,Math.min(F.lng,Math.min(G.lng,X.lng))),N=Math.min(P.lat,Math.min(F.lat,Math.min(G.lat,X.lat))),re=Math.max(P.lng,Math.max(F.lng,Math.max(G.lng,X.lng))),Y=Math.max(P.lat,Math.max(F.lat,Math.max(G.lat,X.lat))),te=Math.min(v[3],Math.min(E[3],Math.min(C[3],k[3]))),ie=Math.max(v[3],Math.max(E[3],Math.max(C[3],k[3])));return{minLngLat:new o.LngLat(q,N),maxLngLat:new o.LngLat(re,Y),minAltitude:te,maxAltitude:ie}}fitScreenCoordinates(t,s,h,m,y){let v,E,C,k;const P=o.pointGeometry.convert(t),F=o.pointGeometry.convert(s),G=this._raycastElevationBox(P,F);if(G)v=G.minLngLat,E=G.maxLngLat,C=G.minAltitude,k=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(P,F))return this;v=this.transform.pointLocation(P),E=this.transform.pointLocation(F)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(t)),this.transform.pointLocation(o.pointGeometry.convert(s)),h,m):this._cameraForBox(v,E,C,k,m),m,y)}_fitInternal(t,s,h){return t?(delete(s=o.extend(t,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,v=!1;return"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=o.LngLat.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(y=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(v=!0,h.pitch=+t.pitch),t.padding==null||h.isPaddingEqual(t.padding)||(h.padding=t.padding),t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),m&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),y&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),v&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Al),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.warnOnce(Al),this;this.stop();const m=h.zoom,y=h.pitch,v=h.bearing;h.setFreeCameraOptions(t);const E=m!==h.zoom,C=y!==h.pitch,k=v!==h.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),E&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),k&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),C&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);const h=this.transform,m=this.getZoom(),y=this.getBearing(),v=this.getPitch(),E=this.getPadding(),C="zoom"in t?+t.zoom:m,k="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:v,F="padding"in t?t.padding:h.padding,G=o.pointGeometry.convert(t.offset);let X,q,N;if(h.projection.name==="globe"){const ze=o.MercatorCoordinate.fromLngLat(h.center),Me=G.rotate(-h.angle);ze.x+=Me.x/h.worldSize,ze.y+=Me.y/h.worldSize;const Ze=ze.toLngLat(),ve=o.LngLat.convert(t.center||Ze);this._normalizeCenter(ve),X=h.centerPoint.add(Me),q=new o.pointGeometry(ze.x,ze.y).mult(h.worldSize),N=new o.pointGeometry(o.mercatorXfromLng(ve.lng),o.mercatorYfromLat(ve.lat)).mult(h.worldSize).sub(q)}else{X=h.centerPoint.add(G);const ze=h.pointLocation(X),Me=o.LngLat.convert(t.center||ze);this._normalizeCenter(Me),q=h.project(ze),N=h.project(Me).sub(q)}const re=h.zoomScale(C-m);let Y,te;t.around&&(Y=o.LngLat.convert(t.around),te=h.locationPoint(Y));const ie=this._zooming||C!==m,oe=this._rotating||y!==k,ee=this._pitching||P!==v,le=!h.isPaddingEqual(F),xe=ze=>Me=>{if(ie&&(ze.zoom=o.number(m,C,Me)),oe&&(ze.bearing=o.number(y,k,Me)),ee&&(ze.pitch=o.number(v,P,Me)),le&&(ze.interpolatePadding(E,F,Me),X=ze.centerPoint.add(G)),Y)ze.setLocationAtPoint(Y,te);else{const Ze=ze.zoomScale(ze.zoom-m),ve=C>m?Math.min(2,re):Math.max(.5,re),qe=Math.pow(ve,1-Me),$e=ze.unproject(q.add(N.mult(Me*qe)).mult(Ze));ze.setLocationAtPoint(ze.renderWorldCopies?$e.wrap():$e,X)}return t.preloadOnly||this._fireMoveEvents(s),ze};if(t.preloadOnly){const ze=this._emulate(xe,t.duration,h);return this._preloadTiles(ze),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=oe,this._pitching=ee,this._padding=le,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Se),this._ease(xe(h),ze=>{h.recenterOnTerrain(),this._afterEase(s,ze)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!h.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new o.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.Event("zoomend",t)),m&&this.fire(new o.Event("rotateend",t)),y&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,s){if(!t.essential&&o.exported.prefersReducedMotion){const ct=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ct,s)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);const h=this.transform,m=this.getZoom(),y=this.getBearing(),v=this.getPitch(),E=this.getPadding(),C="zoom"in t?o.clamp(+t.zoom,h.minZoom,h.maxZoom):m,k="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:v,F="padding"in t?t.padding:h.padding,G=h.zoomScale(C-m),X=o.pointGeometry.convert(t.offset);let q=h.centerPoint.add(X);const N=h.pointLocation(q),re=o.LngLat.convert(t.center||N);this._normalizeCenter(re);const Y=h.project(N),te=h.project(re).sub(Y);let ie=t.curve;const oe=Math.max(h.width,h.height),ee=oe/G,le=te.mag();if("minZoom"in t){const ct=o.clamp(Math.min(t.minZoom,m,C),h.minZoom,h.maxZoom),ut=oe/h.zoomScale(ct-m);ie=Math.sqrt(ut/le*2)}const xe=ie*ie;function Se(ct){const ut=(ee*ee-oe*oe+(ct?-1:1)*xe*xe*le*le)/(2*(ct?ee:oe)*xe*le);return Math.log(Math.sqrt(ut*ut+1)-ut)}function ze(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Me(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const Ze=Se(0);let ve=function(ct){return Me(Ze)/Me(Ze+ie*ct)},qe=function(ct){return oe*((Me(Ze)*(ze(ut=Ze+ie*ct)/Me(ut))-ze(Ze))/xe)/le;var ut},$e=(Se(1)-Ze)/ie;if(Math.abs(le)<1e-6||!isFinite($e)){if(Math.abs(oe-ee)<1e-6)return this.easeTo(t,s);const ct=ee<oe?-1:1;$e=Math.abs(Math.log(ee/oe))/ie,qe=function(){return 0},ve=function(ut){return Math.exp(ct*ie*ut)}}t.duration="duration"in t?+t.duration:1e3*$e/("screenSpeed"in t?+t.screenSpeed/ie:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const dt=y!==k,Pe=P!==v,lt=!h.isPaddingEqual(F),Et=ct=>ut=>{const kt=ut*$e,qt=1/ve(kt);ct.zoom=ut===1?C:m+ct.scaleZoom(qt),dt&&(ct.bearing=o.number(y,k,ut)),Pe&&(ct.pitch=o.number(v,P,ut)),lt&&(ct.interpolatePadding(E,F,ut),q=ct.centerPoint.add(X));const vt=ut===1?re:ct.unproject(Y.add(te.mult(qe(kt))).mult(qt));return ct.setLocationAtPoint(ct.renderWorldCopies?vt.wrap():vt,q),ct._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),ct};if(t.preloadOnly){const ct=this._emulate(Et,t.duration,h);return this._preloadTiles(ct),this}return this._zooming=!0,this._rotating=dt,this._pitching=Pe,this._padding=lt,this._prepareEase(s,!1),this._ease(Et(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=o.wrap(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_emulate(t,s,h){const m=Math.ceil(15*s/1e3),y=[],v=t(h.clone());for(let E=0;E<=m;E++){const C=v(E/m);y.push(C.clone())}return y}}class bl{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact;return this._map=t,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),Z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const h=this._map._getUIString(`AttributionControl.${s}`);t.setAttribute("aria-label",h),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(t){const h=s.reduce((m,y,v)=>(y.value&&(m+=`${y.key}=${y.value}${v<s.length-1?"&":""}`),m),"?");t.href=`${o.config.FEEDBACK_URL}/${h}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const y=s[m];if(y.used){const v=y.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((m,y)=>m.length-y.length),t=t.filter((m,y)=>{for(let v=y+1;v<t.length;v++)if(t[v].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class $h{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Z("div","mapboxgl-ctrl");const s=Z("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Gh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function wl(c,t,s){if(c=new o.LngLat(c.lng,c.lat),t){const h=new o.LngLat(c.lng-360,c.lat),m=new o.LngLat(c.lng+360,c.lat),y=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),v=s.locationPoint(c).distSqr(t),E=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(h).distSqr(t)<v&&(E||Math.abs(h.lng-s.center.lng)<y)?c=h:s.locationPoint(m).distSqr(t)<v&&(E||Math.abs(m.lng-s.center.lng)<y)&&(c=m)}for(;Math.abs(c.lng-s.center.lng)>180;){const h=s.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const El={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Tl extends o.Evented{constructor(t,s){if(super(),(t instanceof o.window.HTMLElement||s)&&(t=o.extend({element:t},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=o.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z("div");const m=41,y=27,v=Q("svg",{display:"block",height:m*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${m}`},this._element),E=Q("radialGradient",{id:"shadowGradient"},Q("defs",{},v));Q("stop",{offset:"10%","stop-opacity":.4},E),Q("stop",{offset:"100%","stop-opacity":.05},E),Q("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},v),Q("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},v),Q("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},v),Q("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},v),this._offset=o.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in El)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s);let m=!1;if(t.transform._terrainEnabled()&&t.getTerrain()){const v=t.getFreeCameraOptions();if(v.position){const E=v.position.toLngLat();m=E.distanceTo(h)<.9*E.distanceTo(this._lngLat)}}const y=(1-t._queryFogOpacity(h))*(m?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t)return;const s=this._offset.mult(this._scale),h=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`
            translate(${t.x}px, ${t.y}px) ${El[this._anchor]}
            rotateX(${h}deg) rotateZ(${m}deg)
            translate(${s.x}px, ${s.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(t){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=wl(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),t===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!s.getTerrain()&&!s.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.pointGeometry.convert(t),this._update(),this}_onMove(t){const s=this._map;if(s){if(!this._isDragging){const h=this._clickTolerance||s._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map;s&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Dp{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=o.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const Bp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Xc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Aa(c){c.parentNode&&c.parentNode.removeChild(c)}const Hc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qc{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new ys({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new jc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Fe()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s),y=m&&m.bearingDelta;if(y&&h.setBearing(h.getBearing()+y),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,s),E=v&&v.pitchDelta;E&&h.setPitch(h.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ft(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Rt(this.element,t)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Rt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ke(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ke(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Br={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Gr,ba=0,Go=!1;const Yc={maxWidth:100,unit:"metric"};function Sl(c,t,s){const h=s&&s.maxWidth||100,m=c._containerHeight/2,y=c._containerWidth/2-h/2,v=c.unproject([y,m]),E=c.unproject([y+h,m]),C=v.distanceTo(E);if(s&&s.unit==="imperial"){const k=3.2808*C;k>5280?vs(t,h,k/5280,c._getUIString("ScaleControl.Miles"),c):vs(t,h,k,c._getUIString("ScaleControl.Feet"),c)}else s&&s.unit==="nautical"?vs(t,h,C/1852,c._getUIString("ScaleControl.NauticalMiles"),c):C>=1e3?vs(t,h,C/1e3,c._getUIString("ScaleControl.Kilometers"),c):vs(t,h,C,c._getUIString("ScaleControl.Meters"),c)}function vs(c,t,s,h,m){const y=function(E){const C=Math.pow(10,`${Math.floor(E)}`.length-1);let k=E/C;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(P){const F=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*F)/F}(k),C*k}(s),v=y/s;m._requestDomTask(()=>{c.style.width=t*v+"px",c.innerHTML=`${y}&nbsp;${h}`})}const en={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wa(c=new o.pointGeometry(0,0),t="bottom"){if(typeof c=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new o.pointGeometry(0,c);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-c);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(c,0);case"right":return new o.pointGeometry(-c,0)}return new o.pointGeometry(0,0)}return c instanceof o.pointGeometry||Array.isArray(c)?o.pointGeometry.convert(c):o.pointGeometry.convert(c[t]||[0,0])}const As={version:o.version,supported:L,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Wc{constructor(c){if((c=o.extend({},Xc,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(c.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _l(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._renderTaskQueue=new Gh,this._domRenderTaskQueue=new Gh,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Bp,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Dp(0),this._explicitProjection=null,this._requestManager=new o.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=o.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Nh(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new bh(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new bl({customAttribution:c.customAttribution})),this._logoControl=new $h,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),this.fire(new o.Event("resize",c)),t&&this.fire(new o.Event("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c==null?-2:c)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c==null?22:c)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c==null?0:c)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c==null?85:c)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._updateProjection(c)}_updateProjection(c){c===null&&(this._explicitProjection=null);const t=c||this.getProjection(),s=this.transform.setProjection(t);if(c&&(this._explicitProjection=this.transform.getProjection()),s){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(c){return this.transform.locationPoint3D(o.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(o.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(c,t,s){if(c==="mouseenter"||c==="mouseover"){let h=!1;const m=v=>{const E=t.filter(k=>this.getLayer(k)),C=E.length?this.queryRenderedFeatures(v.point,{layers:E}):[];C.length?h||(h=!0,s.call(this,new $r(c,this,v.originalEvent,{features:C}))):h=!1},y=()=>{h=!1};return{layers:new Set(t),listener:s,delegates:{mousemove:m,mouseout:y}}}if(c==="mouseleave"||c==="mouseout"){let h=!1;const m=v=>{const E=t.filter(C=>this.getLayer(C));(E.length?this.queryRenderedFeatures(v.point,{layers:E}):[]).length?h=!0:h&&(h=!1,s.call(this,new $r(c,this,v.originalEvent)))},y=v=>{h&&(h=!1,s.call(this,new $r(c,this,v.originalEvent)))};return{layers:new Set(t),listener:s,delegates:{mousemove:m,mouseout:y}}}{const h=m=>{const y=t.filter(E=>this.getLayer(E)),v=y.length?this.queryRenderedFeatures(m.point,{layers:y}):[];v.length&&(m.features=v,s.call(this,m),delete m.features)};return{layers:new Set(t),listener:s,delegates:{[c]:h}}}}on(c,t,s){if(s===void 0)return super.on(c,t);Array.isArray(t)||(t=[t]);const h=this._createDelegatedListener(c,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(c,t,s){if(s===void 0)return super.once(c,t);Array.isArray(t)||(t=[t]);const h=this._createDelegatedListener(c,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(c,t,s){if(s===void 0)return super.off(c,t);t=new Set(Array.isArray(t)?t:[t]);const h=(y,v)=>{if(y.size!==v.size)return!1;for(const E of y)if(!v.has(E))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[c]:void 0;return m&&(y=>{for(let v=0;v<y.length;v++){const E=y[v];if(E.listener===s&&h(E.layers,t)){for(const C in E.delegates)this.off(C,E.delegates[C]);return y.splice(v,1),this}}})(m),this}queryRenderedFeatures(c,t){return this.style?(t!==void 0||c===void 0||c instanceof o.pointGeometry||Array.isArray(c)||(t=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}queryTerrainElevation(c,t){const s=this.transform.elevation;return s?(t=o.extend({},{exaggerated:!0},t),s.getAtPoint(o.MercatorCoordinate.fromLngLat(c),null,t.exaggerated)):null}setStyle(c,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Dr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Dr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if(typeof c=="string"){const s=this._requestManager.normalizeStyleURL(c),h=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(h,(m,y)=>{m?this.fire(new o.ErrorEvent(m)):y&&this._updateDiff(y,t)})}else typeof c=="object"&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const t in c){const s=c[t]._tiles;for(const h in s){const m=s[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(c,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,s)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:y,content:v}={}){if(this._lazyInitEmptyStyle(),t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap){const{width:E,height:C,data:k}=o.exported.getImageData(t);this.style.addImage(c,{data:new o.RGBAImage({width:E,height:C},k),pixelRatio:s,stretchX:m,stretchY:y,content:v,sdf:h,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:C}=t,k=t;this.style.addImage(c,{data:new o.RGBAImage({width:E,height:C},new Uint8Array(k.data)),pixelRatio:s,stretchX:m,stretchY:y,content:v,sdf:h,version:0,userImage:k}),k.onAdd&&k.onAdd(this,c)}}updateImage(c,t){const s=this.style.getImage(c);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap?o.exported.getImageData(t):t,{width:m,height:y}=h;m!==void 0&&y!==void 0?m===s.data.width&&y===s.data.height?(s.data.replace(h.data,!(t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap)),this.style.updateImage(c,s)):this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){o.getImage(this._requestManager.transformRequest(c,o.ResourceType.Image),(s,h)=>{t(s,h instanceof o.window.HTMLImageElement?o.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,t,s){return this.style.setLayerZoomRange(c,t,s),this._update(!0)}setFilter(c,t,s={}){return this.style.setFilter(c,t,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,s,h={}){return this.style.setPaintProperty(c,t,s,h),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,s,h={}){return this.style.setLayoutProperty(c,t,s,h),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(c),this.transform):0}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,m,y=this._container;for(;y&&(!h||!m);){const v=o.window.getComputedStyle(y).transform;v&&v!=="none"&&(s=v.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),y=y.parentElement}this._containerWidth=h?Math.abs(c/h):c,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Z("div","mapboxgl-canvas-container",c);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=Z("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=Z("div","mapboxgl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{h[m]=Z("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const c=o.extend({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);t?(o.storeAuthState(t,!0),this.painter=new vh(t,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(t)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;const s=this.painter.context.extTimerQuery,h=o.exported.now();if(this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;let m=!1;const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,k=this.transform.pitch,P=o.exported.now();this.style.zoomHistory.update(C,P);const F=new o.EvaluationParameters(C,{now:P,fadeDuration:y,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=F.crossFadingFactor();G===1&&G===this._crossFadingFactor||(m=!0,this._crossFadingFactor=G),this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerUpdate()):v=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||m)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const C=o.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{const k=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new o.Event("gpu-timing-frame",{cpuTime:C,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(C);this.fire(new o.Event("gpu-timing-layer",{layerTimes:k}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(v=this._updateAverageElevation(h,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const c of this._markers)c._update()}_updateAverageElevation(c,t=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation(),y=!1;this.transform.elevation&&(y=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const v=Math.abs(h-m);if(v>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,c,300)}else if(v>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===o.AUTH_ERR_MSG||c.status===401)){const t=this.painter.context.gl;o.storeAuthState(t,!1),this._logoControl instanceof $h&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(y){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,y,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(c),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(c,t,s){let h=s[1]-s[0];const m=c.length/4;for(let y=0;y<t.length;y++){const v=t[y];let E=0;for(let C=0;C<v.length;C+=4)v[C]===c[C]&&v[C+1]===c[C+1]&&v[C+2]===c[C+2]&&v[C+3]===c[C+3]&&(E+=1);h+=(s[y+2]-s[y+1])*(1-E/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),Aa(this._canvasContainer),Aa(this._controlContainer),Aa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.exported.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(c){const t=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(t,(s,h)=>s._preloadTiles(c,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,t){o.setCacheLimits(c,t)}get version(){return o.version}},NavigationControl:class{constructor(c){this.options=o.extend({},Hc,c),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),s=t===c.getMaxZoom(),h=t===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qc(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const s=Z("button",c,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(c,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(c){super(),this.options=o.extend({},Br,c),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Vc(this._updateMarkerRotation,20)}onAdd(c){var t;return this._map=c,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Gr!==void 0?t(Gr):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(s=>{Gr=s.state!=="denied",t(Gr)}):(Gr=!!o.window.navigator.geolocation,t(Gr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,ba=0,Go=!1}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),s=c.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",c)),this._finish()}}_updateCamera(c){const t=new o.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,h=this._map.getBearing(),m=o.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new o.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map._containerHeight/2,t=this._map.unproject([0,c]),s=this._map.unproject([100,c]),h=t.distanceTo(s)/100,m=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Go)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Tl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ba--,Go=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ba++,ba>1?(c={maximumAge:6e5,timeout:0},Go=!0):(c=this.options.positionOptions,Go=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bl,ScaleControl:class{constructor(c){this.options=o.extend({},Yc,c),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Sl(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,Sl(this._map,this._container,this.options)}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof o.window.HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(c){super(),this.options=o.extend(Object.create(en),c),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(o.window.document.createTextNode(c))}setHTML(c){const t=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let h;for(s.innerHTML=c;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const s=this._closeButton=Z("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const m=s.offsetWidth,y=s.offsetHeight,v=h.x<m/2,E=h.x>t.transform.width-m/2;if(h.y+c<y)return v?"top-left":E?"top-right":"top";if(h.y>t.transform.height-y){if(v)return"bottom-left";if(E)return"bottom-right"}return v?"left":E?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=Z("div","mapboxgl-popup",t.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wl(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const m=this._pos=this._trackPointer&&c?c:t.project(this._lngLat),y=wa(this.options.offset),v=this._anchor=this._getAnchor(y.y),E=wa(this.options.offset,v),C=m.add(E).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${El[v]} translate(${C.x}px,${C.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(zi);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._content&&(this._content.style.opacity=c),this._tip&&(this._tip.style.opacity=c)}},Marker:Tl,Style:Dr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:da,Evented:o.Evented,config:o.config,prewarm:function(){Ot().acquire(Mt)},clearPrewarmedResources:function(){const c=wt;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(Mt),wt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(c){o.config.ACCESS_TOKEN=c},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(c){o.config.API_URL=c},get workerCount(){return bt.workerCount},set workerCount(c){bt.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return As});var z=w;return z})})(B0);var TC=B0.exports;function SC(a,d){return _n(),gn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[ji("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])}var f_={exports:{}},R0=function(d,g){return function(){for(var w=new Array(arguments.length),S=0;S<w.length;S++)w[S]=arguments[S];return d.apply(g,w)}},rS=R0,Qs=Object.prototype.toString;function m_(a){return Array.isArray(a)}function Lm(a){return typeof a=="undefined"}function nS(a){return a!==null&&!Lm(a)&&a.constructor!==null&&!Lm(a.constructor)&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function F0(a){return Qs.call(a)==="[object ArrayBuffer]"}function oS(a){return Qs.call(a)==="[object FormData]"}function sS(a){var d;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?d=ArrayBuffer.isView(a):d=a&&a.buffer&&F0(a.buffer),d}function aS(a){return typeof a=="string"}function lS(a){return typeof a=="number"}function O0(a){return a!==null&&typeof a=="object"}function Ud(a){if(Qs.call(a)!=="[object Object]")return!1;var d=Object.getPrototypeOf(a);return d===null||d===Object.prototype}function cS(a){return Qs.call(a)==="[object Date]"}function uS(a){return Qs.call(a)==="[object File]"}function hS(a){return Qs.call(a)==="[object Blob]"}function U0(a){return Qs.call(a)==="[object Function]"}function dS(a){return O0(a)&&U0(a.pipe)}function pS(a){return Qs.call(a)==="[object URLSearchParams]"}function fS(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function mS(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function __(a,d){if(!(a===null||typeof a=="undefined"))if(typeof a!="object"&&(a=[a]),m_(a))for(var g=0,A=a.length;g<A;g++)d.call(null,a[g],g,a);else for(var w in a)Object.prototype.hasOwnProperty.call(a,w)&&d.call(null,a[w],w,a)}function Rm(){var a={};function d(w,S){Ud(a[S])&&Ud(w)?a[S]=Rm(a[S],w):Ud(w)?a[S]=Rm({},w):m_(w)?a[S]=w.slice():a[S]=w}for(var g=0,A=arguments.length;g<A;g++)__(arguments[g],d);return a}function _S(a,d,g){return __(d,function(w,S){g&&typeof w=="function"?a[S]=rS(w,g):a[S]=w}),a}function gS(a){return a.charCodeAt(0)===65279&&(a=a.slice(1)),a}var yn={isArray:m_,isArrayBuffer:F0,isBuffer:nS,isFormData:oS,isArrayBufferView:sS,isString:aS,isNumber:lS,isObject:O0,isPlainObject:Ud,isUndefined:Lm,isDate:cS,isFile:uS,isBlob:hS,isFunction:U0,isStream:dS,isURLSearchParams:pS,isStandardBrowserEnv:mS,forEach:__,merge:Rm,extend:_S,trim:fS,stripBOM:gS},Hl=yn;function Lx(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var V0=function(d,g,A){if(!g)return d;var w;if(A)w=A(g);else if(Hl.isURLSearchParams(g))w=g.toString();else{var S=[];Hl.forEach(g,function(L,j){L===null||typeof L=="undefined"||(Hl.isArray(L)?j=j+"[]":L=[L],Hl.forEach(L,function(B){Hl.isDate(B)?B=B.toISOString():Hl.isObject(B)&&(B=JSON.stringify(B)),S.push(Lx(j)+"="+Lx(B))}))}),w=S.join("&")}if(w){var z=d.indexOf("#");z!==-1&&(d=d.slice(0,z)),d+=(d.indexOf("?")===-1?"?":"&")+w}return d},yS=yn;function pp(){this.handlers=[]}pp.prototype.use=function(d,g,A){return this.handlers.push({fulfilled:d,rejected:g,synchronous:A?A.synchronous:!1,runWhen:A?A.runWhen:null}),this.handlers.length-1};pp.prototype.eject=function(d){this.handlers[d]&&(this.handlers[d]=null)};pp.prototype.forEach=function(d){yS.forEach(this.handlers,function(A){A!==null&&d(A)})};var xS=pp,vS=yn,AS=function(d,g){vS.forEach(d,function(w,S){S!==g&&S.toUpperCase()===g.toUpperCase()&&(d[g]=w,delete d[S])})},j0=function(d,g,A,w,S){return d.config=g,A&&(d.code=A),d.request=w,d.response=S,d.isAxiosError=!0,d.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},d},N0={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bS=j0,$0=function(d,g,A,w,S){var z=new Error(d);return bS(z,g,A,w,S)},wS=$0,ES=function(d,g,A){var w=A.config.validateStatus;!A.status||!w||w(A.status)?d(A):g(wS("Request failed with status code "+A.status,A.config,null,A.request,A))},Dd=yn,TS=Dd.isStandardBrowserEnv()?function(){return{write:function(g,A,w,S,z,o){var L=[];L.push(g+"="+encodeURIComponent(A)),Dd.isNumber(w)&&L.push("expires="+new Date(w).toGMTString()),Dd.isString(S)&&L.push("path="+S),Dd.isString(z)&&L.push("domain="+z),o===!0&&L.push("secure"),document.cookie=L.join("; ")},read:function(g){var A=document.cookie.match(new RegExp("(^|;\\s*)("+g+")=([^;]*)"));return A?decodeURIComponent(A[3]):null},remove:function(g){this.write(g,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),SS=function(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)},IS=function(d,g){return g?d.replace(/\/+$/,"")+"/"+g.replace(/^\/+/,""):d},CS=SS,MS=IS,kS=function(d,g){return d&&!CS(g)?MS(d,g):g},tm=yn,zS=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],PS=function(d){var g={},A,w,S;return d&&tm.forEach(d.split(`
`),function(o){if(S=o.indexOf(":"),A=tm.trim(o.substr(0,S)).toLowerCase(),w=tm.trim(o.substr(S+1)),A){if(g[A]&&zS.indexOf(A)>=0)return;A==="set-cookie"?g[A]=(g[A]?g[A]:[]).concat([w]):g[A]=g[A]?g[A]+", "+w:w}}),g},Rx=yn,DS=Rx.isStandardBrowserEnv()?function(){var d=/(msie|trident)/i.test(navigator.userAgent),g=document.createElement("a"),A;function w(S){var z=S;return d&&(g.setAttribute("href",z),z=g.href),g.setAttribute("href",z),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:g.pathname.charAt(0)==="/"?g.pathname:"/"+g.pathname}}return A=w(window.location.href),function(z){var o=Rx.isString(z)?w(z):z;return o.protocol===A.protocol&&o.host===A.host}}():function(){return function(){return!0}}();function g_(a){this.message=a}g_.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};g_.prototype.__CANCEL__=!0;var fp=g_,Bd=yn,BS=ES,LS=TS,RS=V0,FS=kS,OS=PS,US=DS,im=$0,VS=N0,jS=fp,Fx=function(d){return new Promise(function(A,w){var S=d.data,z=d.headers,o=d.responseType,L;function j(){d.cancelToken&&d.cancelToken.unsubscribe(L),d.signal&&d.signal.removeEventListener("abort",L)}Bd.isFormData(S)&&delete z["Content-Type"];var O=new XMLHttpRequest;if(d.auth){var B=d.auth.username||"",Z=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";z.Authorization="Basic "+btoa(B+":"+Z)}var Q=FS(d.baseURL,d.url);O.open(d.method.toUpperCase(),RS(Q,d.params,d.paramsSerializer),!0),O.timeout=d.timeout;function ce(){if(!!O){var Ae="getAllResponseHeaders"in O?OS(O.getAllResponseHeaders()):null,Fe=!o||o==="text"||o==="json"?O.responseText:O.response,ft={data:Fe,status:O.status,statusText:O.statusText,headers:Ae,config:d,request:O};BS(function(mt){A(mt),j()},function(mt){w(mt),j()},ft),O=null}}if("onloadend"in O?O.onloadend=ce:O.onreadystatechange=function(){!O||O.readyState!==4||O.status===0&&!(O.responseURL&&O.responseURL.indexOf("file:")===0)||setTimeout(ce)},O.onabort=function(){!O||(w(im("Request aborted",d,"ECONNABORTED",O)),O=null)},O.onerror=function(){w(im("Network Error",d,null,O)),O=null},O.ontimeout=function(){var Fe=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",ft=d.transitional||VS;d.timeoutErrorMessage&&(Fe=d.timeoutErrorMessage),w(im(Fe,d,ft.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",O)),O=null},Bd.isStandardBrowserEnv()){var Ee=(d.withCredentials||US(Q))&&d.xsrfCookieName?LS.read(d.xsrfCookieName):void 0;Ee&&(z[d.xsrfHeaderName]=Ee)}"setRequestHeader"in O&&Bd.forEach(z,function(Fe,ft){typeof S=="undefined"&&ft.toLowerCase()==="content-type"?delete z[ft]:O.setRequestHeader(ft,Fe)}),Bd.isUndefined(d.withCredentials)||(O.withCredentials=!!d.withCredentials),o&&o!=="json"&&(O.responseType=d.responseType),typeof d.onDownloadProgress=="function"&&O.addEventListener("progress",d.onDownloadProgress),typeof d.onUploadProgress=="function"&&O.upload&&O.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(L=function(Ae){!O||(w(!Ae||Ae&&Ae.type?new jS("canceled"):Ae),O.abort(),O=null)},d.cancelToken&&d.cancelToken.subscribe(L),d.signal&&(d.signal.aborted?L():d.signal.addEventListener("abort",L))),S||(S=null),O.send(S)})},kr=yn,Ox=AS,NS=j0,$S=N0,GS={"Content-Type":"application/x-www-form-urlencoded"};function Ux(a,d){!kr.isUndefined(a)&&kr.isUndefined(a["Content-Type"])&&(a["Content-Type"]=d)}function ZS(){var a;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(a=Fx),a}function qS(a,d,g){if(kr.isString(a))try{return(d||JSON.parse)(a),kr.trim(a)}catch(A){if(A.name!=="SyntaxError")throw A}return(g||JSON.stringify)(a)}var mp={transitional:$S,adapter:ZS(),transformRequest:[function(d,g){return Ox(g,"Accept"),Ox(g,"Content-Type"),kr.isFormData(d)||kr.isArrayBuffer(d)||kr.isBuffer(d)||kr.isStream(d)||kr.isFile(d)||kr.isBlob(d)?d:kr.isArrayBufferView(d)?d.buffer:kr.isURLSearchParams(d)?(Ux(g,"application/x-www-form-urlencoded;charset=utf-8"),d.toString()):kr.isObject(d)||g&&g["Content-Type"]==="application/json"?(Ux(g,"application/json"),qS(d)):d}],transformResponse:[function(d){var g=this.transitional||mp.transitional,A=g&&g.silentJSONParsing,w=g&&g.forcedJSONParsing,S=!A&&this.responseType==="json";if(S||w&&kr.isString(d)&&d.length)try{return JSON.parse(d)}catch(z){if(S)throw z.name==="SyntaxError"?NS(z,this,"E_JSON_PARSE"):z}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};kr.forEach(["delete","get","head"],function(d){mp.headers[d]={}});kr.forEach(["post","put","patch"],function(d){mp.headers[d]=kr.merge(GS)});var y_=mp,WS=yn,XS=y_,HS=function(d,g,A){var w=this||XS;return WS.forEach(A,function(z){d=z.call(w,d,g)}),d},G0=function(d){return!!(d&&d.__CANCEL__)},Vx=yn,rm=HS,QS=G0,YS=y_,KS=fp;function nm(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new KS("canceled")}var JS=function(d){nm(d),d.headers=d.headers||{},d.data=rm.call(d,d.data,d.headers,d.transformRequest),d.headers=Vx.merge(d.headers.common||{},d.headers[d.method]||{},d.headers),Vx.forEach(["delete","get","head","post","put","patch","common"],function(w){delete d.headers[w]});var g=d.adapter||YS.adapter;return g(d).then(function(w){return nm(d),w.data=rm.call(d,w.data,w.headers,d.transformResponse),w},function(w){return QS(w)||(nm(d),w&&w.response&&(w.response.data=rm.call(d,w.response.data,w.response.headers,d.transformResponse))),Promise.reject(w)})},Sn=yn,Z0=function(d,g){g=g||{};var A={};function w(O,B){return Sn.isPlainObject(O)&&Sn.isPlainObject(B)?Sn.merge(O,B):Sn.isPlainObject(B)?Sn.merge({},B):Sn.isArray(B)?B.slice():B}function S(O){if(Sn.isUndefined(g[O])){if(!Sn.isUndefined(d[O]))return w(void 0,d[O])}else return w(d[O],g[O])}function z(O){if(!Sn.isUndefined(g[O]))return w(void 0,g[O])}function o(O){if(Sn.isUndefined(g[O])){if(!Sn.isUndefined(d[O]))return w(void 0,d[O])}else return w(void 0,g[O])}function L(O){if(O in g)return w(d[O],g[O]);if(O in d)return w(void 0,d[O])}var j={url:z,method:z,data:z,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:L};return Sn.forEach(Object.keys(d).concat(Object.keys(g)),function(B){var Z=j[B]||S,Q=Z(B);Sn.isUndefined(Q)&&Z!==L||(A[B]=Q)}),A},q0={version:"0.26.1"},eI=q0.version,x_={};["object","boolean","number","function","string","symbol"].forEach(function(a,d){x_[a]=function(A){return typeof A===a||"a"+(d<1?"n ":" ")+a}});var jx={};x_.transitional=function(d,g,A){function w(S,z){return"[Axios v"+eI+"] Transitional option '"+S+"'"+z+(A?". "+A:"")}return function(S,z,o){if(d===!1)throw new Error(w(z," has been removed"+(g?" in "+g:"")));return g&&!jx[z]&&(jx[z]=!0,console.warn(w(z," has been deprecated since v"+g+" and will be removed in the near future"))),d?d(S,z,o):!0}};function tI(a,d,g){if(typeof a!="object")throw new TypeError("options must be an object");for(var A=Object.keys(a),w=A.length;w-- >0;){var S=A[w],z=d[S];if(z){var o=a[S],L=o===void 0||z(o,S,a);if(L!==!0)throw new TypeError("option "+S+" must be "+L);continue}if(g!==!0)throw Error("Unknown option "+S)}}var iI={assertOptions:tI,validators:x_},W0=yn,rI=V0,Nx=xS,$x=JS,_p=Z0,X0=iI,Ql=X0.validators;function Ku(a){this.defaults=a,this.interceptors={request:new Nx,response:new Nx}}Ku.prototype.request=function(d,g){typeof d=="string"?(g=g||{},g.url=d):g=d||{},g=_p(this.defaults,g),g.method?g.method=g.method.toLowerCase():this.defaults.method?g.method=this.defaults.method.toLowerCase():g.method="get";var A=g.transitional;A!==void 0&&X0.assertOptions(A,{silentJSONParsing:Ql.transitional(Ql.boolean),forcedJSONParsing:Ql.transitional(Ql.boolean),clarifyTimeoutError:Ql.transitional(Ql.boolean)},!1);var w=[],S=!0;this.interceptors.request.forEach(function(Q){typeof Q.runWhen=="function"&&Q.runWhen(g)===!1||(S=S&&Q.synchronous,w.unshift(Q.fulfilled,Q.rejected))});var z=[];this.interceptors.response.forEach(function(Q){z.push(Q.fulfilled,Q.rejected)});var o;if(!S){var L=[$x,void 0];for(Array.prototype.unshift.apply(L,w),L=L.concat(z),o=Promise.resolve(g);L.length;)o=o.then(L.shift(),L.shift());return o}for(var j=g;w.length;){var O=w.shift(),B=w.shift();try{j=O(j)}catch(Z){B(Z);break}}try{o=$x(j)}catch(Z){return Promise.reject(Z)}for(;z.length;)o=o.then(z.shift(),z.shift());return o};Ku.prototype.getUri=function(d){return d=_p(this.defaults,d),rI(d.url,d.params,d.paramsSerializer).replace(/^\?/,"")};W0.forEach(["delete","get","head","options"],function(d){Ku.prototype[d]=function(g,A){return this.request(_p(A||{},{method:d,url:g,data:(A||{}).data}))}});W0.forEach(["post","put","patch"],function(d){Ku.prototype[d]=function(g,A,w){return this.request(_p(w||{},{method:d,url:g,data:A}))}});var nI=Ku,oI=fp;function lc(a){if(typeof a!="function")throw new TypeError("executor must be a function.");var d;this.promise=new Promise(function(w){d=w});var g=this;this.promise.then(function(A){if(!!g._listeners){var w,S=g._listeners.length;for(w=0;w<S;w++)g._listeners[w](A);g._listeners=null}}),this.promise.then=function(A){var w,S=new Promise(function(z){g.subscribe(z),w=z}).then(A);return S.cancel=function(){g.unsubscribe(w)},S},a(function(w){g.reason||(g.reason=new oI(w),d(g.reason))})}lc.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};lc.prototype.subscribe=function(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]};lc.prototype.unsubscribe=function(d){if(!!this._listeners){var g=this._listeners.indexOf(d);g!==-1&&this._listeners.splice(g,1)}};lc.source=function(){var d,g=new lc(function(w){d=w});return{token:g,cancel:d}};var sI=lc,aI=function(d){return function(A){return d.apply(null,A)}},lI=yn,cI=function(d){return lI.isObject(d)&&d.isAxiosError===!0},Gx=yn,uI=R0,Vd=nI,hI=Z0,dI=y_;function H0(a){var d=new Vd(a),g=uI(Vd.prototype.request,d);return Gx.extend(g,Vd.prototype,d),Gx.extend(g,d),g.create=function(w){return H0(hI(a,w))},g}var ko=H0(dI);ko.Axios=Vd;ko.Cancel=fp;ko.CancelToken=sI;ko.isCancel=G0;ko.VERSION=q0.version;ko.all=function(d){return Promise.all(d)};ko.spread=aI;ko.isAxiosError=cI;f_.exports=ko;f_.exports.default=ko;var IC=f_.exports;function Zx(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Object.keys(a).reduce((g,A)=>(d.includes(A)||(g[A]=ai(a[A])),g),{})}function Yd(a){return typeof a=="function"}function pI(a){return is(a)||rc(a)}function Q0(a,d,g,A){return a.call(A,ai(d),ai(g),A)}function Y0(a){return a.$valid!==void 0?!a.$valid:!a}function fI(a,d,g,A,w,S,z){let{$lazy:o,$rewardEarly:L}=w,j=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[],O=arguments.length>8?arguments[8]:void 0,B=arguments.length>9?arguments[9]:void 0,Z=arguments.length>10?arguments[10]:void 0;const Q=$t(!!A.value),ce=$t(0);g.value=!1;const Ee=pn([d,A].concat(j,Z),()=>{if(o&&!A.value||L&&!B.value&&!g.value)return;let Ae;try{Ae=Q0(a,d,O,z)}catch(Fe){Ae=Promise.reject(Fe)}ce.value++,g.value=!!ce.value,Q.value=!1,Promise.resolve(Ae).then(Fe=>{ce.value--,g.value=!!ce.value,S.value=Fe,Q.value=Y0(Fe)}).catch(Fe=>{ce.value--,g.value=!!ce.value,S.value=Fe,Q.value=!0})},{immediate:!0,deep:typeof d=="object"});return{$invalid:Q,$unwatch:Ee}}function mI(a,d,g,A,w,S,z,o){let{$lazy:L,$rewardEarly:j}=A;const O=()=>({}),B=zt(()=>{if(L&&!g.value||j&&!o.value)return!1;let Z=!0;try{const Q=Q0(a,d,z,S);w.value=Q,Z=Y0(Q)}catch(Q){w.value=Q}return Z});return{$unwatch:O,$invalid:B}}function _I(a,d,g,A,w,S,z,o,L,j,O){const B=$t(!1),Z=a.$params||{},Q=$t(null);let ce,Ee;a.$async?{$invalid:ce,$unwatch:Ee}=fI(a.$validator,d,B,g,A,Q,w,a.$watchTargets,L,j,O):{$invalid:ce,$unwatch:Ee}=mI(a.$validator,d,g,A,Q,w,L,j);const Ae=a.$message;return{$message:Yd(Ae)?zt(()=>Ae(Zx({$pending:B,$invalid:ce,$params:Zx(Z),$model:d,$response:Q,$validator:S,$propertyPath:o,$property:z}))):Ae||"",$params:Z,$pending:B,$invalid:ce,$response:Q,$unwatch:Ee}}function gI(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const d=ai(a),g=Object.keys(d),A={},w={},S={};return g.forEach(z=>{const o=d[z];switch(!0){case Yd(o.$validator):A[z]=o;break;case Yd(o):A[z]={$validator:o};break;case z.startsWith("$"):S[z]=o;break;default:w[z]=o}}),{rules:A,nestedValidators:w,config:S}}function yI(){}const xI="__root";function K0(a,d,g){if(g)return d?d(a()):a();try{var A=Promise.resolve(a());return d?A.then(d):A}catch(w){return Promise.reject(w)}}function vI(a,d){return K0(a,yI,d)}function AI(a,d){var g=a();return g&&g.then?g.then(d):d(g)}function bI(a){return function(){for(var d=[],g=0;g<arguments.length;g++)d[g]=arguments[g];try{return Promise.resolve(a.apply(this,d))}catch(A){return Promise.reject(A)}}}function wI(a,d,g,A,w,S,z,o,L){const j=Object.keys(a),O=A.get(w,a),B=$t(!1),Z=$t(!1),Q=$t(0);if(O){if(!O.$partial)return O;O.$unwatch(),B.value=O.$dirty.value}const ce={$dirty:B,$path:w,$touch:()=>{B.value||(B.value=!0)},$reset:()=>{B.value&&(B.value=!1)},$commit:()=>{}};return j.length?(j.forEach(Ee=>{ce[Ee]=_I(a[Ee],d,ce.$dirty,S,z,Ee,g,w,L,Z,Q)}),ce.$externalResults=zt(()=>o.value?[].concat(o.value).map((Ee,Ae)=>({$propertyPath:w,$property:g,$validator:"$externalResults",$uid:`${w}-externalResult-${Ae}`,$message:Ee,$params:{},$response:null,$pending:!1})):[]),ce.$invalid=zt(()=>{const Ee=j.some(Ae=>ai(ce[Ae].$invalid));return Z.value=Ee,!!ce.$externalResults.value.length||Ee}),ce.$pending=zt(()=>j.some(Ee=>ai(ce[Ee].$pending))),ce.$error=zt(()=>ce.$dirty.value?ce.$pending.value||ce.$invalid.value:!1),ce.$silentErrors=zt(()=>j.filter(Ee=>ai(ce[Ee].$invalid)).map(Ee=>{const Ae=ce[Ee];return Mo({$propertyPath:w,$property:g,$validator:Ee,$uid:`${w}-${Ee}`,$message:Ae.$message,$params:Ae.$params,$response:Ae.$response,$pending:Ae.$pending})}).concat(ce.$externalResults.value)),ce.$errors=zt(()=>ce.$dirty.value?ce.$silentErrors.value:[]),ce.$unwatch=()=>j.forEach(Ee=>{ce[Ee].$unwatch()}),ce.$commit=()=>{Z.value=!0,Q.value=Date.now()},A.set(w,a,ce),ce):(O&&A.set(w,a,ce),ce)}function EI(a,d,g,A,w,S,z){const o=Object.keys(a);return o.length?o.reduce((L,j)=>(L[j]=Fm({validations:a[j],state:d,key:j,parentKey:g,resultsCache:A,globalConfig:w,instance:S,externalResults:z}),L),{}):{}}function TI(a,d,g){const A=zt(()=>[d,g].filter(ce=>ce).reduce((ce,Ee)=>ce.concat(Object.values(ai(Ee))),[])),w=zt({get(){return a.$dirty.value||(A.value.length?A.value.every(ce=>ce.$dirty):!1)},set(ce){a.$dirty.value=ce}}),S=zt(()=>{const ce=ai(a.$silentErrors)||[],Ee=A.value.filter(Ae=>(ai(Ae).$silentErrors||[]).length).reduce((Ae,Fe)=>Ae.concat(...Fe.$silentErrors),[]);return ce.concat(Ee)}),z=zt(()=>{const ce=ai(a.$errors)||[],Ee=A.value.filter(Ae=>(ai(Ae).$errors||[]).length).reduce((Ae,Fe)=>Ae.concat(...Fe.$errors),[]);return ce.concat(Ee)}),o=zt(()=>A.value.some(ce=>ce.$invalid)||ai(a.$invalid)||!1),L=zt(()=>A.value.some(ce=>ai(ce.$pending))||ai(a.$pending)||!1),j=zt(()=>A.value.some(ce=>ce.$dirty)||A.value.some(ce=>ce.$anyDirty)||w.value),O=zt(()=>w.value?L.value||o.value:!1),B=()=>{a.$touch(),A.value.forEach(ce=>{ce.$touch()})},Z=()=>{a.$commit(),A.value.forEach(ce=>{ce.$commit()})},Q=()=>{a.$reset(),A.value.forEach(ce=>{ce.$reset()})};return A.value.length&&A.value.every(ce=>ce.$dirty)&&B(),{$dirty:w,$errors:z,$invalid:o,$anyDirty:j,$error:O,$pending:L,$touch:B,$reset:Q,$silentErrors:S,$commit:Z}}function Fm(a){const d=bI(function(){return It(),AI(function(){if(Ee.$rewardEarly)return li(),vI(Mn)},function(){return K0(Mn,function(){return new Promise(Bt=>{if(!Dt.value)return Bt(!We.value);const ki=pn(Dt,()=>{Bt(!We.value),ki()})})})})});let{validations:g,state:A,key:w,parentKey:S,childResults:z,resultsCache:o,globalConfig:L={},instance:j,externalResults:O}=a;const B=S?`${S}.${w}`:w,{rules:Z,nestedValidators:Q,config:ce}=gI(g),Ee=Object.assign({},L,ce),Ae=w?zt(()=>{const Bt=ai(A);return Bt?ai(Bt[w]):void 0}):A,Fe=Object.assign({},ai(O)||{}),ft=zt(()=>{const Bt=ai(O);return w?Bt?ai(Bt[w]):void 0:Bt}),Pt=wI(Z,Ae,w,o,B,Ee,j,ft,A),mt=EI(Q,Ae,B,o,Ee,j,ft),{$dirty:Rt,$errors:Ke,$invalid:We,$anyDirty:gt,$error:Tt,$pending:Dt,$touch:It,$reset:yt,$silentErrors:ti,$commit:li}=TI(Pt,mt,z),_r=w?zt({get:()=>ai(Ae),set:Bt=>{Rt.value=!0;const ki=ai(A),Sr=ai(O);Sr&&(Sr[w]=Fe[w]),Hi(ki[w])?ki[w].value=Bt:ki[w]=Bt}}):null;w&&Ee.$autoDirty&&pn(Ae,()=>{Rt.value||It();const Bt=ai(O);Bt&&(Bt[w]=Fe[w])},{flush:"sync"});function bi(Bt){return(z.value||{})[Bt]}function ui(){Hi(O)?O.value=Fe:Object.keys(Fe).length===0?Object.keys(O).forEach(Bt=>{delete O[Bt]}):Object.assign(O,Fe)}return Mo(Object.assign({},Pt,{$model:_r,$dirty:Rt,$error:Tt,$errors:Ke,$invalid:We,$anyDirty:gt,$pending:Dt,$touch:It,$reset:yt,$path:B||xI,$silentErrors:ti,$validate:d,$commit:li},z&&{$getResultsForChild:bi,$clearExternalResults:ui},mt))}class SI{constructor(){this.storage=new Map}set(d,g,A){this.storage.set(d,{rules:g,result:A})}checkRulesValidity(d,g,A){const w=Object.keys(A),S=Object.keys(g);return S.length!==w.length||!S.every(o=>w.includes(o))?!1:S.every(o=>g[o].$params?Object.keys(g[o].$params).every(L=>ai(A[o].$params[L])===ai(g[o].$params[L])):!0)}get(d,g){const A=this.storage.get(d);if(!A)return;const{rules:w,result:S}=A,z=this.checkRulesValidity(d,g,w),o=S.$unwatch?S.$unwatch:()=>({});return z?S:{$dirty:S.$dirty,$partial:!0,$unwatch:o}}}const jd={COLLECT_ALL:!0,COLLECT_NONE:!1},qx=Symbol("vuelidate#injectChildResults"),Wx=Symbol("vuelidate#removeChildResults");function II(a){let{$scope:d,instance:g}=a;const A={},w=$t([]),S=zt(()=>w.value.reduce((O,B)=>(O[B]=ai(A[B]),O),{}));function z(O,B){let{$registerAs:Z,$scope:Q,$stopPropagation:ce}=B;ce||d===jd.COLLECT_NONE||Q===jd.COLLECT_NONE||d!==jd.COLLECT_ALL&&d!==Q||(A[Z]=O,w.value.push(Z))}g.__vuelidateInjectInstances=[].concat(g.__vuelidateInjectInstances||[],z);function o(O){w.value=w.value.filter(B=>B!==O),delete A[O]}g.__vuelidateRemoveInstances=[].concat(g.__vuelidateRemoveInstances||[],o);const L=Ni(qx,[]);pr(qx,g.__vuelidateInjectInstances);const j=Ni(Wx,[]);return pr(Wx,g.__vuelidateRemoveInstances),{childResults:S,sendValidationResultsToParent:L,removeValidationResultsFromParent:j}}function J0(a){return new Proxy(a,{get(d,g){return typeof d[g]=="object"?J0(d[g]):zt(()=>d[g])}})}function CC(a,d){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};arguments.length===1&&(g=a,a=void 0,d=void 0);let{$registerAs:A,$scope:w=jd.COLLECT_ALL,$stopPropagation:S,$externalResults:z,currentVueInstance:o}=g;const L=o||ap(),j=L?L.type:{};!A&&L&&(A=`_vuelidate_${L.uid||L._uid}`);const O=$t({}),B=new SI,{childResults:Z,sendValidationResultsToParent:Q,removeValidationResultsFromParent:ce}=L?II({$scope:w,instance:L}):{childResults:$t({})};if(!a&&j.validations){const Ee=j.validations;d=$t({}),Pv(()=>{d.value=L.proxy,pn(()=>Yd(Ee)?Ee.call(d.value,new J0(d.value)):Ee,Ae=>{O.value=Fm({validations:Ae,state:d,childResults:Z,resultsCache:B,globalConfig:g,instance:L.proxy,externalResults:z||L.proxy.vuelidateExternalResults})},{immediate:!0})}),g=j.validationsConfig||g}else{const Ee=Hi(a)||pI(a)?a:Mo(a||{});pn(Ee,Ae=>{O.value=Fm({validations:Ae,state:d,childResults:Z,resultsCache:B,globalConfig:g,instance:L?L.proxy:{},externalResults:z})},{immediate:!0})}return L&&(Q.forEach(Ee=>Ee(O,{$registerAs:A,$scope:w,$stopPropagation:S})),i_(()=>ce.forEach(Ee=>Ee(A)))),zt(()=>Object.assign({},ai(O.value),Z.value))}const v_=a=>{if(a=ai(a),Array.isArray(a))return!!a.length;if(a==null)return!1;if(a===!1)return!0;if(a instanceof Date)return!isNaN(a.getTime());if(typeof a=="object"){for(let d in a)return!0;return!1}return!!String(a).length},CI=a=>(a=ai(a),Array.isArray(a)?a.length:typeof a=="object"?Object.keys(a).length:String(a).length);function qa(){for(var a=arguments.length,d=new Array(a),g=0;g<a;g++)d[g]=arguments[g];return A=>(A=ai(A),!v_(A)||d.every(w=>w.test(A)))}qa(/^[a-zA-Z]*$/);qa(/^[a-zA-Z0-9]*$/);var MI=qa(/^\d*(\.\d+)?$/),MC={$validator:MI,$message:"Value must be numeric",$params:{type:"numeric"}};const kI=/^(?:[A-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9]{2,}(?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;var zI=qa(kI),kC={$validator:zI,$message:"Value is not a valid email address",$params:{type:"email"}};function PI(a){return d=>!v_(d)||CI(d)>=ai(a)}function zC(a){return{$validator:PI(a),$message:d=>{let{$params:g}=d;return`This field should be at least ${g.min} long`},$params:{min:a,type:"minLength"}}}function DI(a){return typeof a=="string"&&(a=a.trim()),v_(a)}var PC={$validator:DI,$message:"Value is required",$params:{type:"required"}};function BI(a){return d=>ai(d)===ai(a)}function DC(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"other";return{$validator:BI(a),$message:g=>`The value must be equal to the ${d} value`,$params:{equalTo:a,otherName:d,type:"sameAs"}}}const LI=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i;qa(LI);qa(/(^[0-9]*$)|(^-[0-9]+$)/);qa(/^[-]?\d*(\.\d+)?$/);export{DC as $,HI as A,WI as B,XI as C,d2 as D,$I as E,eo as F,OI as G,GI as H,VE as I,Um as J,uC as K,pC as L,qI as M,aC as N,Mo as O,zt as P,CC as Q,jT as R,dC as S,Hv as T,_C as U,SC as V,PC as W,kC as X,IC as Y,MC as Z,zC as _,_n as a,jI as a0,nC as a1,oC as a2,rC as a3,iC as a4,YI as a5,sC as a6,QI as a7,cC as a8,UI as a9,mC as aa,hC as ab,fC as ac,xC as ad,yC as ae,ZI as af,wC as ag,ji as b,VI as c,EC as d,Zv as e,ai as f,KI as g,gn as h,NI as i,tC as j,Vm as k,TC as l,JI as m,zx as n,Ur as o,eC as p,lC as q,$t as r,bC as s,FI as t,vC as u,AC as v,Ew as w,Hi as x,gC as y,OE as z};
